<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>TauLabs: /home/jb/code/TauLabs/flight/Modules/Osd/osdgen/osdgen.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="icon_128x128.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">TauLabs
   
   </div>
   <div id="projectbrief">TauLabsfirmware</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('osdgen_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">/home/jb/code/TauLabs/flight/Modules/Osd/osdgen/osdgen.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="osdgen_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00016"></a>00016 <span class="comment">/*</span>
<a name="l00017"></a>00017 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
<a name="l00018"></a>00018 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<a name="l00019"></a>00019 <span class="comment"> * the Free Software Foundation; either version 3 of the License, or</span>
<a name="l00020"></a>00020 <span class="comment"> * (at your option) any later version.</span>
<a name="l00021"></a>00021 <span class="comment"> *</span>
<a name="l00022"></a>00022 <span class="comment"> * This program is distributed in the hope that it will be useful, but</span>
<a name="l00023"></a>00023 <span class="comment"> * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
<a name="l00024"></a>00024 <span class="comment"> * or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License</span>
<a name="l00025"></a>00025 <span class="comment"> * for more details.</span>
<a name="l00026"></a>00026 <span class="comment"> *</span>
<a name="l00027"></a>00027 <span class="comment"> * You should have received a copy of the GNU General Public License along</span>
<a name="l00028"></a>00028 <span class="comment"> * with this program; if not, write to the Free Software Foundation, Inc.,</span>
<a name="l00029"></a>00029 <span class="comment"> * 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
<a name="l00030"></a>00030 <span class="comment"> */</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="comment">// ****************</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;openpilot.h&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;physical_constants.h&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="osdgen_8h.html">osdgen.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="attitudeactual_8h.html" title="Implementation of the AttitudeActual object. This file has been automatically generated by the UAVObj...">attitudeactual.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="gpsposition_8h.html" title="Implementation of the GPSPosition object. This file has been automatically generated by the UAVObject...">gpsposition.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="homelocation_8h.html" title="Implementation of the HomeLocation object. This file has been automatically generated by the UAVObjec...">homelocation.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="gpstime_8h.html" title="Implementation of the GPSTime object. This file has been automatically generated by the UAVObjectGene...">gpstime.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="gpssatellites_8h.html" title="Implementation of the GPSSatellites object. This file has been automatically generated by the UAVObje...">gpssatellites.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="osdsettings_8h.html" title="Implementation of the OsdSettings object. This file has been automatically generated by the UAVObject...">osdsettings.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="baroaltitude_8h.html" title="Implementation of the BaroAltitude object. This file has been automatically generated by the UAVObjec...">baroaltitude.h</a>&quot;</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;fonts.h&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;font12x18.h&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;font8x10.h&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="_w_m_m_internal_8h.html" title="Include file of the WorldMagModel internal functionality.">WMMInternal.h</a>&quot;</span>
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;splash.h&quot;</span>
<a name="l00051"></a>00051 <span class="comment">/*</span>
<a name="l00052"></a>00052 <span class="comment">static uint16_t angleA=0;</span>
<a name="l00053"></a>00053 <span class="comment">static int16_t angleB=90;</span>
<a name="l00054"></a>00054 <span class="comment">static int16_t angleC=0;</span>
<a name="l00055"></a>00055 <span class="comment">static int16_t sum=2;</span>
<a name="l00056"></a>00056 <span class="comment"></span>
<a name="l00057"></a>00057 <span class="comment">static int16_t m_pitch=0;</span>
<a name="l00058"></a>00058 <span class="comment">static int16_t m_roll=0;</span>
<a name="l00059"></a>00059 <span class="comment">static int16_t m_yaw=0;</span>
<a name="l00060"></a>00060 <span class="comment">static int16_t m_batt=0;</span>
<a name="l00061"></a>00061 <span class="comment">static int16_t m_alt=0;</span>
<a name="l00062"></a>00062 <span class="comment"></span>
<a name="l00063"></a>00063 <span class="comment">static uint8_t m_gpsStatus=0;</span>
<a name="l00064"></a>00064 <span class="comment">static int32_t m_gpsLat=0;</span>
<a name="l00065"></a>00065 <span class="comment">static int32_t m_gpsLon=0;</span>
<a name="l00066"></a>00066 <span class="comment">static float m_gpsAlt=0;</span>
<a name="l00067"></a>00067 <span class="comment">static float m_gpsSpd=0;*/</span>
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="keyword">extern</span> uint8_t *<a class="code" href="group___o_s_d_g_e_n_module.html#ga52b5c0fc86a398ddf62c5b2bb383374d">draw_buffer_level</a>;
<a name="l00070"></a>00070 <span class="keyword">extern</span> uint8_t *<a class="code" href="group___o_s_d_g_e_n_module.html#ga67085db0125b910109083e4d2605d7d5">draw_buffer_mask</a>;
<a name="l00071"></a>00071 <span class="keyword">extern</span> uint8_t *<a class="code" href="group___o_s_d_g_e_n_module.html#gac6ace302511130c48032b40f32a40bb8">disp_buffer_level</a>;
<a name="l00072"></a>00072 <span class="keyword">extern</span> uint8_t *<a class="code" href="group___o_s_d_g_e_n_module.html#ga2de64a6d3102b302a9b7582d63f09485">disp_buffer_mask</a>;
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 
<a name="l00075"></a><a class="code" href="group___p_i_o_s___v_i_d_e_o.html#gac6e460448d29f05aad59dc67c3035057">00075</a> <a class="code" href="struct_t_time.html">TTime</a> <a class="code" href="group___o_s_d_g_e_n_module.html#gac6e460448d29f05aad59dc67c3035057">timex</a>;
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <span class="comment">// ****************</span>
<a name="l00078"></a>00078 <span class="comment">// Private functions</span>
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 <span class="keyword">static</span> <span class="keywordtype">void</span> osdgenTask(<span class="keywordtype">void</span> *parameters);
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 <span class="comment">// ****************</span>
<a name="l00083"></a>00083 <span class="comment">// Private constants</span>
<a name="l00084"></a>00084 <span class="preprocessor">#define LONG_TIME 0xffff</span>
<a name="l00085"></a><a class="code" href="group___p_i_o_s___v_i_d_e_o.html#ga34f96a89a1ad6c4649787dbc18e218e5">00085</a> <span class="preprocessor"></span>xSemaphoreHandle <a class="code" href="group___o_s_d_g_e_n_module.html#ga34f96a89a1ad6c4649787dbc18e218e5">osdSemaphore</a> = NULL;
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 <span class="preprocessor">#define STACK_SIZE_BYTES            4096</span>
<a name="l00088"></a>00088 <span class="preprocessor"></span>
<a name="l00089"></a>00089 <span class="preprocessor">#define TASK_PRIORITY               (tskIDLE_PRIORITY + 4)</span>
<a name="l00090"></a>00090 <span class="preprocessor"></span><span class="preprocessor">#define UPDATE_PERIOD 100</span>
<a name="l00091"></a>00091 <span class="preprocessor"></span>
<a name="l00092"></a>00092 <span class="comment">// ****************</span>
<a name="l00093"></a>00093 <span class="comment">// Private variables</span>
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <span class="keyword">static</span> xTaskHandle osdgenTaskHandle;
<a name="l00096"></a>00096 
<a name="l00097"></a><a class="code" href="structsplash_entry.html">00097</a> <span class="keyword">struct </span><a class="code" href="structsplash_entry.html">splashEntry</a>
<a name="l00098"></a>00098 {
<a name="l00099"></a><a class="code" href="structsplash_entry.html#abc2b28627fe7b0fc9344188df68bb455">00099</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structsplash_entry.html#abc2b28627fe7b0fc9344188df68bb455">width</a>, <a class="code" href="structsplash_entry.html#a270337b9f05acc774a1297f830c956d7">height</a>;
<a name="l00100"></a><a class="code" href="structsplash_entry.html#a6508f6926dabf69e7f04cec57e8f6d21">00100</a>         <span class="keyword">const</span> uint16_t *<a class="code" href="structsplash_entry.html#a6508f6926dabf69e7f04cec57e8f6d21">level</a>;
<a name="l00101"></a><a class="code" href="structsplash_entry.html#a0c3001285740dd3a0351be5565bf13d2">00101</a>         <span class="keyword">const</span> uint16_t *<a class="code" href="structsplash_entry.html#a0c3001285740dd3a0351be5565bf13d2">mask</a>;
<a name="l00102"></a>00102 };
<a name="l00103"></a>00103 
<a name="l00104"></a><a class="code" href="group___o_s_d_g_e_n_module.html#gafd73dea95bd8cae01a8225936c4c302e">00104</a> <span class="keyword">struct </span><a class="code" href="structsplash_entry.html">splashEntry</a> <a class="code" href="group___o_s_d_g_e_n_module.html#gafd73dea95bd8cae01a8225936c4c302e">splash</a>[3] = {
<a name="l00105"></a>00105         {       oplogo_width,
<a name="l00106"></a>00106                 oplogo_height,
<a name="l00107"></a>00107                 oplogo_bits,
<a name="l00108"></a>00108                 oplogo_mask_bits },
<a name="l00109"></a>00109         {       level_width,
<a name="l00110"></a>00110                 level_height,
<a name="l00111"></a>00111                 level_bits,
<a name="l00112"></a>00112                 level_mask_bits },
<a name="l00113"></a>00113         {       llama_width,
<a name="l00114"></a>00114                 llama_height,
<a name="l00115"></a>00115                 llama_bits,
<a name="l00116"></a>00116                 llama_mask_bits },
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 };
<a name="l00119"></a>00119 
<a name="l00120"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga5a45071c8d6dc7fb048d5f791831b868">00120</a> uint16_t <a class="code" href="group___o_s_d_g_e_n_module.html#ga5a45071c8d6dc7fb048d5f791831b868">mirror</a>(uint16_t source)
<a name="l00121"></a>00121 {
<a name="l00122"></a>00122         <span class="keywordtype">int</span> result = ((source &amp; 0x8000) &gt;&gt; 7) | ((source &amp; 0x4000) &gt;&gt; 5) |
<a name="l00123"></a>00123                         ((source &amp; 0x2000) &gt;&gt; 3) | ((source &amp; 0x1000) &gt;&gt; 1) |
<a name="l00124"></a>00124                         ((source &amp; 0x0800) &lt;&lt; 1) | ((source &amp; 0x0400) &lt;&lt; 3) |
<a name="l00125"></a>00125                         ((source &amp; 0x0200) &lt;&lt; 5) | ((source &amp; 0x0100) &lt;&lt; 7) |
<a name="l00126"></a>00126                         ((source &amp; 0x0080) &gt;&gt; 7) | ((source &amp; 0x0040) &gt;&gt; 5) |
<a name="l00127"></a>00127                         ((source &amp; 0x0020) &gt;&gt; 3) | ((source &amp; 0x0010) &gt;&gt; 1) |
<a name="l00128"></a>00128                         ((source &amp; 0x0008) &lt;&lt; 1) | ((source &amp; 0x0004) &lt;&lt; 3) |
<a name="l00129"></a>00129                         ((source &amp; 0x0002) &lt;&lt; 5) | ((source &amp; 0x0001) &lt;&lt; 7);
<a name="l00130"></a>00130 
<a name="l00131"></a>00131            <span class="keywordflow">return</span> result;
<a name="l00132"></a>00132 }
<a name="l00133"></a>00133 
<a name="l00134"></a><a class="code" href="group___o_s_d_g_e_n_module.html#gaef4730e1cc093c1b98a70d8e9241c3de">00134</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#gaef4730e1cc093c1b98a70d8e9241c3de">clearGraphics</a>() {
<a name="l00135"></a>00135         memset((uint8_t *) <a class="code" href="group___o_s_d_g_e_n_module.html#ga67085db0125b910109083e4d2605d7d5">draw_buffer_mask</a>, 0, GRAPHICS_WIDTH * GRAPHICS_HEIGHT);
<a name="l00136"></a>00136         memset((uint8_t *) <a class="code" href="group___o_s_d_g_e_n_module.html#ga52b5c0fc86a398ddf62c5b2bb383374d">draw_buffer_level</a>, 0, GRAPHICS_WIDTH * GRAPHICS_HEIGHT);
<a name="l00137"></a>00137 }
<a name="l00138"></a>00138 
<a name="l00139"></a><a class="code" href="group___o_s_d_g_e_n_module.html#gaddad1c4131ec096796b78d23a4082da6">00139</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#gaddad1c4131ec096796b78d23a4082da6">copyimage</a>(uint16_t offsetx, uint16_t offsety, <span class="keywordtype">int</span> image) {
<a name="l00140"></a>00140         <span class="comment">//check top/left position</span>
<a name="l00141"></a>00141         <span class="keywordflow">if</span> (!<a class="code" href="group___o_s_d_g_e_n_module.html#ga2f47e18d66eab4b942c583d519b122d8">validPos</a>(offsetx, offsety)) {
<a name="l00142"></a>00142                 <span class="keywordflow">return</span>;
<a name="l00143"></a>00143         }
<a name="l00144"></a>00144         <span class="keyword">struct </span><a class="code" href="structsplash_entry.html">splashEntry</a> splash_info;
<a name="l00145"></a>00145         splash_info = splash[image];
<a name="l00146"></a>00146         offsetx=offsetx/8;
<a name="l00147"></a>00147         <span class="keywordflow">for</span> (uint16_t y = offsety; y &lt; ((splash_info.height)+offsety); y++) {
<a name="l00148"></a>00148                 uint16_t x1=offsetx;
<a name="l00149"></a>00149                 <span class="keywordflow">for</span> (uint16_t x = offsetx; x &lt; (((splash_info.width)/16)+offsetx); x++) {
<a name="l00150"></a>00150                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga52b5c0fc86a398ddf62c5b2bb383374d">draw_buffer_level</a>[y*GRAPHICS_WIDTH+x1+1] = (uint8_t)(<a class="code" href="group___o_s_d_g_e_n_module.html#ga5a45071c8d6dc7fb048d5f791831b868">mirror</a>(splash_info.level[(y-offsety)*((splash_info.width)/16)+(x-offsetx)])&gt;&gt;8);
<a name="l00151"></a>00151                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga52b5c0fc86a398ddf62c5b2bb383374d">draw_buffer_level</a>[y*GRAPHICS_WIDTH+x1] = (uint8_t)(<a class="code" href="group___o_s_d_g_e_n_module.html#ga5a45071c8d6dc7fb048d5f791831b868">mirror</a>(splash_info.level[(y-offsety)*((splash_info.width)/16)+(x-offsetx)])&amp;0xFF);
<a name="l00152"></a>00152                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga67085db0125b910109083e4d2605d7d5">draw_buffer_mask</a>[y*GRAPHICS_WIDTH+x1+1] = (uint8_t)(<a class="code" href="group___o_s_d_g_e_n_module.html#ga5a45071c8d6dc7fb048d5f791831b868">mirror</a>(splash_info.mask[(y-offsety)*((splash_info.width)/16)+(x-offsetx)])&gt;&gt;8);
<a name="l00153"></a>00153                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga67085db0125b910109083e4d2605d7d5">draw_buffer_mask</a>[y*GRAPHICS_WIDTH+x1] = (uint8_t)(<a class="code" href="group___o_s_d_g_e_n_module.html#ga5a45071c8d6dc7fb048d5f791831b868">mirror</a>(splash_info.mask[(y-offsety)*((splash_info.width)/16)+(x-offsetx)])&amp;0xFF);
<a name="l00154"></a>00154                         x1+=2;
<a name="l00155"></a>00155                 }
<a name="l00156"></a>00156         }
<a name="l00157"></a>00157 }
<a name="l00158"></a>00158 
<a name="l00159"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga2f47e18d66eab4b942c583d519b122d8">00159</a> uint8_t <a class="code" href="group___o_s_d_g_e_n_module.html#ga2f47e18d66eab4b942c583d519b122d8">validPos</a>(uint16_t x, uint16_t y) {
<a name="l00160"></a>00160         <span class="keywordflow">if</span> ( x &lt; GRAPHICS_HDEADBAND || x &gt;= GRAPHICS_WIDTH_REAL || y &gt;= GRAPHICS_HEIGHT_REAL) {
<a name="l00161"></a>00161                 <span class="keywordflow">return</span> 0;
<a name="l00162"></a>00162         }
<a name="l00163"></a>00163         <span class="keywordflow">return</span> 1;
<a name="l00164"></a>00164 }
<a name="l00165"></a>00165 
<a name="l00166"></a>00166 <span class="comment">// Credit for this one goes to wikipedia! :-)</span>
<a name="l00167"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga62264c6d524275901f3a3f4d43a13353">00167</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga62264c6d524275901f3a3f4d43a13353">drawCircle</a>(uint16_t x0, uint16_t y0, uint16_t radius) {
<a name="l00168"></a>00168           <span class="keywordtype">int</span> f = 1 - radius;
<a name="l00169"></a>00169           <span class="keywordtype">int</span> ddF_x = 1;
<a name="l00170"></a>00170           <span class="keywordtype">int</span> ddF_y = -2 * radius;
<a name="l00171"></a>00171           <span class="keywordtype">int</span> x = 0;
<a name="l00172"></a>00172           <span class="keywordtype">int</span> y = radius;
<a name="l00173"></a>00173 
<a name="l00174"></a>00174           <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(x0, y0 + radius,1,1);
<a name="l00175"></a>00175           <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(x0, y0 - radius,1,1);
<a name="l00176"></a>00176           <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(x0 + radius, y0,1,1);
<a name="l00177"></a>00177           <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(x0 - radius, y0,1,1);
<a name="l00178"></a>00178 
<a name="l00179"></a>00179           <span class="keywordflow">while</span>(x &lt; y)
<a name="l00180"></a>00180           {
<a name="l00181"></a>00181             <span class="comment">// ddF_x == 2 * x + 1;</span>
<a name="l00182"></a>00182             <span class="comment">// ddF_y == -2 * y;</span>
<a name="l00183"></a>00183             <span class="comment">// f == x*x + y*y - radius*radius + 2*x - y + 1;</span>
<a name="l00184"></a>00184             <span class="keywordflow">if</span>(f &gt;= 0)
<a name="l00185"></a>00185             {
<a name="l00186"></a>00186               y--;
<a name="l00187"></a>00187               ddF_y += 2;
<a name="l00188"></a>00188               f += ddF_y;
<a name="l00189"></a>00189             }
<a name="l00190"></a>00190             x++;
<a name="l00191"></a>00191             ddF_x += 2;
<a name="l00192"></a>00192             f += ddF_x;
<a name="l00193"></a>00193             <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(x0 + x, y0 + y,1,1);
<a name="l00194"></a>00194             <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(x0 - x, y0 + y,1,1);
<a name="l00195"></a>00195             <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(x0 + x, y0 - y,1,1);
<a name="l00196"></a>00196             <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(x0 - x, y0 - y,1,1);
<a name="l00197"></a>00197             <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(x0 + y, y0 + x,1,1);
<a name="l00198"></a>00198             <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(x0 - y, y0 + x,1,1);
<a name="l00199"></a>00199             <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(x0 + y, y0 - x,1,1);
<a name="l00200"></a>00200             <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(x0 - y, y0 - x,1,1);
<a name="l00201"></a>00201           }
<a name="l00202"></a>00202 }
<a name="l00203"></a>00203 
<a name="l00204"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga6079548d874cda431d71e15174ff375c">00204</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga6079548d874cda431d71e15174ff375c">swap</a>(uint16_t* a, uint16_t* b) {
<a name="l00205"></a>00205         uint16_t temp = *a;
<a name="l00206"></a>00206         *a = *b;
<a name="l00207"></a>00207         *b = temp;
<a name="l00208"></a>00208 }
<a name="l00209"></a>00209 
<a name="l00210"></a>00210 
<a name="l00211"></a>00211 <span class="keyword">const</span> <span class="keyword">static</span> int8_t sinData[91] = {
<a name="l00212"></a>00212   0, 2, 3, 5, 7, 9, 10, 12, 14, 16, 17, 19, 21, 22, 24, 26, 28, 29, 31, 33,
<a name="l00213"></a>00213   34, 36, 37, 39, 41, 42, 44, 45, 47, 48, 50, 52, 53, 54, 56, 57, 59, 60, 62,
<a name="l00214"></a>00214   63, 64, 66, 67, 68, 69, 71, 72, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 84,
<a name="l00215"></a>00215   85, 86, 87, 87, 88, 89, 90, 91, 91, 92, 93, 93, 94, 95, 95, 96, 96, 97, 97,
<a name="l00216"></a>00216   97, 98, 98, 98, 99, 99, 99, 99, 100, 100, 100, 100, 100, 100};
<a name="l00217"></a>00217 
<a name="l00218"></a>00218 <span class="keyword">static</span> int8_t mySin(uint16_t angle) {
<a name="l00219"></a>00219         uint16_t pos = 0;
<a name="l00220"></a>00220         pos = angle % 360;
<a name="l00221"></a>00221         int8_t mult = 1;
<a name="l00222"></a>00222         <span class="comment">// 180-359 is same as 0-179 but negative.</span>
<a name="l00223"></a>00223         <span class="keywordflow">if</span> (pos &gt;= 180) {
<a name="l00224"></a>00224                 pos = pos - 180;
<a name="l00225"></a>00225                 mult = -1;
<a name="l00226"></a>00226         }
<a name="l00227"></a>00227         <span class="comment">// 0-89 is equal to 90-179 except backwards.</span>
<a name="l00228"></a>00228         <span class="keywordflow">if</span> (pos &gt;= 90) {
<a name="l00229"></a>00229                 pos = 180 - pos;
<a name="l00230"></a>00230         }
<a name="l00231"></a>00231         <span class="keywordflow">return</span> mult * (int8_t)(sinData[pos]);
<a name="l00232"></a>00232 }
<a name="l00233"></a>00233 
<a name="l00234"></a>00234 <span class="keyword">static</span> int8_t myCos(uint16_t angle) {
<a name="l00235"></a>00235         <span class="keywordflow">return</span> mySin(angle + 90);
<a name="l00236"></a>00236 }
<a name="l00237"></a>00237 
<a name="l00250"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga3fc15f51865688e662571a829c21a3ec">00250</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga3fc15f51865688e662571a829c21a3ec">plotFourQuadrants</a>(int32_t centerX, int32_t centerY, int32_t deltaX, int32_t deltaY)
<a name="l00251"></a>00251 {
<a name="l00252"></a>00252         <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(centerX + deltaX, centerY + deltaY,1,1);      <span class="comment">// Ist      Quadrant</span>
<a name="l00253"></a>00253         <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(centerX - deltaX, centerY + deltaY,1,1);      <span class="comment">// IInd     Quadrant</span>
<a name="l00254"></a>00254         <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(centerX - deltaX, centerY - deltaY,1,1);      <span class="comment">// IIIrd    Quadrant</span>
<a name="l00255"></a>00255         <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(centerX + deltaX, centerY - deltaY,1,1);      <span class="comment">// IVth     Quadrant</span>
<a name="l00256"></a>00256 }
<a name="l00257"></a>00257 
<a name="l00266"></a><a class="code" href="group___o_s_d_g_e_n_module.html#gad7ea00fa059e0f9ec514b43f176db91c">00266</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#gad7ea00fa059e0f9ec514b43f176db91c">ellipse</a>(<span class="keywordtype">int</span> centerX, <span class="keywordtype">int</span> centerY, <span class="keywordtype">int</span> horizontalRadius, <span class="keywordtype">int</span> verticalRadius)
<a name="l00267"></a>00267 {
<a name="l00268"></a>00268     int64_t doubleHorizontalRadius = horizontalRadius * horizontalRadius;
<a name="l00269"></a>00269     int64_t doubleVerticalRadius = verticalRadius * verticalRadius;
<a name="l00270"></a>00270 
<a name="l00271"></a>00271     int64_t <a class="code" href="group___bootloader_update.html#ga5879845a39e040157796c1d907f43d24">error</a> = doubleVerticalRadius - doubleHorizontalRadius * verticalRadius + (doubleVerticalRadius &gt;&gt; 2);
<a name="l00272"></a>00272 
<a name="l00273"></a>00273     <span class="keywordtype">int</span> x = 0;
<a name="l00274"></a>00274     <span class="keywordtype">int</span> y = verticalRadius;
<a name="l00275"></a>00275     <span class="keywordtype">int</span> deltaX = 0;
<a name="l00276"></a>00276     <span class="keywordtype">int</span> deltaY = (doubleHorizontalRadius &lt;&lt; 1) * y;
<a name="l00277"></a>00277 
<a name="l00278"></a>00278     <a class="code" href="group___o_s_d_g_e_n_module.html#ga3fc15f51865688e662571a829c21a3ec">plotFourQuadrants</a>(centerX, centerY, x, y);
<a name="l00279"></a>00279 
<a name="l00280"></a>00280     <span class="keywordflow">while</span>(deltaY &gt;= deltaX)
<a name="l00281"></a>00281     {
<a name="l00282"></a>00282           x++;
<a name="l00283"></a>00283           deltaX += (doubleVerticalRadius &lt;&lt; 1);
<a name="l00284"></a>00284 
<a name="l00285"></a>00285           error +=  deltaX + doubleVerticalRadius;
<a name="l00286"></a>00286 
<a name="l00287"></a>00287           <span class="keywordflow">if</span>(error &gt;= 0)
<a name="l00288"></a>00288           {
<a name="l00289"></a>00289                y--;
<a name="l00290"></a>00290                deltaY -= (doubleHorizontalRadius &lt;&lt; 1);
<a name="l00291"></a>00291 
<a name="l00292"></a>00292                error -= deltaY;
<a name="l00293"></a>00293           }
<a name="l00294"></a>00294           <a class="code" href="group___o_s_d_g_e_n_module.html#ga3fc15f51865688e662571a829c21a3ec">plotFourQuadrants</a>(centerX, centerY, x, y);
<a name="l00295"></a>00295     }
<a name="l00296"></a>00296 
<a name="l00297"></a>00297     error = (int64_t)(doubleVerticalRadius * (x + 1 / 2.0) * (x + 1 / 2.0) + doubleHorizontalRadius * (y - 1) * (y - 1) - doubleHorizontalRadius * doubleVerticalRadius);
<a name="l00298"></a>00298 
<a name="l00299"></a>00299     <span class="keywordflow">while</span> (y&gt;=0)
<a name="l00300"></a>00300     {
<a name="l00301"></a>00301           error += doubleHorizontalRadius;
<a name="l00302"></a>00302           y--;
<a name="l00303"></a>00303           deltaY -= (doubleHorizontalRadius&lt;&lt;1);
<a name="l00304"></a>00304           error -= deltaY;
<a name="l00305"></a>00305 
<a name="l00306"></a>00306           <span class="keywordflow">if</span>(error &lt;= 0)
<a name="l00307"></a>00307           {
<a name="l00308"></a>00308                x++;
<a name="l00309"></a>00309                deltaX += (doubleVerticalRadius &lt;&lt; 1);
<a name="l00310"></a>00310                error += deltaX;
<a name="l00311"></a>00311           }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313           <a class="code" href="group___o_s_d_g_e_n_module.html#ga3fc15f51865688e662571a829c21a3ec">plotFourQuadrants</a>(centerX, centerY, x, y);
<a name="l00314"></a>00314     }
<a name="l00315"></a>00315 }
<a name="l00316"></a>00316 
<a name="l00317"></a>00317 
<a name="l00318"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga6b10ec15d9b155e3ecdd6bac85c227a9">00318</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga6b10ec15d9b155e3ecdd6bac85c227a9">drawArrow</a>(uint16_t x, uint16_t y, uint16_t angle, uint16_t size)
<a name="l00319"></a>00319 {
<a name="l00320"></a>00320         int16_t a = myCos(angle);
<a name="l00321"></a>00321         int16_t b = mySin(angle);
<a name="l00322"></a>00322         a = (a * (size/2)) / 100;
<a name="l00323"></a>00323         b = (b * (size/2)) / 100;
<a name="l00324"></a>00324         <a class="code" href="group___o_s_d_g_e_n_module.html#ga1b12386d924769809d25c0151ca7d47f">write_line_lm</a>((x)-1 - b, (y)-1 + a, (x)-1 + b, (y)-1 - a, 1, 1); <span class="comment">//Direction line</span>
<a name="l00325"></a>00325         <span class="comment">//write_line_lm((GRAPHICS_SIZE/2)-1 + a/2, (GRAPHICS_SIZE/2)-1 + b/2, (GRAPHICS_SIZE/2)-1 - a/2, (GRAPHICS_SIZE/2)-1 - b/2, 1, 1); //Arrow bottom line</span>
<a name="l00326"></a>00326         <a class="code" href="group___o_s_d_g_e_n_module.html#ga1b12386d924769809d25c0151ca7d47f">write_line_lm</a>((x)-1 + b, (y)-1 - a, (x)-1 - a/2, (y)-1 - b/2, 1, 1); <span class="comment">// Arrow &quot;wings&quot;</span>
<a name="l00327"></a>00327         <a class="code" href="group___o_s_d_g_e_n_module.html#ga1b12386d924769809d25c0151ca7d47f">write_line_lm</a>((x)-1 + b, (y)-1 - a, (x)-1 + a/2, (y)-1 + b/2, 1, 1);
<a name="l00328"></a>00328 }
<a name="l00329"></a>00329 
<a name="l00330"></a><a class="code" href="group___o_s_d_g_e_n_module.html#gae399f433b1adebe10b6108074e73ee59">00330</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#gae399f433b1adebe10b6108074e73ee59">drawBox</a>(uint16_t x1, uint16_t y1, uint16_t x2, uint16_t y2)
<a name="l00331"></a>00331 {
<a name="l00332"></a>00332         <a class="code" href="group___o_s_d_g_e_n_module.html#ga1b12386d924769809d25c0151ca7d47f">write_line_lm</a>(x1, y1, x2, y1, 1, 1); <span class="comment">//top</span>
<a name="l00333"></a>00333         <a class="code" href="group___o_s_d_g_e_n_module.html#ga1b12386d924769809d25c0151ca7d47f">write_line_lm</a>(x1, y1, x1, y2, 1, 1); <span class="comment">//left</span>
<a name="l00334"></a>00334         <a class="code" href="group___o_s_d_g_e_n_module.html#ga1b12386d924769809d25c0151ca7d47f">write_line_lm</a>(x2, y1, x2, y2, 1, 1); <span class="comment">//right</span>
<a name="l00335"></a>00335         <a class="code" href="group___o_s_d_g_e_n_module.html#ga1b12386d924769809d25c0151ca7d47f">write_line_lm</a>(x1, y2, x2, y2, 1, 1); <span class="comment">//bottom</span>
<a name="l00336"></a>00336 }
<a name="l00337"></a>00337 
<a name="l00338"></a>00338 <span class="comment">// simple routines</span>
<a name="l00339"></a>00339 
<a name="l00340"></a>00340 <span class="comment">// SUPEROSD routines, modified</span>
<a name="l00341"></a>00341 
<a name="l00350"></a><a class="code" href="group___o_s_d_g_e_n_module.html#gabbd31ecda0c72dedfc2f0455d7dedf3e">00350</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#gabbd31ecda0c72dedfc2f0455d7dedf3e">write_pixel</a>(uint8_t *buff, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> mode)
<a name="l00351"></a>00351 {
<a name="l00352"></a>00352         CHECK_COORDS(x, y);
<a name="l00353"></a>00353         <span class="comment">// Determine the bit in the word to be set and the word</span>
<a name="l00354"></a>00354         <span class="comment">// index to set it in.</span>
<a name="l00355"></a>00355         <span class="keywordtype">int</span> bitnum = CALC_BIT_IN_WORD(x);
<a name="l00356"></a>00356         <span class="keywordtype">int</span> wordnum = CALC_BUFF_ADDR(x, y);
<a name="l00357"></a>00357         <span class="comment">// Apply a mask.</span>
<a name="l00358"></a>00358         uint16_t <a class="code" href="structsplash_entry.html#a0c3001285740dd3a0351be5565bf13d2">mask</a> = 1 &lt;&lt; (7 - bitnum);
<a name="l00359"></a>00359         WRITE_WORD_MODE(buff, wordnum, mask, mode);
<a name="l00360"></a>00360 }
<a name="l00361"></a>00361 
<a name="l00371"></a><a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">00371</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> mmode, <span class="keywordtype">int</span> lmode)
<a name="l00372"></a>00372 {
<a name="l00373"></a>00373         CHECK_COORDS(x, y);
<a name="l00374"></a>00374         <span class="comment">// Determine the bit in the word to be set and the word</span>
<a name="l00375"></a>00375         <span class="comment">// index to set it in.</span>
<a name="l00376"></a>00376         <span class="keywordtype">int</span> bitnum = CALC_BIT_IN_WORD(x);
<a name="l00377"></a>00377         <span class="keywordtype">int</span> wordnum = CALC_BUFF_ADDR(x, y);
<a name="l00378"></a>00378         <span class="comment">// Apply the masks.</span>
<a name="l00379"></a>00379         uint16_t <a class="code" href="structsplash_entry.html#a0c3001285740dd3a0351be5565bf13d2">mask</a> = 1 &lt;&lt; (7 - bitnum);
<a name="l00380"></a>00380         WRITE_WORD_MODE(<a class="code" href="group___o_s_d_g_e_n_module.html#ga67085db0125b910109083e4d2605d7d5">draw_buffer_mask</a>, wordnum, mask, mmode);
<a name="l00381"></a>00381         WRITE_WORD_MODE(<a class="code" href="group___o_s_d_g_e_n_module.html#ga52b5c0fc86a398ddf62c5b2bb383374d">draw_buffer_level</a>, wordnum, mask, lmode);
<a name="l00382"></a>00382 }
<a name="l00383"></a>00383 
<a name="l00384"></a>00384 
<a name="l00394"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga1918951dd8566c5eef5ecfd7dcd7c685">00394</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga1918951dd8566c5eef5ecfd7dcd7c685">write_hline</a>(uint8_t *buff, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x0, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x1, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> mode)
<a name="l00395"></a>00395 {
<a name="l00396"></a>00396         CLIP_COORDS(x0, y);
<a name="l00397"></a>00397         CLIP_COORDS(x1, y);
<a name="l00398"></a>00398         <span class="keywordflow">if</span>(x0 &gt; x1)
<a name="l00399"></a>00399         {
<a name="l00400"></a>00400                 SWAP(x0, x1);
<a name="l00401"></a>00401         }
<a name="l00402"></a>00402         <span class="keywordflow">if</span>(x0 == x1) <span class="keywordflow">return</span>;
<a name="l00403"></a>00403         <span class="comment">/* This is an optimised algorithm for writing horizontal lines.</span>
<a name="l00404"></a>00404 <span class="comment">         * We begin by finding the addresses of the x0 and x1 points. */</span>
<a name="l00405"></a>00405         <span class="keywordtype">int</span> addr0 = CALC_BUFF_ADDR(x0, y);
<a name="l00406"></a>00406         <span class="keywordtype">int</span> addr1 = CALC_BUFF_ADDR(x1, y);
<a name="l00407"></a>00407         <span class="keywordtype">int</span> addr0_bit = CALC_BIT_IN_WORD(x0);
<a name="l00408"></a>00408         <span class="keywordtype">int</span> addr1_bit = CALC_BIT_IN_WORD(x1);
<a name="l00409"></a>00409         <span class="keywordtype">int</span> <a class="code" href="structsplash_entry.html#a0c3001285740dd3a0351be5565bf13d2">mask</a>, mask_l, mask_r, i;
<a name="l00410"></a>00410         <span class="comment">/* If the addresses are equal, we only need to write one word</span>
<a name="l00411"></a>00411 <span class="comment">         * which is an island. */</span>
<a name="l00412"></a>00412         <span class="keywordflow">if</span>(addr0 == addr1)
<a name="l00413"></a>00413         {
<a name="l00414"></a>00414                 mask = COMPUTE_HLINE_ISLAND_MASK(addr0_bit, addr1_bit);
<a name="l00415"></a>00415                 WRITE_WORD_MODE(buff, addr0, mask, mode);
<a name="l00416"></a>00416         }
<a name="l00417"></a>00417         <span class="comment">/* Otherwise we need to write the edges and then the middle. */</span>
<a name="l00418"></a>00418         <span class="keywordflow">else</span>
<a name="l00419"></a>00419         {
<a name="l00420"></a>00420                 mask_l = COMPUTE_HLINE_EDGE_L_MASK(addr0_bit);
<a name="l00421"></a>00421                 mask_r = COMPUTE_HLINE_EDGE_R_MASK(addr1_bit);
<a name="l00422"></a>00422                 WRITE_WORD_MODE(buff, addr0, mask_l, mode);
<a name="l00423"></a>00423                 WRITE_WORD_MODE(buff, addr1, mask_r, mode);
<a name="l00424"></a>00424                 <span class="comment">// Now write 0xffff words from start+1 to end-1.</span>
<a name="l00425"></a>00425                 <span class="keywordflow">for</span>(i = addr0 + 1; i &lt;= addr1 - 1; i++)
<a name="l00426"></a>00426                 {
<a name="l00427"></a>00427                         uint8_t m=0xff;
<a name="l00428"></a>00428                         WRITE_WORD_MODE(buff, i, m, mode);
<a name="l00429"></a>00429                 }
<a name="l00430"></a>00430         }
<a name="l00431"></a>00431 }
<a name="l00432"></a>00432 
<a name="l00442"></a><a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">00442</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x0, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x1, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> lmode, <span class="keywordtype">int</span> mmode)
<a name="l00443"></a>00443 {
<a name="l00444"></a>00444         <span class="comment">// TODO: an optimisation would compute the masks and apply to</span>
<a name="l00445"></a>00445         <span class="comment">// both buffers simultaneously.</span>
<a name="l00446"></a>00446         <a class="code" href="group___o_s_d_g_e_n_module.html#ga1918951dd8566c5eef5ecfd7dcd7c685">write_hline</a>(<a class="code" href="group___o_s_d_g_e_n_module.html#ga52b5c0fc86a398ddf62c5b2bb383374d">draw_buffer_level</a>, x0, x1, y, lmode);
<a name="l00447"></a>00447         <a class="code" href="group___o_s_d_g_e_n_module.html#ga1918951dd8566c5eef5ecfd7dcd7c685">write_hline</a>(<a class="code" href="group___o_s_d_g_e_n_module.html#ga67085db0125b910109083e4d2605d7d5">draw_buffer_mask</a>, x0, x1, y, mmode);
<a name="l00448"></a>00448 }
<a name="l00449"></a>00449 
<a name="l00462"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga093e7b26837226a19a69ea698d6db954">00462</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga093e7b26837226a19a69ea698d6db954">write_hline_outlined</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x0, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x1, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> endcap0, <span class="keywordtype">int</span> endcap1, <span class="keywordtype">int</span> mode, <span class="keywordtype">int</span> mmode)
<a name="l00463"></a>00463 {
<a name="l00464"></a>00464         <span class="keywordtype">int</span> stroke, fill;
<a name="l00465"></a>00465         SETUP_STROKE_FILL(stroke, fill, mode)
<a name="l00466"></a>00466         <span class="keywordflow">if</span>(x0 &gt; x1)
<a name="l00467"></a>00467         {
<a name="l00468"></a>00468                 SWAP(x0, x1);
<a name="l00469"></a>00469         }
<a name="l00470"></a>00470         <span class="comment">// Draw the main body of the line.</span>
<a name="l00471"></a>00471         <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>(x0 + 1, x1 - 1, y - 1, stroke, mmode);
<a name="l00472"></a>00472         <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>(x0 + 1, x1 - 1, y + 1, stroke, mmode);
<a name="l00473"></a>00473         <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>(x0 + 1, x1 - 1, y, fill, mmode);
<a name="l00474"></a>00474         <span class="comment">// Draw the endcaps, if any.</span>
<a name="l00475"></a>00475         DRAW_ENDCAP_HLINE(endcap0, x0, y, stroke, fill, mmode);
<a name="l00476"></a>00476         DRAW_ENDCAP_HLINE(endcap1, x1, y, stroke, fill, mmode);
<a name="l00477"></a>00477 }
<a name="l00478"></a>00478 
<a name="l00488"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga34c98ce736d5146c81ef3b167780031f">00488</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga34c98ce736d5146c81ef3b167780031f">write_vline</a>(uint8_t *buff, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y0, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> mode)
<a name="l00489"></a>00489 {
<a name="l00490"></a>00490         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> a;
<a name="l00491"></a>00491         CLIP_COORDS(x, y0);
<a name="l00492"></a>00492         CLIP_COORDS(x, y1);
<a name="l00493"></a>00493         <span class="keywordflow">if</span>(y0 &gt; y1)
<a name="l00494"></a>00494         {
<a name="l00495"></a>00495                 SWAP(y0, y1);
<a name="l00496"></a>00496         }
<a name="l00497"></a>00497         <span class="keywordflow">if</span>(y0 == y1) <span class="keywordflow">return</span>;
<a name="l00498"></a>00498         <span class="comment">/* This is an optimised algorithm for writing vertical lines.</span>
<a name="l00499"></a>00499 <span class="comment">         * We begin by finding the addresses of the x,y0 and x,y1 points. */</span>
<a name="l00500"></a>00500         <span class="keywordtype">int</span> addr0 = CALC_BUFF_ADDR(x, y0);
<a name="l00501"></a>00501         <span class="keywordtype">int</span> addr1 = CALC_BUFF_ADDR(x, y1);
<a name="l00502"></a>00502         <span class="comment">/* Then we calculate the pixel data to be written. */</span>
<a name="l00503"></a>00503         <span class="keywordtype">int</span> bitnum = CALC_BIT_IN_WORD(x);
<a name="l00504"></a>00504         uint16_t <a class="code" href="structsplash_entry.html#a0c3001285740dd3a0351be5565bf13d2">mask</a> = 1 &lt;&lt; (7 - bitnum);
<a name="l00505"></a>00505         <span class="comment">/* Run from addr0 to addr1 placing pixels. Increment by the number</span>
<a name="l00506"></a>00506 <span class="comment">         * of words n each graphics line. */</span>
<a name="l00507"></a>00507         <span class="keywordflow">for</span>(a = addr0; a &lt;= addr1; a += GRAPHICS_WIDTH_REAL / 8)
<a name="l00508"></a>00508         {
<a name="l00509"></a>00509                 WRITE_WORD_MODE(buff, a, mask, mode);
<a name="l00510"></a>00510         }
<a name="l00511"></a>00511 }
<a name="l00512"></a>00512 
<a name="l00522"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga4ab8daa08074c7ccb69b2f8a1d834979">00522</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga4ab8daa08074c7ccb69b2f8a1d834979">write_vline_lm</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y0, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> lmode, <span class="keywordtype">int</span> mmode)
<a name="l00523"></a>00523 {
<a name="l00524"></a>00524         <span class="comment">// TODO: an optimisation would compute the masks and apply to</span>
<a name="l00525"></a>00525         <span class="comment">// both buffers simultaneously.</span>
<a name="l00526"></a>00526         <a class="code" href="group___o_s_d_g_e_n_module.html#ga34c98ce736d5146c81ef3b167780031f">write_vline</a>(<a class="code" href="group___o_s_d_g_e_n_module.html#ga52b5c0fc86a398ddf62c5b2bb383374d">draw_buffer_level</a>, x, y0, y1, lmode);
<a name="l00527"></a>00527         <a class="code" href="group___o_s_d_g_e_n_module.html#ga34c98ce736d5146c81ef3b167780031f">write_vline</a>(<a class="code" href="group___o_s_d_g_e_n_module.html#ga67085db0125b910109083e4d2605d7d5">draw_buffer_mask</a>, x, y0, y1, mmode);
<a name="l00528"></a>00528 }
<a name="l00529"></a>00529 
<a name="l00542"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga0587de2636d0acd501858f056b6ad4da">00542</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga0587de2636d0acd501858f056b6ad4da">write_vline_outlined</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y0, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> endcap0, <span class="keywordtype">int</span> endcap1, <span class="keywordtype">int</span> mode, <span class="keywordtype">int</span> mmode)
<a name="l00543"></a>00543 {
<a name="l00544"></a>00544         <span class="keywordtype">int</span> stroke, fill;
<a name="l00545"></a>00545         <span class="keywordflow">if</span>(y0 &gt; y1)
<a name="l00546"></a>00546         {
<a name="l00547"></a>00547                 SWAP(y0, y1);
<a name="l00548"></a>00548         }
<a name="l00549"></a>00549         SETUP_STROKE_FILL(stroke, fill, mode);
<a name="l00550"></a>00550         <span class="comment">// Draw the main body of the line.</span>
<a name="l00551"></a>00551         <a class="code" href="group___o_s_d_g_e_n_module.html#ga4ab8daa08074c7ccb69b2f8a1d834979">write_vline_lm</a>(x - 1, y0 + 1, y1 - 1, stroke, mmode);
<a name="l00552"></a>00552         <a class="code" href="group___o_s_d_g_e_n_module.html#ga4ab8daa08074c7ccb69b2f8a1d834979">write_vline_lm</a>(x + 1, y0 + 1, y1 - 1, stroke, mmode);
<a name="l00553"></a>00553         <a class="code" href="group___o_s_d_g_e_n_module.html#ga4ab8daa08074c7ccb69b2f8a1d834979">write_vline_lm</a>(x, y0 + 1, y1 - 1, fill, mmode);
<a name="l00554"></a>00554         <span class="comment">// Draw the endcaps, if any.</span>
<a name="l00555"></a>00555         DRAW_ENDCAP_VLINE(endcap0, x, y0, stroke, fill, mmode);
<a name="l00556"></a>00556         DRAW_ENDCAP_VLINE(endcap1, x, y1, stroke, fill, mmode);
<a name="l00557"></a>00557 }
<a name="l00558"></a>00558 
<a name="l00573"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga66c619079158f1694d8cc86f109ba91e">00573</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga66c619079158f1694d8cc86f109ba91e">write_filled_rectangle</a>(uint8_t *buff, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structsplash_entry.html#abc2b28627fe7b0fc9344188df68bb455">width</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structsplash_entry.html#a270337b9f05acc774a1297f830c956d7">height</a>, <span class="keywordtype">int</span> mode)
<a name="l00574"></a>00574 {
<a name="l00575"></a>00575         <span class="keywordtype">int</span> yy, addr0_old, addr1_old;
<a name="l00576"></a>00576         CHECK_COORDS(x, y);
<a name="l00577"></a>00577         CHECK_COORD_X(x + width);
<a name="l00578"></a>00578         CHECK_COORD_Y(y + height);
<a name="l00579"></a>00579         <span class="keywordflow">if</span>(width &lt;= 0 || height &lt;= 0) <span class="keywordflow">return</span>;
<a name="l00580"></a>00580         <span class="comment">// Calculate as if the rectangle was only a horizontal line. We then</span>
<a name="l00581"></a>00581         <span class="comment">// step these addresses through each row until we iterate `height` times.</span>
<a name="l00582"></a>00582         <span class="keywordtype">int</span> addr0 = CALC_BUFF_ADDR(x, y);
<a name="l00583"></a>00583         <span class="keywordtype">int</span> addr1 = CALC_BUFF_ADDR(x + width, y);
<a name="l00584"></a>00584         <span class="keywordtype">int</span> addr0_bit = CALC_BIT_IN_WORD(x);
<a name="l00585"></a>00585         <span class="keywordtype">int</span> addr1_bit = CALC_BIT_IN_WORD(x + width);
<a name="l00586"></a>00586         <span class="keywordtype">int</span> <a class="code" href="structsplash_entry.html#a0c3001285740dd3a0351be5565bf13d2">mask</a>, mask_l, mask_r, i;
<a name="l00587"></a>00587         <span class="comment">// If the addresses are equal, we need to write one word vertically.</span>
<a name="l00588"></a>00588         <span class="keywordflow">if</span>(addr0 == addr1)
<a name="l00589"></a>00589         {
<a name="l00590"></a>00590                 mask = COMPUTE_HLINE_ISLAND_MASK(addr0_bit, addr1_bit);
<a name="l00591"></a>00591                 <span class="keywordflow">while</span>(height--)
<a name="l00592"></a>00592                 {
<a name="l00593"></a>00593                         WRITE_WORD_MODE(buff, addr0, mask, mode);
<a name="l00594"></a>00594                         addr0 += GRAPHICS_WIDTH_REAL / 8;
<a name="l00595"></a>00595                 }
<a name="l00596"></a>00596         }
<a name="l00597"></a>00597         <span class="comment">// Otherwise we need to write the edges and then the middle repeatedly.</span>
<a name="l00598"></a>00598         <span class="keywordflow">else</span>
<a name="l00599"></a>00599         {
<a name="l00600"></a>00600                 mask_l = COMPUTE_HLINE_EDGE_L_MASK(addr0_bit);
<a name="l00601"></a>00601                 mask_r = COMPUTE_HLINE_EDGE_R_MASK(addr1_bit);
<a name="l00602"></a>00602                 <span class="comment">// Write edges first.</span>
<a name="l00603"></a>00603                 yy = 0;
<a name="l00604"></a>00604                 addr0_old = addr0;
<a name="l00605"></a>00605                 addr1_old = addr1;
<a name="l00606"></a>00606                 <span class="keywordflow">while</span>(yy &lt; height)
<a name="l00607"></a>00607                 {
<a name="l00608"></a>00608                         WRITE_WORD_MODE(buff, addr0, mask_l, mode);
<a name="l00609"></a>00609                         WRITE_WORD_MODE(buff, addr1, mask_r, mode);
<a name="l00610"></a>00610                         addr0 += GRAPHICS_WIDTH_REAL / 8;
<a name="l00611"></a>00611                         addr1 += GRAPHICS_WIDTH_REAL / 8;
<a name="l00612"></a>00612                         yy++;
<a name="l00613"></a>00613                 }
<a name="l00614"></a>00614                 <span class="comment">// Now write 0xffff words from start+1 to end-1 for each row.</span>
<a name="l00615"></a>00615                 yy = 0;
<a name="l00616"></a>00616                 addr0 = addr0_old;
<a name="l00617"></a>00617                 addr1 = addr1_old;
<a name="l00618"></a>00618                 <span class="keywordflow">while</span>(yy &lt; height)
<a name="l00619"></a>00619                 {
<a name="l00620"></a>00620                         <span class="keywordflow">for</span>(i = addr0 + 1; i &lt;= addr1 - 1; i++)
<a name="l00621"></a>00621                         {
<a name="l00622"></a>00622                                 uint8_t m=0xff;
<a name="l00623"></a>00623                             WRITE_WORD_MODE(buff, i, m, mode);
<a name="l00624"></a>00624                         }
<a name="l00625"></a>00625                         addr0 += GRAPHICS_WIDTH_REAL / 8;
<a name="l00626"></a>00626                         addr1 += GRAPHICS_WIDTH_REAL / 8;
<a name="l00627"></a>00627                         yy++;
<a name="l00628"></a>00628                 }
<a name="l00629"></a>00629         }
<a name="l00630"></a>00630 }
<a name="l00631"></a>00631 
<a name="l00642"></a><a class="code" href="group___o_s_d_g_e_n_module.html#gafdf87d4c22a0fcb603bdfba416768248">00642</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#gafdf87d4c22a0fcb603bdfba416768248">write_filled_rectangle_lm</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structsplash_entry.html#abc2b28627fe7b0fc9344188df68bb455">width</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structsplash_entry.html#a270337b9f05acc774a1297f830c956d7">height</a>, <span class="keywordtype">int</span> lmode, <span class="keywordtype">int</span> mmode)
<a name="l00643"></a>00643 {
<a name="l00644"></a>00644         <a class="code" href="group___o_s_d_g_e_n_module.html#ga66c619079158f1694d8cc86f109ba91e">write_filled_rectangle</a>(<a class="code" href="group___o_s_d_g_e_n_module.html#ga67085db0125b910109083e4d2605d7d5">draw_buffer_mask</a>, x, y, width, height, mmode);
<a name="l00645"></a>00645         <a class="code" href="group___o_s_d_g_e_n_module.html#ga66c619079158f1694d8cc86f109ba91e">write_filled_rectangle</a>(<a class="code" href="group___o_s_d_g_e_n_module.html#ga52b5c0fc86a398ddf62c5b2bb383374d">draw_buffer_level</a>, x, y, width, height, lmode);
<a name="l00646"></a>00646 }
<a name="l00647"></a>00647 
<a name="l00659"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga761aea940799fbd6d4f6bafe83ea2032">00659</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga761aea940799fbd6d4f6bafe83ea2032">write_rectangle_outlined</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> <a class="code" href="structsplash_entry.html#abc2b28627fe7b0fc9344188df68bb455">width</a>, <span class="keywordtype">int</span> <a class="code" href="structsplash_entry.html#a270337b9f05acc774a1297f830c956d7">height</a>, <span class="keywordtype">int</span> mode, <span class="keywordtype">int</span> mmode)
<a name="l00660"></a>00660 {
<a name="l00661"></a>00661         <span class="comment">//CHECK_COORDS(x, y);</span>
<a name="l00662"></a>00662         <span class="comment">//CHECK_COORDS(x + width, y + height);</span>
<a name="l00663"></a>00663         <span class="comment">//if((x + width) &gt; DISP_WIDTH) width = DISP_WIDTH - x;</span>
<a name="l00664"></a>00664         <span class="comment">//if((y + height) &gt; DISP_HEIGHT) height = DISP_HEIGHT - y;</span>
<a name="l00665"></a>00665         <a class="code" href="group___o_s_d_g_e_n_module.html#ga093e7b26837226a19a69ea698d6db954">write_hline_outlined</a>(x, x + width, y, ENDCAP_ROUND, ENDCAP_ROUND, mode, mmode);
<a name="l00666"></a>00666         <a class="code" href="group___o_s_d_g_e_n_module.html#ga093e7b26837226a19a69ea698d6db954">write_hline_outlined</a>(x, x + width, y + height, ENDCAP_ROUND, ENDCAP_ROUND, mode, mmode);
<a name="l00667"></a>00667         <a class="code" href="group___o_s_d_g_e_n_module.html#ga0587de2636d0acd501858f056b6ad4da">write_vline_outlined</a>(x, y, y + height, ENDCAP_ROUND, ENDCAP_ROUND, mode, mmode);
<a name="l00668"></a>00668         <a class="code" href="group___o_s_d_g_e_n_module.html#ga0587de2636d0acd501858f056b6ad4da">write_vline_outlined</a>(x + width, y, y + height, ENDCAP_ROUND, ENDCAP_ROUND, mode, mmode);
<a name="l00669"></a>00669 }
<a name="l00670"></a>00670 
<a name="l00682"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga634e8149f811d4bb090d50b25064907c">00682</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga634e8149f811d4bb090d50b25064907c">write_circle</a>(uint8_t *buff, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cx, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cy, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> r, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dashp, <span class="keywordtype">int</span> mode)
<a name="l00683"></a>00683 {
<a name="l00684"></a>00684         CHECK_COORDS(cx, cy);
<a name="l00685"></a>00685         <span class="keywordtype">int</span> <a class="code" href="group___bootloader_update.html#ga5879845a39e040157796c1d907f43d24">error</a> = -r, x = r, y = 0;
<a name="l00686"></a>00686         <span class="keywordflow">while</span>(x &gt;= y)
<a name="l00687"></a>00687         {
<a name="l00688"></a>00688                 <span class="keywordflow">if</span>(dashp == 0 || (y % dashp) &lt; (dashp / 2))
<a name="l00689"></a>00689                 {
<a name="l00690"></a>00690                         CIRCLE_PLOT_8(buff, cx, cy, x, y, mode);
<a name="l00691"></a>00691                 }
<a name="l00692"></a>00692                 error += (y * 2) + 1;
<a name="l00693"></a>00693                 y++;
<a name="l00694"></a>00694                 <span class="keywordflow">if</span>(error &gt;= 0)
<a name="l00695"></a>00695                 {
<a name="l00696"></a>00696                         --x;
<a name="l00697"></a>00697                         error -= x * 2;
<a name="l00698"></a>00698                 }
<a name="l00699"></a>00699         }
<a name="l00700"></a>00700 }
<a name="l00701"></a>00701 
<a name="l00713"></a><a class="code" href="group___o_s_d_g_e_n_module.html#gaa58af239ed159652cb196f745c79d9a6">00713</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#gaa58af239ed159652cb196f745c79d9a6">write_circle_outlined</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cx, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cy, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> r, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dashp, <span class="keywordtype">int</span> bmode, <span class="keywordtype">int</span> mode, <span class="keywordtype">int</span> mmode)
<a name="l00714"></a>00714 {
<a name="l00715"></a>00715         <span class="keywordtype">int</span> stroke, fill;
<a name="l00716"></a>00716         CHECK_COORDS(cx, cy);
<a name="l00717"></a>00717         SETUP_STROKE_FILL(stroke, fill, mode);
<a name="l00718"></a>00718         <span class="comment">// This is a two step procedure. First, we draw the outline of the</span>
<a name="l00719"></a>00719         <span class="comment">// circle, then we draw the inner part.</span>
<a name="l00720"></a>00720         <span class="keywordtype">int</span> <a class="code" href="group___bootloader_update.html#ga5879845a39e040157796c1d907f43d24">error</a> = -r, x = r, y = 0;
<a name="l00721"></a>00721         <span class="keywordflow">while</span>(x &gt;= y)
<a name="l00722"></a>00722         {
<a name="l00723"></a>00723                 <span class="keywordflow">if</span>(dashp == 0 || (y % dashp) &lt; (dashp / 2))
<a name="l00724"></a>00724                 {
<a name="l00725"></a>00725                         CIRCLE_PLOT_8(<a class="code" href="group___o_s_d_g_e_n_module.html#ga67085db0125b910109083e4d2605d7d5">draw_buffer_mask</a>, cx, cy, x + 1, y, mmode);
<a name="l00726"></a>00726                         CIRCLE_PLOT_8(<a class="code" href="group___o_s_d_g_e_n_module.html#ga52b5c0fc86a398ddf62c5b2bb383374d">draw_buffer_level</a>, cx, cy, x + 1, y, stroke);
<a name="l00727"></a>00727                         CIRCLE_PLOT_8(<a class="code" href="group___o_s_d_g_e_n_module.html#ga67085db0125b910109083e4d2605d7d5">draw_buffer_mask</a>, cx, cy, x, y + 1, mmode);
<a name="l00728"></a>00728                         CIRCLE_PLOT_8(<a class="code" href="group___o_s_d_g_e_n_module.html#ga52b5c0fc86a398ddf62c5b2bb383374d">draw_buffer_level</a>, cx, cy, x, y + 1, stroke);
<a name="l00729"></a>00729                         CIRCLE_PLOT_8(<a class="code" href="group___o_s_d_g_e_n_module.html#ga67085db0125b910109083e4d2605d7d5">draw_buffer_mask</a>, cx, cy, x - 1, y, mmode);
<a name="l00730"></a>00730                         CIRCLE_PLOT_8(<a class="code" href="group___o_s_d_g_e_n_module.html#ga52b5c0fc86a398ddf62c5b2bb383374d">draw_buffer_level</a>, cx, cy, x - 1, y, stroke);
<a name="l00731"></a>00731                         CIRCLE_PLOT_8(<a class="code" href="group___o_s_d_g_e_n_module.html#ga67085db0125b910109083e4d2605d7d5">draw_buffer_mask</a>, cx, cy, x, y - 1, mmode);
<a name="l00732"></a>00732                         CIRCLE_PLOT_8(<a class="code" href="group___o_s_d_g_e_n_module.html#ga52b5c0fc86a398ddf62c5b2bb383374d">draw_buffer_level</a>, cx, cy, x, y - 1, stroke);
<a name="l00733"></a>00733                         <span class="keywordflow">if</span>(bmode == 1)
<a name="l00734"></a>00734                         {
<a name="l00735"></a>00735                                 CIRCLE_PLOT_8(<a class="code" href="group___o_s_d_g_e_n_module.html#ga67085db0125b910109083e4d2605d7d5">draw_buffer_mask</a>, cx, cy, x + 1, y + 1, mmode);
<a name="l00736"></a>00736                                 CIRCLE_PLOT_8(<a class="code" href="group___o_s_d_g_e_n_module.html#ga52b5c0fc86a398ddf62c5b2bb383374d">draw_buffer_level</a>, cx, cy, x + 1, y + 1, stroke);
<a name="l00737"></a>00737                                 CIRCLE_PLOT_8(<a class="code" href="group___o_s_d_g_e_n_module.html#ga67085db0125b910109083e4d2605d7d5">draw_buffer_mask</a>, cx, cy, x - 1, y - 1, mmode);
<a name="l00738"></a>00738                                 CIRCLE_PLOT_8(<a class="code" href="group___o_s_d_g_e_n_module.html#ga52b5c0fc86a398ddf62c5b2bb383374d">draw_buffer_level</a>, cx, cy, x - 1, y - 1, stroke);
<a name="l00739"></a>00739                         }
<a name="l00740"></a>00740                 }
<a name="l00741"></a>00741                 error += (y * 2) + 1;
<a name="l00742"></a>00742                 y++;
<a name="l00743"></a>00743                 <span class="keywordflow">if</span>(error &gt;= 0)
<a name="l00744"></a>00744                 {
<a name="l00745"></a>00745                         --x;
<a name="l00746"></a>00746                         error -= x * 2;
<a name="l00747"></a>00747                 }
<a name="l00748"></a>00748         }
<a name="l00749"></a>00749         error = -r;
<a name="l00750"></a>00750         x = r;
<a name="l00751"></a>00751         y = 0;
<a name="l00752"></a>00752         <span class="keywordflow">while</span>(x &gt;= y)
<a name="l00753"></a>00753         {
<a name="l00754"></a>00754                 <span class="keywordflow">if</span>(dashp == 0 || (y % dashp) &lt; (dashp / 2))
<a name="l00755"></a>00755                 {
<a name="l00756"></a>00756                         CIRCLE_PLOT_8(<a class="code" href="group___o_s_d_g_e_n_module.html#ga67085db0125b910109083e4d2605d7d5">draw_buffer_mask</a>, cx, cy, x, y, mmode);
<a name="l00757"></a>00757                         CIRCLE_PLOT_8(<a class="code" href="group___o_s_d_g_e_n_module.html#ga52b5c0fc86a398ddf62c5b2bb383374d">draw_buffer_level</a>, cx, cy, x, y, fill);
<a name="l00758"></a>00758                 }
<a name="l00759"></a>00759                 error += (y * 2) + 1;
<a name="l00760"></a>00760                 y++;
<a name="l00761"></a>00761                 <span class="keywordflow">if</span>(error &gt;= 0)
<a name="l00762"></a>00762                 {
<a name="l00763"></a>00763                         --x;
<a name="l00764"></a>00764                         error -= x * 2;
<a name="l00765"></a>00765                 }
<a name="l00766"></a>00766         }
<a name="l00767"></a>00767 }
<a name="l00768"></a>00768 
<a name="l00778"></a><a class="code" href="group___o_s_d_g_e_n_module.html#gaf369bd7c0a15859e4a35ac7a6bf77263">00778</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#gaf369bd7c0a15859e4a35ac7a6bf77263">write_circle_filled</a>(uint8_t *buff, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cx, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cy, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> r, <span class="keywordtype">int</span> mode)
<a name="l00779"></a>00779 {
<a name="l00780"></a>00780         CHECK_COORDS(cx, cy);
<a name="l00781"></a>00781         <span class="keywordtype">int</span> <a class="code" href="group___bootloader_update.html#ga5879845a39e040157796c1d907f43d24">error</a> = -r, x = r, y = 0, xch = 0;
<a name="l00782"></a>00782         <span class="comment">// It turns out that filled circles can take advantage of the midpoint</span>
<a name="l00783"></a>00783         <span class="comment">// circle algorithm. We simply draw very fast horizontal lines across each</span>
<a name="l00784"></a>00784         <span class="comment">// pair of X,Y coordinates. In some cases, this can even be faster than</span>
<a name="l00785"></a>00785         <span class="comment">// drawing an outlined circle!</span>
<a name="l00786"></a>00786         <span class="comment">//</span>
<a name="l00787"></a>00787         <span class="comment">// Due to multiple writes to each set of pixels, we have a special exception</span>
<a name="l00788"></a>00788         <span class="comment">// for when using the toggling draw mode.</span>
<a name="l00789"></a>00789         <span class="keywordflow">while</span>(x &gt;= y)
<a name="l00790"></a>00790         {
<a name="l00791"></a>00791                 <span class="keywordflow">if</span>(y != 0)
<a name="l00792"></a>00792                 {
<a name="l00793"></a>00793                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga1918951dd8566c5eef5ecfd7dcd7c685">write_hline</a>(buff, cx - x, cx + x, cy + y, mode);
<a name="l00794"></a>00794                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga1918951dd8566c5eef5ecfd7dcd7c685">write_hline</a>(buff, cx - x, cx + x, cy - y, mode);
<a name="l00795"></a>00795                         <span class="keywordflow">if</span>(mode != 2 || (mode == 2 &amp;&amp; xch &amp;&amp; (cx - x) != (cx - y)))
<a name="l00796"></a>00796                         {
<a name="l00797"></a>00797                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga1918951dd8566c5eef5ecfd7dcd7c685">write_hline</a>(buff, cx - y, cx + y, cy + x, mode);
<a name="l00798"></a>00798                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga1918951dd8566c5eef5ecfd7dcd7c685">write_hline</a>(buff, cx - y, cx + y, cy - x, mode);
<a name="l00799"></a>00799                                 xch = 0;
<a name="l00800"></a>00800                         }
<a name="l00801"></a>00801                 }
<a name="l00802"></a>00802                 error += (y * 2) + 1;
<a name="l00803"></a>00803                 y++;
<a name="l00804"></a>00804                 <span class="keywordflow">if</span>(error &gt;= 0)
<a name="l00805"></a>00805                 {
<a name="l00806"></a>00806                         --x;
<a name="l00807"></a>00807                         xch = 1;
<a name="l00808"></a>00808                         error -= x * 2;
<a name="l00809"></a>00809                 }
<a name="l00810"></a>00810         }
<a name="l00811"></a>00811         <span class="comment">// Handle toggle mode.</span>
<a name="l00812"></a>00812         <span class="keywordflow">if</span>(mode == 2)
<a name="l00813"></a>00813         {
<a name="l00814"></a>00814                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga1918951dd8566c5eef5ecfd7dcd7c685">write_hline</a>(buff, cx - r, cx + r, cy, mode);
<a name="l00815"></a>00815         }
<a name="l00816"></a>00816 }
<a name="l00817"></a>00817 
<a name="l00828"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga2fe2ee0f0ff8e34091a5357658c686c1">00828</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga2fe2ee0f0ff8e34091a5357658c686c1">write_line</a>(uint8_t *buff, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x0, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y0, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x1, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> mode)
<a name="l00829"></a>00829 {
<a name="l00830"></a>00830         <span class="comment">// Based on http://en.wikipedia.org/wiki/Bresenham%27s_line_algorithm</span>
<a name="l00831"></a>00831         <span class="keywordtype">int</span> steep = abs(y1 - y0) &gt; abs(x1 - x0);
<a name="l00832"></a>00832         <span class="keywordflow">if</span>(steep)
<a name="l00833"></a>00833         {
<a name="l00834"></a>00834                 SWAP(x0, y0);
<a name="l00835"></a>00835                 SWAP(x1, y1);
<a name="l00836"></a>00836         }
<a name="l00837"></a>00837         <span class="keywordflow">if</span>(x0 &gt; x1)
<a name="l00838"></a>00838         {
<a name="l00839"></a>00839                 SWAP(x0, x1);
<a name="l00840"></a>00840                 SWAP(y0, y1);
<a name="l00841"></a>00841         }
<a name="l00842"></a>00842         <span class="keywordtype">int</span> deltax = x1 - x0;
<a name="l00843"></a>00843         <span class="keywordtype">int</span> deltay = abs(y1 - y0);
<a name="l00844"></a>00844         <span class="keywordtype">int</span> <a class="code" href="group___bootloader_update.html#ga5879845a39e040157796c1d907f43d24">error</a> = deltax / 2;
<a name="l00845"></a>00845         <span class="keywordtype">int</span> ystep;
<a name="l00846"></a>00846         <span class="keywordtype">int</span> y = y0;
<a name="l00847"></a>00847         <span class="keywordtype">int</span> x; <span class="comment">//, lasty = y, stox = 0;</span>
<a name="l00848"></a>00848         <span class="keywordflow">if</span>(y0 &lt; y1)
<a name="l00849"></a>00849                 ystep = 1;
<a name="l00850"></a>00850         <span class="keywordflow">else</span>
<a name="l00851"></a>00851                 ystep = -1;
<a name="l00852"></a>00852         <span class="keywordflow">for</span>(x = x0; x &lt; x1; x++)
<a name="l00853"></a>00853         {
<a name="l00854"></a>00854                 <span class="keywordflow">if</span>(steep)
<a name="l00855"></a>00855                 {
<a name="l00856"></a>00856                         <a class="code" href="group___o_s_d_g_e_n_module.html#gabbd31ecda0c72dedfc2f0455d7dedf3e">write_pixel</a>(buff, y, x, mode);
<a name="l00857"></a>00857                 }
<a name="l00858"></a>00858                 <span class="keywordflow">else</span>
<a name="l00859"></a>00859                 {
<a name="l00860"></a>00860                         <a class="code" href="group___o_s_d_g_e_n_module.html#gabbd31ecda0c72dedfc2f0455d7dedf3e">write_pixel</a>(buff, x, y, mode);
<a name="l00861"></a>00861                 }
<a name="l00862"></a>00862                 error -= deltay;
<a name="l00863"></a>00863                 <span class="keywordflow">if</span>(error &lt; 0)
<a name="l00864"></a>00864                 {
<a name="l00865"></a>00865                         y += ystep;
<a name="l00866"></a>00866                         error += deltax;
<a name="l00867"></a>00867                 }
<a name="l00868"></a>00868         }
<a name="l00869"></a>00869 }
<a name="l00870"></a>00870 
<a name="l00881"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga1b12386d924769809d25c0151ca7d47f">00881</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga1b12386d924769809d25c0151ca7d47f">write_line_lm</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x0, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y0, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x1, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> mmode, <span class="keywordtype">int</span> lmode)
<a name="l00882"></a>00882 {
<a name="l00883"></a>00883         <a class="code" href="group___o_s_d_g_e_n_module.html#ga2fe2ee0f0ff8e34091a5357658c686c1">write_line</a>(<a class="code" href="group___o_s_d_g_e_n_module.html#ga67085db0125b910109083e4d2605d7d5">draw_buffer_mask</a>, x0, y0, x1, y1, mmode);
<a name="l00884"></a>00884         <a class="code" href="group___o_s_d_g_e_n_module.html#ga2fe2ee0f0ff8e34091a5357658c686c1">write_line</a>(<a class="code" href="group___o_s_d_g_e_n_module.html#ga52b5c0fc86a398ddf62c5b2bb383374d">draw_buffer_level</a>, x0, y0, x1, y1, lmode);
<a name="l00885"></a>00885 }
<a name="l00886"></a>00886 
<a name="l00900"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga27afef3cac2fe7bd07005b4cfdab1297">00900</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga27afef3cac2fe7bd07005b4cfdab1297">write_line_outlined</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x0, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y0, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x1, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y1, <span class="keywordtype">int</span> endcap0, <span class="keywordtype">int</span> endcap1, <span class="keywordtype">int</span> mode, <span class="keywordtype">int</span> mmode)
<a name="l00901"></a>00901 {
<a name="l00902"></a>00902         <span class="comment">// Based on http://en.wikipedia.org/wiki/Bresenham%27s_line_algorithm</span>
<a name="l00903"></a>00903         <span class="comment">// This could be improved for speed.</span>
<a name="l00904"></a>00904         <span class="keywordtype">int</span> omode, imode;
<a name="l00905"></a>00905         <span class="keywordflow">if</span>(mode == 0)
<a name="l00906"></a>00906         {
<a name="l00907"></a>00907                 omode = 0;
<a name="l00908"></a>00908                 imode = 1;
<a name="l00909"></a>00909         }
<a name="l00910"></a>00910         <span class="keywordflow">else</span>
<a name="l00911"></a>00911         {
<a name="l00912"></a>00912                 omode = 1;
<a name="l00913"></a>00913                 imode = 0;
<a name="l00914"></a>00914         }
<a name="l00915"></a>00915         <span class="keywordtype">int</span> steep = abs(y1 - y0) &gt; abs(x1 - x0);
<a name="l00916"></a>00916         <span class="keywordflow">if</span>(steep)
<a name="l00917"></a>00917         {
<a name="l00918"></a>00918                 SWAP(x0, y0);
<a name="l00919"></a>00919                 SWAP(x1, y1);
<a name="l00920"></a>00920         }
<a name="l00921"></a>00921         <span class="keywordflow">if</span>(x0 &gt; x1)
<a name="l00922"></a>00922         {
<a name="l00923"></a>00923                 SWAP(x0, x1);
<a name="l00924"></a>00924                 SWAP(y0, y1);
<a name="l00925"></a>00925         }
<a name="l00926"></a>00926         <span class="keywordtype">int</span> deltax = x1 - x0;
<a name="l00927"></a>00927         <span class="keywordtype">int</span> deltay = abs(y1 - y0);
<a name="l00928"></a>00928         <span class="keywordtype">int</span> <a class="code" href="group___bootloader_update.html#ga5879845a39e040157796c1d907f43d24">error</a> = deltax / 2;
<a name="l00929"></a>00929         <span class="keywordtype">int</span> ystep;
<a name="l00930"></a>00930         <span class="keywordtype">int</span> y = y0;
<a name="l00931"></a>00931         <span class="keywordtype">int</span> x;
<a name="l00932"></a>00932         <span class="keywordflow">if</span>(y0 &lt; y1)
<a name="l00933"></a>00933                 ystep = 1;
<a name="l00934"></a>00934         <span class="keywordflow">else</span>
<a name="l00935"></a>00935                 ystep = -1;
<a name="l00936"></a>00936         <span class="comment">// Draw the outline.</span>
<a name="l00937"></a>00937         <span class="keywordflow">for</span>(x = x0; x &lt; x1; x++)
<a name="l00938"></a>00938         {
<a name="l00939"></a>00939                 <span class="keywordflow">if</span>(steep)
<a name="l00940"></a>00940                 {
<a name="l00941"></a>00941                         <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(y - 1, x, mmode, omode);
<a name="l00942"></a>00942                         <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(y + 1, x, mmode, omode);
<a name="l00943"></a>00943                         <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(y, x - 1, mmode, omode);
<a name="l00944"></a>00944                         <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(y, x + 1, mmode, omode);
<a name="l00945"></a>00945                 }
<a name="l00946"></a>00946                 <span class="keywordflow">else</span>
<a name="l00947"></a>00947                 {
<a name="l00948"></a>00948                         <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(x - 1, y, mmode, omode);
<a name="l00949"></a>00949                         <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(x + 1, y, mmode, omode);
<a name="l00950"></a>00950                         <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(x, y - 1, mmode, omode);
<a name="l00951"></a>00951                         <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(x, y + 1, mmode, omode);
<a name="l00952"></a>00952                 }
<a name="l00953"></a>00953                 error -= deltay;
<a name="l00954"></a>00954                 <span class="keywordflow">if</span>(error &lt; 0)
<a name="l00955"></a>00955                 {
<a name="l00956"></a>00956                         y += ystep;
<a name="l00957"></a>00957                         error += deltax;
<a name="l00958"></a>00958                 }
<a name="l00959"></a>00959         }
<a name="l00960"></a>00960         <span class="comment">// Now draw the innards.</span>
<a name="l00961"></a>00961         error = deltax / 2;
<a name="l00962"></a>00962         y = y0;
<a name="l00963"></a>00963         <span class="keywordflow">for</span>(x = x0; x &lt; x1; x++)
<a name="l00964"></a>00964         {
<a name="l00965"></a>00965                 <span class="keywordflow">if</span>(steep)
<a name="l00966"></a>00966                 {
<a name="l00967"></a>00967                         <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(y, x, mmode, imode);
<a name="l00968"></a>00968                 }
<a name="l00969"></a>00969                 <span class="keywordflow">else</span>
<a name="l00970"></a>00970                 {
<a name="l00971"></a>00971                         <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(x, y, mmode, imode);
<a name="l00972"></a>00972                 }
<a name="l00973"></a>00973                 error -= deltay;
<a name="l00974"></a>00974                 <span class="keywordflow">if</span>(error &lt; 0)
<a name="l00975"></a>00975                 {
<a name="l00976"></a>00976                         y += ystep;
<a name="l00977"></a>00977                         error += deltax;
<a name="l00978"></a>00978                 }
<a name="l00979"></a>00979         }
<a name="l00980"></a>00980 }
<a name="l00981"></a>00981 
<a name="l00994"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga609b93e9b64ad8b92c1c555d3cdb80c5">00994</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga609b93e9b64ad8b92c1c555d3cdb80c5">write_word_misaligned</a>(uint8_t *buff, uint16_t word, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> addr, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> xoff, <span class="keywordtype">int</span> mode)
<a name="l00995"></a>00995 {
<a name="l00996"></a>00996         uint16_t firstmask = word &gt;&gt; xoff;
<a name="l00997"></a>00997         uint16_t lastmask = word &lt;&lt; (16 - xoff);
<a name="l00998"></a>00998         WRITE_WORD_MODE(buff, addr+1, firstmask &amp;&amp; 0x00ff, mode);
<a name="l00999"></a>00999         WRITE_WORD_MODE(buff, addr, (firstmask &amp; 0xff00) &gt;&gt; 8, mode);
<a name="l01000"></a>01000         <span class="keywordflow">if</span>(xoff &gt; 0)
<a name="l01001"></a>01001                 WRITE_WORD_MODE(buff, addr+2, (lastmask &amp; 0xff00) &gt;&gt; 8, mode);
<a name="l01002"></a>01002 }
<a name="l01003"></a>01003 
<a name="l01019"></a><a class="code" href="group___o_s_d_g_e_n_module.html#gac311d0b8a75e018101c2f7de25468bce">01019</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#gac311d0b8a75e018101c2f7de25468bce">write_word_misaligned_NAND</a>(uint8_t *buff, uint16_t word, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> addr, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> xoff)
<a name="l01020"></a>01020 {
<a name="l01021"></a>01021         uint16_t firstmask = word &gt;&gt; xoff;
<a name="l01022"></a>01022         uint16_t lastmask = word &lt;&lt; (16 - xoff);
<a name="l01023"></a>01023         WRITE_WORD_NAND(buff, addr+1, firstmask &amp; 0x00ff);
<a name="l01024"></a>01024         WRITE_WORD_NAND(buff, addr, (firstmask &amp; 0xff00) &gt;&gt; 8);
<a name="l01025"></a>01025         <span class="keywordflow">if</span>(xoff &gt; 0)
<a name="l01026"></a>01026                 WRITE_WORD_NAND(buff, addr+2, (lastmask &amp; 0xff00) &gt;&gt; 8);
<a name="l01027"></a>01027 }
<a name="l01028"></a>01028 
<a name="l01044"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga17f327de483285ee88a844c5b617d1ed">01044</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga17f327de483285ee88a844c5b617d1ed">write_word_misaligned_OR</a>(uint8_t *buff, uint16_t word, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> addr, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> xoff)
<a name="l01045"></a>01045 {
<a name="l01046"></a>01046         uint16_t firstmask = word &gt;&gt; xoff;
<a name="l01047"></a>01047         uint16_t lastmask = word &lt;&lt; (16 - xoff);
<a name="l01048"></a>01048         WRITE_WORD_OR(buff, addr+1, firstmask &amp; 0x00ff);
<a name="l01049"></a>01049         WRITE_WORD_OR(buff, addr, (firstmask &amp; 0xff00) &gt;&gt; 8);
<a name="l01050"></a>01050         <span class="keywordflow">if</span>(xoff &gt; 0)
<a name="l01051"></a>01051                 WRITE_WORD_OR(buff, addr + 2, (lastmask &amp; 0xff00) &gt;&gt; 8);
<a name="l01052"></a>01052 
<a name="l01053"></a>01053 }
<a name="l01054"></a>01054 
<a name="l01067"></a><a class="code" href="group___o_s_d_g_e_n_module.html#gaf7b6f5e5e2980741c80f92a24c27d470">01067</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#gaf7b6f5e5e2980741c80f92a24c27d470">write_word_misaligned_lm</a>(uint16_t wordl, uint16_t wordm, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> addr, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> xoff, <span class="keywordtype">int</span> lmode, <span class="keywordtype">int</span> mmode)
<a name="l01068"></a>01068 {
<a name="l01069"></a>01069         <a class="code" href="group___o_s_d_g_e_n_module.html#ga609b93e9b64ad8b92c1c555d3cdb80c5">write_word_misaligned</a>(<a class="code" href="group___o_s_d_g_e_n_module.html#ga52b5c0fc86a398ddf62c5b2bb383374d">draw_buffer_level</a>, wordl, addr, xoff, lmode);
<a name="l01070"></a>01070         <a class="code" href="group___o_s_d_g_e_n_module.html#ga609b93e9b64ad8b92c1c555d3cdb80c5">write_word_misaligned</a>(<a class="code" href="group___o_s_d_g_e_n_module.html#ga67085db0125b910109083e4d2605d7d5">draw_buffer_mask</a>, wordm, addr, xoff, mmode);
<a name="l01071"></a>01071 }
<a name="l01072"></a>01072 
<a name="l01079"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga77bb4c9fa18481a38a30c22fc2b8ad68">01079</a> <span class="keywordtype">int</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga77bb4c9fa18481a38a30c22fc2b8ad68">fetch_font_info</a>(uint8_t ch, <span class="keywordtype">int</span> font, <span class="keyword">struct</span> FontEntry *font_info, <span class="keywordtype">char</span> *lookup)
<a name="l01080"></a>01080 {
<a name="l01081"></a>01081         <span class="comment">// First locate the font struct.</span>
<a name="l01082"></a>01082         <span class="keywordflow">if</span>(font &gt; SIZEOF_ARRAY(fonts))
<a name="l01083"></a>01083                 <span class="keywordflow">return</span> 0; <span class="comment">// font does not exist, exit.*/</span>
<a name="l01084"></a>01084         <span class="comment">// Load the font info; IDs are always sequential.</span>
<a name="l01085"></a>01085         *font_info = fonts[font];
<a name="l01086"></a>01086         <span class="comment">// Locate character in font lookup table. (If required.)</span>
<a name="l01087"></a>01087         <span class="keywordflow">if</span>(lookup != NULL)
<a name="l01088"></a>01088         {
<a name="l01089"></a>01089                 *lookup = font_info-&gt;lookup[ch];
<a name="l01090"></a>01090                 <span class="keywordflow">if</span>(*lookup == 0xff)
<a name="l01091"></a>01091                         <span class="keywordflow">return</span> 0; <span class="comment">// character doesn&#39;t exist, don&#39;t bother writing it.</span>
<a name="l01092"></a>01092         }
<a name="l01093"></a>01093         <span class="keywordflow">return</span> 1;
<a name="l01094"></a>01094 }
<a name="l01095"></a>01095 
<a name="l01096"></a>01096 
<a name="l01108"></a><a class="code" href="group___o_s_d_g_e_n_module.html#gaa298c555d34c7e1929c065b647c0f2c8">01108</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#gaa298c555d34c7e1929c065b647c0f2c8">write_char16</a>(<span class="keywordtype">char</span> ch, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> font)
<a name="l01109"></a>01109 {
<a name="l01110"></a>01110     <span class="keywordtype">int</span> yy, addr_temp, row, row_temp, xshift;
<a name="l01111"></a>01111     uint16_t and_mask, or_mask, level_bits;
<a name="l01112"></a>01112     <span class="keyword">struct </span>FontEntry font_info;
<a name="l01113"></a>01113     <span class="comment">//char lookup = 0;</span>
<a name="l01114"></a>01114     <a class="code" href="group___o_s_d_g_e_n_module.html#ga77bb4c9fa18481a38a30c22fc2b8ad68">fetch_font_info</a>(0, font, &amp;font_info, NULL);
<a name="l01115"></a>01115         
<a name="l01116"></a>01116     <span class="comment">// Compute starting address (for x,y) of character.</span>
<a name="l01117"></a>01117     <span class="keywordtype">int</span> addr = CALC_BUFF_ADDR(x, y);
<a name="l01118"></a>01118     <span class="keywordtype">int</span> wbit = CALC_BIT_IN_WORD(x);
<a name="l01119"></a>01119     <span class="comment">// If font only supports lowercase or uppercase, make the letter</span>
<a name="l01120"></a>01120     <span class="comment">// lowercase or uppercase.</span>
<a name="l01121"></a>01121     <span class="comment">// How big is the character? We handle characters up to 8 pixels</span>
<a name="l01122"></a>01122     <span class="comment">// wide for now. Support for large characters may be added in future.</span>
<a name="l01123"></a>01123     {
<a name="l01124"></a>01124                 <span class="comment">// Ensure we don&#39;t overflow.</span>
<a name="l01125"></a>01125                 <span class="keywordflow">if</span>(x + wbit &gt; GRAPHICS_WIDTH_REAL)
<a name="l01126"></a>01126                         <span class="keywordflow">return</span>;
<a name="l01127"></a>01127                 <span class="comment">// Load data pointer.</span>
<a name="l01128"></a>01128                 row = ch * font_info.height;
<a name="l01129"></a>01129                 row_temp = row;
<a name="l01130"></a>01130                 addr_temp = addr;
<a name="l01131"></a>01131                 xshift = 16 - font_info.width;
<a name="l01132"></a>01132                 <span class="comment">// We can write mask words easily.</span>
<a name="l01133"></a>01133                 <span class="keywordflow">for</span>(yy = y; yy &lt; y + font_info.height; yy++)
<a name="l01134"></a>01134                 {
<a name="l01135"></a>01135                         <span class="keywordflow">if</span>(font==3)
<a name="l01136"></a>01136                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga17f327de483285ee88a844c5b617d1ed">write_word_misaligned_OR</a>(<a class="code" href="group___o_s_d_g_e_n_module.html#ga67085db0125b910109083e4d2605d7d5">draw_buffer_mask</a>, font_mask12x18[row] &lt;&lt; xshift, addr, wbit);
<a name="l01137"></a>01137                         <span class="keywordflow">else</span>
<a name="l01138"></a>01138                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga17f327de483285ee88a844c5b617d1ed">write_word_misaligned_OR</a>(<a class="code" href="group___o_s_d_g_e_n_module.html#ga67085db0125b910109083e4d2605d7d5">draw_buffer_mask</a>, font_mask8x10[row] &lt;&lt; xshift, addr, wbit);
<a name="l01139"></a>01139                         addr += GRAPHICS_WIDTH_REAL / 8;
<a name="l01140"></a>01140                         row++;
<a name="l01141"></a>01141                 }
<a name="l01142"></a>01142                 <span class="comment">// Level bits are more complicated. We need to set or clear</span>
<a name="l01143"></a>01143                 <span class="comment">// level bits, but only where the mask bit is set; otherwise,</span>
<a name="l01144"></a>01144                 <span class="comment">// we need to leave them alone. To do this, for each word, we</span>
<a name="l01145"></a>01145                 <span class="comment">// construct an AND mask and an OR mask, and apply each individually.</span>
<a name="l01146"></a>01146                 row = row_temp;
<a name="l01147"></a>01147                 addr = addr_temp;
<a name="l01148"></a>01148                 <span class="keywordflow">for</span>(yy = y; yy &lt; y + font_info.height; yy++)
<a name="l01149"></a>01149                 {
<a name="l01150"></a>01150                         <span class="keywordflow">if</span>(font==3)
<a name="l01151"></a>01151                         {
<a name="l01152"></a>01152                                 level_bits = font_frame12x18[row];
<a name="l01153"></a>01153                                 <span class="comment">//if(!(flags &amp; FONT_INVERT)) // data is normally inverted</span>
<a name="l01154"></a>01154                                 level_bits = ~level_bits;
<a name="l01155"></a>01155                                 or_mask = font_mask12x18[row] &lt;&lt; xshift;
<a name="l01156"></a>01156                                 and_mask = (font_mask12x18[row] &amp; level_bits) &lt;&lt; xshift;
<a name="l01157"></a>01157                         } <span class="keywordflow">else</span> {
<a name="l01158"></a>01158                                 level_bits = font_frame8x10[row];
<a name="l01159"></a>01159                                 <span class="comment">//if(!(flags &amp; FONT_INVERT)) // data is normally inverted</span>
<a name="l01160"></a>01160                                 level_bits = ~level_bits;
<a name="l01161"></a>01161                                 or_mask = font_mask8x10[row] &lt;&lt; xshift;
<a name="l01162"></a>01162                                 and_mask = (font_mask8x10[row] &amp; level_bits) &lt;&lt; xshift;
<a name="l01163"></a>01163                         }
<a name="l01164"></a>01164                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga17f327de483285ee88a844c5b617d1ed">write_word_misaligned_OR</a>(<a class="code" href="group___o_s_d_g_e_n_module.html#ga52b5c0fc86a398ddf62c5b2bb383374d">draw_buffer_level</a>, or_mask, addr, wbit);
<a name="l01165"></a>01165                         <span class="comment">// If we&#39;re not bold write the AND mask.</span>
<a name="l01166"></a>01166                         <span class="comment">//if(!(flags &amp; FONT_BOLD))</span>
<a name="l01167"></a>01167                         <a class="code" href="group___o_s_d_g_e_n_module.html#gac311d0b8a75e018101c2f7de25468bce">write_word_misaligned_NAND</a>(<a class="code" href="group___o_s_d_g_e_n_module.html#ga52b5c0fc86a398ddf62c5b2bb383374d">draw_buffer_level</a>, and_mask, addr, wbit);
<a name="l01168"></a>01168                         addr += GRAPHICS_WIDTH_REAL / 8;
<a name="l01169"></a>01169                         row++;
<a name="l01170"></a>01170                 }
<a name="l01171"></a>01171     }
<a name="l01172"></a>01172 }
<a name="l01173"></a>01173 
<a name="l01174"></a>01174 
<a name="l01175"></a>01175 
<a name="l01187"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga790a5ed0b4f266fd6699d69102a632f4">01187</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga790a5ed0b4f266fd6699d69102a632f4">write_char</a>(<span class="keywordtype">char</span> ch, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> <a class="code" href="uavobjectmanager_8c.html#a89997860157be94711355010fc2a337d">flags</a>, <span class="keywordtype">int</span> font)
<a name="l01188"></a>01188 {
<a name="l01189"></a>01189     <span class="keywordtype">int</span> yy, addr_temp, row, row_temp, xshift;
<a name="l01190"></a>01190     uint16_t and_mask, or_mask, level_bits;
<a name="l01191"></a>01191     <span class="keyword">struct </span>FontEntry font_info;
<a name="l01192"></a>01192     <span class="keywordtype">char</span> lookup = 0;
<a name="l01193"></a>01193     <a class="code" href="group___o_s_d_g_e_n_module.html#ga77bb4c9fa18481a38a30c22fc2b8ad68">fetch_font_info</a>(ch, font, &amp;font_info, &amp;lookup);
<a name="l01194"></a>01194     <span class="comment">// Compute starting address (for x,y) of character.</span>
<a name="l01195"></a>01195     <span class="keywordtype">int</span> addr = CALC_BUFF_ADDR(x, y);
<a name="l01196"></a>01196     <span class="keywordtype">int</span> wbit = CALC_BIT_IN_WORD(x);
<a name="l01197"></a>01197     <span class="comment">// If font only supports lowercase or uppercase, make the letter</span>
<a name="l01198"></a>01198     <span class="comment">// lowercase or uppercase.</span>
<a name="l01199"></a>01199     <span class="comment">/*if(font_info.flags &amp; FONT_LOWERCASE_ONLY)</span>
<a name="l01200"></a>01200 <span class="comment">                ch = tolower(ch);</span>
<a name="l01201"></a>01201 <span class="comment">    if(font_info.flags &amp; FONT_UPPERCASE_ONLY)</span>
<a name="l01202"></a>01202 <span class="comment">                ch = toupper(ch);*/</span>
<a name="l01203"></a>01203     <a class="code" href="group___o_s_d_g_e_n_module.html#ga77bb4c9fa18481a38a30c22fc2b8ad68">fetch_font_info</a>(ch, font, &amp;font_info, &amp;lookup);
<a name="l01204"></a>01204     <span class="comment">// How big is the character? We handle characters up to 8 pixels</span>
<a name="l01205"></a>01205     <span class="comment">// wide for now. Support for large characters may be added in future.</span>
<a name="l01206"></a>01206     <span class="keywordflow">if</span>(font_info.width &lt;= 8)
<a name="l01207"></a>01207     {
<a name="l01208"></a>01208                 <span class="comment">// Ensure we don&#39;t overflow.</span>
<a name="l01209"></a>01209                 <span class="keywordflow">if</span>(x + wbit &gt; GRAPHICS_WIDTH_REAL)
<a name="l01210"></a>01210                         <span class="keywordflow">return</span>;
<a name="l01211"></a>01211                 <span class="comment">// Load data pointer.</span>
<a name="l01212"></a>01212                 row = lookup * font_info.height * 2;
<a name="l01213"></a>01213                 row_temp = row;
<a name="l01214"></a>01214                 addr_temp = addr;
<a name="l01215"></a>01215                 xshift = 16 - font_info.width;
<a name="l01216"></a>01216                 <span class="comment">// We can write mask words easily.</span>
<a name="l01217"></a>01217                 <span class="keywordflow">for</span>(yy = y; yy &lt; y + font_info.height; yy++)
<a name="l01218"></a>01218                 {
<a name="l01219"></a>01219                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga17f327de483285ee88a844c5b617d1ed">write_word_misaligned_OR</a>(<a class="code" href="group___o_s_d_g_e_n_module.html#ga67085db0125b910109083e4d2605d7d5">draw_buffer_mask</a>, font_info.data[row] &lt;&lt; xshift, addr, wbit);
<a name="l01220"></a>01220                         addr += GRAPHICS_WIDTH_REAL / 8;
<a name="l01221"></a>01221                         row++;
<a name="l01222"></a>01222                 }
<a name="l01223"></a>01223                 <span class="comment">// Level bits are more complicated. We need to set or clear</span>
<a name="l01224"></a>01224                 <span class="comment">// level bits, but only where the mask bit is set; otherwise,</span>
<a name="l01225"></a>01225                 <span class="comment">// we need to leave them alone. To do this, for each word, we</span>
<a name="l01226"></a>01226                 <span class="comment">// construct an AND mask and an OR mask, and apply each individually.</span>
<a name="l01227"></a>01227                 row = row_temp;
<a name="l01228"></a>01228                 addr = addr_temp;
<a name="l01229"></a>01229                 <span class="keywordflow">for</span>(yy = y; yy &lt; y + font_info.height; yy++)
<a name="l01230"></a>01230                 {
<a name="l01231"></a>01231                         level_bits = font_info.data[row + font_info.height];
<a name="l01232"></a>01232                         <span class="keywordflow">if</span>(!(flags &amp; FONT_INVERT)) <span class="comment">// data is normally inverted</span>
<a name="l01233"></a>01233                                 level_bits = ~level_bits;
<a name="l01234"></a>01234                         or_mask = font_info.data[row] &lt;&lt; xshift;
<a name="l01235"></a>01235                         and_mask = (font_info.data[row] &amp; level_bits) &lt;&lt; xshift;
<a name="l01236"></a>01236                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga17f327de483285ee88a844c5b617d1ed">write_word_misaligned_OR</a>(<a class="code" href="group___o_s_d_g_e_n_module.html#ga52b5c0fc86a398ddf62c5b2bb383374d">draw_buffer_level</a>, or_mask, addr, wbit);
<a name="l01237"></a>01237                         <span class="comment">// If we&#39;re not bold write the AND mask.</span>
<a name="l01238"></a>01238                         <span class="comment">//if(!(flags &amp; FONT_BOLD))</span>
<a name="l01239"></a>01239                         <a class="code" href="group___o_s_d_g_e_n_module.html#gac311d0b8a75e018101c2f7de25468bce">write_word_misaligned_NAND</a>(<a class="code" href="group___o_s_d_g_e_n_module.html#ga52b5c0fc86a398ddf62c5b2bb383374d">draw_buffer_level</a>, and_mask, addr, wbit);
<a name="l01240"></a>01240                         addr += GRAPHICS_WIDTH_REAL / 8;
<a name="l01241"></a>01241                         row++;
<a name="l01242"></a>01242                 }
<a name="l01243"></a>01243     }
<a name="l01244"></a>01244 }
<a name="l01245"></a>01245 
<a name="l01257"></a><a class="code" href="group___o_s_d_g_e_n_module.html#gaeb262588efc72fef0d981fb2c7e447d4">01257</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#gaeb262588efc72fef0d981fb2c7e447d4">calc_text_dimensions</a>(<span class="keywordtype">char</span> *str, <span class="keyword">struct</span> FontEntry font, <span class="keywordtype">int</span> xs, <span class="keywordtype">int</span> ys, <span class="keyword">struct</span> <a class="code" href="struct_font_dimensions.html">FontDimensions</a> *dim)
<a name="l01258"></a>01258 {
<a name="l01259"></a>01259     <span class="keywordtype">int</span> max_length = 0, line_length = 0, lines = 1;
<a name="l01260"></a>01260     <span class="keywordflow">while</span>(*str != 0)
<a name="l01261"></a>01261     {
<a name="l01262"></a>01262                 line_length++;
<a name="l01263"></a>01263                 <span class="keywordflow">if</span>(*str == <span class="charliteral">&#39;\n&#39;</span> || *str == <span class="charliteral">&#39;\r&#39;</span>)
<a name="l01264"></a>01264                 {
<a name="l01265"></a>01265                         <span class="keywordflow">if</span>(line_length &gt; max_length)
<a name="l01266"></a>01266                                 max_length = line_length;
<a name="l01267"></a>01267                         line_length = 0;
<a name="l01268"></a>01268                         lines++;
<a name="l01269"></a>01269                 }
<a name="l01270"></a>01270                 str++;
<a name="l01271"></a>01271     }
<a name="l01272"></a>01272     <span class="keywordflow">if</span>(line_length &gt; max_length)
<a name="l01273"></a>01273                 max_length = line_length;
<a name="l01274"></a>01274     dim-&gt;<a class="code" href="struct_font_dimensions.html#a3a7f22c09ebeb18689a296fc7b72323e">width</a> = max_length * (font.width + xs);
<a name="l01275"></a>01275     dim-&gt;<a class="code" href="struct_font_dimensions.html#a0a3e31e8b25bb8b85bbf0c92135deba7">height</a> = lines * (font.height + ys);
<a name="l01276"></a>01276 }
<a name="l01277"></a>01277 
<a name="l01292"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">01292</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(<span class="keywordtype">char</span> *str, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> xs, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ys, <span class="keywordtype">int</span> va, <span class="keywordtype">int</span> ha, <span class="keywordtype">int</span> <a class="code" href="uavobjectmanager_8c.html#a89997860157be94711355010fc2a337d">flags</a>, <span class="keywordtype">int</span> font)
<a name="l01293"></a>01293 {
<a name="l01294"></a>01294     <span class="keywordtype">int</span> xx = 0, yy = 0, xx_original = 0;
<a name="l01295"></a>01295     <span class="keyword">struct </span>FontEntry font_info;
<a name="l01296"></a>01296     <span class="keyword">struct </span><a class="code" href="struct_font_dimensions.html">FontDimensions</a> dim;
<a name="l01297"></a>01297     <span class="comment">// Determine font info and dimensions/position of the string.</span>
<a name="l01298"></a>01298     <a class="code" href="group___o_s_d_g_e_n_module.html#ga77bb4c9fa18481a38a30c22fc2b8ad68">fetch_font_info</a>(0, font, &amp;font_info, NULL);
<a name="l01299"></a>01299     <a class="code" href="group___o_s_d_g_e_n_module.html#gaeb262588efc72fef0d981fb2c7e447d4">calc_text_dimensions</a>(str, font_info, xs, ys, &amp;dim);
<a name="l01300"></a>01300     <span class="keywordflow">switch</span>(va)
<a name="l01301"></a>01301     {
<a name="l01302"></a>01302                 <span class="keywordflow">case</span> TEXT_VA_TOP:               yy = y; <span class="keywordflow">break</span>;
<a name="l01303"></a>01303                 <span class="keywordflow">case</span> TEXT_VA_MIDDLE:    yy = y - (dim.<a class="code" href="struct_font_dimensions.html#a0a3e31e8b25bb8b85bbf0c92135deba7">height</a> / 2); <span class="keywordflow">break</span>;
<a name="l01304"></a>01304                 <span class="keywordflow">case</span> TEXT_VA_BOTTOM:    yy = y - dim.<a class="code" href="struct_font_dimensions.html#a0a3e31e8b25bb8b85bbf0c92135deba7">height</a>; <span class="keywordflow">break</span>;
<a name="l01305"></a>01305     }
<a name="l01306"></a>01306     <span class="keywordflow">switch</span>(ha)
<a name="l01307"></a>01307     {
<a name="l01308"></a>01308                 <span class="keywordflow">case</span> TEXT_HA_LEFT:              xx = x; <span class="keywordflow">break</span>;
<a name="l01309"></a>01309                 <span class="keywordflow">case</span> TEXT_HA_CENTER:    xx = x - (dim.<a class="code" href="struct_font_dimensions.html#a3a7f22c09ebeb18689a296fc7b72323e">width</a> / 2); <span class="keywordflow">break</span>;
<a name="l01310"></a>01310                 <span class="keywordflow">case</span> TEXT_HA_RIGHT:             xx = x - dim.<a class="code" href="struct_font_dimensions.html#a3a7f22c09ebeb18689a296fc7b72323e">width</a>; <span class="keywordflow">break</span>;
<a name="l01311"></a>01311     }
<a name="l01312"></a>01312     <span class="comment">// Then write each character.</span>
<a name="l01313"></a>01313     xx_original = xx;
<a name="l01314"></a>01314     <span class="keywordflow">while</span>(*str != 0)
<a name="l01315"></a>01315     {
<a name="l01316"></a>01316                 <span class="keywordflow">if</span>(*str == <span class="charliteral">&#39;\n&#39;</span> || *str == <span class="charliteral">&#39;\r&#39;</span>)
<a name="l01317"></a>01317                 {
<a name="l01318"></a>01318                         yy += ys + font_info.height;
<a name="l01319"></a>01319                         xx = xx_original;
<a name="l01320"></a>01320                 }
<a name="l01321"></a>01321                 <span class="keywordflow">else</span>
<a name="l01322"></a>01322                 {
<a name="l01323"></a>01323                         <span class="keywordflow">if</span>(xx &gt;= 0 &amp;&amp; xx &lt; GRAPHICS_WIDTH_REAL)
<a name="l01324"></a>01324                         {
<a name="l01325"></a>01325                                 <span class="keywordflow">if</span>(font_info.id&lt;2)
<a name="l01326"></a>01326                                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga790a5ed0b4f266fd6699d69102a632f4">write_char</a>(*str, xx, yy, flags, font);
<a name="l01327"></a>01327                                 <span class="keywordflow">else</span>
<a name="l01328"></a>01328                                         <a class="code" href="group___o_s_d_g_e_n_module.html#gaa298c555d34c7e1929c065b647c0f2c8">write_char16</a>(*str, xx, yy, font);
<a name="l01329"></a>01329                         }
<a name="l01330"></a>01330                         xx += font_info.width + xs;
<a name="l01331"></a>01331                 }
<a name="l01332"></a>01332                 str++;
<a name="l01333"></a>01333     }
<a name="l01334"></a>01334 }
<a name="l01335"></a>01335 
<a name="l01349"></a><a class="code" href="group___o_s_d_g_e_n_module.html#gab49221eead66b5e8af2b4e3104fa8456">01349</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#gab49221eead66b5e8af2b4e3104fa8456">write_string_formatted</a>(<span class="keywordtype">char</span> *str, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> xs, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ys, <span class="keywordtype">int</span> va, <span class="keywordtype">int</span> ha, <span class="keywordtype">int</span> <a class="code" href="uavobjectmanager_8c.html#a89997860157be94711355010fc2a337d">flags</a>)
<a name="l01350"></a>01350 {
<a name="l01351"></a>01351     <span class="keywordtype">int</span> fcode = 0, fptr = 0, font = 0, fwidth = 0, fheight = 0, xx = x, yy = y, max_xx = 0, max_height = 0;
<a name="l01352"></a>01352     <span class="keyword">struct </span>FontEntry font_info;
<a name="l01353"></a>01353     <span class="comment">// Retrieve sizes of the fonts: bigfont and smallfont.</span>
<a name="l01354"></a>01354     <a class="code" href="group___o_s_d_g_e_n_module.html#ga77bb4c9fa18481a38a30c22fc2b8ad68">fetch_font_info</a>(0, 0, &amp;font_info, NULL);
<a name="l01355"></a>01355     <span class="keywordtype">int</span> smallfontwidth = font_info.width, smallfontheight = font_info.height;
<a name="l01356"></a>01356     <a class="code" href="group___o_s_d_g_e_n_module.html#ga77bb4c9fa18481a38a30c22fc2b8ad68">fetch_font_info</a>(0, 1, &amp;font_info, NULL);
<a name="l01357"></a>01357     <span class="keywordtype">int</span> bigfontwidth = font_info.width, bigfontheight = font_info.height;
<a name="l01358"></a>01358     <span class="comment">// 11 byte stack with last byte as NUL.</span>
<a name="l01359"></a>01359     <span class="keywordtype">char</span> fstack[11];
<a name="l01360"></a>01360     fstack[10] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01361"></a>01361     <span class="comment">// First, we need to parse the string for format characters and</span>
<a name="l01362"></a>01362     <span class="comment">// work out a bounding box. We&#39;ll parse again for the final output.</span>
<a name="l01363"></a>01363     <span class="comment">// This is a simple state machine parser.</span>
<a name="l01364"></a>01364     <span class="keywordtype">char</span> *ostr = str;
<a name="l01365"></a>01365     <span class="keywordflow">while</span>(*str)
<a name="l01366"></a>01366     {
<a name="l01367"></a>01367             <span class="keywordflow">if</span>(*str == <span class="charliteral">&#39;&lt;&#39;</span> &amp;&amp; fcode == 1) <span class="comment">// escape code: skip</span>
<a name="l01368"></a>01368                     fcode = 0;
<a name="l01369"></a>01369             <span class="keywordflow">if</span>(*str == <span class="charliteral">&#39;&lt;&#39;</span> &amp;&amp; fcode == 0) <span class="comment">// begin format code?</span>
<a name="l01370"></a>01370             {
<a name="l01371"></a>01371                     fcode = 1;
<a name="l01372"></a>01372                     fptr = 0;
<a name="l01373"></a>01373             }
<a name="l01374"></a>01374             <span class="keywordflow">if</span>(*str == <span class="charliteral">&#39;&gt;&#39;</span> &amp;&amp; fcode == 1)
<a name="l01375"></a>01375             {
<a name="l01376"></a>01376                     fcode = 0;
<a name="l01377"></a>01377                     <span class="keywordflow">if</span>(strcmp(fstack, <span class="stringliteral">&quot;B&quot;</span>)) <span class="comment">// switch to &quot;big&quot; font (font #1)</span>
<a name="l01378"></a>01378                     {
<a name="l01379"></a>01379                             fwidth = bigfontwidth;
<a name="l01380"></a>01380                             fheight = bigfontheight;
<a name="l01381"></a>01381                     }
<a name="l01382"></a>01382                     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(fstack, <span class="stringliteral">&quot;S&quot;</span>)) <span class="comment">// switch to &quot;small&quot; font (font #0)</span>
<a name="l01383"></a>01383                     {
<a name="l01384"></a>01384                             fwidth = smallfontwidth;
<a name="l01385"></a>01385                             fheight = smallfontheight;
<a name="l01386"></a>01386                     }
<a name="l01387"></a>01387                     <span class="keywordflow">if</span>(fheight &gt; max_height)
<a name="l01388"></a>01388                             max_height = fheight;
<a name="l01389"></a>01389                     <span class="comment">// Skip over this byte. Go to next byte.</span>
<a name="l01390"></a>01390                     str++;
<a name="l01391"></a>01391                     <span class="keywordflow">continue</span>;
<a name="l01392"></a>01392             }
<a name="l01393"></a>01393             <span class="keywordflow">if</span>(*str != <span class="charliteral">&#39;&lt;&#39;</span> &amp;&amp; *str != <span class="charliteral">&#39;&gt;&#39;</span> &amp;&amp; fcode == 1)
<a name="l01394"></a>01394             {
<a name="l01395"></a>01395                     <span class="comment">// Add to the format stack (up to 10 bytes.)</span>
<a name="l01396"></a>01396                     <span class="keywordflow">if</span>(fptr &gt; 10) <span class="comment">// stop adding bytes</span>
<a name="l01397"></a>01397                     {
<a name="l01398"></a>01398                             str++; <span class="comment">// go to next byte</span>
<a name="l01399"></a>01399                             <span class="keywordflow">continue</span>;
<a name="l01400"></a>01400                     }
<a name="l01401"></a>01401                     fstack[fptr++] = *str;
<a name="l01402"></a>01402                     fstack[fptr] = <span class="charliteral">&#39;\0&#39;</span>; <span class="comment">// clear next byte (ready for next char or to terminate string.)</span>
<a name="l01403"></a>01403             }
<a name="l01404"></a>01404             <span class="keywordflow">if</span>(fcode == 0)
<a name="l01405"></a>01405             {
<a name="l01406"></a>01406                     <span class="comment">// Not a format code, raw text.</span>
<a name="l01407"></a>01407                     xx += fwidth + xs;
<a name="l01408"></a>01408                     <span class="keywordflow">if</span>(*str == <span class="charliteral">&#39;\n&#39;</span>)
<a name="l01409"></a>01409                     {
<a name="l01410"></a>01410                             <span class="keywordflow">if</span>(xx &gt; max_xx)
<a name="l01411"></a>01411                                     max_xx = xx;
<a name="l01412"></a>01412                             xx = x;
<a name="l01413"></a>01413                             yy += fheight + ys;
<a name="l01414"></a>01414                     }
<a name="l01415"></a>01415             }
<a name="l01416"></a>01416             str++;
<a name="l01417"></a>01417     }
<a name="l01418"></a>01418     <span class="comment">// Reset string pointer.</span>
<a name="l01419"></a>01419     str = ostr;
<a name="l01420"></a>01420     <span class="comment">// Now we&#39;ve parsed it and got a bbox, we need to work out the dimensions of it</span>
<a name="l01421"></a>01421     <span class="comment">// and how to align it.</span>
<a name="l01422"></a>01422     <span class="comment">/*int width = max_xx - x;</span>
<a name="l01423"></a>01423 <span class="comment">    int height = yy - y;</span>
<a name="l01424"></a>01424 <span class="comment">    int ay, ax;</span>
<a name="l01425"></a>01425 <span class="comment">    switch(va)</span>
<a name="l01426"></a>01426 <span class="comment">    {</span>
<a name="l01427"></a>01427 <span class="comment">            case TEXT_VA_TOP:               ay = yy; break;</span>
<a name="l01428"></a>01428 <span class="comment">            case TEXT_VA_MIDDLE:    ay = yy - (height / 2); break;</span>
<a name="l01429"></a>01429 <span class="comment">            case TEXT_VA_BOTTOM:    ay = yy - height; break;</span>
<a name="l01430"></a>01430 <span class="comment">    }</span>
<a name="l01431"></a>01431 <span class="comment">    switch(ha)</span>
<a name="l01432"></a>01432 <span class="comment">    {</span>
<a name="l01433"></a>01433 <span class="comment">            case TEXT_HA_LEFT:              ax = x; break;</span>
<a name="l01434"></a>01434 <span class="comment">            case TEXT_HA_CENTER:    ax = x - (width / 2); break;</span>
<a name="l01435"></a>01435 <span class="comment">            case TEXT_HA_RIGHT:             ax = x - width; break;</span>
<a name="l01436"></a>01436 <span class="comment">    }*/</span>
<a name="l01437"></a>01437     <span class="comment">// So ax,ay is our new text origin. Parse the text format again and paint</span>
<a name="l01438"></a>01438     <span class="comment">// the text on the display.</span>
<a name="l01439"></a>01439     fcode = 0;
<a name="l01440"></a>01440     fptr = 0;
<a name="l01441"></a>01441     font = 0;
<a name="l01442"></a>01442     xx = 0;
<a name="l01443"></a>01443     yy = 0;
<a name="l01444"></a>01444     <span class="keywordflow">while</span>(*str)
<a name="l01445"></a>01445     {
<a name="l01446"></a>01446             <span class="keywordflow">if</span>(*str == <span class="charliteral">&#39;&lt;&#39;</span> &amp;&amp; fcode == 1) <span class="comment">// escape code: skip</span>
<a name="l01447"></a>01447                     fcode = 0;
<a name="l01448"></a>01448             <span class="keywordflow">if</span>(*str == <span class="charliteral">&#39;&lt;&#39;</span> &amp;&amp; fcode == 0) <span class="comment">// begin format code?</span>
<a name="l01449"></a>01449             {
<a name="l01450"></a>01450                     fcode = 1;
<a name="l01451"></a>01451                     fptr = 0;
<a name="l01452"></a>01452             }
<a name="l01453"></a>01453             <span class="keywordflow">if</span>(*str == <span class="charliteral">&#39;&gt;&#39;</span> &amp;&amp; fcode == 1)
<a name="l01454"></a>01454             {
<a name="l01455"></a>01455                     fcode = 0;
<a name="l01456"></a>01456                     <span class="keywordflow">if</span>(strcmp(fstack, <span class="stringliteral">&quot;B&quot;</span>)) <span class="comment">// switch to &quot;big&quot; font (font #1)</span>
<a name="l01457"></a>01457                     {
<a name="l01458"></a>01458                             fwidth = bigfontwidth;
<a name="l01459"></a>01459                             fheight = bigfontheight;
<a name="l01460"></a>01460                             font = 1;
<a name="l01461"></a>01461                     }
<a name="l01462"></a>01462                     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcmp(fstack, <span class="stringliteral">&quot;S&quot;</span>)) <span class="comment">// switch to &quot;small&quot; font (font #0)</span>
<a name="l01463"></a>01463                     {
<a name="l01464"></a>01464                             fwidth = smallfontwidth;
<a name="l01465"></a>01465                             fheight = smallfontheight;
<a name="l01466"></a>01466                             font = 0;
<a name="l01467"></a>01467                     }
<a name="l01468"></a>01468                     <span class="comment">// Skip over this byte. Go to next byte.</span>
<a name="l01469"></a>01469                     str++;
<a name="l01470"></a>01470                     <span class="keywordflow">continue</span>;
<a name="l01471"></a>01471             }
<a name="l01472"></a>01472             <span class="keywordflow">if</span>(*str != <span class="charliteral">&#39;&lt;&#39;</span> &amp;&amp; *str != <span class="charliteral">&#39;&gt;&#39;</span> &amp;&amp; fcode == 1)
<a name="l01473"></a>01473             {
<a name="l01474"></a>01474                     <span class="comment">// Add to the format stack (up to 10 bytes.)</span>
<a name="l01475"></a>01475                     <span class="keywordflow">if</span>(fptr &gt; 10) <span class="comment">// stop adding bytes</span>
<a name="l01476"></a>01476                     {
<a name="l01477"></a>01477                             str++; <span class="comment">// go to next byte</span>
<a name="l01478"></a>01478                             <span class="keywordflow">continue</span>;
<a name="l01479"></a>01479                     }
<a name="l01480"></a>01480                     fstack[fptr++] = *str;
<a name="l01481"></a>01481                     fstack[fptr] = <span class="charliteral">&#39;\0&#39;</span>; <span class="comment">// clear next byte (ready for next char or to terminate string.)</span>
<a name="l01482"></a>01482             }
<a name="l01483"></a>01483             <span class="keywordflow">if</span>(fcode == 0)
<a name="l01484"></a>01484             {
<a name="l01485"></a>01485                     <span class="comment">// Not a format code, raw text. So we draw it.</span>
<a name="l01486"></a>01486                     <span class="comment">// TODO - different font sizes.</span>
<a name="l01487"></a>01487                     <a class="code" href="group___o_s_d_g_e_n_module.html#ga790a5ed0b4f266fd6699d69102a632f4">write_char</a>(*str, xx, yy + (max_height - fheight), flags, font);
<a name="l01488"></a>01488                     xx += fwidth + xs;
<a name="l01489"></a>01489                     <span class="keywordflow">if</span>(*str == <span class="charliteral">&#39;\n&#39;</span>)
<a name="l01490"></a>01490                     {
<a name="l01491"></a>01491                             <span class="keywordflow">if</span>(xx &gt; max_xx)
<a name="l01492"></a>01492                                     max_xx = xx;
<a name="l01493"></a>01493                             xx = x;
<a name="l01494"></a>01494                             yy += fheight + ys;
<a name="l01495"></a>01495                     }
<a name="l01496"></a>01496             }
<a name="l01497"></a>01497             str++;
<a name="l01498"></a>01498     }
<a name="l01499"></a>01499 }
<a name="l01500"></a>01500 
<a name="l01501"></a>01501 
<a name="l01502"></a>01502 <span class="comment">//SUPEROSD-</span>
<a name="l01503"></a>01503 
<a name="l01504"></a>01504 
<a name="l01505"></a>01505 <span class="comment">// graphics</span>
<a name="l01506"></a>01506 
<a name="l01507"></a><a class="code" href="group___o_s_d_g_e_n_module.html#gab6cd6692726c21ca6a7da8b8acf01de3">01507</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#gab6cd6692726c21ca6a7da8b8acf01de3">drawAttitude</a>(uint16_t x, uint16_t y, int16_t pitch, int16_t roll, uint16_t size)
<a name="l01508"></a>01508 {
<a name="l01509"></a>01509         int16_t a = mySin(roll+360);
<a name="l01510"></a>01510         int16_t b = myCos(roll+360);
<a name="l01511"></a>01511         int16_t c = mySin(roll+90+360)*5/100;
<a name="l01512"></a>01512         int16_t d = myCos(roll+90+360)*5/100;
<a name="l01513"></a>01513 
<a name="l01514"></a>01514         int16_t k;
<a name="l01515"></a>01515         int16_t l;
<a name="l01516"></a>01516 
<a name="l01517"></a>01517         int16_t indi30x1=myCos(30)*(size/2+1) / 100;
<a name="l01518"></a>01518         int16_t indi30y1=mySin(30)*(size/2+1) / 100;
<a name="l01519"></a>01519 
<a name="l01520"></a>01520         int16_t indi30x2=myCos(30)*(size/2+4) / 100;
<a name="l01521"></a>01521         int16_t indi30y2=mySin(30)*(size/2+4) / 100;
<a name="l01522"></a>01522 
<a name="l01523"></a>01523         int16_t indi60x1=myCos(60)*(size/2+1) / 100;
<a name="l01524"></a>01524         int16_t indi60y1=mySin(60)*(size/2+1) / 100;
<a name="l01525"></a>01525 
<a name="l01526"></a>01526         int16_t indi60x2=myCos(60)*(size/2+4) / 100;
<a name="l01527"></a>01527         int16_t indi60y2=mySin(60)*(size/2+4) / 100;
<a name="l01528"></a>01528 
<a name="l01529"></a>01529         pitch=pitch%90;
<a name="l01530"></a>01530         <span class="keywordflow">if</span>(pitch&gt;90)
<a name="l01531"></a>01531         {
<a name="l01532"></a>01532                 pitch=pitch-90;
<a name="l01533"></a>01533         }
<a name="l01534"></a>01534         <span class="keywordflow">if</span>(pitch&lt;-90)
<a name="l01535"></a>01535         {
<a name="l01536"></a>01536                 pitch=pitch+90;
<a name="l01537"></a>01537         }
<a name="l01538"></a>01538         a = (a * (size/2)) / 100;
<a name="l01539"></a>01539         b = (b * (size/2)) / 100;
<a name="l01540"></a>01540 
<a name="l01541"></a>01541         <span class="keywordflow">if</span>(roll&lt;-90 || roll&gt;90)
<a name="l01542"></a>01542                 pitch=pitch*-1;
<a name="l01543"></a>01543         k = a*pitch/90;
<a name="l01544"></a>01544         l = b*pitch/90;
<a name="l01545"></a>01545 
<a name="l01546"></a>01546         <span class="comment">// scale</span>
<a name="l01547"></a>01547         <span class="comment">//0</span>
<a name="l01548"></a>01548         <span class="comment">//drawLine((x)-1-(size/2+4), (y)-1, (x)-1 - (size/2+1), (y)-1);</span>
<a name="l01549"></a>01549         <span class="comment">//drawLine((x)-1+(size/2+4), (y)-1, (x)-1 + (size/2+1), (y)-1);</span>
<a name="l01550"></a>01550         <a class="code" href="group___o_s_d_g_e_n_module.html#ga27afef3cac2fe7bd07005b4cfdab1297">write_line_outlined</a>((x)-1-(size/2+4), (y)-1, (x)-1 - (size/2+1), (y)-1,0,0,0,1);
<a name="l01551"></a>01551         <a class="code" href="group___o_s_d_g_e_n_module.html#ga27afef3cac2fe7bd07005b4cfdab1297">write_line_outlined</a>((x)-1+(size/2+4), (y)-1, (x)-1 + (size/2+1), (y)-1,0,0,0,1);
<a name="l01552"></a>01552 
<a name="l01553"></a>01553         <span class="comment">//30</span>
<a name="l01554"></a>01554         <span class="comment">//drawLine((x)-1+indi30x1, (y)-1-indi30y1, (x)-1 + indi30x2, (y)-1 - indi30y2);</span>
<a name="l01555"></a>01555         <span class="comment">//drawLine((x)-1-indi30x1, (y)-1-indi30y1, (x)-1 - indi30x2, (y)-1 - indi30y2);</span>
<a name="l01556"></a>01556         <a class="code" href="group___o_s_d_g_e_n_module.html#ga27afef3cac2fe7bd07005b4cfdab1297">write_line_outlined</a>((x)-1+indi30x1, (y)-1-indi30y1, (x)-1 + indi30x2, (y)-1 - indi30y2,0,0,0,1);
<a name="l01557"></a>01557         <a class="code" href="group___o_s_d_g_e_n_module.html#ga27afef3cac2fe7bd07005b4cfdab1297">write_line_outlined</a>((x)-1-indi30x1, (y)-1-indi30y1, (x)-1 - indi30x2, (y)-1 - indi30y2,0,0,0,1);
<a name="l01558"></a>01558         <span class="comment">//60</span>
<a name="l01559"></a>01559         <span class="comment">//drawLine((x)-1+indi60x1, (y)-1-indi60y1, (x)-1 + indi60x2, (y)-1 - indi60y2);</span>
<a name="l01560"></a>01560         <span class="comment">//drawLine((x)-1-indi60x1, (y)-1-indi60y1, (x)-1 - indi60x2, (y)-1 - indi60y2);</span>
<a name="l01561"></a>01561         <a class="code" href="group___o_s_d_g_e_n_module.html#ga27afef3cac2fe7bd07005b4cfdab1297">write_line_outlined</a>((x)-1+indi60x1, (y)-1-indi60y1, (x)-1 + indi60x2, (y)-1 - indi60y2,0,0,0,1);
<a name="l01562"></a>01562         <a class="code" href="group___o_s_d_g_e_n_module.html#ga27afef3cac2fe7bd07005b4cfdab1297">write_line_outlined</a>((x)-1-indi60x1, (y)-1-indi60y1, (x)-1 - indi60x2, (y)-1 - indi60y2,0,0,0,1);
<a name="l01563"></a>01563         <span class="comment">//90</span>
<a name="l01564"></a>01564         <span class="comment">//drawLine((x)-1, (y)-1-(size/2+4), (x)-1, (y)-1 - (size/2+1));</span>
<a name="l01565"></a>01565         <a class="code" href="group___o_s_d_g_e_n_module.html#ga27afef3cac2fe7bd07005b4cfdab1297">write_line_outlined</a>((x)-1, (y)-1-(size/2+4), (x)-1, (y)-1 - (size/2+1),0,0,0,1);
<a name="l01566"></a>01566 
<a name="l01567"></a>01567 
<a name="l01568"></a>01568         <span class="comment">//roll</span>
<a name="l01569"></a>01569         <span class="comment">//drawLine((x)-1 - b, (y)-1 + a, (x)-1 + b, (y)-1 - a); //Direction line</span>
<a name="l01570"></a>01570         <a class="code" href="group___o_s_d_g_e_n_module.html#ga27afef3cac2fe7bd07005b4cfdab1297">write_line_outlined</a>((x)-1 - b, (y)-1 + a, (x)-1 + b, (y)-1 - a,0,0,0,1); <span class="comment">//Direction line</span>
<a name="l01571"></a>01571         <span class="comment">//&quot;wingtips&quot;</span>
<a name="l01572"></a>01572         <span class="comment">//drawLine((x)-1 - b, (y)-1 + a, (x)-1 - b + d, (y)-1 + a - c);</span>
<a name="l01573"></a>01573         <span class="comment">//drawLine((x)-1 + b + d, (y)-1 - a - c, (x)-1 + b, (y)-1 - a);</span>
<a name="l01574"></a>01574         <a class="code" href="group___o_s_d_g_e_n_module.html#ga27afef3cac2fe7bd07005b4cfdab1297">write_line_outlined</a>((x)-1 - b, (y)-1 + a, (x)-1 - b + d, (y)-1 + a - c,0,0,0,1);
<a name="l01575"></a>01575         <a class="code" href="group___o_s_d_g_e_n_module.html#ga27afef3cac2fe7bd07005b4cfdab1297">write_line_outlined</a>((x)-1 + b + d, (y)-1 - a - c, (x)-1 + b, (y)-1 - a,0,0,0,1);
<a name="l01576"></a>01576 
<a name="l01577"></a>01577         <span class="comment">//pitch</span>
<a name="l01578"></a>01578         <span class="comment">//drawLine((x)-1, (y)-1, (x)-1 - k, (y)-1 - l);</span>
<a name="l01579"></a>01579         <a class="code" href="group___o_s_d_g_e_n_module.html#ga27afef3cac2fe7bd07005b4cfdab1297">write_line_outlined</a>((x)-1, (y)-1, (x)-1 - k, (y)-1 - l,0,0,0,1);
<a name="l01580"></a>01580 
<a name="l01581"></a>01581 
<a name="l01582"></a>01582         <span class="comment">//drawCircle(x-1, y-1, 5);</span>
<a name="l01583"></a>01583         <span class="comment">//write_circle_outlined(x-1, y-1, 5,0,0,0,1);</span>
<a name="l01584"></a>01584         <span class="comment">//drawCircle(x-1, y-1, size/2+4);</span>
<a name="l01585"></a>01585         <span class="comment">//write_circle_outlined(x-1, y-1, size/2+4,0,0,0,1);</span>
<a name="l01586"></a>01586 }
<a name="l01587"></a>01587 
<a name="l01588"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga85d7e1ad745a9c81483f8b513db8cebc">01588</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga85d7e1ad745a9c81483f8b513db8cebc">drawBattery</a>(uint16_t x, uint16_t y, uint8_t battery, uint16_t size)
<a name="l01589"></a>01589 {
<a name="l01590"></a>01590         <span class="keywordtype">int</span> i=0;
<a name="l01591"></a>01591         <span class="keywordtype">int</span> batteryLines;
<a name="l01592"></a>01592         <span class="comment">//top</span>
<a name="l01593"></a>01593         <span class="comment">/*drawLine((x)-1+(size/2-size/4), (y)-1, (x)-1 + (size/2+size/4), (y)-1);</span>
<a name="l01594"></a>01594 <span class="comment">        drawLine((x)-1+(size/2-size/4), (y)-1+1, (x)-1 + (size/2+size/4), (y)-1+1);</span>
<a name="l01595"></a>01595 <span class="comment"></span>
<a name="l01596"></a>01596 <span class="comment">        drawLine((x)-1, (y)-1+2, (x)-1 + size, (y)-1+2);</span>
<a name="l01597"></a>01597 <span class="comment">        //bottom</span>
<a name="l01598"></a>01598 <span class="comment">        drawLine((x)-1, (y)-1+size*3, (x)-1 + size, (y)-1+size*3);</span>
<a name="l01599"></a>01599 <span class="comment">        //left</span>
<a name="l01600"></a>01600 <span class="comment">        drawLine((x)-1, (y)-1+2, (x)-1, (y)-1+size*3);</span>
<a name="l01601"></a>01601 <span class="comment"></span>
<a name="l01602"></a>01602 <span class="comment">        //right</span>
<a name="l01603"></a>01603 <span class="comment">        drawLine((x)-1+size, (y)-1+2, (x)-1+size, (y)-1+size*3);*/</span>
<a name="l01604"></a>01604 
<a name="l01605"></a>01605         <a class="code" href="group___o_s_d_g_e_n_module.html#ga761aea940799fbd6d4f6bafe83ea2032">write_rectangle_outlined</a>((x)-1, (y)-1+2,size,size*3,0,1);
<a name="l01606"></a>01606         <a class="code" href="group___o_s_d_g_e_n_module.html#ga4ab8daa08074c7ccb69b2f8a1d834979">write_vline_lm</a>((x)-1+(size/2+size/4)+1,(y)-2,(y)-1+1,0,1);
<a name="l01607"></a>01607         <a class="code" href="group___o_s_d_g_e_n_module.html#ga4ab8daa08074c7ccb69b2f8a1d834979">write_vline_lm</a>((x)-1+(size/2-size/4)-1,(y)-2,(y)-1+1,0,1);
<a name="l01608"></a>01608         <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>((x)-1+(size/2-size/4),(x)-1 + (size/2+size/4),(y)-2,0,1);
<a name="l01609"></a>01609         <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>((x)-1+(size/2-size/4),(x)-1 + (size/2+size/4),(y)-1,1,1);
<a name="l01610"></a>01610         <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>((x)-1+(size/2-size/4),(x)-1 + (size/2+size/4),(y)-1+1,1,1);
<a name="l01611"></a>01611 
<a name="l01612"></a>01612         batteryLines = battery*(size*3-2)/100;
<a name="l01613"></a>01613         <span class="keywordflow">for</span>(i=0;i&lt;batteryLines;i++)
<a name="l01614"></a>01614         {
<a name="l01615"></a>01615                 <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>((x)-1,(x)-1 + size,(y)-1+size*3-i,1,1);
<a name="l01616"></a>01616         }
<a name="l01617"></a>01617 }
<a name="l01618"></a>01618 
<a name="l01619"></a>01619 
<a name="l01620"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga8b0f8e99f2bfee4a902a9d46a8714579">01620</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga8b0f8e99f2bfee4a902a9d46a8714579">printTime</a>(uint16_t x, uint16_t y) {
<a name="l01621"></a>01621         <span class="keywordtype">char</span> temp[9]={0};
<a name="l01622"></a>01622         <a class="code" href="group___p_i_o_s.html#gaa0649118bc3728b2a62af0b47606ff51">sprintf</a>(temp,<span class="stringliteral">&quot;%02d:%02d:%02d&quot;</span>,timex.<a class="code" href="group___p_i_o_s___v_i_d_e_o.html#gae7afd210e593b007611ac237bd32d30d">hour</a>,timex.<a class="code" href="group___p_i_o_s___v_i_d_e_o.html#gadb9b0440ee5ef05786949736913ce45c">min</a>,timex.<a class="code" href="group___p_i_o_s___v_i_d_e_o.html#gaa6288943af354a6cb143f2ad677cfece">sec</a>);
<a name="l01623"></a>01623         <span class="comment">//printTextFB(x,y,temp);</span>
<a name="l01624"></a>01624         <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temp, x, y, 0, 0, TEXT_VA_TOP, TEXT_HA_LEFT, 0, 3);
<a name="l01625"></a>01625 }
<a name="l01626"></a>01626 
<a name="l01627"></a>01627 <span class="comment">/*</span>
<a name="l01628"></a>01628 <span class="comment">void drawAltitude(uint16_t x, uint16_t y, int16_t alt, uint8_t dir) {</span>
<a name="l01629"></a>01629 <span class="comment"></span>
<a name="l01630"></a>01630 <span class="comment">        char temp[9]={0};</span>
<a name="l01631"></a>01631 <span class="comment">        char updown=&#39; &#39;;</span>
<a name="l01632"></a>01632 <span class="comment">        uint16_t charx=x/16;</span>
<a name="l01633"></a>01633 <span class="comment">        if(dir==0)</span>
<a name="l01634"></a>01634 <span class="comment">                updown=24;</span>
<a name="l01635"></a>01635 <span class="comment">        if(dir==1)</span>
<a name="l01636"></a>01636 <span class="comment">                updown=25;</span>
<a name="l01637"></a>01637 <span class="comment">        sprintf(temp,&quot;%c%6dm&quot;,updown,alt);</span>
<a name="l01638"></a>01638 <span class="comment">        printTextFB(charx,y+2,temp);</span>
<a name="l01639"></a>01639 <span class="comment">        // frame</span>
<a name="l01640"></a>01640 <span class="comment">        drawBox(charx*16-3,y,charx*16+strlen(temp)*8+3,y+11);</span>
<a name="l01641"></a>01641 <span class="comment">}*/</span>
<a name="l01642"></a>01642 
<a name="l01660"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga03d95a090f293be5c864ee5334d3c287">01660</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga03d95a090f293be5c864ee5334d3c287">hud_draw_vertical_scale</a>(<span class="keywordtype">int</span> v, <span class="keywordtype">int</span> range, <span class="keywordtype">int</span> halign, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> height, <span class="keywordtype">int</span> mintick_step, <span class="keywordtype">int</span> majtick_step, <span class="keywordtype">int</span> mintick_len, <span class="keywordtype">int</span> majtick_len, <span class="keywordtype">int</span> boundtick_len, <span class="keywordtype">int</span> max_val, <span class="keywordtype">int</span> <a class="code" href="uavobjectmanager_8c.html#a89997860157be94711355010fc2a337d">flags</a>)
<a name="l01661"></a>01661 {
<a name="l01662"></a>01662         <span class="keywordtype">char</span> temp[15];<span class="comment">//, temp2[15];</span>
<a name="l01663"></a>01663         <span class="keyword">struct </span>FontEntry font_info;
<a name="l01664"></a>01664         <span class="keyword">struct </span><a class="code" href="struct_font_dimensions.html">FontDimensions</a> dim;
<a name="l01665"></a>01665         <span class="comment">// Halign should be in a small span.</span>
<a name="l01666"></a>01666         <span class="comment">//MY_ASSERT(halign &gt;= -1 &amp;&amp; halign &lt;= 1);</span>
<a name="l01667"></a>01667         <span class="comment">// Compute the position of the elements.</span>
<a name="l01668"></a>01668         <span class="keywordtype">int</span> majtick_start = 0, majtick_end = 0, mintick_start = 0, mintick_end = 0, boundtick_start = 0, boundtick_end = 0;
<a name="l01669"></a>01669         <span class="keywordflow">if</span>(halign == -1)
<a name="l01670"></a>01670         {
<a name="l01671"></a>01671                 majtick_start = x;
<a name="l01672"></a>01672                 majtick_end = x + majtick_len;
<a name="l01673"></a>01673                 mintick_start = x;
<a name="l01674"></a>01674                 mintick_end = x + mintick_len;
<a name="l01675"></a>01675                 boundtick_start = x;
<a name="l01676"></a>01676                 boundtick_end = x + boundtick_len;
<a name="l01677"></a>01677         }
<a name="l01678"></a>01678         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(halign == +1)
<a name="l01679"></a>01679         {
<a name="l01680"></a>01680                         x=x-GRAPHICS_HDEADBAND;
<a name="l01681"></a>01681                 majtick_start = GRAPHICS_WIDTH_REAL - x - 1;
<a name="l01682"></a>01682                 majtick_end = GRAPHICS_WIDTH_REAL - x - majtick_len - 1;
<a name="l01683"></a>01683                 mintick_start = GRAPHICS_WIDTH_REAL - x - 1;
<a name="l01684"></a>01684                 mintick_end = GRAPHICS_WIDTH_REAL - x - mintick_len - 1;
<a name="l01685"></a>01685                 boundtick_start = GRAPHICS_WIDTH_REAL - x - 1;
<a name="l01686"></a>01686                 boundtick_end = GRAPHICS_WIDTH_REAL - x - boundtick_len - 1;
<a name="l01687"></a>01687         }
<a name="l01688"></a>01688         <span class="comment">// Retrieve width of large font (font #0); from this calculate the x spacing.</span>
<a name="l01689"></a>01689         <a class="code" href="group___o_s_d_g_e_n_module.html#ga77bb4c9fa18481a38a30c22fc2b8ad68">fetch_font_info</a>(0, 0, &amp;font_info, NULL);
<a name="l01690"></a>01690         <span class="keywordtype">int</span> arrow_len = (font_info.height / 2) + 1;             <span class="comment">// FIXME, font info being loaded correctly??</span>
<a name="l01691"></a>01691         <span class="keywordtype">int</span> text_x_spacing = arrow_len;
<a name="l01692"></a>01692         <span class="keywordtype">int</span> max_text_y = 0, text_length = 0;
<a name="l01693"></a>01693         <span class="keywordtype">int</span> small_font_char_width = font_info.width + 1; <span class="comment">// +1 for horizontal spacing = 1</span>
<a name="l01694"></a>01694         <span class="comment">// For -(range / 2) to +(range / 2), draw the scale.</span>
<a name="l01695"></a>01695         <span class="keywordtype">int</span> range_2 = range / 2; <span class="comment">//, height_2 = height / 2;</span>
<a name="l01696"></a>01696         <span class="keywordtype">int</span> r = 0, rr = 0, rv = 0, ys = 0, style = 0; <span class="comment">//calc_ys = 0,</span>
<a name="l01697"></a>01697         <span class="comment">// Iterate through each step.</span>
<a name="l01698"></a>01698         <span class="keywordflow">for</span>(r = -range_2; r &lt;= +range_2; r++)
<a name="l01699"></a>01699         {
<a name="l01700"></a>01700                 style = 0;
<a name="l01701"></a>01701                 rr = r + range_2 - v; <span class="comment">// normalise range for modulo, subtract value to move ticker tape</span>
<a name="l01702"></a>01702                 rv = -rr + range_2; <span class="comment">// for number display</span>
<a name="l01703"></a>01703                 <span class="keywordflow">if</span>(flags &amp; HUD_VSCALE_FLAG_NO_NEGATIVE)
<a name="l01704"></a>01704                         rr += majtick_step / 2;
<a name="l01705"></a>01705                 <span class="keywordflow">if</span>(rr % majtick_step == 0)
<a name="l01706"></a>01706                         style = 1; <span class="comment">// major tick</span>
<a name="l01707"></a>01707                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(rr % mintick_step == 0)
<a name="l01708"></a>01708                         style = 2; <span class="comment">// minor tick</span>
<a name="l01709"></a>01709                 <span class="keywordflow">else</span>
<a name="l01710"></a>01710                         style = 0;
<a name="l01711"></a>01711                 <span class="keywordflow">if</span>(flags &amp; HUD_VSCALE_FLAG_NO_NEGATIVE &amp;&amp; rv &lt; 0)
<a name="l01712"></a>01712                         <span class="keywordflow">continue</span>;
<a name="l01713"></a>01713                 <span class="keywordflow">if</span>(style)
<a name="l01714"></a>01714                 {
<a name="l01715"></a>01715                         <span class="comment">// Calculate y position.</span>
<a name="l01716"></a>01716                         ys = ((<span class="keywordtype">long</span> int)(r * height) / (<span class="keywordtype">long</span> int)range) + y;
<a name="l01717"></a>01717                         <span class="comment">//sprintf(temp, &quot;ys=%d&quot;, ys);</span>
<a name="l01718"></a>01718                         <span class="comment">//con_puts(temp, 0);</span>
<a name="l01719"></a>01719                         <span class="comment">// Depending on style, draw a minor or a major tick.</span>
<a name="l01720"></a>01720                         <span class="keywordflow">if</span>(style == 1)
<a name="l01721"></a>01721                         {
<a name="l01722"></a>01722                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga093e7b26837226a19a69ea698d6db954">write_hline_outlined</a>(majtick_start, majtick_end, ys, 2, 2, 0, 1);
<a name="l01723"></a>01723                                 memset(temp, <span class="charliteral">&#39; &#39;</span>, 10);
<a name="l01724"></a>01724                                 <span class="comment">//my_itoa(rv, temp);</span>
<a name="l01725"></a>01725                                 <a class="code" href="group___p_i_o_s.html#gaa0649118bc3728b2a62af0b47606ff51">sprintf</a>(temp,<span class="stringliteral">&quot;%d&quot;</span>,rv);
<a name="l01726"></a>01726                                 text_length = (strlen(temp) + 1) * small_font_char_width; <span class="comment">// add 1 for margin</span>
<a name="l01727"></a>01727                                 <span class="keywordflow">if</span>(text_length &gt; max_text_y)
<a name="l01728"></a>01728                                         max_text_y = text_length;
<a name="l01729"></a>01729                                 <span class="keywordflow">if</span>(halign == -1)
<a name="l01730"></a>01730                                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temp, majtick_end + text_x_spacing, ys, 1, 0, TEXT_VA_MIDDLE, TEXT_HA_LEFT, 0, 1);
<a name="l01731"></a>01731                                 <span class="keywordflow">else</span>
<a name="l01732"></a>01732                                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temp, majtick_end - text_x_spacing + 1, ys, 1, 0, TEXT_VA_MIDDLE, TEXT_HA_RIGHT, 0, 1);
<a name="l01733"></a>01733                         }
<a name="l01734"></a>01734                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(style == 2)
<a name="l01735"></a>01735                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga093e7b26837226a19a69ea698d6db954">write_hline_outlined</a>(mintick_start, mintick_end, ys, 2, 2, 0, 1);
<a name="l01736"></a>01736                 }
<a name="l01737"></a>01737         }
<a name="l01738"></a>01738         <span class="comment">// Generate the string for the value, as well as calculating its dimensions.</span>
<a name="l01739"></a>01739         memset(temp, <span class="charliteral">&#39; &#39;</span>, 10);
<a name="l01740"></a>01740         <span class="comment">//my_itoa(v, temp);</span>
<a name="l01741"></a>01741         <a class="code" href="group___p_i_o_s.html#gaa0649118bc3728b2a62af0b47606ff51">sprintf</a>(temp,<span class="stringliteral">&quot;%d&quot;</span>,v);
<a name="l01742"></a>01742         <span class="comment">// TODO: add auto-sizing.</span>
<a name="l01743"></a>01743         <a class="code" href="group___o_s_d_g_e_n_module.html#gaeb262588efc72fef0d981fb2c7e447d4">calc_text_dimensions</a>(temp, font_info, 1, 0, &amp;dim);
<a name="l01744"></a>01744         <span class="keywordtype">int</span> xx = 0, i = 0;
<a name="l01745"></a>01745         <span class="keywordflow">if</span>(halign == -1)
<a name="l01746"></a>01746                 xx = majtick_end + text_x_spacing;
<a name="l01747"></a>01747         <span class="keywordflow">else</span>
<a name="l01748"></a>01748                 xx = majtick_end - text_x_spacing;
<a name="l01749"></a>01749         <span class="comment">// Draw an arrow from the number to the point.</span>
<a name="l01750"></a>01750         <span class="keywordflow">for</span>(i = 0; i &lt; arrow_len; i++)
<a name="l01751"></a>01751         {
<a name="l01752"></a>01752                 <span class="keywordflow">if</span>(halign == -1)
<a name="l01753"></a>01753                 {
<a name="l01754"></a>01754                         <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(xx - arrow_len + i, y - i - 1, 1, 1);
<a name="l01755"></a>01755                         <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(xx - arrow_len + i, y + i - 1, 1, 1);
<a name="l01756"></a>01756                         <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>(xx + dim.<a class="code" href="struct_font_dimensions.html#a3a7f22c09ebeb18689a296fc7b72323e">width</a> - 1, xx - arrow_len + i + 1, y - i - 1, 0, 1);
<a name="l01757"></a>01757                         <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>(xx + dim.<a class="code" href="struct_font_dimensions.html#a3a7f22c09ebeb18689a296fc7b72323e">width</a> - 1, xx - arrow_len + i + 1, y + i - 1, 0, 1);
<a name="l01758"></a>01758                 }
<a name="l01759"></a>01759                 <span class="keywordflow">else</span>
<a name="l01760"></a>01760                 {
<a name="l01761"></a>01761                         <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(xx + arrow_len - i, y - i - 1, 1, 1);
<a name="l01762"></a>01762                         <a class="code" href="group___o_s_d_g_e_n_module.html#gac1761b4fcfac704692e9a6cb6b263c70">write_pixel_lm</a>(xx + arrow_len - i, y + i - 1, 1, 1);
<a name="l01763"></a>01763                         <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>(xx - dim.<a class="code" href="struct_font_dimensions.html#a3a7f22c09ebeb18689a296fc7b72323e">width</a> - 1, xx + arrow_len - i - 1, y - i - 1, 0, 1);
<a name="l01764"></a>01764                         <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>(xx - dim.<a class="code" href="struct_font_dimensions.html#a3a7f22c09ebeb18689a296fc7b72323e">width</a> - 1, xx + arrow_len - i - 1, y + i - 1, 0, 1);
<a name="l01765"></a>01765                 }
<a name="l01766"></a>01766                 <span class="comment">// FIXME</span>
<a name="l01767"></a>01767                 <span class="comment">// write_hline_lm(xx - dim.width - 1, xx + (arrow_len - i), y - i - 1, 1, 1);</span>
<a name="l01768"></a>01768                 <span class="comment">// write_hline_lm(xx - dim.width - 1, xx + (arrow_len - i), y + i - 1, 1, 1);</span>
<a name="l01769"></a>01769         }
<a name="l01770"></a>01770         <span class="keywordflow">if</span>(halign == -1)
<a name="l01771"></a>01771         {
<a name="l01772"></a>01772                 <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>(xx, xx + dim.<a class="code" href="struct_font_dimensions.html#a3a7f22c09ebeb18689a296fc7b72323e">width</a> - 1, y - arrow_len, 1, 1);
<a name="l01773"></a>01773                 <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>(xx, xx + dim.<a class="code" href="struct_font_dimensions.html#a3a7f22c09ebeb18689a296fc7b72323e">width</a> - 1, y + arrow_len - 2, 1, 1);
<a name="l01774"></a>01774                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga4ab8daa08074c7ccb69b2f8a1d834979">write_vline_lm</a>(xx + dim.<a class="code" href="struct_font_dimensions.html#a3a7f22c09ebeb18689a296fc7b72323e">width</a> - 1, y - arrow_len, y + arrow_len - 2, 1, 1);
<a name="l01775"></a>01775         }
<a name="l01776"></a>01776         <span class="keywordflow">else</span>
<a name="l01777"></a>01777         {
<a name="l01778"></a>01778                 <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>(xx, xx - dim.<a class="code" href="struct_font_dimensions.html#a3a7f22c09ebeb18689a296fc7b72323e">width</a> - 1, y - arrow_len, 1, 1);
<a name="l01779"></a>01779                 <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>(xx, xx - dim.<a class="code" href="struct_font_dimensions.html#a3a7f22c09ebeb18689a296fc7b72323e">width</a> - 1, y + arrow_len - 2, 1, 1);
<a name="l01780"></a>01780                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga4ab8daa08074c7ccb69b2f8a1d834979">write_vline_lm</a>(xx - dim.<a class="code" href="struct_font_dimensions.html#a3a7f22c09ebeb18689a296fc7b72323e">width</a> - 1, y - arrow_len, y + arrow_len - 2, 1, 1);
<a name="l01781"></a>01781         }
<a name="l01782"></a>01782         <span class="comment">// Draw the text.</span>
<a name="l01783"></a>01783         <span class="keywordflow">if</span>(halign == -1)
<a name="l01784"></a>01784                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temp, xx, y, 1, 0, TEXT_VA_MIDDLE, TEXT_HA_LEFT, 0, 0);
<a name="l01785"></a>01785         <span class="keywordflow">else</span>
<a name="l01786"></a>01786                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temp, xx, y, 1, 0, TEXT_VA_MIDDLE, TEXT_HA_RIGHT, 0, 0);
<a name="l01787"></a>01787         <span class="comment">// Then, add a slow cut off on the edges, so the text doesn&#39;t sharply</span>
<a name="l01788"></a>01788         <span class="comment">// disappear. We simply clear the areas above and below the ticker, and we</span>
<a name="l01789"></a>01789         <span class="comment">// use little markers on the edges.</span>
<a name="l01790"></a>01790         <span class="keywordflow">if</span>(halign == -1)
<a name="l01791"></a>01791         {
<a name="l01792"></a>01792                 <a class="code" href="group___o_s_d_g_e_n_module.html#gafdf87d4c22a0fcb603bdfba416768248">write_filled_rectangle_lm</a>(majtick_end + text_x_spacing, y + (height / 2) - (font_info.height / 2), max_text_y - boundtick_start, font_info.height, 0, 0);
<a name="l01793"></a>01793                 <a class="code" href="group___o_s_d_g_e_n_module.html#gafdf87d4c22a0fcb603bdfba416768248">write_filled_rectangle_lm</a>(majtick_end + text_x_spacing, y - (height / 2) - (font_info.height / 2), max_text_y - boundtick_start, font_info.height, 0, 0);
<a name="l01794"></a>01794         }
<a name="l01795"></a>01795         <span class="keywordflow">else</span>
<a name="l01796"></a>01796         {
<a name="l01797"></a>01797                 <a class="code" href="group___o_s_d_g_e_n_module.html#gafdf87d4c22a0fcb603bdfba416768248">write_filled_rectangle_lm</a>(majtick_end - text_x_spacing - max_text_y, y + (height / 2) - (font_info.height / 2), max_text_y, font_info.height, 0, 0);
<a name="l01798"></a>01798                 <a class="code" href="group___o_s_d_g_e_n_module.html#gafdf87d4c22a0fcb603bdfba416768248">write_filled_rectangle_lm</a>(majtick_end - text_x_spacing - max_text_y, y - (height / 2) - (font_info.height / 2), max_text_y, font_info.height, 0, 0);
<a name="l01799"></a>01799         }
<a name="l01800"></a>01800         <a class="code" href="group___o_s_d_g_e_n_module.html#ga093e7b26837226a19a69ea698d6db954">write_hline_outlined</a>(boundtick_start, boundtick_end, y + (height / 2), 2, 2, 0, 1);
<a name="l01801"></a>01801         <a class="code" href="group___o_s_d_g_e_n_module.html#ga093e7b26837226a19a69ea698d6db954">write_hline_outlined</a>(boundtick_start, boundtick_end, y - (height / 2), 2, 2, 0, 1);
<a name="l01802"></a>01802 }
<a name="l01803"></a>01803 
<a name="l01818"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga1598b1881ca23bff8a3df4c896ed4869">01818</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga1598b1881ca23bff8a3df4c896ed4869">hud_draw_linear_compass</a>(<span class="keywordtype">int</span> v, <span class="keywordtype">int</span> range, <span class="keywordtype">int</span> <a class="code" href="struct_font_dimensions.html#a3a7f22c09ebeb18689a296fc7b72323e">width</a>, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> mintick_step, <span class="keywordtype">int</span> majtick_step, <span class="keywordtype">int</span> mintick_len, <span class="keywordtype">int</span> majtick_len, <span class="keywordtype">int</span> <a class="code" href="uavobjectmanager_8c.html#a89997860157be94711355010fc2a337d">flags</a>)
<a name="l01819"></a>01819 {
<a name="l01820"></a>01820         v %= 360; <span class="comment">// wrap, just in case.</span>
<a name="l01821"></a>01821         <span class="keyword">struct </span>FontEntry font_info;
<a name="l01822"></a>01822         <span class="keywordtype">int</span> majtick_start = 0, majtick_end = 0, mintick_start = 0, mintick_end = 0, textoffset = 0;
<a name="l01823"></a>01823         <span class="keywordtype">char</span> headingstr[4];
<a name="l01824"></a>01824         majtick_start = y;
<a name="l01825"></a>01825         majtick_end = y - majtick_len;
<a name="l01826"></a>01826         mintick_start = y;
<a name="l01827"></a>01827         mintick_end = y - mintick_len;
<a name="l01828"></a>01828         textoffset = 8;
<a name="l01829"></a>01829         <span class="keywordtype">int</span> r, style, rr, xs; <span class="comment">// rv,</span>
<a name="l01830"></a>01830         <span class="keywordtype">int</span> range_2 = range / 2;
<a name="l01831"></a>01831         <span class="keywordflow">for</span>(r = -range_2; r &lt;= +range_2; r++)
<a name="l01832"></a>01832         {
<a name="l01833"></a>01833                 style = 0;
<a name="l01834"></a>01834                 rr = (v + r + 360) % 360; <span class="comment">// normalise range for modulo, add to move compass track</span>
<a name="l01835"></a>01835                 <span class="comment">//rv = -rr + range_2; // for number display</span>
<a name="l01836"></a>01836                 <span class="keywordflow">if</span>(rr % majtick_step == 0)
<a name="l01837"></a>01837                         style = 1; <span class="comment">// major tick</span>
<a name="l01838"></a>01838                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(rr % mintick_step == 0)
<a name="l01839"></a>01839                         style = 2; <span class="comment">// minor tick</span>
<a name="l01840"></a>01840                 <span class="keywordflow">if</span>(style)
<a name="l01841"></a>01841                 {
<a name="l01842"></a>01842                         <span class="comment">// Calculate x position.</span>
<a name="l01843"></a>01843                         xs = ((<span class="keywordtype">long</span> int)(r * width) / (<span class="keywordtype">long</span> int)range) + x;
<a name="l01844"></a>01844                         <span class="comment">// Draw it.</span>
<a name="l01845"></a>01845                         <span class="keywordflow">if</span>(style == 1)
<a name="l01846"></a>01846                         {
<a name="l01847"></a>01847                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga0587de2636d0acd501858f056b6ad4da">write_vline_outlined</a>(xs, majtick_start, majtick_end, 2, 2, 0, 1);
<a name="l01848"></a>01848                                 <span class="comment">// Draw heading above this tick.</span>
<a name="l01849"></a>01849                                 <span class="comment">// If it&#39;s not one of north, south, east, west, draw the heading.</span>
<a name="l01850"></a>01850                                 <span class="comment">// Otherwise, draw one of the identifiers.</span>
<a name="l01851"></a>01851                                 <span class="keywordflow">if</span>(rr % 90 != 0)
<a name="l01852"></a>01852                                 {
<a name="l01853"></a>01853                                         <span class="comment">// We abbreviate heading to two digits. This has the side effect of being easy to compute.</span>
<a name="l01854"></a>01854                                         headingstr[0] = <span class="charliteral">&#39;0&#39;</span> + (rr / 100);
<a name="l01855"></a>01855                                         headingstr[1] = <span class="charliteral">&#39;0&#39;</span> + ((rr / 10) % 10);
<a name="l01856"></a>01856                                         headingstr[2] = 0;
<a name="l01857"></a>01857                                         headingstr[3] = 0; <span class="comment">// nul to terminate</span>
<a name="l01858"></a>01858                                 }
<a name="l01859"></a>01859                                 <span class="keywordflow">else</span>
<a name="l01860"></a>01860                                 {
<a name="l01861"></a>01861                                         <span class="keywordflow">switch</span>(rr)
<a name="l01862"></a>01862                                         {
<a name="l01863"></a>01863                                                 <span class="keywordflow">case</span> 0:   headingstr[0] = <span class="charliteral">&#39;N&#39;</span>; <span class="keywordflow">break</span>;
<a name="l01864"></a>01864                                                 <span class="keywordflow">case</span> 90:  headingstr[0] = <span class="charliteral">&#39;E&#39;</span>; <span class="keywordflow">break</span>;
<a name="l01865"></a>01865                                                 <span class="keywordflow">case</span> 180: headingstr[0] = <span class="charliteral">&#39;S&#39;</span>; <span class="keywordflow">break</span>;
<a name="l01866"></a>01866                                                 <span class="keywordflow">case</span> 270: headingstr[0] = <span class="charliteral">&#39;W&#39;</span>; <span class="keywordflow">break</span>;
<a name="l01867"></a>01867                                         }
<a name="l01868"></a>01868                                         headingstr[1] = 0;
<a name="l01869"></a>01869                                         headingstr[2] = 0;
<a name="l01870"></a>01870                                         headingstr[3] = 0;
<a name="l01871"></a>01871                                 }
<a name="l01872"></a>01872                                 <span class="comment">// +1 fudge...!</span>
<a name="l01873"></a>01873                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(headingstr, xs + 1, majtick_start + textoffset, 1, 0, TEXT_VA_MIDDLE, TEXT_HA_CENTER, 0, 1);
<a name="l01874"></a>01874                         }
<a name="l01875"></a>01875                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(style == 2)
<a name="l01876"></a>01876                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga0587de2636d0acd501858f056b6ad4da">write_vline_outlined</a>(xs, mintick_start, mintick_end, 2, 2, 0, 1);
<a name="l01877"></a>01877                 }
<a name="l01878"></a>01878         }
<a name="l01879"></a>01879         <span class="comment">// Then, draw a rectangle with the present heading in it.</span>
<a name="l01880"></a>01880         <span class="comment">// We want to cover up any other markers on the bottom.</span>
<a name="l01881"></a>01881         <span class="comment">// First compute font size.</span>
<a name="l01882"></a>01882         <a class="code" href="group___o_s_d_g_e_n_module.html#ga77bb4c9fa18481a38a30c22fc2b8ad68">fetch_font_info</a>(0, 3, &amp;font_info, NULL);
<a name="l01883"></a>01883         <span class="keywordtype">int</span> text_width = (font_info.width + 1) * 3;
<a name="l01884"></a>01884         <span class="keywordtype">int</span> rect_width = text_width + 2;
<a name="l01885"></a>01885         <a class="code" href="group___o_s_d_g_e_n_module.html#gafdf87d4c22a0fcb603bdfba416768248">write_filled_rectangle_lm</a>(x - (rect_width / 2), majtick_start + 2, rect_width, font_info.height + 2, 0, 1);
<a name="l01886"></a>01886         <a class="code" href="group___o_s_d_g_e_n_module.html#ga761aea940799fbd6d4f6bafe83ea2032">write_rectangle_outlined</a>(x - (rect_width / 2), majtick_start + 2, rect_width, font_info.height + 2, 0, 1);
<a name="l01887"></a>01887         headingstr[0] = <span class="charliteral">&#39;0&#39;</span> + (v / 100);
<a name="l01888"></a>01888         headingstr[1] = <span class="charliteral">&#39;0&#39;</span> + ((v / 10) % 10);
<a name="l01889"></a>01889         headingstr[2] = <span class="charliteral">&#39;0&#39;</span> + (v % 10);
<a name="l01890"></a>01890         headingstr[3] = 0;
<a name="l01891"></a>01891         <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(headingstr, x + 1, majtick_start + textoffset+2, 0, 0, TEXT_VA_MIDDLE, TEXT_HA_CENTER, 1, 3);
<a name="l01892"></a>01892 }
<a name="l01893"></a>01893 <span class="comment">// CORE draw routines end here</span>
<a name="l01894"></a>01894 
<a name="l01895"></a><a class="code" href="group___o_s_d_g_e_n_module.html#gab0e4e7223434b0cf8dd683461136fcd2">01895</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#gab0e4e7223434b0cf8dd683461136fcd2">draw_artificial_horizon</a>(<span class="keywordtype">float</span> angle, <span class="keywordtype">float</span> pitch, int16_t l_x, int16_t l_y, int16_t size )
<a name="l01896"></a>01896 {
<a name="l01897"></a>01897         <span class="keywordtype">float</span> alpha;
<a name="l01898"></a>01898         uint8_t vertical=0,horizontal=0;
<a name="l01899"></a>01899         int16_t x1,x2;
<a name="l01900"></a>01900         int16_t y1,y2;
<a name="l01901"></a>01901         int16_t refx,refy;
<a name="l01902"></a>01902         alpha=angle * DEG2RAD;
<a name="l01903"></a>01903         refx=l_x + size/2;
<a name="l01904"></a>01904         refy=l_y + size/2;
<a name="l01905"></a>01905 
<a name="l01906"></a>01906         <span class="comment">//</span>
<a name="l01907"></a>01907         <span class="keywordtype">float</span> k=0;
<a name="l01908"></a>01908         <span class="keywordtype">float</span> dx = sinf(alpha)*(pitch/90.0f*(size/2));
<a name="l01909"></a>01909         <span class="keywordtype">float</span> dy = cosf(alpha)*(pitch/90.0f*(size/2));
<a name="l01910"></a>01910         int16_t x0 = (size/2)-dx;
<a name="l01911"></a>01911         int16_t y0 = (size/2)+dy;
<a name="l01912"></a>01912         <span class="comment">// calculate the line function</span>
<a name="l01913"></a>01913         <span class="keywordflow">if</span>((angle != 90) &amp;&amp; (angle != -90))
<a name="l01914"></a>01914         {
<a name="l01915"></a>01915                 k = tanf(alpha);
<a name="l01916"></a>01916                 vertical = 0;
<a name="l01917"></a>01917                 <span class="keywordflow">if</span>(k==0)
<a name="l01918"></a>01918                 {
<a name="l01919"></a>01919                         horizontal=1;
<a name="l01920"></a>01920                 }
<a name="l01921"></a>01921         }
<a name="l01922"></a>01922         <span class="keywordflow">else</span>
<a name="l01923"></a>01923         {
<a name="l01924"></a>01924                 vertical = 1;
<a name="l01925"></a>01925         }
<a name="l01926"></a>01926 
<a name="l01927"></a>01927         <span class="comment">// crossing point of line</span>
<a name="l01928"></a>01928         <span class="keywordflow">if</span>(!vertical &amp;&amp; !horizontal)
<a name="l01929"></a>01929         {
<a name="l01930"></a>01930                 <span class="comment">// y-y0=k(x-x0)</span>
<a name="l01931"></a>01931                 int16_t x=0;
<a name="l01932"></a>01932                 int16_t y=k*(x-x0)+y0;
<a name="l01933"></a>01933                 <span class="comment">// find right crossing point</span>
<a name="l01934"></a>01934                 x1=x;
<a name="l01935"></a>01935                 y1=y;
<a name="l01936"></a>01936                 <span class="keywordflow">if</span>(y&lt;0)
<a name="l01937"></a>01937                 {
<a name="l01938"></a>01938                         y1=0;
<a name="l01939"></a>01939                         x1=((y1-y0)+k*x0)/k;
<a name="l01940"></a>01940                 }
<a name="l01941"></a>01941                 <span class="keywordflow">if</span>(y&gt;size)
<a name="l01942"></a>01942                 {
<a name="l01943"></a>01943                         y1=size;
<a name="l01944"></a>01944                         x1=((y1-y0)+k*x0)/k;
<a name="l01945"></a>01945                 }
<a name="l01946"></a>01946                 <span class="comment">// left crossing point</span>
<a name="l01947"></a>01947                 x=size;
<a name="l01948"></a>01948                 y=k*(x-x0)+y0;
<a name="l01949"></a>01949                 x2=x;
<a name="l01950"></a>01950                 y2=y;
<a name="l01951"></a>01951                 <span class="keywordflow">if</span>(y&lt;0)
<a name="l01952"></a>01952                 {
<a name="l01953"></a>01953                         y2=0;
<a name="l01954"></a>01954                         x2=((y2-y0)+k*x0)/k;
<a name="l01955"></a>01955                 }
<a name="l01956"></a>01956                 <span class="keywordflow">if</span>(y&gt;size)
<a name="l01957"></a>01957                 {
<a name="l01958"></a>01958                         y2=size;
<a name="l01959"></a>01959                         x2=((y2-y0)+k*x0)/k;
<a name="l01960"></a>01960                 }
<a name="l01961"></a>01961                 <span class="comment">// move to location</span>
<a name="l01962"></a>01962                 <span class="comment">// horizon line</span>
<a name="l01963"></a>01963                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga27afef3cac2fe7bd07005b4cfdab1297">write_line_outlined</a>(x1+l_x,y1+l_y,x2+l_x,y2+l_y,0,0,0,1);
<a name="l01964"></a>01964                 <span class="comment">//fill</span>
<a name="l01965"></a>01965                 <span class="keywordflow">if</span>(angle&lt;=0 &amp;&amp; angle&gt;-90)
<a name="l01966"></a>01966                 {
<a name="l01967"></a>01967                         <span class="comment">//write_string(&quot;1&quot;, APPLY_HDEADBAND((GRAPHICS_RIGHT/2)),APPLY_VDEADBAND(GRAPHICS_BOTTOM-10), 0, 0, TEXT_VA_BOTTOM, TEXT_HA_CENTER, 0, 3);</span>
<a name="l01968"></a>01968                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=y2;i&lt;size;i++)
<a name="l01969"></a>01969                         {
<a name="l01970"></a>01970                                 x2=((i-y0)+k*x0)/k;
<a name="l01971"></a>01971                                 <span class="keywordflow">if</span>(x2&gt;size)
<a name="l01972"></a>01972                                         x2=size;
<a name="l01973"></a>01973                                 <span class="keywordflow">if</span>(x2&lt;0)
<a name="l01974"></a>01974                                         x2=0;
<a name="l01975"></a>01975                                 <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>(x2+l_x,size+l_x,i+l_y,1,1);
<a name="l01976"></a>01976                         }
<a name="l01977"></a>01977                 }
<a name="l01978"></a>01978                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(angle&lt;-90)
<a name="l01979"></a>01979                 {
<a name="l01980"></a>01980                         <span class="comment">//write_string(&quot;2&quot;, APPLY_HDEADBAND((GRAPHICS_RIGHT/2)),APPLY_VDEADBAND(GRAPHICS_BOTTOM-10), 0, 0, TEXT_VA_BOTTOM, TEXT_HA_CENTER, 0, 3);</span>
<a name="l01981"></a>01981                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;y2;i++)
<a name="l01982"></a>01982                         {
<a name="l01983"></a>01983                                 x2=((i-y0)+k*x0)/k;
<a name="l01984"></a>01984                                 <span class="keywordflow">if</span>(x2&gt;size)
<a name="l01985"></a>01985                                         x2=size;
<a name="l01986"></a>01986                                 <span class="keywordflow">if</span>(x2&lt;0)
<a name="l01987"></a>01987                                         x2=0;
<a name="l01988"></a>01988                                 <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>(size+l_x,x2+l_x,i+l_y,1,1);
<a name="l01989"></a>01989                         }
<a name="l01990"></a>01990                 }
<a name="l01991"></a>01991                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(angle&gt;0 &amp;&amp; angle&lt;90)
<a name="l01992"></a>01992                 {
<a name="l01993"></a>01993                         <span class="comment">//write_string(&quot;3&quot;, APPLY_HDEADBAND((GRAPHICS_RIGHT/2)),APPLY_VDEADBAND(GRAPHICS_BOTTOM-10), 0, 0, TEXT_VA_BOTTOM, TEXT_HA_CENTER, 0, 3);</span>
<a name="l01994"></a>01994                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=y1;i&lt;size;i++)
<a name="l01995"></a>01995                         {
<a name="l01996"></a>01996                                 x2=((i-y0)+k*x0)/k;
<a name="l01997"></a>01997                                 <span class="keywordflow">if</span>(x2&gt;size)
<a name="l01998"></a>01998                                         x2=size;
<a name="l01999"></a>01999                                 <span class="keywordflow">if</span>(x2&lt;0)
<a name="l02000"></a>02000                                         x2=0;
<a name="l02001"></a>02001                                 <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>(0+l_x,x2+l_x,i+l_y,1,1);
<a name="l02002"></a>02002                         }
<a name="l02003"></a>02003                 }
<a name="l02004"></a>02004                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(angle&gt;90)
<a name="l02005"></a>02005                 {
<a name="l02006"></a>02006                         <span class="comment">//write_string(&quot;4&quot;, APPLY_HDEADBAND((GRAPHICS_RIGHT/2)),APPLY_VDEADBAND(GRAPHICS_BOTTOM-10), 0, 0, TEXT_VA_BOTTOM, TEXT_HA_CENTER, 0, 3);</span>
<a name="l02007"></a>02007                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;y1;i++)
<a name="l02008"></a>02008                         {
<a name="l02009"></a>02009                                 x2=((i-y0)+k*x0)/k;
<a name="l02010"></a>02010                                 <span class="keywordflow">if</span>(x2&gt;size)
<a name="l02011"></a>02011                                         x2=size;
<a name="l02012"></a>02012                                 <span class="keywordflow">if</span>(x2&lt;0)
<a name="l02013"></a>02013                                         x2=0;
<a name="l02014"></a>02014                                 <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>(x2+l_x,0+l_x,i+l_y,1,1);
<a name="l02015"></a>02015                         }
<a name="l02016"></a>02016                 }
<a name="l02017"></a>02017         }
<a name="l02018"></a>02018         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(vertical)
<a name="l02019"></a>02019         {
<a name="l02020"></a>02020                 <span class="comment">// horizon line</span>
<a name="l02021"></a>02021                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga27afef3cac2fe7bd07005b4cfdab1297">write_line_outlined</a>(x0+l_x,0+l_y,x0+l_x,size+l_y,0,0,0,1);
<a name="l02022"></a>02022                 <span class="keywordflow">if</span>(angle==90)
<a name="l02023"></a>02023                 {
<a name="l02024"></a>02024                         <span class="comment">//write_string(&quot;5&quot;, APPLY_HDEADBAND((GRAPHICS_RIGHT/2)),APPLY_VDEADBAND(GRAPHICS_BOTTOM-10), 0, 0, TEXT_VA_BOTTOM, TEXT_HA_CENTER, 0, 3);</span>
<a name="l02025"></a>02025                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;size;i++)
<a name="l02026"></a>02026                         {
<a name="l02027"></a>02027                                 <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>(0+l_x,x0+l_x,i+l_y,1,1);
<a name="l02028"></a>02028                         }
<a name="l02029"></a>02029                 }
<a name="l02030"></a>02030                 <span class="keywordflow">else</span>
<a name="l02031"></a>02031                 {
<a name="l02032"></a>02032                         <span class="comment">//write_string(&quot;6&quot;, APPLY_HDEADBAND((GRAPHICS_RIGHT/2)),APPLY_VDEADBAND(GRAPHICS_BOTTOM-10), 0, 0, TEXT_VA_BOTTOM, TEXT_HA_CENTER, 0, 3);</span>
<a name="l02033"></a>02033                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;size;i++)
<a name="l02034"></a>02034                         {
<a name="l02035"></a>02035                                 <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>(size+l_x,x0+l_x,i+l_y,1,1);
<a name="l02036"></a>02036                         }
<a name="l02037"></a>02037                 }
<a name="l02038"></a>02038         }
<a name="l02039"></a>02039         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(horizontal)
<a name="l02040"></a>02040         {
<a name="l02041"></a>02041                 <span class="comment">// horizon line</span>
<a name="l02042"></a>02042                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga093e7b26837226a19a69ea698d6db954">write_hline_outlined</a>(0+l_x,size+l_x,y0+l_y,0,0,0,1);
<a name="l02043"></a>02043                 <span class="keywordflow">if</span>(angle&lt;0)
<a name="l02044"></a>02044                 {
<a name="l02045"></a>02045                         <span class="comment">//write_string(&quot;7&quot;, APPLY_HDEADBAND((GRAPHICS_RIGHT/2)),APPLY_VDEADBAND(GRAPHICS_BOTTOM-10), 0, 0, TEXT_VA_BOTTOM, TEXT_HA_CENTER, 0, 3);</span>
<a name="l02046"></a>02046                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;y0;i++)
<a name="l02047"></a>02047                         {
<a name="l02048"></a>02048                                 <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>(0+l_x,size+l_x,i+l_y,1,1);
<a name="l02049"></a>02049                         }
<a name="l02050"></a>02050                 }
<a name="l02051"></a>02051                 <span class="keywordflow">else</span>
<a name="l02052"></a>02052                 {
<a name="l02053"></a>02053                         <span class="comment">//write_string(&quot;8&quot;, APPLY_HDEADBAND((GRAPHICS_RIGHT/2)),APPLY_VDEADBAND(GRAPHICS_BOTTOM-10), 0, 0, TEXT_VA_BOTTOM, TEXT_HA_CENTER, 0, 3);</span>
<a name="l02054"></a>02054                         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=y0;i&lt;size;i++)
<a name="l02055"></a>02055                         {
<a name="l02056"></a>02056                                 <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>(0+l_x,size+l_x,i+l_y,1,1);
<a name="l02057"></a>02057                         }
<a name="l02058"></a>02058                 }
<a name="l02059"></a>02059         }
<a name="l02060"></a>02060 
<a name="l02061"></a>02061         <span class="comment">//sides</span>
<a name="l02062"></a>02062         <a class="code" href="group___o_s_d_g_e_n_module.html#ga27afef3cac2fe7bd07005b4cfdab1297">write_line_outlined</a>(l_x,l_y,l_x,l_y+size,0,0,0,1);
<a name="l02063"></a>02063         <a class="code" href="group___o_s_d_g_e_n_module.html#ga27afef3cac2fe7bd07005b4cfdab1297">write_line_outlined</a>(l_x+size,l_y,l_x+size,l_y+size,0,0,0,1);
<a name="l02064"></a>02064         <span class="comment">//plane</span>
<a name="l02065"></a>02065         <a class="code" href="group___o_s_d_g_e_n_module.html#ga27afef3cac2fe7bd07005b4cfdab1297">write_line_outlined</a>(refx-5,refy,refx+6,refy,0,0,0,1);
<a name="l02066"></a>02066         <a class="code" href="group___o_s_d_g_e_n_module.html#ga27afef3cac2fe7bd07005b4cfdab1297">write_line_outlined</a>(refx,refy,refx,refy-3,0,0,0,1);
<a name="l02067"></a>02067 }
<a name="l02068"></a>02068 
<a name="l02069"></a>02069 
<a name="l02070"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga637c8a1ae3f761c2724cebbe6f92cce6">02070</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga637c8a1ae3f761c2724cebbe6f92cce6">introText</a>(){
<a name="l02071"></a>02071         <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(<span class="stringliteral">&quot;ver 0.2&quot;</span>, APPLY_HDEADBAND((GRAPHICS_RIGHT/2)),APPLY_VDEADBAND(GRAPHICS_BOTTOM-10), 0, 0, TEXT_VA_BOTTOM, TEXT_HA_CENTER, 0, 3);
<a name="l02072"></a>02072 }
<a name="l02073"></a>02073 
<a name="l02074"></a><a class="code" href="group___o_s_d_g_e_n_module.html#gadb49e780d11eb6b7ca55b1a555b55d21">02074</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#gadb49e780d11eb6b7ca55b1a555b55d21">introGraphics</a>() {
<a name="l02075"></a>02075         <span class="comment">/* logo */</span>
<a name="l02076"></a>02076         <span class="keywordtype">int</span> image=0;
<a name="l02077"></a>02077         <span class="keyword">struct </span><a class="code" href="structsplash_entry.html">splashEntry</a> splash_info;
<a name="l02078"></a>02078         splash_info = splash[image];
<a name="l02079"></a>02079 
<a name="l02080"></a>02080         <a class="code" href="group___o_s_d_g_e_n_module.html#gaddad1c4131ec096796b78d23a4082da6">copyimage</a>(APPLY_HDEADBAND(GRAPHICS_RIGHT/2-(splash_info.width)/2), APPLY_VDEADBAND(GRAPHICS_BOTTOM/2-(splash_info.height)/2),image);
<a name="l02081"></a>02081 
<a name="l02082"></a>02082         <span class="comment">/* frame */</span>
<a name="l02083"></a>02083         <a class="code" href="group___o_s_d_g_e_n_module.html#gae399f433b1adebe10b6108074e73ee59">drawBox</a>(APPLY_HDEADBAND(0),APPLY_VDEADBAND(0),APPLY_HDEADBAND(GRAPHICS_RIGHT-8),APPLY_VDEADBAND(GRAPHICS_BOTTOM));
<a name="l02084"></a>02084 
<a name="l02085"></a>02085         <span class="comment">// Must mask out last half-word because SPI keeps clocking it out otherwise</span>
<a name="l02086"></a>02086         <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; 8; i++) {
<a name="l02087"></a>02087                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga34c98ce736d5146c81ef3b167780031f">write_vline</a>( <a class="code" href="group___o_s_d_g_e_n_module.html#ga52b5c0fc86a398ddf62c5b2bb383374d">draw_buffer_level</a>,GRAPHICS_WIDTH_REAL-i-1,0,GRAPHICS_HEIGHT_REAL-1,0);
<a name="l02088"></a>02088                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga34c98ce736d5146c81ef3b167780031f">write_vline</a>( <a class="code" href="group___o_s_d_g_e_n_module.html#ga67085db0125b910109083e4d2605d7d5">draw_buffer_mask</a>,GRAPHICS_WIDTH_REAL-i-1,0,GRAPHICS_HEIGHT_REAL-1,0);
<a name="l02089"></a>02089         }
<a name="l02090"></a>02090 }
<a name="l02091"></a>02091 
<a name="l02092"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga00457c3ec2ca140e964b76b872c7b57f">02092</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga00457c3ec2ca140e964b76b872c7b57f">calcHomeArrow</a>(int16_t m_yaw)
<a name="l02093"></a>02093 {
<a name="l02094"></a>02094         HomeLocationData home;
<a name="l02095"></a>02095         HomeLocationGet (&amp;home);
<a name="l02096"></a>02096         GPSPositionData gpsData;
<a name="l02097"></a>02097         GPSPositionGet (&amp;gpsData);
<a name="l02098"></a>02098 
<a name="l02100"></a>02100     <span class="keywordtype">float</span> lat1, lat2, lon1, lon2, a, c, d, x, y, brng, u2g;
<a name="l02101"></a>02101     <span class="keywordtype">float</span> elevation;
<a name="l02102"></a>02102     <span class="keywordtype">float</span> gcsAlt=home.Altitude; <span class="comment">// Home MSL altitude</span>
<a name="l02103"></a>02103     <span class="keywordtype">float</span> uavAlt=gpsData.Altitude; <span class="comment">// UAV MSL altitude</span>
<a name="l02104"></a>02104     <span class="keywordtype">float</span> dAlt=uavAlt-gcsAlt; <span class="comment">// Altitude difference</span>
<a name="l02105"></a>02105 
<a name="l02106"></a>02106     <span class="comment">// Convert to radians</span>
<a name="l02107"></a>02107     lat1 = home.Latitude/10000000.0f * DEG2RAD; <span class="comment">// Home lat</span>
<a name="l02108"></a>02108     lon1 = home.Longitude/10000000.0f * DEG2RAD; <span class="comment">// Home lon</span>
<a name="l02109"></a>02109     lat2 = gpsData.Latitude/10000000.0f * DEG2RAD; <span class="comment">// UAV lat</span>
<a name="l02110"></a>02110     lon2 = gpsData.Longitude/10000000.0f * DEG2RAD; <span class="comment">// UAV lon</span>
<a name="l02111"></a>02111 
<a name="l02112"></a>02112     <span class="comment">// Bearing</span>
<a name="l02119"></a>02119 <span class="comment"></span>    y = sinf(lon2-lon1) * cosf(lat2);
<a name="l02120"></a>02120     x = cosf(lat1) * sinf(lat2) - sinf(lat1) * cosf(lat2) * cosf(lon2-lon1);
<a name="l02121"></a>02121     brng = atan2f(y,x) * RAD2DEG;
<a name="l02122"></a>02122     <span class="keywordflow">if</span>(brng&lt;0)
<a name="l02123"></a>02123         brng+=360;
<a name="l02124"></a>02124 
<a name="l02125"></a>02125     <span class="comment">// yaw corrected bearing, needs compass</span>
<a name="l02126"></a>02126     u2g=brng-180-m_yaw;
<a name="l02127"></a>02127     <span class="keywordflow">if</span>(u2g&lt;0)
<a name="l02128"></a>02128         u2g+=360;
<a name="l02129"></a>02129 
<a name="l02130"></a>02130     <span class="comment">// Haversine formula for distance</span>
<a name="l02141"></a>02141 <span class="comment"></span>    a = sinf((lat2-lat1)/2) * sinf((lat2-lat1)/2) +
<a name="l02142"></a>02142             cosf(lat1) * cosf(lat2) *
<a name="l02143"></a>02143             sinf((lon2-lon1)/2) * sinf((lon2-lon1)/2);
<a name="l02144"></a>02144     c = 2 * atan2f(sqrtf(a), sqrtf(1-a));
<a name="l02145"></a>02145     d = WGS84_RADIUS_EARTH_KM * 1000 * c;
<a name="l02146"></a>02146 
<a name="l02147"></a>02147     <span class="comment">// Elevation  v depends servo direction</span>
<a name="l02148"></a>02148     <span class="keywordflow">if</span>(d!=0)
<a name="l02149"></a>02149         elevation = 90-(atanf(dAlt/d) * RAD2DEG);
<a name="l02150"></a>02150     <span class="keywordflow">else</span>
<a name="l02151"></a>02151         elevation = 0;
<a name="l02153"></a>02153 
<a name="l02154"></a>02154         <span class="keywordtype">char</span> temp[50]={0};
<a name="l02155"></a>02155         <a class="code" href="group___p_i_o_s.html#gaa0649118bc3728b2a62af0b47606ff51">sprintf</a>(temp,<span class="stringliteral">&quot;hea:%d&quot;</span>,(<span class="keywordtype">int</span>)brng);
<a name="l02156"></a>02156         <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temp, APPLY_HDEADBAND(GRAPHICS_RIGHT/2-30), APPLY_VDEADBAND(30), 0, 0, TEXT_VA_TOP, TEXT_HA_LEFT, 0, 2);
<a name="l02157"></a>02157         <a class="code" href="group___p_i_o_s.html#gaa0649118bc3728b2a62af0b47606ff51">sprintf</a>(temp,<span class="stringliteral">&quot;ele:%d&quot;</span>,(<span class="keywordtype">int</span>)elevation);
<a name="l02158"></a>02158         <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temp, APPLY_HDEADBAND(GRAPHICS_RIGHT/2-30), APPLY_VDEADBAND(30+10), 0, 0, TEXT_VA_TOP, TEXT_HA_LEFT, 0, 2);
<a name="l02159"></a>02159         <a class="code" href="group___p_i_o_s.html#gaa0649118bc3728b2a62af0b47606ff51">sprintf</a>(temp,<span class="stringliteral">&quot;dis:%d&quot;</span>,(<span class="keywordtype">int</span>)d);
<a name="l02160"></a>02160         <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temp, APPLY_HDEADBAND(GRAPHICS_RIGHT/2-30), APPLY_VDEADBAND(30+10+10), 0, 0, TEXT_VA_TOP, TEXT_HA_LEFT, 0, 2);
<a name="l02161"></a>02161         <a class="code" href="group___p_i_o_s.html#gaa0649118bc3728b2a62af0b47606ff51">sprintf</a>(temp,<span class="stringliteral">&quot;u2g:%d&quot;</span>,(<span class="keywordtype">int</span>)u2g);
<a name="l02162"></a>02162         <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temp, APPLY_HDEADBAND(GRAPHICS_RIGHT/2-30), APPLY_VDEADBAND(30+10+10+10), 0, 0, TEXT_VA_TOP, TEXT_HA_LEFT, 0, 2);
<a name="l02163"></a>02163 
<a name="l02164"></a>02164         <a class="code" href="group___p_i_o_s.html#gaa0649118bc3728b2a62af0b47606ff51">sprintf</a>(temp,<span class="stringliteral">&quot;%c%c&quot;</span>,(<span class="keywordtype">int</span>)(u2g/22.5f)*2+0x90,(<span class="keywordtype">int</span>)(u2g/22.5f)*2+0x91);
<a name="l02165"></a>02165         <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temp, APPLY_HDEADBAND(250), APPLY_VDEADBAND(40+10+10), 0, 0, TEXT_VA_TOP, TEXT_HA_LEFT, 0, 3);
<a name="l02166"></a>02166 }
<a name="l02167"></a>02167 
<a name="l02168"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga36bea199c0657c29a6c7836f8157066e">02168</a> <span class="keywordtype">int</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga36bea199c0657c29a6c7836f8157066e">lama</a>=10;
<a name="l02169"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga35258f3e002e3b7d6dc3a50b458c1ed5">02169</a> <span class="keywordtype">int</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga35258f3e002e3b7d6dc3a50b458c1ed5">lama_loc</a>[2][30];
<a name="l02170"></a>02170 
<a name="l02171"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga78f00a89c30b0c4c25cb300a153efe54">02171</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga78f00a89c30b0c4c25cb300a153efe54">lamas</a>(<span class="keywordtype">void</span>)
<a name="l02172"></a>02172 {
<a name="l02173"></a>02173         <span class="keywordtype">char</span> temp[10]={0};
<a name="l02174"></a>02174         lama++;
<a name="l02175"></a>02175         <span class="keywordflow">if</span>(lama%10==0)
<a name="l02176"></a>02176         {
<a name="l02177"></a>02177                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> z=0; z&lt;30;z++)
<a name="l02178"></a>02178                 {
<a name="l02179"></a>02179 
<a name="l02180"></a>02180                         lama_loc[0][z]=rand()%(GRAPHICS_RIGHT-10);
<a name="l02181"></a>02181                         lama_loc[1][z]=rand()%(GRAPHICS_BOTTOM-10);
<a name="l02182"></a>02182                 }
<a name="l02183"></a>02183         }
<a name="l02184"></a>02184         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> z=0; z&lt;30;z++)
<a name="l02185"></a>02185         {
<a name="l02186"></a>02186                 <a class="code" href="group___p_i_o_s.html#gaa0649118bc3728b2a62af0b47606ff51">sprintf</a>(temp,<span class="stringliteral">&quot;%c&quot;</span>,0xe8+(lama_loc[0][z]%2));
<a name="l02187"></a>02187                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temp,APPLY_HDEADBAND(lama_loc[0][z]),APPLY_VDEADBAND(lama_loc[1][z]), 0, 0, TEXT_VA_TOP, TEXT_HA_LEFT, 0, 2);
<a name="l02188"></a>02188         }
<a name="l02189"></a>02189 }
<a name="l02190"></a>02190 
<a name="l02191"></a>02191 <span class="comment">//main draw function</span>
<a name="l02192"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga2a784a5e5cba20bd454de8c32e2dcfde">02192</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga2a784a5e5cba20bd454de8c32e2dcfde">updateGraphics</a>() {
<a name="l02193"></a>02193         OsdSettingsData OsdSettings;
<a name="l02194"></a>02194         OsdSettingsGet (&amp;OsdSettings);
<a name="l02195"></a>02195         AttitudeActualData attitude;
<a name="l02196"></a>02196         AttitudeActualGet(&amp;attitude);
<a name="l02197"></a>02197         GPSPositionData gpsData;
<a name="l02198"></a>02198         GPSPositionGet(&amp;gpsData);
<a name="l02199"></a>02199         HomeLocationData home;
<a name="l02200"></a>02200         HomeLocationGet(&amp;home);
<a name="l02201"></a>02201         BaroAltitudeData baro;
<a name="l02202"></a>02202         BaroAltitudeGet(&amp;baro);
<a name="l02203"></a>02203         
<a name="l02204"></a>02204         <span class="keywordflow">switch</span> (OsdSettings.Screen) {
<a name="l02205"></a>02205                 <span class="keywordflow">case</span> 0: <span class="comment">// Dave simple</span>
<a name="l02206"></a>02206                 {
<a name="l02207"></a>02207                         <span class="keywordflow">if</span>(home.Set == <a class="code" href="group___home_location.html#ggaafc69a438eb9559e75dea074dbd94ef2a6841b255b64db1a98869cd41b32a2569">HOMELOCATION_SET_FALSE</a>)
<a name="l02208"></a>02208                         {
<a name="l02209"></a>02209                                 <span class="keywordtype">char</span> temps[20]={0};
<a name="l02210"></a>02210                                 <a class="code" href="group___p_i_o_s.html#gaa0649118bc3728b2a62af0b47606ff51">sprintf</a>(temps,<span class="stringliteral">&quot;HOME NOT SET&quot;</span>);
<a name="l02211"></a>02211                                 <span class="comment">//printTextFB(x,y,temp);</span>
<a name="l02212"></a>02212                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temps, APPLY_HDEADBAND(GRAPHICS_RIGHT/2), (GRAPHICS_BOTTOM/2), 0, 0, TEXT_VA_TOP, TEXT_HA_CENTER, 0, 3);
<a name="l02213"></a>02213                         }
<a name="l02214"></a>02214 
<a name="l02215"></a>02215                         
<a name="l02216"></a>02216                         <span class="keywordtype">char</span> temp[50]={0};
<a name="l02217"></a>02217                         memset(temp, <span class="charliteral">&#39; &#39;</span>, 40);
<a name="l02218"></a>02218                         <a class="code" href="group___p_i_o_s.html#gaa0649118bc3728b2a62af0b47606ff51">sprintf</a>(temp,<span class="stringliteral">&quot;Lat:%11.7f&quot;</span>,gpsData.Latitude/10000000.0f);
<a name="l02219"></a>02219                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temp, APPLY_HDEADBAND(20), APPLY_VDEADBAND(GRAPHICS_BOTTOM-30), 0, 0, TEXT_VA_BOTTOM, TEXT_HA_LEFT, 0, 3);
<a name="l02220"></a>02220                         <a class="code" href="group___p_i_o_s.html#gaa0649118bc3728b2a62af0b47606ff51">sprintf</a>(temp,<span class="stringliteral">&quot;Lon:%11.7f&quot;</span>,gpsData.Longitude/10000000.0f);
<a name="l02221"></a>02221                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temp, APPLY_HDEADBAND(20), APPLY_VDEADBAND(GRAPHICS_BOTTOM-10), 0, 0, TEXT_VA_BOTTOM, TEXT_HA_LEFT, 0, 3);
<a name="l02222"></a>02222                         <a class="code" href="group___p_i_o_s.html#gaa0649118bc3728b2a62af0b47606ff51">sprintf</a>(temp,<span class="stringliteral">&quot;Sat:%d&quot;</span>,(<span class="keywordtype">int</span>)gpsData.Satellites);
<a name="l02223"></a>02223                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temp, APPLY_HDEADBAND(GRAPHICS_RIGHT-40), APPLY_VDEADBAND(30), 0, 0, TEXT_VA_TOP, TEXT_HA_RIGHT, 0, 2);
<a name="l02224"></a>02224                         
<a name="l02225"></a>02225                         <span class="comment">/* Print ADC voltage FLIGHT*/</span>
<a name="l02226"></a>02226                         <a class="code" href="group___p_i_o_s.html#gaa0649118bc3728b2a62af0b47606ff51">sprintf</a>(temp,<span class="stringliteral">&quot;V:%5.2fV&quot;</span>,(<a class="code" href="group___p_i_o_s___a_d_c.html#ga99e9080cf4eb3114f15ad00364a5b4d0" title="Gets the ADC value of the given pin of the device.">PIOS_ADC_DevicePinGet</a>(PIOS_INTERNAL_ADC, 2)*3*6.1f/4096));
<a name="l02227"></a>02227                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temp, APPLY_HDEADBAND(20), APPLY_VDEADBAND(20), 0, 0, TEXT_VA_TOP, TEXT_HA_LEFT, 0, 3);
<a name="l02228"></a>02228                         
<a name="l02229"></a>02229                         <span class="keywordflow">if</span>(gpsData.Heading&gt;180)
<a name="l02230"></a>02230                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga00457c3ec2ca140e964b76b872c7b57f">calcHomeArrow</a>((int16_t)(gpsData.Heading-360));
<a name="l02231"></a>02231                         <span class="keywordflow">else</span>
<a name="l02232"></a>02232                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga00457c3ec2ca140e964b76b872c7b57f">calcHomeArrow</a>((int16_t)(gpsData.Heading));
<a name="l02233"></a>02233                 }
<a name="l02234"></a>02234                 <span class="keywordflow">break</span>;
<a name="l02235"></a>02235                 <span class="keywordflow">case</span> 1:
<a name="l02236"></a>02236                 {
<a name="l02237"></a>02237                                 <span class="comment">/*drawBox(2,2,GRAPHICS_WIDTH_REAL-4,GRAPHICS_HEIGHT_REAL-4);</span>
<a name="l02238"></a>02238 <span class="comment">                                 write_filled_rectangle(draw_buffer_mask,0,0,GRAPHICS_WIDTH_REAL-2,GRAPHICS_HEIGHT_REAL-2,0);</span>
<a name="l02239"></a>02239 <span class="comment">                                 write_filled_rectangle(draw_buffer_mask,2,2,GRAPHICS_WIDTH_REAL-4-2,GRAPHICS_HEIGHT_REAL-4-2,2);</span>
<a name="l02240"></a>02240 <span class="comment">                                 write_filled_rectangle(draw_buffer_mask,3,3,GRAPHICS_WIDTH_REAL-4-1,GRAPHICS_HEIGHT_REAL-4-1,0);*/</span>
<a name="l02241"></a>02241                                 <span class="comment">//write_filled_rectangle(draw_buffer_mask,5,5,GRAPHICS_WIDTH_REAL-4-5,GRAPHICS_HEIGHT_REAL-4-5,0);</span>
<a name="l02242"></a>02242                                 <span class="comment">//write_rectangle_outlined(10,10,GRAPHICS_WIDTH_REAL-20,GRAPHICS_HEIGHT_REAL-20,0,0);</span>
<a name="l02243"></a>02243                                 <span class="comment">//drawLine(GRAPHICS_WIDTH_REAL-1, GRAPHICS_HEIGHT_REAL-1,(GRAPHICS_WIDTH_REAL/2)-1, GRAPHICS_HEIGHT_REAL-1 );</span>
<a name="l02244"></a>02244                                 <span class="comment">//drawCircle((GRAPHICS_WIDTH_REAL/2)-1, (GRAPHICS_HEIGHT_REAL/2)-1, (GRAPHICS_HEIGHT_REAL/2)-1);</span>
<a name="l02245"></a>02245                                 <span class="comment">//drawCircle((GRAPHICS_SIZE/2)-1, (GRAPHICS_SIZE/2)-1, (GRAPHICS_SIZE/2)-2);</span>
<a name="l02246"></a>02246                                 <span class="comment">//drawLine(0, (GRAPHICS_SIZE/2)-1, GRAPHICS_SIZE-1, (GRAPHICS_SIZE/2)-1);</span>
<a name="l02247"></a>02247                                 <span class="comment">//drawLine((GRAPHICS_SIZE/2)-1, 0, (GRAPHICS_SIZE/2)-1, GRAPHICS_SIZE-1);</span>
<a name="l02248"></a>02248                                 <span class="comment">/*angleA++;</span>
<a name="l02249"></a>02249 <span class="comment">                                if(angleB&lt;=-90)</span>
<a name="l02250"></a>02250 <span class="comment">                                {</span>
<a name="l02251"></a>02251 <span class="comment">                                        sum=2;</span>
<a name="l02252"></a>02252 <span class="comment">                                }</span>
<a name="l02253"></a>02253 <span class="comment">                                if(angleB&gt;=90)</span>
<a name="l02254"></a>02254 <span class="comment">                                {</span>
<a name="l02255"></a>02255 <span class="comment">                                        sum=-2;</span>
<a name="l02256"></a>02256 <span class="comment">                                }</span>
<a name="l02257"></a>02257 <span class="comment">                                angleB+=sum;</span>
<a name="l02258"></a>02258 <span class="comment">                                angleC+=2;*/</span>
<a name="l02259"></a>02259                                 
<a name="l02260"></a>02260                                 <span class="comment">// GPS HACK</span>
<a name="l02261"></a>02261                                 <span class="keywordflow">if</span>(gpsData.Heading&gt;180)
<a name="l02262"></a>02262                                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga00457c3ec2ca140e964b76b872c7b57f">calcHomeArrow</a>((int16_t)(gpsData.Heading-360));
<a name="l02263"></a>02263                                 <span class="keywordflow">else</span>
<a name="l02264"></a>02264                                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga00457c3ec2ca140e964b76b872c7b57f">calcHomeArrow</a>((int16_t)(gpsData.Heading));
<a name="l02265"></a>02265                                 
<a name="l02266"></a>02266                                 <span class="comment">/* Draw Attitude Indicator */</span>
<a name="l02267"></a>02267                                 <span class="keywordflow">if</span>(OsdSettings.Attitude == <a class="code" href="group___osd_settings.html#ggaacff9da7fadd73b3f77732789fc3b015a9d40e6702b19dc2f4a49c4ee9d3ef2be">OSDSETTINGS_ATTITUDE_ENABLED</a>)
<a name="l02268"></a>02268                                 {
<a name="l02269"></a>02269                                         <a class="code" href="group___o_s_d_g_e_n_module.html#gab6cd6692726c21ca6a7da8b8acf01de3">drawAttitude</a>(APPLY_HDEADBAND(OsdSettings.AttitudeSetup[<a class="code" href="group___osd_settings.html#ggaafe2302d46b0c673994c2256b3024127a9d74da6dece789d168dd03fb4481f010">OSDSETTINGS_ATTITUDESETUP_X</a>]),APPLY_VDEADBAND(OsdSettings.AttitudeSetup[<a class="code" href="group___osd_settings.html#ggaafe2302d46b0c673994c2256b3024127a732a83ed7c0b5b9dce704a19f392313a">OSDSETTINGS_ATTITUDESETUP_Y</a>]),attitude.Pitch,attitude.Roll,96);
<a name="l02270"></a>02270                                 }
<a name="l02271"></a>02271                                 <span class="comment">//write_string(&quot;Hello OP-OSD&quot;, 60, 12, 1, 0, TEXT_VA_TOP, TEXT_HA_LEFT, 0, 0);</span>
<a name="l02272"></a>02272                                 <span class="comment">//printText16( 60, 12,&quot;Hello OP-OSD&quot;);</span>
<a name="l02273"></a>02273                                 
<a name="l02274"></a>02274                                 <span class="keywordtype">char</span> temp[50]={0};
<a name="l02275"></a>02275                                 memset(temp, <span class="charliteral">&#39; &#39;</span>, 40);
<a name="l02276"></a>02276                                 <a class="code" href="group___p_i_o_s.html#gaa0649118bc3728b2a62af0b47606ff51">sprintf</a>(temp,<span class="stringliteral">&quot;Lat:%11.7f&quot;</span>,gpsData.Latitude/10000000.0f);
<a name="l02277"></a>02277                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temp, APPLY_HDEADBAND(5), APPLY_VDEADBAND(5), 0, 0, TEXT_VA_TOP, TEXT_HA_LEFT, 0, 2);
<a name="l02278"></a>02278                                 <a class="code" href="group___p_i_o_s.html#gaa0649118bc3728b2a62af0b47606ff51">sprintf</a>(temp,<span class="stringliteral">&quot;Lon:%11.7f&quot;</span>,gpsData.Longitude/10000000.0f);
<a name="l02279"></a>02279                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temp, APPLY_HDEADBAND(5), APPLY_VDEADBAND(15), 0, 0, TEXT_VA_TOP, TEXT_HA_LEFT, 0, 2);
<a name="l02280"></a>02280                                 <a class="code" href="group___p_i_o_s.html#gaa0649118bc3728b2a62af0b47606ff51">sprintf</a>(temp,<span class="stringliteral">&quot;Fix:%d&quot;</span>,(<span class="keywordtype">int</span>)gpsData.Status);
<a name="l02281"></a>02281                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temp, APPLY_HDEADBAND(5), APPLY_VDEADBAND(25), 0, 0, TEXT_VA_TOP, TEXT_HA_LEFT, 0, 2);
<a name="l02282"></a>02282                                 <a class="code" href="group___p_i_o_s.html#gaa0649118bc3728b2a62af0b47606ff51">sprintf</a>(temp,<span class="stringliteral">&quot;Sat:%d&quot;</span>,(<span class="keywordtype">int</span>)gpsData.Satellites);
<a name="l02283"></a>02283                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temp, APPLY_HDEADBAND(5), APPLY_VDEADBAND(35), 0, 0, TEXT_VA_TOP, TEXT_HA_LEFT, 0, 2);
<a name="l02284"></a>02284                                 
<a name="l02285"></a>02285                                 
<a name="l02286"></a>02286                                 <span class="comment">/* Print RTC time */</span>
<a name="l02287"></a>02287                                 <span class="keywordflow">if</span>(OsdSettings.Time == <a class="code" href="group___osd_settings.html#ggafe2af3db28b01633d6435ea50b6f9092af7c374d8c3479a2ee8c8f305800275f3">OSDSETTINGS_TIME_ENABLED</a>)
<a name="l02288"></a>02288                                 {
<a name="l02289"></a>02289                                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga8b0f8e99f2bfee4a902a9d46a8714579">printTime</a>(APPLY_HDEADBAND(OsdSettings.TimeSetup[<a class="code" href="group___osd_settings.html#gga9c6b6b667b67fb2d2ea3157896adc301a7e7bd8025cbb8f5bd80505d264484c74">OSDSETTINGS_TIMESETUP_X</a>]),APPLY_VDEADBAND(OsdSettings.TimeSetup[<a class="code" href="group___osd_settings.html#gga9c6b6b667b67fb2d2ea3157896adc301a885516495bd0eb93856c4144f463dd7c">OSDSETTINGS_TIMESETUP_Y</a>]));
<a name="l02290"></a>02290                                 }
<a name="l02291"></a>02291                                 
<a name="l02292"></a>02292                                 <span class="comment">/* Print Number of detected video Lines */</span>
<a name="l02293"></a>02293                                 <a class="code" href="group___p_i_o_s.html#gaa0649118bc3728b2a62af0b47606ff51">sprintf</a>(temp,<span class="stringliteral">&quot;Lines:%4d&quot;</span>,<a class="code" href="group___p_i_o_s___v_i_d_e_o.html#ga79339656dd43737af275c88061f31458">PIOS_Video_GetOSDLines</a>());
<a name="l02294"></a>02294                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temp, APPLY_HDEADBAND((GRAPHICS_RIGHT - 8)),APPLY_VDEADBAND(5), 0, 0, TEXT_VA_TOP, TEXT_HA_RIGHT, 0, 2);
<a name="l02295"></a>02295                                 
<a name="l02296"></a>02296                                 <span class="comment">/* Print ADC voltage */</span>
<a name="l02297"></a>02297                                 <span class="comment">//sprintf(temp,&quot;Rssi:%4dV&quot;,(int)(PIOS_ADC_DevicePinGet(PIOS_INTERNAL_ADC,4)*3000/4096));</span>
<a name="l02298"></a>02298                                 <span class="comment">//write_string(temp, (GRAPHICS_WIDTH_REAL - 2),15, 0, 0, TEXT_VA_TOP, TEXT_HA_RIGHT, 0, 2);</span>
<a name="l02299"></a>02299                                 <a class="code" href="group___p_i_o_s.html#gaa0649118bc3728b2a62af0b47606ff51">sprintf</a>(temp,<span class="stringliteral">&quot;Rssi:%4.2fV&quot;</span>,(<a class="code" href="group___p_i_o_s___a_d_c.html#ga99e9080cf4eb3114f15ad00364a5b4d0" title="Gets the ADC value of the given pin of the device.">PIOS_ADC_DevicePinGet</a>(PIOS_INTERNAL_ADC,4)*3.0f/4096.0f));
<a name="l02300"></a>02300                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temp, APPLY_HDEADBAND((GRAPHICS_RIGHT - 8)),APPLY_VDEADBAND(15), 0, 0, TEXT_VA_TOP, TEXT_HA_RIGHT, 0, 2);
<a name="l02301"></a>02301                                 
<a name="l02302"></a>02302                                 <span class="comment">/* Print CPU temperature */</span>
<a name="l02303"></a>02303                                 <a class="code" href="group___p_i_o_s.html#gaa0649118bc3728b2a62af0b47606ff51">sprintf</a>(temp,<span class="stringliteral">&quot;Temp:%4.2fC&quot;</span>,(<a class="code" href="group___p_i_o_s___a_d_c.html#ga99e9080cf4eb3114f15ad00364a5b4d0" title="Gets the ADC value of the given pin of the device.">PIOS_ADC_DevicePinGet</a>(PIOS_INTERNAL_ADC,6)*0.29296875f-264));
<a name="l02304"></a>02304                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temp, APPLY_HDEADBAND((GRAPHICS_RIGHT - 8)),APPLY_VDEADBAND(25), 0, 0, TEXT_VA_TOP, TEXT_HA_RIGHT, 0, 2);
<a name="l02305"></a>02305                                 
<a name="l02306"></a>02306                                 <span class="comment">/* Print ADC voltage FLIGHT*/</span>
<a name="l02307"></a>02307                                 <a class="code" href="group___p_i_o_s.html#gaa0649118bc3728b2a62af0b47606ff51">sprintf</a>(temp,<span class="stringliteral">&quot;FltV:%4.2fV&quot;</span>,(<a class="code" href="group___p_i_o_s___a_d_c.html#ga99e9080cf4eb3114f15ad00364a5b4d0" title="Gets the ADC value of the given pin of the device.">PIOS_ADC_DevicePinGet</a>(PIOS_INTERNAL_ADC,2)*3.0f*6.1f/4096.0f));
<a name="l02308"></a>02308                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temp, APPLY_HDEADBAND((GRAPHICS_RIGHT - 8)),APPLY_VDEADBAND(35), 0, 0, TEXT_VA_TOP, TEXT_HA_RIGHT, 0, 2);
<a name="l02309"></a>02309                                 
<a name="l02310"></a>02310                                 <span class="comment">/* Print ADC voltage VIDEO*/</span>
<a name="l02311"></a>02311                                 <a class="code" href="group___p_i_o_s.html#gaa0649118bc3728b2a62af0b47606ff51">sprintf</a>(temp,<span class="stringliteral">&quot;VidV:%4.2fV&quot;</span>,(<a class="code" href="group___p_i_o_s___a_d_c.html#ga99e9080cf4eb3114f15ad00364a5b4d0" title="Gets the ADC value of the given pin of the device.">PIOS_ADC_DevicePinGet</a>(PIOS_INTERNAL_ADC,3)*3.0f*6.1f/4096.0f));
<a name="l02312"></a>02312                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga9202b1bd055f9fa88d46cec7ed412763">write_string</a>(temp, APPLY_HDEADBAND((GRAPHICS_RIGHT - 8)),APPLY_VDEADBAND(45), 0, 0, TEXT_VA_TOP, TEXT_HA_RIGHT, 0, 2);
<a name="l02313"></a>02313                                 
<a name="l02314"></a>02314                                 <span class="comment">/* Print ADC voltage RSSI */</span>
<a name="l02315"></a>02315                                 <span class="comment">//sprintf(temp,&quot;Curr:%4dA&quot;,(int)(PIOS_ADC_DevicePinGet(PIOS_INTERNAL_ADC,0)*300*61/4096));</span>
<a name="l02316"></a>02316                                 <span class="comment">//write_string(temp, (GRAPHICS_WIDTH_REAL - 2),60, 0, 0, TEXT_VA_TOP, TEXT_HA_RIGHT, 0, 2);</span>
<a name="l02317"></a>02317                                 
<a name="l02318"></a>02318                                 <span class="comment">/* Draw Battery Gauge */</span>
<a name="l02319"></a>02319                                 <span class="comment">/*m_batt++;</span>
<a name="l02320"></a>02320 <span class="comment">                                uint8_t dir=3;</span>
<a name="l02321"></a>02321 <span class="comment">                                if(m_batt==101)</span>
<a name="l02322"></a>02322 <span class="comment">                                        m_batt=0;</span>
<a name="l02323"></a>02323 <span class="comment">                                if(m_pitch&gt;0)</span>
<a name="l02324"></a>02324 <span class="comment">                                {</span>
<a name="l02325"></a>02325 <span class="comment">                                        dir=0;</span>
<a name="l02326"></a>02326 <span class="comment">                                        m_alt+=m_pitch/2;</span>
<a name="l02327"></a>02327 <span class="comment">                                }</span>
<a name="l02328"></a>02328 <span class="comment">                                else if(m_pitch&lt;0)</span>
<a name="l02329"></a>02329 <span class="comment">                                {</span>
<a name="l02330"></a>02330 <span class="comment">                                        dir=1;</span>
<a name="l02331"></a>02331 <span class="comment">                                        m_alt+=m_pitch/2;</span>
<a name="l02332"></a>02332 <span class="comment">                                }*/</span>
<a name="l02333"></a>02333 
<a name="l02334"></a>02334                                 <span class="comment">/*if(OsdSettings.Battery == OSDSETTINGS_BATTERY_ENABLED)</span>
<a name="l02335"></a>02335 <span class="comment">                                {</span>
<a name="l02336"></a>02336 <span class="comment">                                        drawBattery(APPLY_HDEADBAND(OsdSettings.BatterySetup[OSDSETTINGS_BATTERYSETUP_X]),APPLY_VDEADBAND(OsdSettings.BatterySetup[OSDSETTINGS_BATTERYSETUP_Y]),m_batt,16);</span>
<a name="l02337"></a>02337 <span class="comment">                                }*/</span>
<a name="l02338"></a>02338                                 
<a name="l02339"></a>02339                                 <span class="comment">//drawAltitude(200,50,m_alt,dir);</span>
<a name="l02340"></a>02340                                 
<a name="l02341"></a>02341                                 
<a name="l02342"></a>02342                                 <span class="comment">//drawArrow(96,GRAPHICS_HEIGHT_REAL/2,angleB,32);</span>
<a name="l02343"></a>02343                                 
<a name="l02344"></a>02344                                 <span class="comment">// Draw airspeed (left side.)</span>
<a name="l02345"></a>02345                                 <span class="keywordflow">if</span>(OsdSettings.Speed == <a class="code" href="group___osd_settings.html#gga75920d493f2f5fe4953c2c1beb93c8f5a562550e981134b9a1ba47a2f10e91409">OSDSETTINGS_SPEED_ENABLED</a>)
<a name="l02346"></a>02346                                 {
<a name="l02347"></a>02347                                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga03d95a090f293be5c864ee5334d3c287">hud_draw_vertical_scale</a>((<span class="keywordtype">int</span>)gpsData.Groundspeed, 100, -1, APPLY_HDEADBAND(OsdSettings.SpeedSetup[<a class="code" href="group___osd_settings.html#gga51a790a0000d545e412888d1b7fa3ad2a2c0f6c038fb2a233e97dc26b1921aa4b">OSDSETTINGS_SPEEDSETUP_X</a>]),
<a name="l02348"></a>02348                                                         APPLY_VDEADBAND(OsdSettings.SpeedSetup[<a class="code" href="group___osd_settings.html#gga51a790a0000d545e412888d1b7fa3ad2acb49400c717ad099d43ea35b33976c46">OSDSETTINGS_SPEEDSETUP_Y</a>]), 100, 10, 20, 7, 12, 15, 1000, HUD_VSCALE_FLAG_NO_NEGATIVE);
<a name="l02349"></a>02349                                 }
<a name="l02350"></a>02350                                 <span class="comment">// Draw altimeter (right side.)</span>
<a name="l02351"></a>02351                                 <span class="keywordflow">if</span>(OsdSettings.Altitude == <a class="code" href="group___osd_settings.html#gga662c877251c2b10a6646adb9e7b440dea5338a4d6e258e2f84042b1cedcb35cfb">OSDSETTINGS_ALTITUDE_ENABLED</a>)
<a name="l02352"></a>02352                                 {
<a name="l02353"></a>02353                                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga03d95a090f293be5c864ee5334d3c287">hud_draw_vertical_scale</a>((<span class="keywordtype">int</span>)gpsData.Altitude, 200, +1, APPLY_HDEADBAND(OsdSettings.AltitudeSetup[<a class="code" href="group___osd_settings.html#gga18264390d2835507563456b24f1dcb60a92fad892ebfdd28039568a95351919e8">OSDSETTINGS_ALTITUDESETUP_X</a>]),
<a name="l02354"></a>02354                                                         APPLY_VDEADBAND(OsdSettings.AltitudeSetup[<a class="code" href="group___osd_settings.html#gga18264390d2835507563456b24f1dcb60a592bcfde58f9c3cf02070e2d4d96c140">OSDSETTINGS_ALTITUDESETUP_Y</a>]), 100, 20, 100, 7, 12, 15, 500, 0);
<a name="l02355"></a>02355                                 }
<a name="l02356"></a>02356                                 <span class="comment">// Draw compass.</span>
<a name="l02357"></a>02357                                 <span class="keywordflow">if</span>(OsdSettings.Heading == <a class="code" href="group___osd_settings.html#gga4a6ad9b3b136b2bc0e788d823deee46fa8cfef2b18aa227d9c3da7b008eacbeed">OSDSETTINGS_HEADING_ENABLED</a>)
<a name="l02358"></a>02358                                 {
<a name="l02359"></a>02359                                         <span class="keywordflow">if</span>(attitude.Yaw&lt;0) {
<a name="l02360"></a>02360                                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga1598b1881ca23bff8a3df4c896ed4869">hud_draw_linear_compass</a>(360+attitude.Yaw, 150, 120, APPLY_HDEADBAND(OsdSettings.HeadingSetup[<a class="code" href="group___osd_settings.html#gga18a158ec456312dd7aeb13fa9e99f380a3e342c17a72e8f2f9ce5863602b6ba02">OSDSETTINGS_HEADINGSETUP_X</a>]),
<a name="l02361"></a>02361                                                                 APPLY_VDEADBAND(OsdSettings.HeadingSetup[<a class="code" href="group___osd_settings.html#gga18a158ec456312dd7aeb13fa9e99f380a8a14958b0b8a7a6ec356d9b7a7de1b49">OSDSETTINGS_HEADINGSETUP_Y</a>]), 15, 30, 7, 12, 0);
<a name="l02362"></a>02362                                         } <span class="keywordflow">else</span> {
<a name="l02363"></a>02363                                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga1598b1881ca23bff8a3df4c896ed4869">hud_draw_linear_compass</a>(attitude.Yaw, 150, 120, APPLY_HDEADBAND(OsdSettings.HeadingSetup[<a class="code" href="group___osd_settings.html#gga18a158ec456312dd7aeb13fa9e99f380a3e342c17a72e8f2f9ce5863602b6ba02">OSDSETTINGS_HEADINGSETUP_X</a>]),
<a name="l02364"></a>02364                                                                 APPLY_VDEADBAND(OsdSettings.HeadingSetup[<a class="code" href="group___osd_settings.html#gga18a158ec456312dd7aeb13fa9e99f380a8a14958b0b8a7a6ec356d9b7a7de1b49">OSDSETTINGS_HEADINGSETUP_Y</a>]), 15, 30, 7, 12, 0);
<a name="l02365"></a>02365                                         }
<a name="l02366"></a>02366                                 }
<a name="l02367"></a>02367                 }
<a name="l02368"></a>02368                 <span class="keywordflow">break</span>;
<a name="l02369"></a>02369                 <span class="keywordflow">case</span> 2:
<a name="l02370"></a>02370                 {
<a name="l02371"></a>02371                         <span class="keywordtype">int</span> size=64;
<a name="l02372"></a>02372                         <span class="keywordtype">int</span> x=((GRAPHICS_RIGHT/2)-(size/2)),y=(GRAPHICS_BOTTOM-size-2);
<a name="l02373"></a>02373                         <a class="code" href="group___o_s_d_g_e_n_module.html#gab0e4e7223434b0cf8dd683461136fcd2">draw_artificial_horizon</a>(-attitude.Roll,attitude.Pitch,APPLY_HDEADBAND(x),APPLY_VDEADBAND(y),size);
<a name="l02374"></a>02374                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga03d95a090f293be5c864ee5334d3c287">hud_draw_vertical_scale</a>((<span class="keywordtype">int</span>)gpsData.Groundspeed, 20, +1, APPLY_HDEADBAND(GRAPHICS_RIGHT-(x-1)),
<a name="l02375"></a>02375                                         APPLY_VDEADBAND(y+(size/2)), size, 5, 10, 4, 7, 10, 100, HUD_VSCALE_FLAG_NO_NEGATIVE);
<a name="l02376"></a>02376                         <span class="keywordflow">if</span>(1)
<a name="l02377"></a>02377                         {
<a name="l02378"></a>02378                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga03d95a090f293be5c864ee5334d3c287">hud_draw_vertical_scale</a>((<span class="keywordtype">int</span>)baro.Altitude, 50, -1, APPLY_HDEADBAND((x+size+1)),
<a name="l02379"></a>02379                                         APPLY_VDEADBAND(y+(size/2)), size, 10, 20, 4, 7, 10, 500, 0);
<a name="l02380"></a>02380                         }
<a name="l02381"></a>02381                         <span class="keywordflow">else</span>
<a name="l02382"></a>02382                         {
<a name="l02383"></a>02383                                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga03d95a090f293be5c864ee5334d3c287">hud_draw_vertical_scale</a>((<span class="keywordtype">int</span>)gpsData.Altitude, 50, -1, APPLY_HDEADBAND((x+size+1)),
<a name="l02384"></a>02384                                         APPLY_VDEADBAND(y+(size/2)), size, 10, 20, 4, 7, 10, 500, 0);
<a name="l02385"></a>02385                         }
<a name="l02386"></a>02386 
<a name="l02387"></a>02387                 }
<a name="l02388"></a>02388                 <span class="keywordflow">break</span>;
<a name="l02389"></a>02389                 <span class="keywordflow">case</span> 3:
<a name="l02390"></a>02390                 {
<a name="l02391"></a>02391                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga78f00a89c30b0c4c25cb300a153efe54">lamas</a>();
<a name="l02392"></a>02392                 }
<a name="l02393"></a>02393                 <span class="keywordflow">break</span>;
<a name="l02394"></a>02394         <span class="keywordflow">default</span>:
<a name="l02395"></a>02395                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga4ab8daa08074c7ccb69b2f8a1d834979">write_vline_lm</a>( APPLY_HDEADBAND(GRAPHICS_RIGHT/2),APPLY_VDEADBAND(0),APPLY_VDEADBAND(GRAPHICS_BOTTOM),1,1);
<a name="l02396"></a>02396                 <a class="code" href="group___o_s_d_g_e_n_module.html#gacf5cb2507be8b860675b466d19fa4aa8">write_hline_lm</a>( APPLY_HDEADBAND(0),APPLY_HDEADBAND(GRAPHICS_RIGHT),APPLY_VDEADBAND(GRAPHICS_BOTTOM/2),1,1);
<a name="l02397"></a>02397                 <span class="keywordflow">break</span>;
<a name="l02398"></a>02398         }
<a name="l02399"></a>02399         
<a name="l02400"></a>02400         <span class="comment">// Must mask out last half-word because SPI keeps clocking it out otherwise</span>
<a name="l02401"></a>02401         <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; 8; i++) {
<a name="l02402"></a>02402                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga34c98ce736d5146c81ef3b167780031f">write_vline</a>( <a class="code" href="group___o_s_d_g_e_n_module.html#ga52b5c0fc86a398ddf62c5b2bb383374d">draw_buffer_level</a>,GRAPHICS_WIDTH_REAL-i-1,0,GRAPHICS_HEIGHT_REAL-1,0);
<a name="l02403"></a>02403                 <a class="code" href="group___o_s_d_g_e_n_module.html#ga34c98ce736d5146c81ef3b167780031f">write_vline</a>( <a class="code" href="group___o_s_d_g_e_n_module.html#ga67085db0125b910109083e4d2605d7d5">draw_buffer_mask</a>,GRAPHICS_WIDTH_REAL-i-1,0,GRAPHICS_HEIGHT_REAL-1,0);
<a name="l02404"></a>02404         }
<a name="l02405"></a>02405 }
<a name="l02406"></a>02406 
<a name="l02407"></a><a class="code" href="group___o_s_d_g_e_n_module.html#ga368bd7bc79f8c2f6999dee52aabd7b19">02407</a> <span class="keywordtype">void</span> <a class="code" href="group___o_s_d_g_e_n_module.html#ga368bd7bc79f8c2f6999dee52aabd7b19">updateOnceEveryFrame</a>() {
<a name="l02408"></a>02408         <a class="code" href="group___o_s_d_g_e_n_module.html#gaef4730e1cc093c1b98a70d8e9241c3de">clearGraphics</a>();
<a name="l02409"></a>02409         <a class="code" href="group___o_s_d_g_e_n_module.html#ga2a784a5e5cba20bd454de8c32e2dcfde">updateGraphics</a>();
<a name="l02410"></a>02410 }
<a name="l02411"></a>02411 
<a name="l02412"></a>02412 
<a name="l02413"></a>02413 <span class="comment">// ****************</span>
<a name="l02420"></a><a class="code" href="group___o_s_d_g_e_n_module.html#gab4a7ade39ef421b0eb737497084c6c89">02420</a> <span class="comment"></span>int32_t <a class="code" href="group___o_s_d_g_e_n_module.html#gab4a7ade39ef421b0eb737497084c6c89">osdgenStart</a>(<span class="keywordtype">void</span>)
<a name="l02421"></a>02421 {
<a name="l02422"></a>02422         <span class="comment">// Start gps task</span>
<a name="l02423"></a>02423         vSemaphoreCreateBinary( <a class="code" href="group___o_s_d_g_e_n_module.html#ga34f96a89a1ad6c4649787dbc18e218e5">osdSemaphore</a>);
<a name="l02424"></a>02424         xTaskCreate(osdgenTask, (<span class="keywordtype">signed</span> <span class="keywordtype">char</span> *)<span class="stringliteral">&quot;OSDGEN&quot;</span>, STACK_SIZE_BYTES/4, NULL, TASK_PRIORITY, &amp;osdgenTaskHandle);
<a name="l02425"></a>02425         <span class="comment">//TaskMonitorAdd(TASKINFO_RUNNING_GPS, osdgenTaskHandle);</span>
<a name="l02426"></a>02426 
<a name="l02427"></a>02427         <span class="keywordflow">return</span> 0;
<a name="l02428"></a>02428 }
<a name="l02429"></a>02429 
<a name="l02435"></a><a class="code" href="group___o_s_d_g_e_n_module.html#gad5c99924576b5d8a3922949f6bc6643c">02435</a> int32_t <a class="code" href="group___o_s_d_g_e_n_module.html#gad5c99924576b5d8a3922949f6bc6643c">osdgenInitialize</a>(<span class="keywordtype">void</span>)
<a name="l02436"></a>02436 {
<a name="l02437"></a>02437         <a class="code" href="group___attitude_actual.html#ga301430d4316b3957d05b4555e91ddc60">AttitudeActualInitialize</a>();
<a name="l02438"></a>02438 <span class="preprocessor">#ifdef PIOS_INCLUDE_GPS</span>
<a name="l02439"></a>02439 <span class="preprocessor"></span>        <a class="code" href="group___g_p_s_position.html#ga7c40b2714db6dcbd1937ad9ce85f6612">GPSPositionInitialize</a>();
<a name="l02440"></a>02440 <span class="preprocessor">#if !defined(PIOS_GPS_MINIMAL)</span>
<a name="l02441"></a>02441 <span class="preprocessor"></span>        <a class="code" href="group___g_p_s_time.html#ga332e162991009e40a83069d47bc5dae1">GPSTimeInitialize</a>();
<a name="l02442"></a>02442         <a class="code" href="group___g_p_s_satellites.html#ga30e61e25b112d528115afb56cd9f56d6">GPSSatellitesInitialize</a>();
<a name="l02443"></a>02443 <span class="preprocessor">#endif</span>
<a name="l02444"></a>02444 <span class="preprocessor"></span><span class="preprocessor">#ifdef PIOS_GPS_SETS_HOMELOCATION</span>
<a name="l02445"></a>02445 <span class="preprocessor"></span>        <a class="code" href="group___home_location.html#gad85f8b5f76043ab0067b5c5b9018bedb">HomeLocationInitialize</a>();
<a name="l02446"></a>02446 <span class="preprocessor">#endif</span>
<a name="l02447"></a>02447 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l02448"></a>02448 <span class="preprocessor"></span>        <a class="code" href="group___osd_settings.html#gacf7a72e7f35ad626f7174abbdd10d333">OsdSettingsInitialize</a>();
<a name="l02449"></a>02449         <a class="code" href="group___baro_altitude.html#gad1310a7af03fb74a553fa5b8a8443a08">BaroAltitudeInitialize</a>();
<a name="l02450"></a>02450 
<a name="l02451"></a>02451         <span class="keywordflow">return</span> 0;
<a name="l02452"></a>02452 }
<a name="l02453"></a><a class="code" href="group___o_s_d_g_e_n_module.html#gabf1debb6845824a756c3194f8367323a">02453</a> <a class="code" href="group___actuator_module.html#ga3fc102c0bb02fa6b86182b6230765ca5" title="Main Actuator module task.">MODULE_INITCALL</a>(<a class="code" href="group___o_s_d_g_e_n_module.html#gad5c99924576b5d8a3922949f6bc6643c">osdgenInitialize</a>, <a class="code" href="group___o_s_d_g_e_n_module.html#gab4a7ade39ef421b0eb737497084c6c89">osdgenStart</a>)
<a name="l02454"></a>02454 
<a name="l02455"></a>02455 <span class="comment">// ****************</span>
<a name="l02460"></a>02460 <span class="comment"></span>static <span class="keywordtype">void</span> osdgenTask(<span class="keywordtype">void</span> *parameters)
<a name="l02461"></a>02461 {
<a name="l02462"></a>02462         <span class="comment">//portTickType lastSysTime;</span>
<a name="l02463"></a>02463         <span class="comment">// Loop forever</span>
<a name="l02464"></a>02464         <span class="comment">//lastSysTime = xTaskGetTickCount();</span>
<a name="l02465"></a>02465 
<a name="l02466"></a>02466         <span class="comment">// intro</span>
<a name="l02467"></a>02467         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;63; i++)
<a name="l02468"></a>02468         {
<a name="l02469"></a>02469         <span class="keywordflow">if</span>( xSemaphoreTake( <a class="code" href="group___o_s_d_g_e_n_module.html#ga34f96a89a1ad6c4649787dbc18e218e5">osdSemaphore</a>, LONG_TIME ) == pdTRUE )
<a name="l02470"></a>02470         {
<a name="l02471"></a>02471                         <a class="code" href="group___o_s_d_g_e_n_module.html#gaef4730e1cc093c1b98a70d8e9241c3de">clearGraphics</a>();
<a name="l02472"></a>02472                         <a class="code" href="group___o_s_d_g_e_n_module.html#gadb49e780d11eb6b7ca55b1a555b55d21">introGraphics</a>();
<a name="l02473"></a>02473         }
<a name="l02474"></a>02474         }
<a name="l02475"></a>02475         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;63; i++)
<a name="l02476"></a>02476         {
<a name="l02477"></a>02477         <span class="keywordflow">if</span>( xSemaphoreTake( <a class="code" href="group___o_s_d_g_e_n_module.html#ga34f96a89a1ad6c4649787dbc18e218e5">osdSemaphore</a>, LONG_TIME ) == pdTRUE )
<a name="l02478"></a>02478         {
<a name="l02479"></a>02479                         <a class="code" href="group___o_s_d_g_e_n_module.html#gaef4730e1cc093c1b98a70d8e9241c3de">clearGraphics</a>();
<a name="l02480"></a>02480                         <a class="code" href="group___o_s_d_g_e_n_module.html#gadb49e780d11eb6b7ca55b1a555b55d21">introGraphics</a>();
<a name="l02481"></a>02481                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga637c8a1ae3f761c2724cebbe6f92cce6">introText</a>();
<a name="l02482"></a>02482         }
<a name="l02483"></a>02483         }
<a name="l02484"></a>02484 
<a name="l02485"></a>02485         <span class="keywordflow">while</span> (1)
<a name="l02486"></a>02486         {
<a name="l02487"></a>02487         <span class="keywordflow">if</span>( xSemaphoreTake( <a class="code" href="group___o_s_d_g_e_n_module.html#ga34f96a89a1ad6c4649787dbc18e218e5">osdSemaphore</a>, LONG_TIME ) == pdTRUE )
<a name="l02488"></a>02488         {
<a name="l02489"></a>02489                         <a class="code" href="group___o_s_d_g_e_n_module.html#ga368bd7bc79f8c2f6999dee52aabd7b19">updateOnceEveryFrame</a>();
<a name="l02490"></a>02490         }
<a name="l02491"></a>02491                 <span class="comment">//xSemaphoreTake(osdSemaphore, portMAX_DELAY);</span>
<a name="l02492"></a>02492                 <span class="comment">//vTaskDelayUntil(&amp;lastSysTime, 10 / portTICK_RATE_MS);</span>
<a name="l02493"></a>02493         }
<a name="l02494"></a>02494 }
<a name="l02495"></a>02495 
<a name="l02496"></a>02496 
<a name="l02497"></a>02497 <span class="comment">// ****************</span>
<a name="l02498"></a>02498 
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="osdgen_8c.html">osdgen.c</a>      </li>

    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
