<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>TauLabs: /home/jb/code/TauLabs/ground/gcs/src/libs/utils/coordinateconversions.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="icon_128x128.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">TauLabs
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('coordinateconversions_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">/home/jb/code/TauLabs/ground/gcs/src/libs/utils/coordinateconversions.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="coordinateconversions_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00014"></a>00014 <span class="comment">/*</span>
<a name="l00015"></a>00015 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
<a name="l00016"></a>00016 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<a name="l00017"></a>00017 <span class="comment"> * the Free Software Foundation; either version 3 of the License, or</span>
<a name="l00018"></a>00018 <span class="comment"> * (at your option) any later version.</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> * This program is distributed in the hope that it will be useful, but</span>
<a name="l00021"></a>00021 <span class="comment"> * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
<a name="l00022"></a>00022 <span class="comment"> * or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License</span>
<a name="l00023"></a>00023 <span class="comment"> * for more details.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * You should have received a copy of the GNU General Public License along</span>
<a name="l00026"></a>00026 <span class="comment"> * with this program; if not, write to the Free Software Foundation, Inc.,</span>
<a name="l00027"></a>00027 <span class="comment"> * 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
<a name="l00028"></a>00028 <span class="comment"> */</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="coordinateconversions_8h.html">coordinateconversions.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;stdint.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;QDebug&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">#define RAD2DEG (180.0/M_PI)</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span><span class="preprocessor">#define DEG2RAD (M_PI/180.0)</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span>
<a name="l00038"></a>00038 <span class="keyword">namespace </span>Utils {
<a name="l00039"></a>00039 
<a name="l00040"></a><a class="code" href="class_utils_1_1_coordinate_conversions.html#a67dec67c0b9491d9b3135d5cc6ad67d1">00040</a> <a class="code" href="class_utils_1_1_coordinate_conversions.html#a67dec67c0b9491d9b3135d5cc6ad67d1">CoordinateConversions::CoordinateConversions</a>()
<a name="l00041"></a>00041 {
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 }
<a name="l00044"></a>00044 
<a name="l00050"></a><a class="code" href="class_utils_1_1_coordinate_conversions.html#afed986b1a4f6cee14a6cf505dd6cf8fd">00050</a> <span class="keywordtype">void</span> <a class="code" href="class_utils_1_1_coordinate_conversions.html#afed986b1a4f6cee14a6cf505dd6cf8fd">CoordinateConversions::LLA2Rne</a>(<span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#a011779f2c5f2a3505308bb1369101a54">LLA</a>[3], <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#a29600f30d6d5478f57eb98ded59e49f4">Rne</a>[3][3]){
<a name="l00051"></a>00051     <span class="keywordtype">float</span> <a class="code" href="_o_p_plots_8m.html#af000cf7fd57b63001bb8346bebb6472c">sinLat</a>, <a class="code" href="_o_p_plots_8m.html#a545ef384c76a9d0cd05e512194aadff7">sinLon</a>, <a class="code" href="_o_p_plots_8m.html#a495b98cbfa41dbf5df2090f1284568d8">cosLat</a>, <a class="code" href="_o_p_plots_8m.html#a6f7550e312de6f085807c22619b8b769">cosLon</a>;
<a name="l00052"></a>00052 
<a name="l00053"></a>00053     sinLat=(float)sin(<a class="code" href="group___aero_sim_r_c.html#gacbfd2fc3314cc3762ea0c3720979f8bc">DEG2RAD</a>*LLA[0]);
<a name="l00054"></a>00054     sinLon=(float)sin(<a class="code" href="group___aero_sim_r_c.html#gacbfd2fc3314cc3762ea0c3720979f8bc">DEG2RAD</a>*LLA[1]);
<a name="l00055"></a>00055     cosLat=(float)cos(<a class="code" href="group___aero_sim_r_c.html#gacbfd2fc3314cc3762ea0c3720979f8bc">DEG2RAD</a>*LLA[0]);
<a name="l00056"></a>00056     cosLon=(float)cos(<a class="code" href="group___aero_sim_r_c.html#gacbfd2fc3314cc3762ea0c3720979f8bc">DEG2RAD</a>*LLA[1]);
<a name="l00057"></a>00057 
<a name="l00058"></a>00058     Rne[0][0] = -sinLat*<a class="code" href="_o_p_plots_8m.html#a6f7550e312de6f085807c22619b8b769">cosLon</a>; Rne[0][1] = -sinLat*<a class="code" href="_o_p_plots_8m.html#a545ef384c76a9d0cd05e512194aadff7">sinLon</a>; Rne[0][2] = <a class="code" href="_o_p_plots_8m.html#a495b98cbfa41dbf5df2090f1284568d8">cosLat</a>;
<a name="l00059"></a>00059     Rne[1][0] = -<a class="code" href="_o_p_plots_8m.html#a545ef384c76a9d0cd05e512194aadff7">sinLon</a>;        Rne[1][1] = <a class="code" href="_o_p_plots_8m.html#a6f7550e312de6f085807c22619b8b769">cosLon</a>;         Rne[1][2] = 0;
<a name="l00060"></a>00060     Rne[2][0] = -cosLat*<a class="code" href="_o_p_plots_8m.html#a6f7550e312de6f085807c22619b8b769">cosLon</a>; Rne[2][1] = -cosLat*<a class="code" href="_o_p_plots_8m.html#a545ef384c76a9d0cd05e512194aadff7">sinLon</a>; Rne[2][2] = -<a class="code" href="_o_p_plots_8m.html#af000cf7fd57b63001bb8346bebb6472c">sinLat</a>;
<a name="l00061"></a>00061 }
<a name="l00062"></a>00062 
<a name="l00068"></a><a class="code" href="class_utils_1_1_coordinate_conversions.html#adf0d7843c3aa4616bec152ee0ec710a3">00068</a> <span class="keywordtype">void</span> <a class="code" href="class_utils_1_1_coordinate_conversions.html#adf0d7843c3aa4616bec152ee0ec710a3">CoordinateConversions::LLA2ECEF</a>(<span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#a011779f2c5f2a3505308bb1369101a54">LLA</a>[3], <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#a2533e14f69f3f2d42c293390afb6d3aa">ECEF</a>[3]){
<a name="l00069"></a>00069   <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#ab6991d210d93a78cdbdf6de1889c1259">a</a> = R_equator;           <span class="comment">// Equatorial Radius</span>
<a name="l00070"></a>00070   <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#a9425be9aab51621e317ba7ade564b570">e</a> = eccentricity;  <span class="comment">// Eccentricity</span>
<a name="l00071"></a>00071   <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#af000cf7fd57b63001bb8346bebb6472c">sinLat</a>, <a class="code" href="_o_p_plots_8m.html#a545ef384c76a9d0cd05e512194aadff7">sinLon</a>, <a class="code" href="_o_p_plots_8m.html#a495b98cbfa41dbf5df2090f1284568d8">cosLat</a>, <a class="code" href="_o_p_plots_8m.html#a6f7550e312de6f085807c22619b8b769">cosLon</a>;
<a name="l00072"></a>00072   <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#a8cc2e7240164328fdc3f0e5e21032c56">N</a>;
<a name="l00073"></a>00073 
<a name="l00074"></a>00074         sinLat=sin(<a class="code" href="group___aero_sim_r_c.html#gacbfd2fc3314cc3762ea0c3720979f8bc">DEG2RAD</a>*LLA[0]);
<a name="l00075"></a>00075         sinLon=sin(<a class="code" href="group___aero_sim_r_c.html#gacbfd2fc3314cc3762ea0c3720979f8bc">DEG2RAD</a>*LLA[1]);
<a name="l00076"></a>00076         cosLat=cos(<a class="code" href="group___aero_sim_r_c.html#gacbfd2fc3314cc3762ea0c3720979f8bc">DEG2RAD</a>*LLA[0]);
<a name="l00077"></a>00077         cosLon=cos(<a class="code" href="group___aero_sim_r_c.html#gacbfd2fc3314cc3762ea0c3720979f8bc">DEG2RAD</a>*LLA[1]);
<a name="l00078"></a>00078 
<a name="l00079"></a>00079         N = a / sqrt(1.0 - e*e*sinLat*sinLat);  <span class="comment">//prime vertical radius of curvature</span>
<a name="l00080"></a>00080 
<a name="l00081"></a>00081         ECEF[0] = (N+LLA[2])*cosLat*cosLon;
<a name="l00082"></a>00082         ECEF[1] = (N+LLA[2])*cosLat*sinLon;
<a name="l00083"></a>00083         ECEF[2] = ((1-e*<a class="code" href="_o_p_plots_8m.html#a9425be9aab51621e317ba7ade564b570">e</a>)*N + LLA[2]) * <a class="code" href="_o_p_plots_8m.html#af000cf7fd57b63001bb8346bebb6472c">sinLat</a>;
<a name="l00084"></a>00084 }
<a name="l00085"></a>00085 
<a name="l00091"></a><a class="code" href="class_utils_1_1_coordinate_conversions.html#a7051104006671c1328016dd2825b365b">00091</a> <span class="keywordtype">int</span> <a class="code" href="class_utils_1_1_coordinate_conversions.html#a7051104006671c1328016dd2825b365b">CoordinateConversions::ECEF2LLA</a>(<span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#a2533e14f69f3f2d42c293390afb6d3aa">ECEF</a>[3], <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#a011779f2c5f2a3505308bb1369101a54">LLA</a>[3])
<a name="l00092"></a>00092 {
<a name="l00093"></a>00093     <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#ab6991d210d93a78cdbdf6de1889c1259">a</a> = R_equator;           <span class="comment">// Equatorial Radius</span>
<a name="l00094"></a>00094     <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#a9425be9aab51621e317ba7ade564b570">e</a> = eccentricity;  <span class="comment">// Eccentricity</span>
<a name="l00095"></a>00095     <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#a9336ebf25087d91c818ee6e9ec29f8c1">x</a>=ECEF[0], <a class="code" href="_o_p_plots_8m.html#a2fb1c5cf58867b5bbc9a1b145a86f3a0">y</a>=ECEF[1], <a class="code" href="_o_p_plots_8m.html#a25ed1bcb423b0b7200f485fc5ff71c8e">z</a>=ECEF[2];
<a name="l00096"></a>00096     <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#afdc4c4bc9859d268f8b5d1cc44b8ab7c">Lat</a>, <a class="code" href="_o_p_plots_8m.html#a8cc2e7240164328fdc3f0e5e21032c56">N</a>, <a class="code" href="_o_p_plots_8m.html#a26ca739b495b2df3ebcbe54a4b37a5a0">NplusH</a>, <a class="code" href="_o_p_plots_8m.html#a66db7c5e4e9699c54207ab857ae72cb7">delta</a>, <a class="code" href="_o_p_plots_8m.html#a4268023e0b72098c8d8722f4573b5d3a">esLat</a>;
<a name="l00097"></a>00097     uint16_t <a class="code" href="_o_p_plots_8m.html#a1fc3ae6bd5c6a80e9b81b27fc7b7a11a">iter</a>;
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     LLA[1] = <a class="code" href="group___aero_sim_r_c.html#gabb429aecc5bba8de3564e19ded7ef104">RAD2DEG</a>*atan2(y,x);
<a name="l00100"></a>00100     N = <a class="code" href="_o_p_plots_8m.html#ab6991d210d93a78cdbdf6de1889c1259">a</a>;
<a name="l00101"></a>00101     NplusH = <a class="code" href="_o_p_plots_8m.html#a8cc2e7240164328fdc3f0e5e21032c56">N</a>;
<a name="l00102"></a>00102     delta = 1;
<a name="l00103"></a>00103     Lat = 1;
<a name="l00104"></a>00104     iter=0;
<a name="l00105"></a>00105 
<a name="l00106"></a>00106     <span class="keywordflow">while</span> (((delta &gt; 1.0e-14)||(delta &lt; -1.0e-14)) &amp;&amp; (iter &lt; 100))
<a name="l00107"></a>00107     {
<a name="l00108"></a>00108         delta = Lat - atan(z / (sqrt(x*x + y*y)*(1-(N*e*e/NplusH))));
<a name="l00109"></a>00109         Lat = Lat-<a class="code" href="_o_p_plots_8m.html#a66db7c5e4e9699c54207ab857ae72cb7">delta</a>;
<a name="l00110"></a>00110         esLat = e*sin(Lat);
<a name="l00111"></a>00111         N = a / sqrt(1 - esLat*esLat);
<a name="l00112"></a>00112         NplusH = sqrt(x*x + y*y)/cos(Lat);
<a name="l00113"></a>00113         iter += 1;
<a name="l00114"></a>00114     }
<a name="l00115"></a>00115 
<a name="l00116"></a>00116     LLA[0] = <a class="code" href="group___aero_sim_r_c.html#gabb429aecc5bba8de3564e19ded7ef104">RAD2DEG</a>*<a class="code" href="_o_p_plots_8m.html#afdc4c4bc9859d268f8b5d1cc44b8ab7c">Lat</a>;
<a name="l00117"></a>00117     LLA[2] = NplusH - <a class="code" href="_o_p_plots_8m.html#a8cc2e7240164328fdc3f0e5e21032c56">N</a>;
<a name="l00118"></a>00118 
<a name="l00119"></a>00119     <span class="keywordflow">if</span> (iter==500) <span class="keywordflow">return</span> (0);
<a name="l00120"></a>00120     <span class="keywordflow">else</span> <span class="keywordflow">return</span> (1);
<a name="l00121"></a>00121 }
<a name="l00122"></a>00122 
<a name="l00132"></a><a class="code" href="class_utils_1_1_coordinate_conversions.html#ae2c8e0f3a749495b4fce5a42dff87302">00132</a> <span class="keywordtype">int</span> <a class="code" href="class_utils_1_1_coordinate_conversions.html#ae2c8e0f3a749495b4fce5a42dff87302">CoordinateConversions::NED2LLA_HomeECEF</a>(<span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#ac1ec51a7dd6d455e7752b2436fd61a0c">BaseECEF</a>[3], <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#abb3119256791e93ec6e33c8eee7035d6">NED</a>[3], <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#a011779f2c5f2a3505308bb1369101a54">LLA</a>[3])
<a name="l00133"></a>00133 {
<a name="l00134"></a>00134     <span class="keywordtype">int</span> <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>;
<a name="l00135"></a>00135     <span class="keywordtype">double</span> BaseLLA[3];
<a name="l00136"></a>00136     <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#a2533e14f69f3f2d42c293390afb6d3aa">ECEF</a>[3];
<a name="l00137"></a>00137     <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#a29600f30d6d5478f57eb98ded59e49f4">Rne</a> [3][3];
<a name="l00138"></a>00138 
<a name="l00139"></a>00139     <span class="comment">// Get LLA address to compute conversion matrix</span>
<a name="l00140"></a>00140     <a class="code" href="class_utils_1_1_coordinate_conversions.html#a7051104006671c1328016dd2825b365b">ECEF2LLA</a>(BaseECEF, BaseLLA);
<a name="l00141"></a>00141     <a class="code" href="class_utils_1_1_coordinate_conversions.html#afed986b1a4f6cee14a6cf505dd6cf8fd">LLA2Rne</a>(BaseLLA, Rne);
<a name="l00142"></a>00142 
<a name="l00143"></a>00143     <span class="comment">/* P = ECEF + Rne&#39; * NED */</span>
<a name="l00144"></a>00144     <span class="keywordflow">for</span>(i = 0; i &lt; 3; i++)
<a name="l00145"></a>00145         ECEF[i] = BaseECEF[i] + Rne[0][i]*NED[0] + Rne[1][i]*NED[1] + Rne[2][i]*NED[2];
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     <a class="code" href="class_utils_1_1_coordinate_conversions.html#a7051104006671c1328016dd2825b365b">ECEF2LLA</a>(ECEF,LLA);
<a name="l00148"></a>00148 
<a name="l00149"></a>00149     <span class="keywordflow">return</span> 0;
<a name="l00150"></a>00150 }
<a name="l00151"></a>00151 
<a name="l00161"></a><a class="code" href="class_utils_1_1_coordinate_conversions.html#aa8dc93690408a9522db08f0a13ec12e1">00161</a> <span class="keywordtype">int</span> <a class="code" href="class_utils_1_1_coordinate_conversions.html#aa8dc93690408a9522db08f0a13ec12e1">CoordinateConversions::NED2LLA_HomeLLA</a>(<span class="keywordtype">double</span> homeLLA[3], <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#abb3119256791e93ec6e33c8eee7035d6">NED</a>[3], <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#a011779f2c5f2a3505308bb1369101a54">LLA</a>[3])
<a name="l00162"></a>00162 {
<a name="l00163"></a>00163     <span class="keywordtype">double</span> T[3];
<a name="l00164"></a>00164     T[0] = homeLLA[2]+6.378137E6f * M_PI / 180.0;
<a name="l00165"></a>00165     T[1] = cosf(homeLLA[0] * M_PI / 180.0)*(homeLLA[2]+6.378137E6f) * M_PI / 180.0;
<a name="l00166"></a>00166     T[2] = -1.0f;
<a name="l00167"></a>00167 
<a name="l00168"></a>00168     LLA[0] = homeLLA[0] + NED[0] / T[0];
<a name="l00169"></a>00169     LLA[1] = homeLLA[1] + NED[1] / T[1];
<a name="l00170"></a>00170     LLA[2] = homeLLA[2] + NED[2] / T[2];
<a name="l00171"></a>00171 
<a name="l00172"></a>00172     <span class="keywordflow">return</span> 0;
<a name="l00173"></a>00173 }
<a name="l00174"></a>00174 
<a name="l00185"></a><a class="code" href="class_utils_1_1_coordinate_conversions.html#ab6c71c876b0366488f55455d5a450013">00185</a> <span class="keywordtype">void</span> <a class="code" href="class_utils_1_1_coordinate_conversions.html#ab6c71c876b0366488f55455d5a450013">CoordinateConversions::LLA2NED_HomeECEF</a>(<span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#a011779f2c5f2a3505308bb1369101a54">LLA</a>[3], <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#ac1ec51a7dd6d455e7752b2436fd61a0c">BaseECEF</a>[3], <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#a29600f30d6d5478f57eb98ded59e49f4">Rne</a>[3][3], <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#abb3119256791e93ec6e33c8eee7035d6">NED</a>[3])
<a name="l00186"></a>00186 {
<a name="l00187"></a>00187     <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#a2533e14f69f3f2d42c293390afb6d3aa">ECEF</a>[3];
<a name="l00188"></a>00188     <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#acbb9d2dc78b59ac8322ba303b960b44b">diff</a>[3];
<a name="l00189"></a>00189 
<a name="l00190"></a>00190     <a class="code" href="class_utils_1_1_coordinate_conversions.html#adf0d7843c3aa4616bec152ee0ec710a3">LLA2ECEF</a>(LLA, ECEF);
<a name="l00191"></a>00191 
<a name="l00192"></a>00192     diff[0] = ECEF[0] - BaseECEF[0];
<a name="l00193"></a>00193     diff[1] = ECEF[1] - BaseECEF[1];
<a name="l00194"></a>00194     diff[2] = ECEF[2] - BaseECEF[2];
<a name="l00195"></a>00195 
<a name="l00196"></a>00196     NED[0] = Rne[0][0] * diff[0] + Rne[0][1] * diff[1] + Rne[0][2] * diff[2];
<a name="l00197"></a>00197     NED[1] = Rne[1][0] * diff[0] + Rne[1][1] * diff[1] + Rne[1][2] * diff[2];
<a name="l00198"></a>00198     NED[2] = Rne[2][0] * diff[0] + Rne[2][1] * diff[1] + Rne[2][2] * diff[2];
<a name="l00199"></a>00199 }
<a name="l00200"></a>00200 
<a name="l00210"></a><a class="code" href="class_utils_1_1_coordinate_conversions.html#a1dc099f580d3a37ef39bb155cc7e4e62">00210</a> <span class="keywordtype">void</span> <a class="code" href="class_utils_1_1_coordinate_conversions.html#a1dc099f580d3a37ef39bb155cc7e4e62">CoordinateConversions::LLA2NED_HomeLLA</a>(<span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#a011779f2c5f2a3505308bb1369101a54">LLA</a>[3], <span class="keywordtype">double</span> homeLLA[3], <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#abb3119256791e93ec6e33c8eee7035d6">NED</a>[3])
<a name="l00211"></a>00211 {
<a name="l00212"></a>00212     <span class="keywordtype">double</span> lat = homeLLA[0] * <a class="code" href="group___aero_sim_r_c.html#gacbfd2fc3314cc3762ea0c3720979f8bc">DEG2RAD</a>;
<a name="l00213"></a>00213     <span class="keywordtype">double</span> alt = homeLLA[2];
<a name="l00214"></a>00214 
<a name="l00215"></a>00215     <span class="keywordtype">float</span> T[3];
<a name="l00216"></a>00216     T[0] = alt+6.378137E6;
<a name="l00217"></a>00217     T[1] = cos(lat)*(alt+6.378137E6);
<a name="l00218"></a>00218     T[2] = -1.0;
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     <span class="keywordtype">float</span> dL[3] = {(LLA[0] - homeLLA[0]) * DEG2RAD,
<a name="l00221"></a>00221         (LLA[1] - homeLLA[1]) * <a class="code" href="group___aero_sim_r_c.html#gacbfd2fc3314cc3762ea0c3720979f8bc">DEG2RAD</a>,
<a name="l00222"></a>00222         (LLA[2] - homeLLA[2])};
<a name="l00223"></a>00223 
<a name="l00224"></a>00224     NED[0] = T[0] * dL[0];
<a name="l00225"></a>00225     NED[1] = T[1] * dL[1];
<a name="l00226"></a>00226     NED[2] = T[2] * dL[2];
<a name="l00227"></a>00227 }
<a name="l00228"></a>00228 
<a name="l00229"></a>00229 <span class="comment">// ****** find roll, pitch, yaw from quaternion ********</span>
<a name="l00230"></a><a class="code" href="class_utils_1_1_coordinate_conversions.html#ab31c5e9a595fae1d5754c36e612767c7">00230</a> <span class="keywordtype">void</span> <a class="code" href="class_utils_1_1_coordinate_conversions.html#ab31c5e9a595fae1d5754c36e612767c7">CoordinateConversions::Quaternion2RPY</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> q[4], <span class="keywordtype">float</span> rpy[3])
<a name="l00231"></a>00231 {
<a name="l00232"></a>00232         <span class="keywordtype">float</span> R13, R11, R12, R23, R33;
<a name="l00233"></a>00233         <span class="keywordtype">float</span> q0s = q[0] * q[0];
<a name="l00234"></a>00234         <span class="keywordtype">float</span> q1s = q[1] * q[1];
<a name="l00235"></a>00235         <span class="keywordtype">float</span> q2s = q[2] * q[2];
<a name="l00236"></a>00236         <span class="keywordtype">float</span> q3s = q[3] * q[3];
<a name="l00237"></a>00237 
<a name="l00238"></a>00238         R13 = 2 * (q[1] * q[3] - q[0] * q[2]);
<a name="l00239"></a>00239         R11 = q0s + q1s - q2s - q3s;
<a name="l00240"></a>00240         R12 = 2 * (q[1] * q[2] + q[0] * q[3]);
<a name="l00241"></a>00241         R23 = 2 * (q[2] * q[3] + q[0] * q[1]);
<a name="l00242"></a>00242         R33 = q0s - q1s - q2s + q3s;
<a name="l00243"></a>00243 
<a name="l00244"></a>00244         rpy[1] = <a class="code" href="group___aero_sim_r_c.html#gabb429aecc5bba8de3564e19ded7ef104">RAD2DEG</a> * asinf(-R13); <span class="comment">// pitch always between -pi/2 to pi/2</span>
<a name="l00245"></a>00245         rpy[2] = <a class="code" href="group___aero_sim_r_c.html#gabb429aecc5bba8de3564e19ded7ef104">RAD2DEG</a> * atan2f(R12, R11);
<a name="l00246"></a>00246         rpy[0] = <a class="code" href="group___aero_sim_r_c.html#gabb429aecc5bba8de3564e19ded7ef104">RAD2DEG</a> * atan2f(R23, R33);
<a name="l00247"></a>00247 
<a name="l00248"></a>00248         <span class="comment">//TODO: consider the cases where |R13| ~= 1, |pitch| ~= pi/2</span>
<a name="l00249"></a>00249 }
<a name="l00250"></a>00250 
<a name="l00251"></a>00251 <span class="comment">// ****** find quaternion from roll, pitch, yaw ********</span>
<a name="l00252"></a><a class="code" href="class_utils_1_1_coordinate_conversions.html#a8a980e54c71e22ba92754dc67b888741">00252</a> <span class="keywordtype">void</span> <a class="code" href="class_utils_1_1_coordinate_conversions.html#a8a980e54c71e22ba92754dc67b888741">CoordinateConversions::RPY2Quaternion</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> rpy[3], <span class="keywordtype">float</span> q[4])
<a name="l00253"></a>00253 {
<a name="l00254"></a>00254         <span class="keywordtype">float</span> phi, theta, psi;
<a name="l00255"></a>00255         <span class="keywordtype">float</span> cphi, sphi, ctheta, stheta, cpsi, spsi;
<a name="l00256"></a>00256 
<a name="l00257"></a>00257         phi = DEG2RAD * rpy[0] / 2;
<a name="l00258"></a>00258         theta = DEG2RAD * rpy[1] / 2;
<a name="l00259"></a>00259         psi = DEG2RAD * rpy[2] / 2;
<a name="l00260"></a>00260         cphi = cosf(phi);
<a name="l00261"></a>00261         sphi = sinf(phi);
<a name="l00262"></a>00262         ctheta = cosf(theta);
<a name="l00263"></a>00263         stheta = sinf(theta);
<a name="l00264"></a>00264         cpsi = cosf(psi);
<a name="l00265"></a>00265         spsi = sinf(psi);
<a name="l00266"></a>00266 
<a name="l00267"></a>00267         q[0] = cphi * ctheta * cpsi + sphi * stheta * spsi;
<a name="l00268"></a>00268         q[1] = sphi * ctheta * cpsi - cphi * stheta * spsi;
<a name="l00269"></a>00269         q[2] = cphi * stheta * cpsi + sphi * ctheta * spsi;
<a name="l00270"></a>00270         q[3] = cphi * ctheta * spsi - sphi * stheta * cpsi;
<a name="l00271"></a>00271 
<a name="l00272"></a>00272         <span class="keywordflow">if</span> (q[0] &lt; 0) {         <span class="comment">// q0 always positive for uniqueness</span>
<a name="l00273"></a>00273                 q[0] = -q[0];
<a name="l00274"></a>00274                 q[1] = -q[1];
<a name="l00275"></a>00275                 q[2] = -q[2];
<a name="l00276"></a>00276                 q[3] = -q[3];
<a name="l00277"></a>00277         }
<a name="l00278"></a>00278 }
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 <span class="comment">//** Find Rbe, that rotates a vector from earth fixed to body frame, from quaternion **</span>
<a name="l00281"></a><a class="code" href="class_utils_1_1_coordinate_conversions.html#ad702a970b22f067de795e9ebac95c58e">00281</a> <span class="keywordtype">void</span> <a class="code" href="class_utils_1_1_coordinate_conversions.html#ad702a970b22f067de795e9ebac95c58e">CoordinateConversions::Quaternion2R</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> q[4], <span class="keywordtype">float</span> Rbe[3][3])
<a name="l00282"></a>00282 {
<a name="l00283"></a>00283 
<a name="l00284"></a>00284         <span class="keywordtype">float</span> q0s = q[0] * q[0], q1s = q[1] * q[1], q2s = q[2] * q[2], q3s = q[3] * q[3];
<a name="l00285"></a>00285 
<a name="l00286"></a>00286         Rbe[0][0] = q0s + q1s - q2s - q3s;
<a name="l00287"></a>00287         Rbe[0][1] = 2 * (q[1] * q[2] + q[0] * q[3]);
<a name="l00288"></a>00288         Rbe[0][2] = 2 * (q[1] * q[3] - q[0] * q[2]);
<a name="l00289"></a>00289         Rbe[1][0] = 2 * (q[1] * q[2] - q[0] * q[3]);
<a name="l00290"></a>00290         Rbe[1][1] = q0s - q1s + q2s - q3s;
<a name="l00291"></a>00291         Rbe[1][2] = 2 * (q[2] * q[3] + q[0] * q[1]);
<a name="l00292"></a>00292         Rbe[2][0] = 2 * (q[1] * q[3] + q[0] * q[2]);
<a name="l00293"></a>00293         Rbe[2][1] = 2 * (q[2] * q[3] - q[0] * q[1]);
<a name="l00294"></a>00294         Rbe[2][2] = q0s - q1s - q2s + q3s;
<a name="l00295"></a>00295 }
<a name="l00296"></a>00296 
<a name="l00297"></a>00297 <span class="comment">//** Find quaternion vector from a rotation matrix, Rbe, a matrix which rotates a vector from earth frame to body frame **</span>
<a name="l00298"></a><a class="code" href="class_utils_1_1_coordinate_conversions.html#a7766a4e896afaf476215cc469f5003ba">00298</a> <span class="keywordtype">void</span> <a class="code" href="class_utils_1_1_coordinate_conversions.html#a7766a4e896afaf476215cc469f5003ba">CoordinateConversions::R2Quaternion</a>(<span class="keywordtype">float</span> <span class="keyword">const</span> Rbe[3][3], <span class="keywordtype">float</span> q[4])
<a name="l00299"></a>00299 {
<a name="l00300"></a>00300     qreal w, <a class="code" href="_o_p_plots_8m.html#a9336ebf25087d91c818ee6e9ec29f8c1">x</a>, <a class="code" href="_o_p_plots_8m.html#a2fb1c5cf58867b5bbc9a1b145a86f3a0">y</a>, <a class="code" href="_o_p_plots_8m.html#a25ed1bcb423b0b7200f485fc5ff71c8e">z</a>;
<a name="l00301"></a>00301 
<a name="l00302"></a>00302     <span class="comment">// w always &gt;= 0</span>
<a name="l00303"></a>00303     w = sqrt(std::max(0.0, 1.0 + Rbe[0][0] + Rbe[1][1] + Rbe[2][2])) / 2.0;
<a name="l00304"></a>00304     x = sqrt(std::max(0.0, 1.0 + Rbe[0][0] - Rbe[1][1] - Rbe[2][2])) / 2.0;
<a name="l00305"></a>00305     y = sqrt(std::max(0.0, 1.0 - Rbe[0][0] + Rbe[1][1] - Rbe[2][2])) / 2.0;
<a name="l00306"></a>00306     z = sqrt(std::max(0.0, 1.0 - Rbe[0][0] - Rbe[1][1] + Rbe[2][2])) / 2.0;
<a name="l00307"></a>00307 
<a name="l00308"></a>00308     x = copysign(x, (Rbe[1][2] - Rbe[2][1]));
<a name="l00309"></a>00309     y = copysign(y, (Rbe[2][0] - Rbe[0][2]));
<a name="l00310"></a>00310     z = copysign(z, (Rbe[0][1] - Rbe[1][0]));
<a name="l00311"></a>00311 
<a name="l00312"></a>00312     q[0]=w;
<a name="l00313"></a>00313     q[1]=<a class="code" href="_o_p_plots_8m.html#a9336ebf25087d91c818ee6e9ec29f8c1">x</a>;
<a name="l00314"></a>00314     q[2]=<a class="code" href="_o_p_plots_8m.html#a2fb1c5cf58867b5bbc9a1b145a86f3a0">y</a>;
<a name="l00315"></a>00315     q[3]=<a class="code" href="_o_p_plots_8m.html#a25ed1bcb423b0b7200f485fc5ff71c8e">z</a>;
<a name="l00316"></a>00316 }
<a name="l00317"></a>00317 
<a name="l00318"></a>00318 
<a name="l00319"></a>00319 }
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="coordinateconversions_8cpp.html">coordinateconversions.cpp</a>      </li>

    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
