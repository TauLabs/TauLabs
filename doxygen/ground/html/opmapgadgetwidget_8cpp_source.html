<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>TauLabs: /home/jb/code/TauLabs/ground/gcs/src/plugins/opmap/opmapgadgetwidget.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="icon_128x128.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">TauLabs
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('opmapgadgetwidget_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">/home/jb/code/TauLabs/ground/gcs/src/plugins/opmap/opmapgadgetwidget.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="opmapgadgetwidget_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00013"></a>00013 <span class="comment">/*</span>
<a name="l00014"></a>00014 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
<a name="l00015"></a>00015 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<a name="l00016"></a>00016 <span class="comment"> * the Free Software Foundation; either version 3 of the License, or</span>
<a name="l00017"></a>00017 <span class="comment"> * (at your option) any later version.</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> * This program is distributed in the hope that it will be useful, but</span>
<a name="l00020"></a>00020 <span class="comment"> * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
<a name="l00021"></a>00021 <span class="comment"> * or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License</span>
<a name="l00022"></a>00022 <span class="comment"> * for more details.</span>
<a name="l00023"></a>00023 <span class="comment"> *</span>
<a name="l00024"></a>00024 <span class="comment"> * You should have received a copy of the GNU General Public License along</span>
<a name="l00025"></a>00025 <span class="comment"> * with this program; if not, write to the Free Software Foundation, Inc.,</span>
<a name="l00026"></a>00026 <span class="comment"> * 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
<a name="l00027"></a>00027 <span class="comment"> */</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="opmapgadgetwidget_8h.html">opmapgadgetwidget.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;ui_opmap_widget.h&quot;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;QtGui/QApplication&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;QtGui/QHBoxLayout&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;QtGui/QVBoxLayout&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;QtGui/QClipboard&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;QtGui/QMenu&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;QStringList&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;QDir&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;QFile&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;QDateTime&gt;</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="stylehelper_8h.html">utils/stylehelper.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="homelocationutil_8h.html">utils/homelocationutil.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="worldmagmodel_8h.html">utils/worldmagmodel.h</a>&quot;</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="telemetrymanager_8h.html">uavtalk/telemetrymanager.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="uavobject_8h.html">uavobject.h</a>&quot;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;positionactual.h&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;homelocation.h&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;gpsposition.h&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;gyros.h&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;attitudeactual.h&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;positionactual.h&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;velocityactual.h&quot;</span>
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;../pathplanner/pathplannergadgetwidget.h&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;../pathplanner/waypointdialog.h&quot;</span>
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="preprocessor">#define allow_manual_home_location_move</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span>
<a name="l00064"></a>00064 <span class="comment">// *************************************************************************************</span>
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="preprocessor">#define deg_to_rad          ((double)M_PI / 180.0)</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span><span class="preprocessor">#define rad_to_deg          (180.0 / (double)M_PI)</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span>
<a name="l00069"></a>00069 <span class="preprocessor">#define earth_mean_radius   6371    // kilometers</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span>
<a name="l00071"></a>00071 <span class="preprocessor">#define max_digital_zoom    3       // maximum allowed digital zoom level</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span>
<a name="l00073"></a><a class="code" href="group___o_p_map_plugin.html#ga508cdf04246e0731ce2b58e5d72844d6">00073</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="group___o_p_map_plugin.html#ga508cdf04246e0731ce2b58e5d72844d6">safe_area_radius_list</a>[] = {5, 10, 20, 50, 100, 200, 500, 1000, 2000, 5000};   <span class="comment">// meters</span>
<a name="l00074"></a>00074 
<a name="l00075"></a><a class="code" href="group___o_p_map_plugin.html#ga42a1c15ba77f6bec7efc5e15cc2d7a6b">00075</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="group___o_p_map_plugin.html#ga42a1c15ba77f6bec7efc5e15cc2d7a6b">uav_trail_time_list</a>[] = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10};                      <span class="comment">// seconds</span>
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="group___o_p_map_plugin.html#ga8974b27951316cb97856a384f680d85e">00077</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="group___o_p_map_plugin.html#ga8974b27951316cb97856a384f680d85e">uav_trail_distance_list</a>[] = {1, 2, 5, 10, 20, 50, 100, 200, 500};             <span class="comment">// meters</span>
<a name="l00078"></a>00078 
<a name="l00079"></a><a class="code" href="group___o_p_map_plugin.html#ga924197d237c4236b05e045cf5b299e51">00079</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="group___o_p_map_plugin.html#ga924197d237c4236b05e045cf5b299e51">max_update_rate_list</a>[] = {100, 200, 500, 1000, 2000, 5000};                   <span class="comment">// milliseconds</span>
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 <span class="comment">// *************************************************************************************</span>
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 <span class="comment">// *************************************************************************************</span>
<a name="l00085"></a>00085 <span class="comment">//  NOTE: go back to SVN REV 2137 and earlier to get back to experimental waypoint support.</span>
<a name="l00086"></a>00086 <span class="comment">// *************************************************************************************</span>
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 <span class="comment">// constructor</span>
<a name="l00090"></a><a class="code" href="group___o_p_map_plugin.html#ga7fe62a2d1a8b920f3e44900dee8d9d5a">00090</a> <a class="code" href="group___o_p_map_plugin.html#ga7fe62a2d1a8b920f3e44900dee8d9d5a">OPMapGadgetWidget::OPMapGadgetWidget</a>(QWidget *parent) : QWidget(parent)
<a name="l00091"></a>00091 {
<a name="l00092"></a>00092     <span class="comment">// **************</span>
<a name="l00093"></a>00093 
<a name="l00094"></a>00094     m_widget = NULL;
<a name="l00095"></a>00095     m_map = NULL;
<a name="l00096"></a>00096     findPlaceCompleter = NULL;
<a name="l00097"></a>00097 
<a name="l00098"></a>00098     m_mouse_waypoint = NULL;
<a name="l00099"></a>00099 
<a name="l00100"></a>00100         pm = NULL;
<a name="l00101"></a>00101         obm = NULL;
<a name="l00102"></a>00102         obum = NULL;
<a name="l00103"></a>00103 
<a name="l00104"></a>00104         m_prev_tile_number = 0;
<a name="l00105"></a>00105 
<a name="l00106"></a>00106         m_min_zoom = m_max_zoom = 0;
<a name="l00107"></a>00107 
<a name="l00108"></a>00108     m_map_mode = <a class="code" href="group___o_p_map_plugin.html#gga10cb3e7dfbac87e40e00c1a8c76c16e5afdcda6e378c8e0a54e928947a5fdede8">Normal_MapMode</a>;
<a name="l00109"></a>00109 
<a name="l00110"></a>00110     m_maxUpdateRate = <a class="code" href="group___o_p_map_plugin.html#ga924197d237c4236b05e045cf5b299e51">max_update_rate_list</a>[4];  <span class="comment">// 2 seconds //SHOULDN&#39;T THIS BE LOADED FROM THE USER PREFERENCES?</span>
<a name="l00111"></a>00111 
<a name="l00112"></a>00112         m_telemetry_connected = <span class="keyword">false</span>;
<a name="l00113"></a>00113 
<a name="l00114"></a>00114         m_context_menu_lat_lon = m_mouse_lat_lon = <a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a>(0, 0);
<a name="l00115"></a>00115 
<a name="l00116"></a>00116     setMouseTracking(<span class="keyword">true</span>);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118         pm = ExtensionSystem::PluginManager::instance();
<a name="l00119"></a>00119         <span class="keywordflow">if</span> (pm)
<a name="l00120"></a>00120         {
<a name="l00121"></a>00121                 obm = pm-&gt;getObject&lt;<a class="code" href="class_u_a_v_object_manager.html">UAVObjectManager</a>&gt;();
<a name="l00122"></a>00122                 obum = pm-&gt;getObject&lt;<a class="code" href="class_u_a_v_object_util_manager.html">UAVObjectUtilManager</a>&gt;();
<a name="l00123"></a>00123         }
<a name="l00124"></a>00124 
<a name="l00125"></a>00125         <span class="comment">// **************</span>
<a name="l00126"></a>00126     <span class="comment">// get current location</span>
<a name="l00127"></a>00127 
<a name="l00128"></a>00128     <span class="keywordtype">double</span> latitude = 0;
<a name="l00129"></a>00129     <span class="keywordtype">double</span> longitude = 0;
<a name="l00130"></a>00130     <span class="keywordtype">double</span> altitude = 0;
<a name="l00131"></a>00131 
<a name="l00132"></a>00132         <span class="comment">// current position</span>
<a name="l00133"></a>00133         getUAVPosition(latitude, longitude, altitude);
<a name="l00134"></a>00134 
<a name="l00135"></a>00135     <a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a> pos_lat_lon = <a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a>(latitude, longitude);
<a name="l00136"></a>00136 
<a name="l00137"></a>00137     <span class="comment">// **************</span>
<a name="l00138"></a>00138     <span class="comment">// default home position</span>
<a name="l00139"></a>00139 
<a name="l00140"></a>00140         m_home_position.<a class="code" href="group___o_p_map_plugin.html#ga6324b0912396582281b54bc6d5a6f38a">coord</a> = pos_lat_lon;
<a name="l00141"></a>00141         m_home_position.<a class="code" href="group___o_p_map_plugin.html#ga14ce78cb516fe7a0e7f20e423e92d538">altitude</a> = altitude;
<a name="l00142"></a>00142         m_home_position.<a class="code" href="group___o_p_map_plugin.html#ga4cc9a1ca8d219f1aa6d823fab6080f02">locked</a> = <span class="keyword">false</span>;
<a name="l00143"></a>00143 
<a name="l00144"></a>00144     <span class="comment">// **************</span>
<a name="l00145"></a>00145     <span class="comment">// create the widget that holds the user controls and the map</span>
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     m_widget = <span class="keyword">new</span> Ui::OPMap_Widget();
<a name="l00148"></a>00148     m_widget-&gt;setupUi(<span class="keyword">this</span>);
<a name="l00149"></a>00149 
<a name="l00150"></a>00150     <span class="comment">// **************</span>
<a name="l00151"></a>00151     <span class="comment">// create the central map widget</span>
<a name="l00152"></a>00152 
<a name="l00153"></a>00153     m_map = <span class="keyword">new</span> <a class="code" href="classmapcontrol_1_1_o_p_map_widget.html">mapcontrol::OPMapWidget</a>();      <span class="comment">// create the map object</span>
<a name="l00154"></a>00154 
<a name="l00155"></a>00155     m_map-&gt;setFrameStyle(QFrame::NoFrame);      <span class="comment">// no border frame</span>
<a name="l00156"></a>00156     m_map-&gt;setBackgroundBrush(QBrush(<a class="code" href="class_utils_1_1_style_helper.html#a7d96ffba4103b4bac982826c2cb846e5">Utils::StyleHelper::baseColor</a>())); <span class="comment">// tile background</span>
<a name="l00157"></a>00157 
<a name="l00158"></a>00158     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gaa79e123990d6d7b2f1c45e5c2a56313d">configuration</a>-&gt;<a class="code" href="group___o_p_map_widget.html#ga18190e2acae7a12ba6b598cf25244acf" title="Button used for dragging.">DragButton</a> = Qt::LeftButton;  <span class="comment">// use the left mouse button for map dragging</span>
<a name="l00159"></a>00159 
<a name="l00160"></a>00160     m_widget-&gt;horizontalSliderZoom-&gt;setMinimum(m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gac91f92751a3ac3a5a10a6592d4213d42">MinZoom</a>());                       <span class="comment">//</span>
<a name="l00161"></a>00161     m_widget-&gt;horizontalSliderZoom-&gt;setMaximum(m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga20e653fc57f65044824fd9697d9111a8" title="Returns the maximum zoom for the map.">MaxZoom</a>() + max_digital_zoom);    <span class="comment">//</span>
<a name="l00162"></a>00162 
<a name="l00163"></a>00163         m_min_zoom = m_widget-&gt;horizontalSliderZoom-&gt;minimum(); <span class="comment">// minimum zoom we can accept</span>
<a name="l00164"></a>00164         m_max_zoom = m_widget-&gt;horizontalSliderZoom-&gt;maximum(); <span class="comment">// maximum zoom we can accept</span>
<a name="l00165"></a>00165 
<a name="l00166"></a>00166     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga24fd1f0f732f8306c89d00997f9957e1">SetMouseWheelZoomType</a>(internals::MouseWheelZoomType::MousePositionWithoutCenter);        <span class="comment">// set how the mouse wheel zoom functions</span>
<a name="l00167"></a>00167     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga9713d4bd6a80debb60fbb66d3e55ebd3">SetFollowMouse</a>(<span class="keyword">true</span>);                                    <span class="comment">// we want a contiuous mouse position reading</span>
<a name="l00168"></a>00168 
<a name="l00169"></a>00169     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gaa503c30b06667b16caa4190f8fa47f86">SetShowHome</a>(<span class="keyword">true</span>);                                       <span class="comment">// display the HOME position on the map</span>
<a name="l00170"></a>00170     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga0ced0790f99341bffe4d71cd8f1f3d61">SetShowUAV</a>(<span class="keyword">true</span>);                                        <span class="comment">// display the UAV position on the map</span>
<a name="l00171"></a>00171 
<a name="l00172"></a>00172     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga3c39e182c87b25990664fbe7dd0a9eff">Home</a>-&gt;SetSafeArea(<a class="code" href="group___o_p_map_plugin.html#ga508cdf04246e0731ce2b58e5d72844d6">safe_area_radius_list</a>[0]);                         <span class="comment">// set radius (meters) //SHOULDN&#39;T THE DEFAULT BE USER DEFINED?</span>
<a name="l00173"></a>00173     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga3c39e182c87b25990664fbe7dd0a9eff">Home</a>-&gt;SetShowSafeArea(<span class="keyword">true</span>);                                         <span class="comment">// show the safe area  //SHOULDN&#39;T THE DEFAULT BE USER DEFINED?</span>
<a name="l00174"></a>00174     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga3c39e182c87b25990664fbe7dd0a9eff">Home</a>-&gt;SetToggleRefresh(<span class="keyword">true</span>);
<a name="l00175"></a>00175 
<a name="l00176"></a>00176     <span class="keywordflow">if</span>(m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga3c39e182c87b25990664fbe7dd0a9eff">Home</a>)
<a name="l00177"></a>00177         connect(m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga3c39e182c87b25990664fbe7dd0a9eff">Home</a>,SIGNAL(homedoubleclick(HomeItem*)),<span class="keyword">this</span>,SLOT(onHomeDoubleClick(HomeItem*)));
<a name="l00178"></a>00178     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;SetTrailTime(<a class="code" href="group___o_p_map_plugin.html#ga42a1c15ba77f6bec7efc5e15cc2d7a6b">uav_trail_time_list</a>[0]);                           <span class="comment">// seconds</span>
<a name="l00179"></a>00179     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;SetTrailDistance(<a class="code" href="group___o_p_map_plugin.html#ga8974b27951316cb97856a384f680d85e">uav_trail_distance_list</a>[1]);                   <span class="comment">// meters</span>
<a name="l00180"></a>00180 
<a name="l00181"></a>00181     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;SetTrailType(UAVTrailType::ByTimeElapsed);
<a name="l00182"></a>00182     <span class="keywordflow">if</span>(m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga83798c623babeffb173d483ad1c84ccc">GPS</a>)
<a name="l00183"></a>00183     {
<a name="l00184"></a>00184         m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga83798c623babeffb173d483ad1c84ccc">GPS</a>-&gt;SetTrailTime(<a class="code" href="group___o_p_map_plugin.html#ga42a1c15ba77f6bec7efc5e15cc2d7a6b">uav_trail_time_list</a>[0]);                           <span class="comment">// seconds</span>
<a name="l00185"></a>00185         m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga83798c623babeffb173d483ad1c84ccc">GPS</a>-&gt;SetTrailDistance(<a class="code" href="group___o_p_map_plugin.html#ga8974b27951316cb97856a384f680d85e">uav_trail_distance_list</a>[1]);                   <span class="comment">// meters</span>
<a name="l00186"></a>00186 
<a name="l00187"></a>00187         m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga83798c623babeffb173d483ad1c84ccc">GPS</a>-&gt;SetTrailType(UAVTrailType::ByTimeElapsed);
<a name="l00188"></a>00188     }
<a name="l00189"></a>00189     <span class="comment">// **************</span>
<a name="l00190"></a>00190 
<a name="l00191"></a>00191     setSizePolicy(QSizePolicy::MinimumExpanding, QSizePolicy::MinimumExpanding);
<a name="l00192"></a>00192 
<a name="l00193"></a>00193     QVBoxLayout *layout = <span class="keyword">new</span> QVBoxLayout;
<a name="l00194"></a>00194     layout-&gt;setSpacing(0);
<a name="l00195"></a>00195     layout-&gt;setContentsMargins(0, 0, 0, 0);
<a name="l00196"></a>00196     layout-&gt;addWidget(m_map);
<a name="l00197"></a>00197     m_widget-&gt;mapWidget-&gt;setLayout(layout);
<a name="l00198"></a>00198 
<a name="l00199"></a>00199             m_widget-&gt;toolButtonMagicWaypointMapMode-&gt;setChecked(<span class="keyword">false</span>);
<a name="l00200"></a>00200             m_widget-&gt;toolButtonNormalMapMode-&gt;setChecked(<span class="keyword">true</span>);
<a name="l00201"></a>00201             hideMagicWaypointControls();
<a name="l00202"></a>00202 
<a name="l00203"></a>00203     m_widget-&gt;labelUAVPos-&gt;setText(<span class="stringliteral">&quot;---&quot;</span>);
<a name="l00204"></a>00204     m_widget-&gt;labelMapPos-&gt;setText(<span class="stringliteral">&quot;---&quot;</span>);
<a name="l00205"></a>00205     m_widget-&gt;labelMousePos-&gt;setText(<span class="stringliteral">&quot;---&quot;</span>);
<a name="l00206"></a>00206     m_widget-&gt;labelMapZoom-&gt;setText(<span class="stringliteral">&quot;---&quot;</span>);
<a name="l00207"></a>00207     m_widget-&gt;labelNEDCoords-&gt;setText(<span class="stringliteral">&quot;---&quot;</span>);
<a name="l00208"></a>00208 
<a name="l00209"></a>00209     m_widget-&gt;progressBarMap-&gt;setMaximum(1);
<a name="l00210"></a>00210 
<a name="l00211"></a>00211     connect(m_map, SIGNAL(zoomChanged(<span class="keywordtype">double</span>, <span class="keywordtype">double</span>, <span class="keywordtype">double</span>)), <span class="keyword">this</span>, SLOT(zoomChanged(<span class="keywordtype">double</span>, <span class="keywordtype">double</span>, <span class="keywordtype">double</span>)));                                       <span class="comment">// map zoom change signals</span>
<a name="l00212"></a>00212     connect(m_map, SIGNAL(OnCurrentPositionChanged(<a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a>)), <span class="keyword">this</span>, SLOT(OnCurrentPositionChanged(<a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a>)));    <span class="comment">// map poisition change signals</span>
<a name="l00213"></a>00213     connect(m_map, SIGNAL(OnTileLoadComplete()), <span class="keyword">this</span>, SLOT(OnTileLoadComplete()));                                     <span class="comment">// tile loading stop signals</span>
<a name="l00214"></a>00214     connect(m_map, SIGNAL(OnTileLoadStart()), <span class="keyword">this</span>, SLOT(OnTileLoadStart()));                                   <span class="comment">// tile loading start signals</span>
<a name="l00215"></a>00215     connect(m_map, SIGNAL(OnTilesStillToLoad(<span class="keywordtype">int</span>)), <span class="keyword">this</span>, SLOT(OnTilesStillToLoad(<span class="keywordtype">int</span>)));                               <span class="comment">// tile loading signals</span>
<a name="l00216"></a>00216     connect(m_map,SIGNAL(OnWayPointDoubleClicked(WayPointItem*)),<span class="keyword">this</span>,SLOT(wpDoubleClickEvent(WayPointItem*)));
<a name="l00217"></a>00217         m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga5144489a16c9bd07abbd0d8adc01656d">SetCurrentPosition</a>(m_home_position.<a class="code" href="group___o_p_map_plugin.html#ga6324b0912396582281b54bc6d5a6f38a">coord</a>);         <span class="comment">// set the map position</span>
<a name="l00218"></a>00218         m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga3c39e182c87b25990664fbe7dd0a9eff">Home</a>-&gt;SetCoord(m_home_position.<a class="code" href="group___o_p_map_plugin.html#ga6324b0912396582281b54bc6d5a6f38a">coord</a>);             <span class="comment">// set the HOME position</span>
<a name="l00219"></a>00219         m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;SetUAVPos(m_home_position.<a class="code" href="group___o_p_map_plugin.html#ga6324b0912396582281b54bc6d5a6f38a">coord</a>, 0.0);        <span class="comment">// set the UAV position</span>
<a name="l00220"></a>00220     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;update();
<a name="l00221"></a>00221     <span class="keywordflow">if</span>(m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga83798c623babeffb173d483ad1c84ccc">GPS</a>)
<a name="l00222"></a>00222         m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga83798c623babeffb173d483ad1c84ccc">GPS</a>-&gt;SetUAVPos(m_home_position.<a class="code" href="group___o_p_map_plugin.html#ga6324b0912396582281b54bc6d5a6f38a">coord</a>, 0.0);        <span class="comment">// set the GPS position</span>
<a name="l00223"></a>00223 
<a name="l00224"></a>00224     <span class="comment">// Connect to the existing model</span>
<a name="l00225"></a>00225     <a class="code" href="class_extension_system_1_1_plugin_manager.html" title="Core plugin system that manages the plugins, their life cycle and their registered objects...">ExtensionSystem::PluginManager</a> *pm = ExtensionSystem::PluginManager::instance();
<a name="l00226"></a>00226     model = pm-&gt;getObject&lt;<a class="code" href="class_flight_data_model.html">FlightDataModel</a>&gt;();
<a name="l00227"></a>00227     Q_ASSERT(model);
<a name="l00228"></a>00228 
<a name="l00229"></a>00229     <span class="comment">// Get the path planner selection model to keep the gadget in sync with the map</span>
<a name="l00230"></a>00230     selectionModel =  pm-&gt;getObject&lt;QItemSelectionModel&gt;();
<a name="l00231"></a>00231     Q_ASSERT(selectionModel);
<a name="l00232"></a>00232     mapProxy = <span class="keyword">new</span> <a class="code" href="class_model_map_proxy.html" title="The ModelMapProxy class maps from the FlightDataModel to the OPMap and provides synchronization, both when the model changes updating the UI and if it is modified on the UI propagating changes to the model.">ModelMapProxy</a>(<span class="keyword">this</span>, m_map, model, selectionModel);
<a name="l00233"></a>00233 
<a name="l00234"></a>00234     magicWayPoint=m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gad4bf26f4b1c6f177513e61bd70956360">magicWPCreate</a>();
<a name="l00235"></a>00235     magicWayPoint-&gt;setVisible(<span class="keyword">false</span>);
<a name="l00236"></a>00236 
<a name="l00237"></a>00237     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga989b4bdc242ebd97536cffb2be2193fc">setOverlayOpacity</a>(0.5);
<a name="l00238"></a>00238 
<a name="l00239"></a>00239     <span class="comment">// **************</span>
<a name="l00240"></a>00240     <span class="comment">// create various context menu (mouse right click menu) actions</span>
<a name="l00241"></a>00241 
<a name="l00242"></a>00242     createActions();
<a name="l00243"></a>00243 
<a name="l00244"></a>00244     <span class="comment">// **************</span>
<a name="l00245"></a>00245     <span class="comment">// connect to the UAVObject updates we require to become a bit aware of our environment:</span>
<a name="l00246"></a>00246 
<a name="l00247"></a>00247     <span class="keywordflow">if</span> (pm)
<a name="l00248"></a>00248     {
<a name="l00249"></a>00249         <span class="comment">// Register for Home Location state changes</span>
<a name="l00250"></a>00250         <span class="keywordflow">if</span> (obm)
<a name="l00251"></a>00251         {
<a name="l00252"></a>00252                         <a class="code" href="class_u_a_v_data_object.html">UAVDataObject</a> *obj = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_u_a_v_data_object.html">UAVDataObject</a> *<span class="keyword">&gt;</span>(obm-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gada44cdbfa55a281b78d41abcc6834dc0">getObject</a>(<a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a>(<span class="stringliteral">&quot;HomeLocation&quot;</span>)));
<a name="l00253"></a>00253             <span class="keywordflow">if</span> (obj)
<a name="l00254"></a>00254             {
<a name="l00255"></a>00255                                 connect(obj, SIGNAL(objectUpdated(<a class="code" href="class_u_a_v_object.html">UAVObject</a> *)), <span class="keyword">this</span> , SLOT(<a class="code" href="group___o_p_map_plugin.html#gae67526d9495209b93360c1fae84e3d47">homePositionUpdated</a>(<a class="code" href="class_u_a_v_object.html">UAVObject</a> *)));
<a name="l00256"></a>00256             }
<a name="l00257"></a>00257         }
<a name="l00258"></a>00258 
<a name="l00259"></a>00259         <span class="comment">// Listen to telemetry connection events</span>
<a name="l00260"></a>00260         <a class="code" href="class_telemetry_manager.html">TelemetryManager</a> *telMngr = pm-&gt;getObject&lt;<a class="code" href="class_telemetry_manager.html">TelemetryManager</a>&gt;();
<a name="l00261"></a>00261         <span class="keywordflow">if</span> (telMngr)
<a name="l00262"></a>00262         {
<a name="l00263"></a>00263             connect(telMngr, SIGNAL(connected()), <span class="keyword">this</span>, SLOT(<a class="code" href="group___o_p_map_plugin.html#gad7068b438d89bb8f2a9e31ef5ca2d708">onTelemetryConnect</a>()));
<a name="l00264"></a>00264             connect(telMngr, SIGNAL(disconnected()), <span class="keyword">this</span>, SLOT(<a class="code" href="group___o_p_map_plugin.html#ga723918dc2ebb03ce17180228e4233d06">onTelemetryDisconnect</a>()));
<a name="l00265"></a>00265         }
<a name="l00266"></a>00266     }
<a name="l00267"></a>00267 
<a name="l00268"></a>00268     <span class="comment">// **************</span>
<a name="l00269"></a>00269     <span class="comment">// create the desired timers</span>
<a name="l00270"></a>00270 
<a name="l00271"></a>00271     m_updateTimer = <span class="keyword">new</span> QTimer();
<a name="l00272"></a>00272         m_updateTimer-&gt;setInterval(m_maxUpdateRate);
<a name="l00273"></a>00273     connect(m_updateTimer, SIGNAL(timeout()), <span class="keyword">this</span>, SLOT(updatePosition()));
<a name="l00274"></a>00274     m_updateTimer-&gt;start();
<a name="l00275"></a>00275 
<a name="l00276"></a>00276     m_statusUpdateTimer = <span class="keyword">new</span> QTimer();
<a name="l00277"></a>00277         m_statusUpdateTimer-&gt;setInterval(200);
<a name="l00278"></a>00278         connect(m_statusUpdateTimer, SIGNAL(timeout()), <span class="keyword">this</span>, SLOT(updateMousePos()));
<a name="l00279"></a>00279     m_statusUpdateTimer-&gt;start();
<a name="l00280"></a>00280     <span class="comment">// **************</span>
<a name="l00281"></a>00281 
<a name="l00282"></a>00282     m_map-&gt;setFocus();
<a name="l00283"></a>00283 }
<a name="l00284"></a>00284 
<a name="l00285"></a>00285 <span class="comment">// destructor</span>
<a name="l00286"></a><a class="code" href="group___o_p_map_plugin.html#ga7c7775d0011bd9d0f8ca0219f48bc193">00286</a> <a class="code" href="group___o_p_map_plugin.html#ga7c7775d0011bd9d0f8ca0219f48bc193">OPMapGadgetWidget::~OPMapGadgetWidget</a>()
<a name="l00287"></a>00287 {
<a name="l00288"></a>00288         <span class="keywordflow">if</span> (m_map)
<a name="l00289"></a>00289         {
<a name="l00290"></a>00290                 disconnect(m_map, 0, 0, 0);
<a name="l00291"></a>00291                 m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gaa503c30b06667b16caa4190f8fa47f86">SetShowHome</a>(<span class="keyword">false</span>);      <span class="comment">// doing this appears to stop the map lib crashing on exit</span>
<a name="l00292"></a>00292                 m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga0ced0790f99341bffe4d71cd8f1f3d61">SetShowUAV</a>(<span class="keyword">false</span>);       <span class="comment">//   &quot;          &quot;</span>
<a name="l00293"></a>00293         }
<a name="l00294"></a>00294 
<a name="l00295"></a>00295         <span class="keywordflow">if</span> (m_map)
<a name="l00296"></a>00296         {
<a name="l00297"></a>00297                 <span class="keyword">delete</span> m_map;
<a name="l00298"></a>00298                 m_map = NULL;
<a name="l00299"></a>00299         }
<a name="l00300"></a>00300 
<a name="l00301"></a>00301     <span class="keywordflow">if</span>(!mapProxy.isNull())
<a name="l00302"></a>00302         <span class="keyword">delete</span> mapProxy;
<a name="l00303"></a>00303 }
<a name="l00304"></a>00304 
<a name="l00305"></a>00305 <span class="comment">// *************************************************************************************</span>
<a name="l00306"></a>00306 <span class="comment">// widget signals .. the mouseMoveEvent does not get called - don&#39;t yet know why</span>
<a name="l00307"></a>00307 
<a name="l00308"></a><a class="code" href="group___o_p_map_plugin.html#ga5364db038789e0e4ad94ae0606391100">00308</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#ga5364db038789e0e4ad94ae0606391100">OPMapGadgetWidget::resizeEvent</a>(QResizeEvent *event)
<a name="l00309"></a>00309 {
<a name="l00310"></a>00310     <a class="code" href="group___o_p_map_plugin.html#ga5364db038789e0e4ad94ae0606391100">QWidget::resizeEvent</a>(event);
<a name="l00311"></a>00311 }
<a name="l00312"></a>00312 
<a name="l00313"></a><a class="code" href="group___o_p_map_plugin.html#gac0a4e19ec058721095f125dfba28ea79">00313</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#gac0a4e19ec058721095f125dfba28ea79">OPMapGadgetWidget::mouseMoveEvent</a>(QMouseEvent *event)
<a name="l00314"></a>00314 {
<a name="l00315"></a>00315     <span class="keywordflow">if</span> (m_widget &amp;&amp; m_map)
<a name="l00316"></a>00316     {
<a name="l00317"></a>00317     }
<a name="l00318"></a>00318 
<a name="l00319"></a>00319     <span class="keywordflow">if</span> (event-&gt;buttons() &amp; Qt::LeftButton)
<a name="l00320"></a>00320     {
<a name="l00321"></a>00321     }
<a name="l00322"></a>00322     <a class="code" href="group___o_p_map_plugin.html#gac0a4e19ec058721095f125dfba28ea79">QWidget::mouseMoveEvent</a>(event);
<a name="l00323"></a>00323 }
<a name="l00324"></a>00324 <span class="keywordtype">void</span> OPMapGadgetWidget::wpDoubleClickEvent(WayPointItem  *wp)
<a name="l00325"></a>00325 {
<a name="l00326"></a>00326         m_mouse_waypoint = wp;
<a name="l00327"></a>00327         onEditWayPointAct_triggered();
<a name="l00328"></a>00328 }
<a name="l00329"></a>00329 
<a name="l00330"></a><a class="code" href="group___o_p_map_plugin.html#gab4575b0db17580cc1a575aafa2fc5710">00330</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#gab4575b0db17580cc1a575aafa2fc5710">OPMapGadgetWidget::contextMenuEvent</a>(QContextMenuEvent *event)
<a name="l00331"></a>00331 {   <span class="comment">// the user has right clicked on the map - create the pop-up context menu and display it</span>
<a name="l00332"></a>00332 
<a name="l00333"></a>00333     <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> <a class="code" href="uavobjecttemplate_8m.html#a3691308f2a4c2f6983f2880d32e29c84">s</a>;
<a name="l00334"></a>00334 
<a name="l00335"></a>00335     <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l00336"></a>00336         <span class="keywordflow">return</span>;
<a name="l00337"></a>00337 
<a name="l00338"></a>00338     <span class="keywordflow">if</span> (event-&gt;reason() != QContextMenuEvent::Mouse)
<a name="l00339"></a>00339         <span class="keywordflow">return</span>; <span class="comment">// not a mouse click event</span>
<a name="l00340"></a>00340 
<a name="l00341"></a>00341     <span class="comment">// current mouse position</span>
<a name="l00342"></a>00342     QPoint p = m_map-&gt;mapFromGlobal(event-&gt;globalPos());
<a name="l00343"></a>00343     m_context_menu_lat_lon = m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga350ef32ca621e11b3d5a2d3fe4aeaca6">GetFromLocalToLatLng</a>(p);
<a name="l00344"></a>00344 
<a name="l00345"></a>00345     <span class="keywordflow">if</span> (!m_map-&gt;contentsRect().contains(p))
<a name="l00346"></a>00346         <span class="keywordflow">return</span>;                                     <span class="comment">// the mouse click was not on the map</span>
<a name="l00347"></a>00347 
<a name="l00348"></a>00348     <span class="comment">// show the mouse position</span>
<a name="l00349"></a>00349     s = QString::number(m_context_menu_lat_lon.<a class="code" href="group___o_p_map_widget.html#gacf58e663626e5a88876d68937505dc64">Lat</a>(), <span class="charliteral">&#39;f&#39;</span>, 7) + <span class="stringliteral">&quot;  &quot;</span> + QString::number(m_context_menu_lat_lon.<a class="code" href="group___o_p_map_widget.html#ga2a02db7101a66a3c2e5f536e60b38423">Lng</a>(), <span class="charliteral">&#39;f&#39;</span>, 7);
<a name="l00350"></a>00350     m_widget-&gt;labelMousePos-&gt;setText(s);
<a name="l00351"></a>00351 
<a name="l00352"></a>00352     <span class="comment">// find out if we have a waypoint under the mouse cursor</span>
<a name="l00353"></a>00353     QGraphicsItem *item = m_map-&gt;itemAt(p);
<a name="l00354"></a>00354     m_mouse_waypoint = qgraphicsitem_cast&lt;<a class="code" href="classmapcontrol_1_1_way_point_item.html" title="A QGraphicsItem representing a WayPoint.">mapcontrol::WayPointItem</a> *&gt;(item);
<a name="l00355"></a>00355 
<a name="l00356"></a>00356     <span class="comment">// find out if the waypoint is locked (or not)</span>
<a name="l00357"></a>00357     <span class="keywordtype">bool</span> waypoint_locked = <span class="keyword">false</span>;
<a name="l00358"></a>00358     <span class="keywordflow">if</span> (m_mouse_waypoint)
<a name="l00359"></a>00359         waypoint_locked = (m_mouse_waypoint-&gt;flags() &amp; QGraphicsItem::ItemIsMovable) == 0;
<a name="l00360"></a>00360 
<a name="l00361"></a>00361     <span class="comment">// ****************</span>
<a name="l00362"></a>00362     <span class="comment">// Dynamically create the popup menu</span>
<a name="l00363"></a>00363 
<a name="l00364"></a>00364     contextMenu.addAction(closeAct1);
<a name="l00365"></a>00365     contextMenu.addSeparator();
<a name="l00366"></a>00366     contextMenu.addAction(reloadAct);
<a name="l00367"></a>00367     contextMenu.addSeparator();
<a name="l00368"></a>00368     contextMenu.addAction(ripAct);
<a name="l00369"></a>00369     contextMenu.addSeparator();
<a name="l00370"></a>00370 
<a name="l00371"></a>00371     QMenu maxUpdateRateSubMenu(tr(<span class="stringliteral">&quot;&amp;Max Update Rate &quot;</span>) + <span class="stringliteral">&quot;(&quot;</span> + QString::number(m_maxUpdateRate) + <span class="stringliteral">&quot; ms)&quot;</span>, <span class="keyword">this</span>);
<a name="l00372"></a>00372     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; maxUpdateRateAct.count(); <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)
<a name="l00373"></a>00373         maxUpdateRateSubMenu.addAction(maxUpdateRateAct.at(<a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>));
<a name="l00374"></a>00374     contextMenu.addMenu(&amp;maxUpdateRateSubMenu);
<a name="l00375"></a>00375 
<a name="l00376"></a>00376     contextMenu.addSeparator();
<a name="l00377"></a>00377 
<a name="l00378"></a>00378     <span class="keywordflow">switch</span> (m_map_mode)
<a name="l00379"></a>00379     {
<a name="l00380"></a>00380         <span class="keywordflow">case</span> <a class="code" href="group___o_p_map_plugin.html#gga10cb3e7dfbac87e40e00c1a8c76c16e5afdcda6e378c8e0a54e928947a5fdede8">Normal_MapMode</a>: s = tr(<span class="stringliteral">&quot; (Normal)&quot;</span>); <span class="keywordflow">break</span>;
<a name="l00381"></a>00381         <span class="keywordflow">case</span> <a class="code" href="group___o_p_map_plugin.html#gga10cb3e7dfbac87e40e00c1a8c76c16e5abdc1c0b7296fb52149bbda0739034825">MagicWaypoint_MapMode</a>: s = tr(<span class="stringliteral">&quot; (Magic Waypoint)&quot;</span>); <span class="keywordflow">break</span>;
<a name="l00382"></a>00382         <span class="keywordflow">default</span>: s = tr(<span class="stringliteral">&quot; (Unknown)&quot;</span>); <span class="keywordflow">break</span>;
<a name="l00383"></a>00383     }
<a name="l00384"></a>00384     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; mapModeAct.count(); <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)
<a name="l00385"></a>00385     {   <span class="comment">// set the menu to checked (or not)</span>
<a name="l00386"></a>00386         QAction *act = mapModeAct.at(<a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>);
<a name="l00387"></a>00387         <span class="keywordflow">if</span> (!act) <span class="keywordflow">continue</span>;
<a name="l00388"></a>00388         <span class="keywordflow">if</span> (act-&gt;data().toInt() == (int)m_map_mode)
<a name="l00389"></a>00389             act-&gt;setChecked(<span class="keyword">true</span>);
<a name="l00390"></a>00390     }
<a name="l00391"></a>00391     QMenu mapModeSubMenu(tr(<span class="stringliteral">&quot;Map mode&quot;</span>) + s, <span class="keyword">this</span>);
<a name="l00392"></a>00392     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; mapModeAct.count(); <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)
<a name="l00393"></a>00393         mapModeSubMenu.addAction(mapModeAct.at(<a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>));
<a name="l00394"></a>00394     contextMenu.addMenu(&amp;mapModeSubMenu);
<a name="l00395"></a>00395 
<a name="l00396"></a>00396     contextMenu.addSeparator();
<a name="l00397"></a>00397 
<a name="l00398"></a>00398     QMenu copySubMenu(tr(<span class="stringliteral">&quot;Copy&quot;</span>), <span class="keyword">this</span>);
<a name="l00399"></a>00399     copySubMenu.addAction(copyMouseLatLonToClipAct);
<a name="l00400"></a>00400     copySubMenu.addAction(copyMouseLatToClipAct);
<a name="l00401"></a>00401     copySubMenu.addAction(copyMouseLonToClipAct);
<a name="l00402"></a>00402     contextMenu.addMenu(&amp;copySubMenu);
<a name="l00403"></a>00403 
<a name="l00404"></a>00404     contextMenu.addSeparator();
<a name="l00405"></a>00405     contextMenu.addAction(changeDefaultLocalAndZoom);
<a name="l00406"></a>00406     contextMenu.addSeparator();
<a name="l00407"></a>00407 
<a name="l00408"></a>00408     QMenu safeArea(<span class="stringliteral">&quot;Safety Area definitions&quot;</span>);
<a name="l00409"></a>00409    <span class="comment">// menu.addAction(showSafeAreaAct);</span>
<a name="l00410"></a>00410     QMenu safeAreaSubMenu(tr(<span class="stringliteral">&quot;Safe Area Radius&quot;</span>) + <span class="stringliteral">&quot; (&quot;</span> + QString::number(m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga3c39e182c87b25990664fbe7dd0a9eff">Home</a>-&gt;SafeArea()) + <span class="stringliteral">&quot;m)&quot;</span>, <span class="keyword">this</span>);
<a name="l00411"></a>00411     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; safeAreaAct.count(); <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)
<a name="l00412"></a>00412         safeAreaSubMenu.addAction(safeAreaAct.at(<a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>));
<a name="l00413"></a>00413     safeArea.addMenu(&amp;safeAreaSubMenu);
<a name="l00414"></a>00414     safeArea.addAction(showSafeAreaAct);
<a name="l00415"></a>00415     contextMenu.addMenu(&amp;safeArea);
<a name="l00416"></a>00416 
<a name="l00417"></a>00417     contextMenu.addSeparator();
<a name="l00418"></a>00418 
<a name="l00419"></a>00419     contextMenu.addAction(showCompassAct);
<a name="l00420"></a>00420 
<a name="l00421"></a>00421     contextMenu.addAction(showDiagnostics);
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     contextMenu.addAction(showUAVInfo);
<a name="l00424"></a>00424 
<a name="l00425"></a>00425     contextMenu.addSeparator()-&gt;setText(tr(<span class="stringliteral">&quot;Zoom&quot;</span>));
<a name="l00426"></a>00426 
<a name="l00427"></a>00427     contextMenu.addAction(zoomInAct);
<a name="l00428"></a>00428     contextMenu.addAction(zoomOutAct);
<a name="l00429"></a>00429 
<a name="l00430"></a>00430     QMenu zoomSubMenu(tr(<span class="stringliteral">&quot;&amp;Zoom &quot;</span>) + <span class="stringliteral">&quot;(&quot;</span> + QString::number(m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga2060cbfea71913a458f3a6f0c6dad8c5">ZoomTotal</a>()) + <span class="stringliteral">&quot;)&quot;</span>, <span class="keyword">this</span>);
<a name="l00431"></a>00431     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; zoomAct.count(); <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)
<a name="l00432"></a>00432         zoomSubMenu.addAction(zoomAct.at(<a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>));
<a name="l00433"></a>00433     contextMenu.addMenu(&amp;zoomSubMenu);
<a name="l00434"></a>00434 
<a name="l00435"></a>00435     contextMenu.addSeparator();
<a name="l00436"></a>00436 
<a name="l00437"></a>00437     contextMenu.addAction(goMouseClickAct);
<a name="l00438"></a>00438 
<a name="l00439"></a>00439     contextMenu.addSeparator()-&gt;setText(tr(<span class="stringliteral">&quot;HOME&quot;</span>));
<a name="l00440"></a>00440 
<a name="l00441"></a>00441     contextMenu.addAction(setHomeAct);
<a name="l00442"></a>00442     contextMenu.addAction(showHomeAct);
<a name="l00443"></a>00443     contextMenu.addAction(goHomeAct);
<a name="l00444"></a>00444 
<a name="l00445"></a>00445     <span class="comment">// ****</span>
<a name="l00446"></a>00446     <span class="comment">// uav trails</span>
<a name="l00447"></a>00447     QMenu uav_menu(tr(<span class="stringliteral">&quot;UAV&quot;</span>));
<a name="l00448"></a>00448     uav_menu.addSeparator()-&gt;setText(tr(<span class="stringliteral">&quot;UAV Trail&quot;</span>));
<a name="l00449"></a>00449     contextMenu.addMenu(&amp;uav_menu);
<a name="l00450"></a>00450     QMenu uavTrailTypeSubMenu(tr(<span class="stringliteral">&quot;UAV trail type&quot;</span>) + <span class="stringliteral">&quot; (&quot;</span> + <a class="code" href="group___o_p_map_widget.html#gab2895e09cf7115779c738cc43d815123" title="Converts from Type to String.">mapcontrol::Helper::StrFromUAVTrailType</a>(m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;GetTrailType()) + <span class="stringliteral">&quot;)&quot;</span>, <span class="keyword">this</span>);
<a name="l00451"></a>00451     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; uavTrailTypeAct.count(); <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)
<a name="l00452"></a>00452         uavTrailTypeSubMenu.addAction(uavTrailTypeAct.at(<a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>));
<a name="l00453"></a>00453     uav_menu.addMenu(&amp;uavTrailTypeSubMenu);
<a name="l00454"></a>00454 
<a name="l00455"></a>00455     QMenu uavTrailTimeSubMenu(tr(<span class="stringliteral">&quot;UAV trail time&quot;</span>) + <span class="stringliteral">&quot; (&quot;</span> + QString::number(m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;TrailTime()) + <span class="stringliteral">&quot; sec)&quot;</span>, <span class="keyword">this</span>);
<a name="l00456"></a>00456     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; uavTrailTimeAct.count(); <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)
<a name="l00457"></a>00457         uavTrailTimeSubMenu.addAction(uavTrailTimeAct.at(<a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>));
<a name="l00458"></a>00458     uav_menu.addMenu(&amp;uavTrailTimeSubMenu);
<a name="l00459"></a>00459 
<a name="l00460"></a>00460     QMenu uavTrailDistanceSubMenu(tr(<span class="stringliteral">&quot;UAV trail distance&quot;</span>) + <span class="stringliteral">&quot; (&quot;</span> + QString::number(m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;TrailDistance()) + <span class="stringliteral">&quot; meters)&quot;</span>, <span class="keyword">this</span>);
<a name="l00461"></a>00461     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; uavTrailDistanceAct.count(); <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)
<a name="l00462"></a>00462         uavTrailDistanceSubMenu.addAction(uavTrailDistanceAct.at(<a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>));
<a name="l00463"></a>00463     uav_menu.addMenu(&amp;uavTrailDistanceSubMenu);
<a name="l00464"></a>00464 
<a name="l00465"></a>00465     uav_menu.addAction(showTrailAct);
<a name="l00466"></a>00466 
<a name="l00467"></a>00467     uav_menu.addAction(showTrailLineAct);
<a name="l00468"></a>00468 
<a name="l00469"></a>00469     uav_menu.addAction(clearUAVtrailAct);
<a name="l00470"></a>00470 
<a name="l00471"></a>00471     <span class="comment">// ****</span>
<a name="l00472"></a>00472 
<a name="l00473"></a>00473     uav_menu.addSeparator()-&gt;setText(tr(<span class="stringliteral">&quot;UAV&quot;</span>));
<a name="l00474"></a>00474 
<a name="l00475"></a>00475     uav_menu.addAction(showUAVAct);
<a name="l00476"></a>00476     uav_menu.addAction(followUAVpositionAct);
<a name="l00477"></a>00477     uav_menu.addAction(followUAVheadingAct);
<a name="l00478"></a>00478     uav_menu.addAction(goUAVAct);
<a name="l00479"></a>00479 
<a name="l00480"></a>00480     <span class="comment">// *********</span>
<a name="l00481"></a>00481     <span class="keywordflow">switch</span> (m_map_mode)
<a name="l00482"></a>00482     {
<a name="l00483"></a>00483         <span class="keywordflow">case</span> <a class="code" href="group___o_p_map_plugin.html#gga10cb3e7dfbac87e40e00c1a8c76c16e5afdcda6e378c8e0a54e928947a5fdede8">Normal_MapMode</a>:
<a name="l00484"></a>00484         <span class="comment">// only show the waypoint stuff if not in &#39;magic waypoint&#39; mode</span>
<a name="l00485"></a>00485 
<a name="l00486"></a>00486             contextMenu.addSeparator()-&gt;setText(tr(<span class="stringliteral">&quot;Waypoints&quot;</span>));
<a name="l00487"></a>00487 
<a name="l00488"></a>00488             contextMenu.addAction(wayPointEditorAct);
<a name="l00489"></a>00489             contextMenu.addAction(addWayPointActFromContextMenu);
<a name="l00490"></a>00490 
<a name="l00491"></a>00491             <span class="keywordflow">if</span> (m_mouse_waypoint)
<a name="l00492"></a>00492             {   <span class="comment">// we have a waypoint under the mouse</span>
<a name="l00493"></a>00493                 contextMenu.addAction(editWayPointAct);
<a name="l00494"></a>00494 
<a name="l00495"></a>00495                 lockWayPointAct-&gt;setChecked(waypoint_locked);
<a name="l00496"></a>00496                 contextMenu.addAction(lockWayPointAct);
<a name="l00497"></a>00497 
<a name="l00498"></a>00498                 <span class="keywordflow">if</span> (!waypoint_locked)
<a name="l00499"></a>00499                     contextMenu.addAction(deleteWayPointAct);
<a name="l00500"></a>00500             }
<a name="l00501"></a>00501 
<a name="l00502"></a>00502             <span class="keywordflow">if</span> (m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga22fc188ce6991cc900182e1a60b3ee34">WPPresent</a>())
<a name="l00503"></a>00503                 contextMenu.addAction(clearWayPointsAct);       <span class="comment">// we have waypoints</span>
<a name="l00504"></a>00504 
<a name="l00505"></a>00505             <span class="keywordflow">break</span>;
<a name="l00506"></a>00506 
<a name="l00507"></a>00507         <span class="keywordflow">case</span> <a class="code" href="group___o_p_map_plugin.html#gga10cb3e7dfbac87e40e00c1a8c76c16e5abdc1c0b7296fb52149bbda0739034825">MagicWaypoint_MapMode</a>:
<a name="l00508"></a>00508             contextMenu.addSeparator()-&gt;setText(tr(<span class="stringliteral">&quot;Waypoints&quot;</span>));
<a name="l00509"></a>00509             contextMenu.addAction(homeMagicWaypointAct);
<a name="l00510"></a>00510             <span class="keywordflow">break</span>;
<a name="l00511"></a>00511     }
<a name="l00512"></a>00512     <span class="comment">// *********</span>
<a name="l00513"></a>00513 
<a name="l00514"></a>00514     QMenu overlaySubMenu(tr(<span class="stringliteral">&quot;&amp;Overlay Opacity &quot;</span>),<span class="keyword">this</span>);
<a name="l00515"></a>00515     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; overlayOpacityAct.count(); <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)
<a name="l00516"></a>00516         overlaySubMenu.addAction(overlayOpacityAct.at(<a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>));
<a name="l00517"></a>00517     contextMenu.addMenu(&amp;overlaySubMenu);
<a name="l00518"></a>00518     contextMenu.addSeparator();
<a name="l00519"></a>00519 
<a name="l00520"></a>00520     contextMenu.addAction(closeAct2);
<a name="l00521"></a>00521 
<a name="l00522"></a>00522     contextMenu.exec(event-&gt;globalPos());  <span class="comment">// popup the menu</span>
<a name="l00523"></a>00523 
<a name="l00524"></a>00524     <span class="comment">// ****************</span>
<a name="l00525"></a>00525 }
<a name="l00526"></a>00526 
<a name="l00527"></a><a class="code" href="group___o_p_map_plugin.html#ga07f947001ed1fdf9d099f170e5116aa2">00527</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#ga07f947001ed1fdf9d099f170e5116aa2">OPMapGadgetWidget::closeEvent</a>(QCloseEvent *event)
<a name="l00528"></a>00528 {
<a name="l00529"></a>00529     <a class="code" href="group___o_p_map_plugin.html#ga07f947001ed1fdf9d099f170e5116aa2">QWidget::closeEvent</a>(event);
<a name="l00530"></a>00530 }
<a name="l00531"></a>00531 
<a name="l00532"></a>00532 <span class="comment">// *************************************************************************************</span>
<a name="l00533"></a>00533 <span class="comment">// timer signals</span>
<a name="l00534"></a>00534 
<a name="l00539"></a>00539 <span class="keywordtype">void</span> OPMapGadgetWidget::updatePosition()
<a name="l00540"></a>00540 {
<a name="l00541"></a>00541         <span class="keywordtype">double</span> uav_latitude, uav_longitude, uav_altitude, uav_yaw;
<a name="l00542"></a>00542         <span class="keywordtype">double</span> gps_latitude, gps_longitude, gps_altitude, gps_heading;
<a name="l00543"></a>00543 
<a name="l00544"></a>00544         <a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a> uav_pos;
<a name="l00545"></a>00545         <a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a> gps_pos;
<a name="l00546"></a>00546 
<a name="l00547"></a>00547         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l00548"></a>00548                 <span class="keywordflow">return</span>;
<a name="l00549"></a>00549 
<a name="l00550"></a>00550     QMutexLocker locker(&amp;m_map_mutex);
<a name="l00551"></a>00551 
<a name="l00552"></a>00552         <span class="comment">// *************</span>
<a name="l00553"></a>00553         <span class="comment">// get the current UAV details</span>
<a name="l00554"></a>00554 
<a name="l00555"></a>00555     <span class="comment">// get current UAV position</span>
<a name="l00556"></a>00556         <span class="keywordflow">if</span> (!getUAVPosition(uav_latitude, uav_longitude, uav_altitude))
<a name="l00557"></a>00557         <span class="keywordflow">return</span>;
<a name="l00558"></a>00558 
<a name="l00559"></a>00559     <span class="comment">// get current UAV heading</span>
<a name="l00560"></a>00560         uav_yaw = getUAV_Yaw();
<a name="l00561"></a>00561 
<a name="l00562"></a>00562         uav_pos = <a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a>(uav_latitude, uav_longitude);
<a name="l00563"></a>00563 
<a name="l00564"></a>00564         <span class="comment">// *************</span>
<a name="l00565"></a>00565     <span class="comment">// Load GPSPosition UAVO</span>
<a name="l00566"></a>00566     GPSPosition *gpsPositionObj = GPSPosition::GetInstance(obm);
<a name="l00567"></a>00567     Q_ASSERT(gpsPositionObj);
<a name="l00568"></a>00568 
<a name="l00569"></a>00569     GPSPosition::DataFields gpsPositionData = gpsPositionObj-&gt;getData();
<a name="l00570"></a>00570 
<a name="l00571"></a>00571     <span class="comment">// get current GPS heading, latitude, longitude, and altitude</span>
<a name="l00572"></a>00572     gps_heading = gpsPositionData.Heading;
<a name="l00573"></a>00573     gps_latitude = gpsPositionData.Latitude;
<a name="l00574"></a>00574     gps_longitude = gpsPositionData.Longitude;
<a name="l00575"></a>00575     gps_altitude = gpsPositionData.Altitude;
<a name="l00576"></a>00576 
<a name="l00577"></a>00577         gps_pos = <a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a>(gps_latitude, gps_longitude);
<a name="l00578"></a>00578 
<a name="l00579"></a>00579     <span class="comment">//**********************</span>
<a name="l00580"></a>00580     <span class="comment">// get the current position and heading estimates</span>
<a name="l00581"></a>00581     AttitudeActual *attitudeActualObj = AttitudeActual::GetInstance(obm);
<a name="l00582"></a>00582     PositionActual *positionActualObj = PositionActual::GetInstance(obm);
<a name="l00583"></a>00583     VelocityActual *velocityActualObj = VelocityActual::GetInstance(obm);
<a name="l00584"></a>00584     Gyros *gyrosObj = Gyros::GetInstance(obm);
<a name="l00585"></a>00585 
<a name="l00586"></a>00586     Q_ASSERT(attitudeActualObj);
<a name="l00587"></a>00587     Q_ASSERT(positionActualObj);
<a name="l00588"></a>00588     Q_ASSERT(velocityActualObj);
<a name="l00589"></a>00589     Q_ASSERT(gyrosObj);
<a name="l00590"></a>00590 
<a name="l00591"></a>00591     AttitudeActual::DataFields attitudeActualData = attitudeActualObj-&gt;getData();
<a name="l00592"></a>00592     PositionActual::DataFields positionActualData = positionActualObj-&gt;getData();
<a name="l00593"></a>00593     VelocityActual::DataFields velocityActualData = velocityActualObj-&gt;getData();
<a name="l00594"></a>00594     Gyros::DataFields gyrosData = gyrosObj-&gt;getData();
<a name="l00595"></a>00595 
<a name="l00596"></a>00596     <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#abb3119256791e93ec6e33c8eee7035d6">NED</a>[3]={positionActualData.North, positionActualData.East, positionActualData.Down};
<a name="l00597"></a>00597     <span class="keywordtype">double</span> vNED[3]={velocityActualData.North, velocityActualData.East, velocityActualData.Down};
<a name="l00598"></a>00598 
<a name="l00599"></a>00599     <span class="comment">//Set the position and heading estimates in the painter module</span>
<a name="l00600"></a>00600     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;SetNED(NED);
<a name="l00601"></a>00601     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;SetCAS(-1); <span class="comment">//THIS NEEDS TO BECOME AIRSPEED, ONCE WE SETTLE ON A UAVO</span>
<a name="l00602"></a>00602     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;SetGroundspeed(vNED, m_maxUpdateRate);
<a name="l00603"></a>00603 
<a name="l00604"></a>00604     <span class="comment">//Convert angular velocities into a rotationg rate around the world-frame yaw axis. This is found by simply taking the dot product of the angular Euler-rate matrix with the angular rates.</span>
<a name="l00605"></a>00605     <span class="keywordtype">float</span> psiRate_dps=0*gyrosData.z + sin(attitudeActualData.Roll*deg_to_rad)/cos(attitudeActualData.Pitch*deg_to_rad)*gyrosData.y + cos(attitudeActualData.Roll*deg_to_rad)/cos(attitudeActualData.Pitch*deg_to_rad)*gyrosData.z;
<a name="l00606"></a>00606 
<a name="l00607"></a>00607     <span class="comment">//Set the angular rate in the painter module</span>
<a name="l00608"></a>00608     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;SetYawRate(psiRate_dps); <span class="comment">//Not correct, but I&#39;m being lazy right now.</span>
<a name="l00609"></a>00609 
<a name="l00610"></a>00610     <span class="comment">// *************</span>
<a name="l00611"></a>00611         <span class="comment">// display the UAV position</span>
<a name="l00612"></a>00612 
<a name="l00613"></a>00613     <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> str =
<a name="l00614"></a>00614             <span class="stringliteral">&quot;lat: &quot;</span> + QString::number(uav_pos.<a class="code" href="group___o_p_map_widget.html#gacf58e663626e5a88876d68937505dc64">Lat</a>(), <span class="charliteral">&#39;f&#39;</span>, 7) +
<a name="l00615"></a>00615             <span class="stringliteral">&quot; lon: &quot;</span> + QString::number(uav_pos.<a class="code" href="group___o_p_map_widget.html#ga2a02db7101a66a3c2e5f536e60b38423">Lng</a>(), <span class="charliteral">&#39;f&#39;</span>, 7) +
<a name="l00616"></a>00616                         <span class="stringliteral">&quot; &quot;</span> + QString::number(uav_yaw, <span class="charliteral">&#39;f&#39;</span>, 1) + <span class="stringliteral">&quot;deg&quot;</span> +
<a name="l00617"></a>00617                         <span class="stringliteral">&quot; &quot;</span> + QString::number(uav_altitude, <span class="charliteral">&#39;f&#39;</span>, 1) + <span class="stringliteral">&quot;m&quot;</span>;
<a name="l00618"></a>00618 <span class="comment">//            &quot; &quot; + QString::number(uav_ground_speed_meters_per_second, &#39;f&#39;, 1) + &quot;m/s&quot;;</span>
<a name="l00619"></a>00619     m_widget-&gt;labelUAVPos-&gt;setText(str);
<a name="l00620"></a>00620 
<a name="l00621"></a>00621         <span class="comment">// *************</span>
<a name="l00622"></a>00622         <span class="comment">// set the UAV icon position on the map</span>
<a name="l00623"></a>00623 
<a name="l00624"></a>00624         m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;SetUAVPos(uav_pos, uav_altitude);        <span class="comment">// set the maps UAV position</span>
<a name="l00625"></a>00625 <span class="comment">//      qDebug()&lt;&lt;&quot;UAVPOSITION&quot;&lt;&lt;uav_pos.ToString();</span>
<a name="l00626"></a>00626         m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;SetUAVHeading(uav_yaw);                  <span class="comment">// set the maps UAV heading</span>
<a name="l00627"></a>00627 
<a name="l00628"></a>00628         <span class="comment">// *************</span>
<a name="l00629"></a>00629         <span class="comment">// set the GPS icon position on the map</span>
<a name="l00630"></a>00630     <span class="keywordflow">if</span>(m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga83798c623babeffb173d483ad1c84ccc">GPS</a>)
<a name="l00631"></a>00631     {
<a name="l00632"></a>00632         m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga83798c623babeffb173d483ad1c84ccc">GPS</a>-&gt;SetUAVPos(gps_pos, gps_altitude); <span class="comment">// set the maps GPS position</span>
<a name="l00633"></a>00633         m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga83798c623babeffb173d483ad1c84ccc">GPS</a>-&gt;SetUAVHeading(gps_heading);       <span class="comment">// set the maps GPS heading</span>
<a name="l00634"></a>00634     }
<a name="l00635"></a>00635     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;updateTextOverlay();
<a name="l00636"></a>00636     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;update();
<a name="l00637"></a>00637         <span class="comment">// *************</span>
<a name="l00638"></a>00638 }
<a name="l00639"></a>00639 
<a name="l00644"></a>00644 <span class="keywordtype">void</span> OPMapGadgetWidget::updateMousePos()
<a name="l00645"></a>00645 {
<a name="l00646"></a>00646         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l00647"></a>00647                 <span class="keywordflow">return</span>;
<a name="l00648"></a>00648 
<a name="l00649"></a>00649     QMutexLocker locker(&amp;m_map_mutex);
<a name="l00650"></a>00650 
<a name="l00651"></a>00651     QPoint p = m_map-&gt;mapFromGlobal(QCursor::pos());
<a name="l00652"></a>00652     <a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a> lat_lon = m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga350ef32ca621e11b3d5a2d3fe4aeaca6">GetFromLocalToLatLng</a>(p);    <span class="comment">// fetch the current lat/lon mouse position</span>
<a name="l00653"></a>00653     lastLatLngMouse=lat_lon;
<a name="l00654"></a>00654     <span class="keywordflow">if</span> (!m_map-&gt;contentsRect().contains(p))
<a name="l00655"></a>00655         <span class="keywordflow">return</span>;                                     <span class="comment">// the mouse is not on the map</span>
<a name="l00656"></a>00656 
<a name="l00657"></a>00657 <span class="comment">//    internals::PointLatLng lat_lon = m_map-&gt;currentMousePosition();     // fetch the current lat/lon mouse position</span>
<a name="l00658"></a>00658 
<a name="l00659"></a>00659     QGraphicsItem *item = m_map-&gt;itemAt(p);
<a name="l00660"></a>00660 
<a name="l00661"></a>00661     <span class="comment">// find out if we are over the home position</span>
<a name="l00662"></a>00662     <a class="code" href="classmapcontrol_1_1_home_item.html">mapcontrol::HomeItem</a> *home = qgraphicsitem_cast&lt;<a class="code" href="classmapcontrol_1_1_home_item.html">mapcontrol::HomeItem</a> *&gt;(item);
<a name="l00663"></a>00663 
<a name="l00664"></a>00664     <span class="comment">// find out if we have a waypoint under the mouse cursor</span>
<a name="l00665"></a>00665     <a class="code" href="classmapcontrol_1_1_way_point_item.html" title="A QGraphicsItem representing a WayPoint.">mapcontrol::WayPointItem</a> *wp = qgraphicsitem_cast&lt;<a class="code" href="classmapcontrol_1_1_way_point_item.html" title="A QGraphicsItem representing a WayPoint.">mapcontrol::WayPointItem</a> *&gt;(item);
<a name="l00666"></a>00666 
<a name="l00667"></a>00667         <span class="keywordflow">if</span> (m_mouse_lat_lon == lat_lon)
<a name="l00668"></a>00668         <span class="keywordflow">return</span>;                 <span class="comment">// the mouse has not moved</span>
<a name="l00669"></a>00669 
<a name="l00670"></a>00670         m_mouse_lat_lon = lat_lon;    <span class="comment">// yes it has!</span>
<a name="l00671"></a>00671 
<a name="l00672"></a>00672     <a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a> home_lat_lon = m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga3c39e182c87b25990664fbe7dd0a9eff">Home</a>-&gt;Coord();
<a name="l00673"></a>00673 
<a name="l00674"></a>00674     <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> <a class="code" href="_o_p_plots_8m.html#a2f07e0f444810cc4e54ee2be2ce0ac65">s1</a> = QString::number(m_mouse_lat_lon.<a class="code" href="group___o_p_map_widget.html#gacf58e663626e5a88876d68937505dc64">Lat</a>(), <span class="charliteral">&#39;f&#39;</span>, 7) + <span class="stringliteral">&quot;  &quot;</span> + QString::number(m_mouse_lat_lon.<a class="code" href="group___o_p_map_widget.html#ga2a02db7101a66a3c2e5f536e60b38423">Lng</a>(), <span class="charliteral">&#39;f&#39;</span>, 7);
<a name="l00675"></a>00675     <span class="keywordflow">if</span> (wp)
<a name="l00676"></a>00676     {
<a name="l00677"></a>00677         s1 += <span class="stringliteral">&quot;  wp[&quot;</span> + QString::number(wp-&gt;numberAdjusted()) + <span class="stringliteral">&quot;]&quot;</span>;
<a name="l00678"></a>00678 
<a name="l00679"></a>00679         <span class="keywordtype">double</span> dist = distance(home_lat_lon, wp-&gt;Coord());
<a name="l00680"></a>00680         <span class="keywordtype">double</span> bear = bearing(home_lat_lon, wp-&gt;Coord());
<a name="l00681"></a>00681         s1 += <span class="stringliteral">&quot;  &quot;</span> + QString::number(dist * 1000, <span class="charliteral">&#39;f&#39;</span>, 1) + <span class="stringliteral">&quot;m&quot;</span>;
<a name="l00682"></a>00682         s1 += <span class="stringliteral">&quot;  &quot;</span> + QString::number(bear, <span class="charliteral">&#39;f&#39;</span>, 1) + <span class="stringliteral">&quot;deg&quot;</span>;
<a name="l00683"></a>00683     }
<a name="l00684"></a>00684     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (home)
<a name="l00685"></a>00685     {
<a name="l00686"></a>00686         s1 += <span class="stringliteral">&quot;  home&quot;</span>;
<a name="l00687"></a>00687 
<a name="l00688"></a>00688                 <span class="keywordtype">double</span> dist = distance(home_lat_lon, m_mouse_lat_lon);
<a name="l00689"></a>00689                 <span class="keywordtype">double</span> bear = bearing(home_lat_lon, m_mouse_lat_lon);
<a name="l00690"></a>00690         s1 += <span class="stringliteral">&quot;  &quot;</span> + QString::number(dist * 1000, <span class="charliteral">&#39;f&#39;</span>, 1) + <span class="stringliteral">&quot;m&quot;</span>;
<a name="l00691"></a>00691         s1 += <span class="stringliteral">&quot;  &quot;</span> + QString::number(bear, <span class="charliteral">&#39;f&#39;</span>, 1) + <span class="stringliteral">&quot;deg&quot;</span>;
<a name="l00692"></a>00692     }
<a name="l00693"></a>00693     m_widget-&gt;labelMousePos-&gt;setText(s1);
<a name="l00694"></a>00694 
<a name="l00695"></a>00695     <span class="keywordtype">double</span> NED[3];
<a name="l00696"></a>00696     <span class="keywordtype">double</span> homeLLA[3]={home_lat_lon.<a class="code" href="group___o_p_map_widget.html#gacf58e663626e5a88876d68937505dc64">Lat</a>(), home_lat_lon.<a class="code" href="group___o_p_map_widget.html#ga2a02db7101a66a3c2e5f536e60b38423">Lng</a>(), 0};
<a name="l00697"></a>00697     <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#a011779f2c5f2a3505308bb1369101a54">LLA</a>[3]={m_mouse_lat_lon.<a class="code" href="group___o_p_map_widget.html#gacf58e663626e5a88876d68937505dc64">Lat</a>(), m_mouse_lat_lon.<a class="code" href="group___o_p_map_widget.html#ga2a02db7101a66a3c2e5f536e60b38423">Lng</a>(), 0};
<a name="l00698"></a>00698     <a class="code" href="class_utils_1_1_coordinate_conversions.html">Utils::CoordinateConversions</a>().<a class="code" href="class_utils_1_1_coordinate_conversions.html#a1dc099f580d3a37ef39bb155cc7e4e62">LLA2NED_HomeLLA</a>(LLA, homeLLA, NED); <span class="comment">//&lt;-- This yields, NED, the tile size in meters, assuming we are at the origin in a plate carre system</span>
<a name="l00699"></a>00699     <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> <a class="code" href="_o_p_plots_8m.html#a2e63e71737e8b6802b81f6a7c5ca6a0a">s2</a> = QString::number(NED[0], <span class="charliteral">&#39;g&#39;</span>, 5) + <span class="stringliteral">&quot;  &quot;</span> + QString::number(NED[1], <span class="charliteral">&#39;g&#39;</span>, 5);
<a name="l00700"></a>00700     m_widget-&gt;labelNEDCoords-&gt;setText(s2);
<a name="l00701"></a>00701 }
<a name="l00702"></a>00702 
<a name="l00703"></a>00703 <span class="comment">// *************************************************************************************</span>
<a name="l00704"></a>00704 <span class="comment">// map signals</span>
<a name="l00705"></a>00705 
<a name="l00706"></a>00706 
<a name="l00710"></a>00710 <span class="keywordtype">void</span> OPMapGadgetWidget::zoomChanged(<span class="keywordtype">double</span> zoomt, <span class="keywordtype">double</span> zoom, <span class="keywordtype">double</span> zoomd)
<a name="l00711"></a>00711 {
<a name="l00712"></a>00712         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l00713"></a>00713                 <span class="keywordflow">return</span>;
<a name="l00714"></a>00714 
<a name="l00715"></a>00715     <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> <a class="code" href="uavobjecttemplate_8m.html#a3691308f2a4c2f6983f2880d32e29c84">s</a> = <span class="stringliteral">&quot;tot:&quot;</span> + QString::number(zoomt, <span class="charliteral">&#39;f&#39;</span>, 1) + <span class="stringliteral">&quot; rea:&quot;</span> + QString::number(zoom, <span class="charliteral">&#39;f&#39;</span>, 1) + <span class="stringliteral">&quot; dig:&quot;</span> + QString::number(zoomd, <span class="charliteral">&#39;f&#39;</span>, 1);
<a name="l00716"></a>00716     m_widget-&gt;labelMapZoom-&gt;setText(s);
<a name="l00717"></a>00717 
<a name="l00718"></a>00718     <span class="keywordtype">int</span> i_zoom = (int)(zoomt + 0.5);
<a name="l00719"></a>00719 
<a name="l00720"></a>00720     <span class="keywordflow">if</span> (i_zoom &lt; m_min_zoom) i_zoom = m_min_zoom;
<a name="l00721"></a>00721     <span class="keywordflow">else</span>        <span class="keywordflow">if</span> (i_zoom &gt; m_max_zoom) i_zoom = m_max_zoom;
<a name="l00722"></a>00722 
<a name="l00723"></a>00723     <span class="keywordflow">if</span> (m_widget-&gt;horizontalSliderZoom-&gt;value() != i_zoom)
<a name="l00724"></a>00724         m_widget-&gt;horizontalSliderZoom-&gt;setValue(i_zoom);       <span class="comment">// set the GUI zoom slider position</span>
<a name="l00725"></a>00725 
<a name="l00726"></a>00726         <span class="keywordtype">int</span> index0_zoom = i_zoom - m_min_zoom;                  <span class="comment">// zoom level starting at index level &#39;0&#39;</span>
<a name="l00727"></a>00727     <span class="keywordflow">if</span> (index0_zoom &lt; zoomAct.count())
<a name="l00728"></a>00728         zoomAct.at(index0_zoom)-&gt;setChecked(<span class="keyword">true</span>);              <span class="comment">// set the right-click context menu zoom level</span>
<a name="l00729"></a>00729 }
<a name="l00730"></a>00730 
<a name="l00731"></a>00731 <span class="keywordtype">void</span> OPMapGadgetWidget::OnCurrentPositionChanged(<a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a> point)
<a name="l00732"></a>00732 {
<a name="l00733"></a>00733         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l00734"></a>00734                 <span class="keywordflow">return</span>;
<a name="l00735"></a>00735 
<a name="l00736"></a>00736     <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> coord_str = QString::number(point.<a class="code" href="group___o_p_map_widget.html#gacf58e663626e5a88876d68937505dc64">Lat</a>(), <span class="charliteral">&#39;f&#39;</span>, 7) + <span class="stringliteral">&quot;   &quot;</span> + QString::number(point.<a class="code" href="group___o_p_map_widget.html#ga2a02db7101a66a3c2e5f536e60b38423">Lng</a>(), <span class="charliteral">&#39;f&#39;</span>, 7) + <span class="stringliteral">&quot; &quot;</span>;
<a name="l00737"></a>00737     m_widget-&gt;labelMapPos-&gt;setText(coord_str);
<a name="l00738"></a>00738 }
<a name="l00739"></a>00739 
<a name="l00743"></a>00743 <span class="keywordtype">void</span> OPMapGadgetWidget::OnTilesStillToLoad(<span class="keywordtype">int</span> number)
<a name="l00744"></a>00744 {
<a name="l00745"></a>00745         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l00746"></a>00746                 <span class="keywordflow">return</span>;
<a name="l00747"></a>00747 
<a name="l00748"></a>00748         <span class="keywordflow">if</span> (m_widget-&gt;progressBarMap-&gt;maximum() &lt; number)
<a name="l00749"></a>00749             m_widget-&gt;progressBarMap-&gt;setMaximum(number);
<a name="l00750"></a>00750 
<a name="l00751"></a>00751         m_widget-&gt;progressBarMap-&gt;setValue(m_widget-&gt;progressBarMap-&gt;maximum() - number);       <span class="comment">// update the progress bar</span>
<a name="l00752"></a>00752 
<a name="l00753"></a>00753         m_prev_tile_number = number;
<a name="l00754"></a>00754 }
<a name="l00755"></a>00755 
<a name="l00759"></a>00759 <span class="keywordtype">void</span> OPMapGadgetWidget::OnTileLoadStart()
<a name="l00760"></a>00760 {
<a name="l00761"></a>00761         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l00762"></a>00762                 <span class="keywordflow">return</span>;
<a name="l00763"></a>00763     m_widget-&gt;progressBarMap-&gt;setVisible(<span class="keyword">true</span>);
<a name="l00764"></a>00764 }
<a name="l00765"></a>00765 
<a name="l00772"></a>00772 <span class="keywordtype">void</span> OPMapGadgetWidget::OnTileLoadComplete()
<a name="l00773"></a>00773 {
<a name="l00774"></a>00774         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l00775"></a>00775                 <span class="keywordflow">return</span>;
<a name="l00776"></a>00776 
<a name="l00777"></a>00777     m_widget-&gt;progressBarMap-&gt;setVisible(<span class="keyword">false</span>);
<a name="l00778"></a>00778 }
<a name="l00779"></a>00779 
<a name="l00780"></a>00780 <span class="keywordtype">void</span> OPMapGadgetWidget::on_toolButtonZoomP_clicked()
<a name="l00781"></a>00781 {
<a name="l00782"></a>00782     QMutexLocker locker(&amp;m_map_mutex);
<a name="l00783"></a>00783     zoomIn();
<a name="l00784"></a>00784 }
<a name="l00785"></a>00785 
<a name="l00786"></a>00786 <span class="keywordtype">void</span> OPMapGadgetWidget::on_toolButtonZoomM_clicked()
<a name="l00787"></a>00787 {
<a name="l00788"></a>00788     QMutexLocker locker(&amp;m_map_mutex);
<a name="l00789"></a>00789     zoomOut();
<a name="l00790"></a>00790 }
<a name="l00791"></a>00791 
<a name="l00792"></a>00792 <span class="keywordtype">void</span> OPMapGadgetWidget::on_toolButtonMapHome_clicked()
<a name="l00793"></a>00793 {
<a name="l00794"></a>00794     QMutexLocker locker(&amp;m_map_mutex);
<a name="l00795"></a>00795     <a class="code" href="group___o_p_map_plugin.html#gab81157189920148cb4178548aeef4b92">goHome</a>();
<a name="l00796"></a>00796 }
<a name="l00797"></a>00797 
<a name="l00798"></a>00798 <span class="keywordtype">void</span> OPMapGadgetWidget::on_toolButtonMapUAV_clicked()
<a name="l00799"></a>00799 {
<a name="l00800"></a>00800         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l00801"></a>00801                 <span class="keywordflow">return</span>;
<a name="l00802"></a>00802 
<a name="l00803"></a>00803     QMutexLocker locker(&amp;m_map_mutex);
<a name="l00804"></a>00804 
<a name="l00805"></a>00805     followUAVpositionAct-&gt;toggle();
<a name="l00806"></a>00806 }
<a name="l00807"></a>00807 
<a name="l00808"></a>00808 <span class="keywordtype">void</span> OPMapGadgetWidget::on_toolButtonMapUAVheading_clicked()
<a name="l00809"></a>00809 {
<a name="l00810"></a>00810         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l00811"></a>00811                 <span class="keywordflow">return</span>;
<a name="l00812"></a>00812 
<a name="l00813"></a>00813     followUAVheadingAct-&gt;toggle();
<a name="l00814"></a>00814 }
<a name="l00815"></a>00815 
<a name="l00816"></a>00816 <span class="keywordtype">void</span> OPMapGadgetWidget::on_horizontalSliderZoom_sliderMoved(<span class="keywordtype">int</span> position)
<a name="l00817"></a>00817 {
<a name="l00818"></a>00818         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l00819"></a>00819                 <span class="keywordflow">return</span>;
<a name="l00820"></a>00820 
<a name="l00821"></a>00821     QMutexLocker locker(&amp;m_map_mutex);
<a name="l00822"></a>00822 
<a name="l00823"></a>00823     <a class="code" href="group___o_p_map_plugin.html#gaa2731b7fb965c417860b30ac354437ca">setZoom</a>(position);
<a name="l00824"></a>00824 }
<a name="l00825"></a>00825 
<a name="l00826"></a>00826 
<a name="l00827"></a>00827 <span class="keywordtype">void</span> OPMapGadgetWidget::on_toolButtonNormalMapMode_clicked()
<a name="l00828"></a>00828 {
<a name="l00829"></a>00829     <a class="code" href="group___o_p_map_plugin.html#gafe9c5443c9ed4947f2072bf8feba9673">setMapMode</a>(<a class="code" href="group___o_p_map_plugin.html#gga10cb3e7dfbac87e40e00c1a8c76c16e5afdcda6e378c8e0a54e928947a5fdede8">Normal_MapMode</a>);
<a name="l00830"></a>00830 }
<a name="l00831"></a>00831 
<a name="l00832"></a>00832 <span class="keywordtype">void</span> OPMapGadgetWidget::on_toolButtonMagicWaypointMapMode_clicked()
<a name="l00833"></a>00833 {
<a name="l00834"></a>00834     <a class="code" href="group___o_p_map_plugin.html#gafe9c5443c9ed4947f2072bf8feba9673">setMapMode</a>(<a class="code" href="group___o_p_map_plugin.html#gga10cb3e7dfbac87e40e00c1a8c76c16e5abdc1c0b7296fb52149bbda0739034825">MagicWaypoint_MapMode</a>);
<a name="l00835"></a>00835 }
<a name="l00836"></a>00836 
<a name="l00837"></a>00837 <span class="keywordtype">void</span> OPMapGadgetWidget::on_toolButtonHomeWaypoint_clicked()
<a name="l00838"></a>00838 {
<a name="l00839"></a>00839     homeMagicWaypoint();
<a name="l00840"></a>00840 }
<a name="l00841"></a>00841 
<a name="l00842"></a>00842 <span class="keywordtype">void</span> OPMapGadgetWidget::on_toolButtonMoveToWP_clicked()
<a name="l00843"></a>00843 {
<a name="l00844"></a>00844     moveToMagicWaypointPosition();
<a name="l00845"></a>00845 }
<a name="l00846"></a>00846 
<a name="l00847"></a>00847 <span class="comment">// *************************************************************************************</span>
<a name="l00848"></a>00848 <span class="comment">// public slots</span>
<a name="l00849"></a>00849 
<a name="l00850"></a><a class="code" href="group___o_p_map_plugin.html#gad7068b438d89bb8f2a9e31ef5ca2d708">00850</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#gad7068b438d89bb8f2a9e31ef5ca2d708">OPMapGadgetWidget::onTelemetryConnect</a>()
<a name="l00851"></a>00851 {
<a name="l00852"></a>00852         m_telemetry_connected = <span class="keyword">true</span>;
<a name="l00853"></a>00853 
<a name="l00854"></a>00854         <span class="keywordflow">if</span> (!obum) <span class="keywordflow">return</span>;
<a name="l00855"></a>00855 
<a name="l00856"></a>00856         <span class="keywordtype">bool</span> <span class="keyword">set</span>;
<a name="l00857"></a>00857         <span class="keywordtype">double</span> LLA[3];
<a name="l00858"></a>00858 
<a name="l00859"></a>00859         <span class="comment">// ***********************</span>
<a name="l00860"></a>00860         <span class="comment">// fetch the home location</span>
<a name="l00861"></a>00861 
<a name="l00862"></a>00862         <span class="keywordflow">if</span> (obum-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gac5e7b38a473a50f709fb6312ef511e59">getHomeLocation</a>(<span class="keyword">set</span>, LLA) &lt; 0)
<a name="l00863"></a>00863                 <span class="keywordflow">return</span>; <span class="comment">// error</span>
<a name="l00864"></a>00864 
<a name="l00865"></a>00865     <a class="code" href="group___o_p_map_plugin.html#gaea4b659a9476e351373fc6df96026327" title="public functions">setHome</a>(<a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a>(LLA[0], LLA[1]),LLA[2]);
<a name="l00866"></a>00866 
<a name="l00867"></a>00867     <span class="keywordflow">if</span> (m_map)
<a name="l00868"></a>00868     {
<a name="l00869"></a>00869         <span class="keywordflow">if</span>(m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;GetMapFollowType()!=UAVMapFollowType::None)
<a name="l00870"></a>00870             m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga5144489a16c9bd07abbd0d8adc01656d">SetCurrentPosition</a>(m_home_position.<a class="code" href="group___o_p_map_plugin.html#ga6324b0912396582281b54bc6d5a6f38a">coord</a>);         <span class="comment">// set the map position</span>
<a name="l00871"></a>00871     }
<a name="l00872"></a>00872     <span class="comment">// ***********************</span>
<a name="l00873"></a>00873 }
<a name="l00874"></a>00874 
<a name="l00875"></a><a class="code" href="group___o_p_map_plugin.html#ga723918dc2ebb03ce17180228e4233d06">00875</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#ga723918dc2ebb03ce17180228e4233d06">OPMapGadgetWidget::onTelemetryDisconnect</a>()
<a name="l00876"></a>00876 {
<a name="l00877"></a>00877         m_telemetry_connected = <span class="keyword">false</span>;
<a name="l00878"></a>00878 }
<a name="l00879"></a>00879 
<a name="l00880"></a>00880 <span class="comment">// Updates the Home position icon whenever the HomePosition object is updated</span>
<a name="l00881"></a><a class="code" href="group___o_p_map_plugin.html#gae67526d9495209b93360c1fae84e3d47">00881</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#gae67526d9495209b93360c1fae84e3d47">OPMapGadgetWidget::homePositionUpdated</a>(<a class="code" href="class_u_a_v_object.html">UAVObject</a> *hp)
<a name="l00882"></a>00882 {
<a name="l00883"></a>00883     Q_UNUSED(hp);
<a name="l00884"></a>00884     <span class="keywordflow">if</span> (!obum) <span class="keywordflow">return</span>;
<a name="l00885"></a>00885     <span class="keywordtype">bool</span> <span class="keyword">set</span>;
<a name="l00886"></a>00886     <span class="keywordtype">double</span> LLA[3];
<a name="l00887"></a>00887     <span class="keywordflow">if</span> (obum-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gac5e7b38a473a50f709fb6312ef511e59">getHomeLocation</a>(<span class="keyword">set</span>, LLA) &lt; 0)
<a name="l00888"></a>00888         <span class="keywordflow">return</span>; <span class="comment">// error</span>
<a name="l00889"></a>00889     <a class="code" href="group___o_p_map_plugin.html#gaea4b659a9476e351373fc6df96026327" title="public functions">setHome</a>(<a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a>(LLA[0], LLA[1]),LLA[2]);
<a name="l00890"></a>00890 
<a name="l00891"></a>00891 }
<a name="l00892"></a>00892 
<a name="l00893"></a>00893 <span class="comment">// *************************************************************************************</span>
<a name="l00894"></a>00894 <span class="comment">// public functions</span>
<a name="l00895"></a>00895 
<a name="l00899"></a><a class="code" href="group___o_p_map_plugin.html#gaea4b659a9476e351373fc6df96026327">00899</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#gaea4b659a9476e351373fc6df96026327" title="public functions">OPMapGadgetWidget::setHome</a>(QPointF pos)
<a name="l00900"></a>00900 {
<a name="l00901"></a>00901         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l00902"></a>00902                 <span class="keywordflow">return</span>;
<a name="l00903"></a>00903 
<a name="l00904"></a>00904     <span class="keywordtype">double</span> latitude = pos.x();
<a name="l00905"></a>00905     <span class="keywordtype">double</span> longitude = pos.y();
<a name="l00906"></a>00906 
<a name="l00907"></a>00907     <span class="keywordflow">if</span> (latitude &gt;  90) latitude =  90;
<a name="l00908"></a>00908     <span class="keywordflow">else</span>
<a name="l00909"></a>00909     <span class="keywordflow">if</span> (latitude &lt; -90) latitude = -90;
<a name="l00910"></a>00910 
<a name="l00911"></a>00911     <span class="keywordflow">if</span> (longitude != longitude) longitude = 0; <span class="comment">// nan detection</span>
<a name="l00912"></a>00912     <span class="keywordflow">else</span>
<a name="l00913"></a>00913     <span class="keywordflow">if</span> (longitude &gt;  180) longitude =  180;
<a name="l00914"></a>00914     <span class="keywordflow">else</span>
<a name="l00915"></a>00915     <span class="keywordflow">if</span> (longitude &lt; -180) longitude = -180;
<a name="l00916"></a>00916 
<a name="l00917"></a>00917     <a class="code" href="group___o_p_map_plugin.html#gaea4b659a9476e351373fc6df96026327" title="public functions">setHome</a>(<a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a>(latitude, longitude),0);
<a name="l00918"></a>00918 }
<a name="l00919"></a>00919 
<a name="l00923"></a><a class="code" href="group___o_p_map_plugin.html#ga7eaa4b0e19be1df614f49d7b86393a19">00923</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#gaea4b659a9476e351373fc6df96026327" title="public functions">OPMapGadgetWidget::setHome</a>(<a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a> pos_lat_lon, <span class="keywordtype">double</span> altitude)
<a name="l00924"></a>00924 {
<a name="l00925"></a>00925         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l00926"></a>00926                 <span class="keywordflow">return</span>;
<a name="l00927"></a>00927 
<a name="l00928"></a>00928     <span class="keywordflow">if</span> (pos_lat_lon.<a class="code" href="group___o_p_map_widget.html#gacf58e663626e5a88876d68937505dc64">Lat</a>() != pos_lat_lon.<a class="code" href="group___o_p_map_widget.html#gacf58e663626e5a88876d68937505dc64">Lat</a>() || pos_lat_lon.<a class="code" href="group___o_p_map_widget.html#ga2a02db7101a66a3c2e5f536e60b38423">Lng</a>() != pos_lat_lon.<a class="code" href="group___o_p_map_widget.html#ga2a02db7101a66a3c2e5f536e60b38423">Lng</a>())
<a name="l00929"></a>00929         <span class="keywordflow">return</span>;; <span class="comment">// nan prevention</span>
<a name="l00930"></a>00930 
<a name="l00931"></a>00931     <span class="keywordtype">double</span> latitude = pos_lat_lon.<a class="code" href="group___o_p_map_widget.html#gacf58e663626e5a88876d68937505dc64">Lat</a>();
<a name="l00932"></a>00932     <span class="keywordtype">double</span> longitude = pos_lat_lon.<a class="code" href="group___o_p_map_widget.html#ga2a02db7101a66a3c2e5f536e60b38423">Lng</a>();
<a name="l00933"></a>00933 
<a name="l00934"></a>00934     <span class="keywordflow">if</span> (latitude != latitude) latitude = 0; <span class="comment">// nan detection</span>
<a name="l00935"></a>00935     <span class="keywordflow">else</span>
<a name="l00936"></a>00936     <span class="keywordflow">if</span> (latitude &gt;  90) latitude =  90;
<a name="l00937"></a>00937     <span class="keywordflow">else</span>
<a name="l00938"></a>00938     <span class="keywordflow">if</span> (latitude &lt; -90) latitude = -90;
<a name="l00939"></a>00939 
<a name="l00940"></a>00940     <span class="keywordflow">if</span> (longitude != longitude) longitude = 0; <span class="comment">// nan detection</span>
<a name="l00941"></a>00941     <span class="keywordflow">else</span>
<a name="l00942"></a>00942     <span class="keywordflow">if</span> (longitude &gt;  180) longitude =  180;
<a name="l00943"></a>00943     <span class="keywordflow">else</span>
<a name="l00944"></a>00944     <span class="keywordflow">if</span> (longitude &lt; -180) longitude = -180;
<a name="l00945"></a>00945 
<a name="l00946"></a>00946     <span class="comment">// *********</span>
<a name="l00947"></a>00947 
<a name="l00948"></a>00948     m_home_position.<a class="code" href="group___o_p_map_plugin.html#ga6324b0912396582281b54bc6d5a6f38a">coord</a> = <a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a>(latitude, longitude);
<a name="l00949"></a>00949     m_home_position.<a class="code" href="group___o_p_map_plugin.html#ga14ce78cb516fe7a0e7f20e423e92d538">altitude</a> = altitude;
<a name="l00950"></a>00950 
<a name="l00951"></a>00951     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga3c39e182c87b25990664fbe7dd0a9eff">Home</a>-&gt;SetCoord(m_home_position.<a class="code" href="group___o_p_map_plugin.html#ga6324b0912396582281b54bc6d5a6f38a">coord</a>);
<a name="l00952"></a>00952     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga3c39e182c87b25990664fbe7dd0a9eff">Home</a>-&gt;SetAltitude(altitude);
<a name="l00953"></a>00953     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga3c39e182c87b25990664fbe7dd0a9eff">Home</a>-&gt;<a class="code" href="group___o_p_map_widget.html#ga1c60e950a733d8e38796cfe092fb4154">RefreshPos</a>();
<a name="l00954"></a>00954 
<a name="l00955"></a>00955     <span class="comment">// move the magic waypoint to keep it within the safe area boundry</span>
<a name="l00956"></a>00956     keepMagicWaypointWithInSafeArea();
<a name="l00957"></a>00957 }
<a name="l00958"></a>00958 
<a name="l00959"></a>00959 
<a name="l00963"></a><a class="code" href="group___o_p_map_plugin.html#gab81157189920148cb4178548aeef4b92">00963</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#gab81157189920148cb4178548aeef4b92">OPMapGadgetWidget::goHome</a>()
<a name="l00964"></a>00964 {
<a name="l00965"></a>00965         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l00966"></a>00966                 <span class="keywordflow">return</span>;
<a name="l00967"></a>00967 
<a name="l00968"></a>00968     followUAVpositionAct-&gt;setChecked(<span class="keyword">false</span>);
<a name="l00969"></a>00969 
<a name="l00970"></a>00970         <a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a> home_pos = m_home_position.<a class="code" href="group___o_p_map_plugin.html#ga6324b0912396582281b54bc6d5a6f38a">coord</a>;        <span class="comment">// get the home location</span>
<a name="l00971"></a>00971     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga5144489a16c9bd07abbd0d8adc01656d">SetCurrentPosition</a>(home_pos);                    <span class="comment">// center the map onto the home location</span>
<a name="l00972"></a>00972 }
<a name="l00973"></a>00973 
<a name="l00974"></a>00974 
<a name="l00975"></a>00975 <span class="keywordtype">void</span> OPMapGadgetWidget::zoomIn()
<a name="l00976"></a>00976 {
<a name="l00977"></a>00977         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l00978"></a>00978                 <span class="keywordflow">return</span>;
<a name="l00979"></a>00979 
<a name="l00980"></a>00980     <span class="keywordtype">int</span> zoom = m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga2060cbfea71913a458f3a6f0c6dad8c5">ZoomTotal</a>() + 1;
<a name="l00981"></a>00981 
<a name="l00982"></a>00982         <span class="keywordflow">if</span> (zoom &lt; m_min_zoom) zoom = m_min_zoom;
<a name="l00983"></a>00983     <span class="keywordflow">else</span>
<a name="l00984"></a>00984         <span class="keywordflow">if</span> (zoom &gt; m_max_zoom) zoom = m_max_zoom;
<a name="l00985"></a>00985 
<a name="l00986"></a>00986     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga63fe346f4ea58f09453ccd42ffe87260">SetZoom</a>(zoom);
<a name="l00987"></a>00987 }
<a name="l00988"></a>00988 
<a name="l00989"></a>00989 <span class="keywordtype">void</span> OPMapGadgetWidget::zoomOut()
<a name="l00990"></a>00990 {
<a name="l00991"></a>00991         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l00992"></a>00992                 <span class="keywordflow">return</span>;
<a name="l00993"></a>00993 
<a name="l00994"></a>00994     <span class="keywordtype">int</span> zoom = m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga2060cbfea71913a458f3a6f0c6dad8c5">ZoomTotal</a>() - 1;
<a name="l00995"></a>00995 
<a name="l00996"></a>00996         <span class="keywordflow">if</span> (zoom &lt; m_min_zoom) zoom = m_min_zoom;
<a name="l00997"></a>00997     <span class="keywordflow">else</span>
<a name="l00998"></a>00998         <span class="keywordflow">if</span> (zoom &gt; m_max_zoom) zoom = m_max_zoom;
<a name="l00999"></a>00999 
<a name="l01000"></a>01000     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga63fe346f4ea58f09453ccd42ffe87260">SetZoom</a>(zoom);
<a name="l01001"></a>01001 }
<a name="l01002"></a>01002 
<a name="l01003"></a><a class="code" href="group___o_p_map_plugin.html#ga865f22d42c30a2446539f03df486e64e">01003</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#ga865f22d42c30a2446539f03df486e64e">OPMapGadgetWidget::setMaxUpdateRate</a>(<span class="keywordtype">int</span> update_rate)
<a name="l01004"></a>01004 {
<a name="l01005"></a>01005         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01006"></a>01006                 <span class="keywordflow">return</span>;
<a name="l01007"></a>01007 
<a name="l01008"></a>01008         <span class="keywordtype">int</span> list_size = <span class="keyword">sizeof</span>(<a class="code" href="group___o_p_map_plugin.html#ga924197d237c4236b05e045cf5b299e51">max_update_rate_list</a>) / <span class="keyword">sizeof</span>(<a class="code" href="group___o_p_map_plugin.html#ga924197d237c4236b05e045cf5b299e51">max_update_rate_list</a>[0]);
<a name="l01009"></a>01009         <span class="keywordtype">int</span> min_rate = <a class="code" href="group___o_p_map_plugin.html#ga924197d237c4236b05e045cf5b299e51">max_update_rate_list</a>[0];
<a name="l01010"></a>01010         <span class="keywordtype">int</span> max_rate = <a class="code" href="group___o_p_map_plugin.html#ga924197d237c4236b05e045cf5b299e51">max_update_rate_list</a>[list_size - 1];
<a name="l01011"></a>01011 
<a name="l01012"></a>01012         <span class="keywordflow">if</span> (update_rate &lt; min_rate) update_rate = min_rate;
<a name="l01013"></a>01013         <span class="keywordflow">else</span>
<a name="l01014"></a>01014         <span class="keywordflow">if</span> (update_rate &gt; max_rate) update_rate = max_rate;
<a name="l01015"></a>01015 
<a name="l01016"></a>01016         m_maxUpdateRate = update_rate;
<a name="l01017"></a>01017 
<a name="l01018"></a>01018         <span class="keywordflow">if</span> (m_updateTimer)
<a name="l01019"></a>01019                 m_updateTimer-&gt;setInterval(m_maxUpdateRate);
<a name="l01020"></a>01020 
<a name="l01021"></a>01021 <span class="comment">//      if (m_statusUpdateTimer)</span>
<a name="l01022"></a>01022 <span class="comment">//              m_statusUpdateTimer-&gt;setInterval(m_maxUpdateRate);</span>
<a name="l01023"></a>01023 }
<a name="l01024"></a>01024 
<a name="l01025"></a><a class="code" href="group___o_p_map_plugin.html#gaa2731b7fb965c417860b30ac354437ca">01025</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#gaa2731b7fb965c417860b30ac354437ca">OPMapGadgetWidget::setZoom</a>(<span class="keywordtype">int</span> zoom)
<a name="l01026"></a>01026 {
<a name="l01027"></a>01027         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01028"></a>01028                 <span class="keywordflow">return</span>;
<a name="l01029"></a>01029 
<a name="l01030"></a>01030         <span class="keywordflow">if</span> (zoom &lt; m_min_zoom) zoom = m_min_zoom;
<a name="l01031"></a>01031     <span class="keywordflow">else</span>
<a name="l01032"></a>01032         <span class="keywordflow">if</span> (zoom &gt; m_max_zoom) zoom = m_max_zoom;
<a name="l01033"></a>01033 
<a name="l01034"></a>01034     internals::MouseWheelZoomType::Types zoom_type = m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gaccdd5b2b818dd9add21788954c49eabe">GetMouseWheelZoomType</a>();
<a name="l01035"></a>01035     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga24fd1f0f732f8306c89d00997f9957e1">SetMouseWheelZoomType</a>(internals::MouseWheelZoomType::ViewCenter);
<a name="l01036"></a>01036 
<a name="l01037"></a>01037     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga63fe346f4ea58f09453ccd42ffe87260">SetZoom</a>(zoom);
<a name="l01038"></a>01038 
<a name="l01039"></a>01039     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga24fd1f0f732f8306c89d00997f9957e1">SetMouseWheelZoomType</a>(zoom_type);
<a name="l01040"></a>01040 }
<a name="l01041"></a><a class="code" href="group___o_p_map_plugin.html#ga7d642e3ea7bf1e5cd0cc8be6dafc7ba8">01041</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#ga7d642e3ea7bf1e5cd0cc8be6dafc7ba8">OPMapGadgetWidget::setOverlayOpacity</a>(qreal value)
<a name="l01042"></a>01042 {
<a name="l01043"></a>01043     <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01044"></a>01044         <span class="keywordflow">return</span>;
<a name="l01045"></a>01045     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga989b4bdc242ebd97536cffb2be2193fc">setOverlayOpacity</a>(value);
<a name="l01046"></a>01046     overlayOpacityAct.at(value*10)-&gt;setChecked(<span class="keyword">true</span>);
<a name="l01047"></a>01047 }
<a name="l01048"></a>01048 
<a name="l01049"></a><a class="code" href="group___o_p_map_plugin.html#ga44a752ab2b6f6b6212e39316b4050683">01049</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#ga44a752ab2b6f6b6212e39316b4050683">OPMapGadgetWidget::setHomePosition</a>(QPointF pos)
<a name="l01050"></a>01050 {
<a name="l01051"></a>01051     <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01052"></a>01052         <span class="keywordflow">return</span>;
<a name="l01053"></a>01053 
<a name="l01054"></a>01054     <span class="keywordtype">double</span> latitude = pos.y();
<a name="l01055"></a>01055     <span class="keywordtype">double</span> longitude = pos.x();
<a name="l01056"></a>01056 
<a name="l01057"></a>01057     <span class="keywordflow">if</span> (latitude != latitude || longitude != longitude)
<a name="l01058"></a>01058         <span class="keywordflow">return</span>; <span class="comment">// nan prevention</span>
<a name="l01059"></a>01059 
<a name="l01060"></a>01060     <span class="keywordflow">if</span> (latitude &gt;  90) latitude =  90;
<a name="l01061"></a>01061     <span class="keywordflow">else</span>
<a name="l01062"></a>01062     <span class="keywordflow">if</span> (latitude &lt; -90) latitude = -90;
<a name="l01063"></a>01063 
<a name="l01064"></a>01064     <span class="keywordflow">if</span> (longitude &gt;  180) longitude =  180;
<a name="l01065"></a>01065     <span class="keywordflow">else</span>
<a name="l01066"></a>01066     <span class="keywordflow">if</span> (longitude &lt; -180) longitude = -180;
<a name="l01067"></a>01067 
<a name="l01068"></a>01068     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga3c39e182c87b25990664fbe7dd0a9eff">Home</a>-&gt;SetCoord(<a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a>(latitude, longitude));
<a name="l01069"></a>01069 }
<a name="l01070"></a>01070 
<a name="l01071"></a><a class="code" href="group___o_p_map_plugin.html#ga4c9793fea42fd12ba9f7f27c25f98523">01071</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#ga4c9793fea42fd12ba9f7f27c25f98523">OPMapGadgetWidget::setPosition</a>(QPointF pos)
<a name="l01072"></a>01072 {
<a name="l01073"></a>01073         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01074"></a>01074                 <span class="keywordflow">return</span>;
<a name="l01075"></a>01075 
<a name="l01076"></a>01076     <span class="keywordtype">double</span> latitude = pos.y();
<a name="l01077"></a>01077     <span class="keywordtype">double</span> longitude = pos.x();
<a name="l01078"></a>01078 
<a name="l01079"></a>01079     <span class="keywordflow">if</span> (latitude != latitude || longitude != longitude)
<a name="l01080"></a>01080         <span class="keywordflow">return</span>; <span class="comment">// nan prevention</span>
<a name="l01081"></a>01081 
<a name="l01082"></a>01082     <span class="keywordflow">if</span> (latitude &gt;  90) latitude =  90;
<a name="l01083"></a>01083     <span class="keywordflow">else</span>
<a name="l01084"></a>01084     <span class="keywordflow">if</span> (latitude &lt; -90) latitude = -90;
<a name="l01085"></a>01085 
<a name="l01086"></a>01086     <span class="keywordflow">if</span> (longitude &gt;  180) longitude =  180;
<a name="l01087"></a>01087     <span class="keywordflow">else</span>
<a name="l01088"></a>01088     <span class="keywordflow">if</span> (longitude &lt; -180) longitude = -180;
<a name="l01089"></a>01089 
<a name="l01090"></a>01090     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga5144489a16c9bd07abbd0d8adc01656d">SetCurrentPosition</a>(<a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a>(latitude, longitude));
<a name="l01091"></a>01091 }
<a name="l01092"></a>01092 
<a name="l01093"></a><a class="code" href="group___o_p_map_plugin.html#gab677b7feb42a6edd833e63325d2a928b">01093</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#gab677b7feb42a6edd833e63325d2a928b">OPMapGadgetWidget::setMapProvider</a>(<a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> provider)
<a name="l01094"></a>01094 {
<a name="l01095"></a>01095         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01096"></a>01096                 <span class="keywordflow">return</span>;
<a name="l01097"></a>01097 <span class="comment">//</span>
<a name="l01098"></a>01098     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga57d623773f3801edb2a359b9d92c648b">SetMapType</a>(<a class="code" href="group___o_p_map_widget.html#gae829b229cde8f7beebc9f3c0981f674c" title="Converts from String to Type.">mapcontrol::Helper::MapTypeFromString</a>(provider));
<a name="l01099"></a>01099 }
<a name="l01100"></a>01100 
<a name="l01101"></a><a class="code" href="group___o_p_map_plugin.html#ga5187482d55aa0753cb6395bef5c402dd">01101</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#ga5187482d55aa0753cb6395bef5c402dd">OPMapGadgetWidget::setAccessMode</a>(<a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> accessMode)
<a name="l01102"></a>01102 {
<a name="l01103"></a>01103         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01104"></a>01104                 <span class="keywordflow">return</span>;
<a name="l01105"></a>01105 
<a name="l01106"></a>01106     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gaa79e123990d6d7b2f1c45e5c2a56313d">configuration</a>-&gt;<a class="code" href="group___o_p_map_widget.html#ga41001a3e8948832246f19baf28c45e68" title="Sets the access mode for the map (cache only, server and cache...)">SetAccessMode</a>(<a class="code" href="group___o_p_map_widget.html#ga800ba0d0ba832cda15296dcc2bad12c5" title="Converts from String to Type.">mapcontrol::Helper::AccessModeFromString</a>(accessMode));
<a name="l01107"></a>01107 }
<a name="l01108"></a>01108 
<a name="l01109"></a><a class="code" href="group___o_p_map_plugin.html#ga98807be867cfbdd8a0eeb05835b63a75">01109</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#ga98807be867cfbdd8a0eeb05835b63a75">OPMapGadgetWidget::setUseOpenGL</a>(<span class="keywordtype">bool</span> useOpenGL)
<a name="l01110"></a>01110 {
<a name="l01111"></a>01111         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01112"></a>01112                 <span class="keywordflow">return</span>;
<a name="l01113"></a>01113 
<a name="l01114"></a>01114     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga1dad00a9a3dc508690c7db4cb7b3373d">SetUseOpenGL</a>(useOpenGL);
<a name="l01115"></a>01115 }
<a name="l01116"></a>01116 
<a name="l01117"></a><a class="code" href="group___o_p_map_plugin.html#ga30af002abadbc8e420a9fe75f5042765">01117</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#ga30af002abadbc8e420a9fe75f5042765">OPMapGadgetWidget::setShowTileGridLines</a>(<span class="keywordtype">bool</span> showTileGridLines)
<a name="l01118"></a>01118 {
<a name="l01119"></a>01119         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01120"></a>01120                 <span class="keywordflow">return</span>;
<a name="l01121"></a>01121 
<a name="l01122"></a>01122     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gae09f73466c8f5ba738db48600eab7635" title="Defines if map is to show gridlines.">SetShowTileGridLines</a>(showTileGridLines);
<a name="l01123"></a>01123 }
<a name="l01124"></a>01124 
<a name="l01125"></a><a class="code" href="group___o_p_map_plugin.html#gad5bce7bba1964ba7d8303ec72e107dd8">01125</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#gad5bce7bba1964ba7d8303ec72e107dd8">OPMapGadgetWidget::setUseMemoryCache</a>(<span class="keywordtype">bool</span> useMemoryCache)
<a name="l01126"></a>01126 {
<a name="l01127"></a>01127         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01128"></a>01128                 <span class="keywordflow">return</span>;
<a name="l01129"></a>01129 
<a name="l01130"></a>01130     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gaa79e123990d6d7b2f1c45e5c2a56313d">configuration</a>-&gt;<a class="code" href="group___o_p_map_widget.html#ga323ea9b6071044204ce278734ef855fb" title="Used to allow disallow use of memory caching.">SetUseMemoryCache</a>(useMemoryCache);
<a name="l01131"></a>01131 }
<a name="l01132"></a>01132 
<a name="l01133"></a><a class="code" href="group___o_p_map_plugin.html#gab99ed3caf53adec86782ef89c0e8f47a">01133</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#gab99ed3caf53adec86782ef89c0e8f47a">OPMapGadgetWidget::setCacheLocation</a>(<a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> cacheLocation)
<a name="l01134"></a>01134 {
<a name="l01135"></a>01135         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01136"></a>01136                 <span class="keywordflow">return</span>;
<a name="l01137"></a>01137 
<a name="l01138"></a>01138     cacheLocation = cacheLocation.simplified(); <span class="comment">// remove any surrounding spaces</span>
<a name="l01139"></a>01139 
<a name="l01140"></a>01140     <span class="keywordflow">if</span> (cacheLocation.isEmpty()) <span class="keywordflow">return</span>;
<a name="l01141"></a>01141 
<a name="l01142"></a>01142     <span class="keywordflow">if</span> (!cacheLocation.endsWith(QDir::separator())) cacheLocation += QDir::separator();
<a name="l01143"></a>01143 
<a name="l01144"></a>01144     QDir dir;
<a name="l01145"></a>01145     <span class="keywordflow">if</span> (!dir.exists(cacheLocation))
<a name="l01146"></a>01146         <span class="keywordflow">if</span> (!dir.mkpath(cacheLocation))
<a name="l01147"></a>01147             <span class="keywordflow">return</span>;
<a name="l01148"></a>01148     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gaa79e123990d6d7b2f1c45e5c2a56313d">configuration</a>-&gt;<a class="code" href="group___o_p_map_widget.html#ga735443d74919b6c74f91fbf1f0576931" title="Sets the location for the SQLite Database used for caching and the geocoding cache files...">SetCacheLocation</a>(cacheLocation);
<a name="l01149"></a>01149 }
<a name="l01150"></a>01150 
<a name="l01151"></a><a class="code" href="group___o_p_map_plugin.html#gafe9c5443c9ed4947f2072bf8feba9673">01151</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#gafe9c5443c9ed4947f2072bf8feba9673">OPMapGadgetWidget::setMapMode</a>(<a class="code" href="group___o_p_map_plugin.html#ga10cb3e7dfbac87e40e00c1a8c76c16e5">opMapModeType</a> mode)
<a name="l01152"></a>01152 {
<a name="l01153"></a>01153         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01154"></a>01154                 <span class="keywordflow">return</span>;
<a name="l01155"></a>01155 
<a name="l01156"></a>01156     <span class="keywordflow">if</span> (mode != <a class="code" href="group___o_p_map_plugin.html#gga10cb3e7dfbac87e40e00c1a8c76c16e5afdcda6e378c8e0a54e928947a5fdede8">Normal_MapMode</a> &amp;&amp; mode != <a class="code" href="group___o_p_map_plugin.html#gga10cb3e7dfbac87e40e00c1a8c76c16e5abdc1c0b7296fb52149bbda0739034825">MagicWaypoint_MapMode</a>)
<a name="l01157"></a>01157         mode = <a class="code" href="group___o_p_map_plugin.html#gga10cb3e7dfbac87e40e00c1a8c76c16e5afdcda6e378c8e0a54e928947a5fdede8">Normal_MapMode</a>;  <span class="comment">// fix error</span>
<a name="l01158"></a>01158 
<a name="l01159"></a>01159     <span class="keywordflow">if</span> (m_map_mode == mode)
<a name="l01160"></a>01160     {   <span class="comment">// no change in map mode</span>
<a name="l01161"></a>01161         <span class="keywordflow">switch</span> (mode)
<a name="l01162"></a>01162         {   <span class="comment">// make sure the UI buttons are set correctly</span>
<a name="l01163"></a>01163             <span class="keywordflow">case</span> <a class="code" href="group___o_p_map_plugin.html#gga10cb3e7dfbac87e40e00c1a8c76c16e5afdcda6e378c8e0a54e928947a5fdede8">Normal_MapMode</a>:
<a name="l01164"></a>01164                 m_widget-&gt;toolButtonMagicWaypointMapMode-&gt;setChecked(<span class="keyword">false</span>);
<a name="l01165"></a>01165                 m_widget-&gt;toolButtonNormalMapMode-&gt;setChecked(<span class="keyword">true</span>);
<a name="l01166"></a>01166                 <span class="keywordflow">break</span>;
<a name="l01167"></a>01167             <span class="keywordflow">case</span> <a class="code" href="group___o_p_map_plugin.html#gga10cb3e7dfbac87e40e00c1a8c76c16e5abdc1c0b7296fb52149bbda0739034825">MagicWaypoint_MapMode</a>:
<a name="l01168"></a>01168                 m_widget-&gt;toolButtonNormalMapMode-&gt;setChecked(<span class="keyword">false</span>);
<a name="l01169"></a>01169                 m_widget-&gt;toolButtonMagicWaypointMapMode-&gt;setChecked(<span class="keyword">true</span>);
<a name="l01170"></a>01170                 <span class="keywordflow">break</span>;
<a name="l01171"></a>01171         }
<a name="l01172"></a>01172         <span class="keywordflow">return</span>;
<a name="l01173"></a>01173     }
<a name="l01174"></a>01174 
<a name="l01175"></a>01175     <span class="keywordflow">switch</span> (mode)
<a name="l01176"></a>01176     {
<a name="l01177"></a>01177         <span class="keywordflow">case</span> <a class="code" href="group___o_p_map_plugin.html#gga10cb3e7dfbac87e40e00c1a8c76c16e5afdcda6e378c8e0a54e928947a5fdede8">Normal_MapMode</a>:
<a name="l01178"></a>01178             m_map_mode = <a class="code" href="group___o_p_map_plugin.html#gga10cb3e7dfbac87e40e00c1a8c76c16e5afdcda6e378c8e0a54e928947a5fdede8">Normal_MapMode</a>;
<a name="l01179"></a>01179 
<a name="l01180"></a>01180             m_widget-&gt;toolButtonMagicWaypointMapMode-&gt;setChecked(<span class="keyword">false</span>);
<a name="l01181"></a>01181             m_widget-&gt;toolButtonNormalMapMode-&gt;setChecked(<span class="keyword">true</span>);
<a name="l01182"></a>01182 
<a name="l01183"></a>01183             hideMagicWaypointControls();
<a name="l01184"></a>01184 
<a name="l01185"></a>01185             magicWayPoint-&gt;setVisible(<span class="keyword">false</span>);
<a name="l01186"></a>01186             m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga9a1f7cb8eb3ca498061257be74ed76c6">WPSetVisibleAll</a>(<span class="keyword">true</span>);
<a name="l01187"></a>01187 
<a name="l01188"></a>01188             <span class="keywordflow">break</span>;
<a name="l01189"></a>01189 
<a name="l01190"></a>01190         <span class="keywordflow">case</span> <a class="code" href="group___o_p_map_plugin.html#gga10cb3e7dfbac87e40e00c1a8c76c16e5abdc1c0b7296fb52149bbda0739034825">MagicWaypoint_MapMode</a>:
<a name="l01191"></a>01191             m_map_mode = <a class="code" href="group___o_p_map_plugin.html#gga10cb3e7dfbac87e40e00c1a8c76c16e5abdc1c0b7296fb52149bbda0739034825">MagicWaypoint_MapMode</a>;
<a name="l01192"></a>01192 
<a name="l01193"></a>01193             m_widget-&gt;toolButtonNormalMapMode-&gt;setChecked(<span class="keyword">false</span>);
<a name="l01194"></a>01194             m_widget-&gt;toolButtonMagicWaypointMapMode-&gt;setChecked(<span class="keyword">true</span>);
<a name="l01195"></a>01195 
<a name="l01196"></a>01196             showMagicWaypointControls();
<a name="l01197"></a>01197 
<a name="l01198"></a>01198             <span class="comment">// delete the normal waypoints from the map</span>
<a name="l01199"></a>01199 
<a name="l01200"></a>01200             m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga9a1f7cb8eb3ca498061257be74ed76c6">WPSetVisibleAll</a>(<span class="keyword">false</span>);
<a name="l01201"></a>01201             magicWayPoint-&gt;setVisible(<span class="keyword">true</span>);
<a name="l01202"></a>01202 
<a name="l01203"></a>01203             <span class="keywordflow">break</span>;
<a name="l01204"></a>01204     }
<a name="l01205"></a>01205 }
<a name="l01206"></a>01206 
<a name="l01207"></a><a class="code" href="group___o_p_map_plugin.html#ga7afda7ed24be3606e25a6005fcc881da">01207</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#ga7afda7ed24be3606e25a6005fcc881da">OPMapGadgetWidget::setUserImageLocation</a>(<a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> userImageLocation)
<a name="l01208"></a>01208 {
<a name="l01209"></a>01209     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gab46d43fc65b333d32a79056ca882caa0">SetUserImageLocation</a>(userImageLocation);
<a name="l01210"></a>01210 }
<a name="l01211"></a><a class="code" href="group___o_p_map_plugin.html#gab57277e52834ff73fe190391e3b2aa40">01211</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#gab57277e52834ff73fe190391e3b2aa40">OPMapGadgetWidget::setUserImageHorizontalScale</a>(<span class="keywordtype">double</span> userImageHorizontalScale)
<a name="l01212"></a>01212 {
<a name="l01213"></a>01213     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gad61028ad754a5341e96c7f2e0e8c13f0">SetUserImageHorizontalScale</a>(userImageHorizontalScale);
<a name="l01214"></a>01214 }
<a name="l01215"></a><a class="code" href="group___o_p_map_plugin.html#gab9a1ad0c6a406ed144ba3ec120d94d28">01215</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#gab9a1ad0c6a406ed144ba3ec120d94d28">OPMapGadgetWidget::setUserImageVerticalScale</a>(<span class="keywordtype">double</span> userImageVerticalScale)
<a name="l01216"></a>01216 {
<a name="l01217"></a>01217     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gaac2d5997b77a7b661f1d983316e4f825">SetUserImageVerticalScale</a>(userImageVerticalScale);
<a name="l01218"></a>01218 }
<a name="l01219"></a>01219 
<a name="l01220"></a>01220 
<a name="l01221"></a>01221 <span class="comment">// *************************************************************************************</span>
<a name="l01222"></a>01222 <span class="comment">// Context menu stuff</span>
<a name="l01223"></a>01223 
<a name="l01224"></a>01224 <span class="keywordtype">void</span> OPMapGadgetWidget::createActions()
<a name="l01225"></a>01225 {
<a name="l01226"></a>01226         <span class="keywordtype">int</span> list_size;
<a name="l01227"></a>01227 
<a name="l01228"></a>01228         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01229"></a>01229                 <span class="keywordflow">return</span>;
<a name="l01230"></a>01230 
<a name="l01231"></a>01231     <span class="comment">// ***********************</span>
<a name="l01232"></a>01232     <span class="comment">// create menu actions</span>
<a name="l01233"></a>01233 
<a name="l01234"></a>01234     closeAct1 = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Close menu&quot;</span>), <span class="keyword">this</span>);
<a name="l01235"></a>01235     closeAct1-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Close the context menu&quot;</span>));
<a name="l01236"></a>01236 
<a name="l01237"></a>01237     closeAct2 = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Close menu&quot;</span>), <span class="keyword">this</span>);
<a name="l01238"></a>01238     closeAct2-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Close the context menu&quot;</span>));
<a name="l01239"></a>01239 
<a name="l01240"></a>01240     reloadAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;&amp;Reload map&quot;</span>), <span class="keyword">this</span>);
<a name="l01241"></a>01241     reloadAct-&gt;setShortcut(tr(<span class="stringliteral">&quot;F5&quot;</span>));
<a name="l01242"></a>01242     reloadAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Reload the map tiles&quot;</span>));
<a name="l01243"></a>01243     connect(reloadAct, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(onReloadAct_triggered()));
<a name="l01244"></a>01244     this-&gt;addAction(reloadAct);
<a name="l01245"></a>01245     ripAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;&amp;Rip map&quot;</span>), <span class="keyword">this</span>);
<a name="l01246"></a>01246     ripAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Rip the map tiles&quot;</span>));
<a name="l01247"></a>01247     connect(ripAct, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(onRipAct_triggered()));
<a name="l01248"></a>01248 
<a name="l01249"></a>01249     copyMouseLatLonToClipAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Mouse latitude and longitude&quot;</span>), <span class="keyword">this</span>);
<a name="l01250"></a>01250     copyMouseLatLonToClipAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Copy the mouse latitude and longitude to the clipboard&quot;</span>));
<a name="l01251"></a>01251     connect(copyMouseLatLonToClipAct, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(onCopyMouseLatLonToClipAct_triggered()));
<a name="l01252"></a>01252 
<a name="l01253"></a>01253     copyMouseLatToClipAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Mouse latitude&quot;</span>), <span class="keyword">this</span>);
<a name="l01254"></a>01254     copyMouseLatToClipAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Copy the mouse latitude to the clipboard&quot;</span>));
<a name="l01255"></a>01255     connect(copyMouseLatToClipAct, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(onCopyMouseLatToClipAct_triggered()));
<a name="l01256"></a>01256 
<a name="l01257"></a>01257     copyMouseLonToClipAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Mouse longitude&quot;</span>), <span class="keyword">this</span>);
<a name="l01258"></a>01258     copyMouseLonToClipAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Copy the mouse longitude to the clipboard&quot;</span>));
<a name="l01259"></a>01259     connect(copyMouseLonToClipAct, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(onCopyMouseLonToClipAct_triggered()));
<a name="l01260"></a>01260 
<a name="l01261"></a>01261     showCompassAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Show compass&quot;</span>), <span class="keyword">this</span>);
<a name="l01262"></a>01262     showCompassAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Show/Hide the compass&quot;</span>));
<a name="l01263"></a>01263     showCompassAct-&gt;setCheckable(<span class="keyword">true</span>);
<a name="l01264"></a>01264     showCompassAct-&gt;setChecked(<span class="keyword">true</span>);
<a name="l01265"></a>01265     connect(showCompassAct, SIGNAL(toggled(<span class="keywordtype">bool</span>)), <span class="keyword">this</span>, SLOT(onShowCompassAct_toggled(<span class="keywordtype">bool</span>)));
<a name="l01266"></a>01266 
<a name="l01267"></a>01267     showDiagnostics = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Show Diagnostics&quot;</span>), <span class="keyword">this</span>);
<a name="l01268"></a>01268     showDiagnostics-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Show/Hide the diagnostics&quot;</span>));
<a name="l01269"></a>01269     showDiagnostics-&gt;setCheckable(<span class="keyword">true</span>);
<a name="l01270"></a>01270     showDiagnostics-&gt;setChecked(<span class="keyword">false</span>);
<a name="l01271"></a>01271     connect(showDiagnostics, SIGNAL(toggled(<span class="keywordtype">bool</span>)), <span class="keyword">this</span>, SLOT(onShowDiagnostics_toggled(<span class="keywordtype">bool</span>)));
<a name="l01272"></a>01272 
<a name="l01273"></a>01273     showUAVInfo = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Show UAV Info&quot;</span>), <span class="keyword">this</span>);
<a name="l01274"></a>01274     showUAVInfo-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Show/Hide the UAV info&quot;</span>));
<a name="l01275"></a>01275     showUAVInfo-&gt;setCheckable(<span class="keyword">true</span>);
<a name="l01276"></a>01276     showUAVInfo-&gt;setChecked(<span class="keyword">false</span>);
<a name="l01277"></a>01277     connect(showUAVInfo, SIGNAL(toggled(<span class="keywordtype">bool</span>)), <span class="keyword">this</span>, SLOT(onShowUAVInfo_toggled(<span class="keywordtype">bool</span>)));
<a name="l01278"></a>01278 
<a name="l01279"></a>01279     showHomeAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Show Home&quot;</span>), <span class="keyword">this</span>);
<a name="l01280"></a>01280     showHomeAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Show/Hide the Home location&quot;</span>));
<a name="l01281"></a>01281     showHomeAct-&gt;setCheckable(<span class="keyword">true</span>);
<a name="l01282"></a>01282     showHomeAct-&gt;setChecked(<span class="keyword">true</span>);
<a name="l01283"></a>01283     connect(showHomeAct, SIGNAL(toggled(<span class="keywordtype">bool</span>)), <span class="keyword">this</span>, SLOT(onShowHomeAct_toggled(<span class="keywordtype">bool</span>)));
<a name="l01284"></a>01284 
<a name="l01285"></a>01285     showUAVAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Show UAV&quot;</span>), <span class="keyword">this</span>);
<a name="l01286"></a>01286     showUAVAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Show/Hide the UAV&quot;</span>));
<a name="l01287"></a>01287     showUAVAct-&gt;setCheckable(<span class="keyword">true</span>);
<a name="l01288"></a>01288     showUAVAct-&gt;setChecked(<span class="keyword">true</span>);
<a name="l01289"></a>01289     connect(showUAVAct, SIGNAL(toggled(<span class="keywordtype">bool</span>)), <span class="keyword">this</span>, SLOT(onShowUAVAct_toggled(<span class="keywordtype">bool</span>)));
<a name="l01290"></a>01290 
<a name="l01291"></a>01291     changeDefaultLocalAndZoom = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Set default zoom and location&quot;</span>), <span class="keyword">this</span>);
<a name="l01292"></a>01292     changeDefaultLocalAndZoom-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Changes the map default zoom and location to the current values&quot;</span>));
<a name="l01293"></a>01293     connect(changeDefaultLocalAndZoom, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(onChangeDefaultLocalAndZoom()));
<a name="l01294"></a>01294 
<a name="l01295"></a>01295     zoomInAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Zoom &amp;In&quot;</span>), <span class="keyword">this</span>);
<a name="l01296"></a>01296     zoomInAct-&gt;setShortcut(Qt::Key_PageUp);
<a name="l01297"></a>01297     zoomInAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Zoom the map in&quot;</span>));
<a name="l01298"></a>01298     connect(zoomInAct, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(onGoZoomInAct_triggered()));
<a name="l01299"></a>01299     this-&gt;addAction(zoomInAct);
<a name="l01300"></a>01300 
<a name="l01301"></a>01301     zoomOutAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Zoom &amp;Out&quot;</span>), <span class="keyword">this</span>);
<a name="l01302"></a>01302     zoomOutAct-&gt;setShortcut(Qt::Key_PageDown);
<a name="l01303"></a>01303     zoomOutAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Zoom the map out&quot;</span>));
<a name="l01304"></a>01304     connect(zoomOutAct, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(onGoZoomOutAct_triggered()));
<a name="l01305"></a>01305     this-&gt;addAction(zoomOutAct);
<a name="l01306"></a>01306 
<a name="l01307"></a>01307     goMouseClickAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Go to where you right clicked the mouse&quot;</span>), <span class="keyword">this</span>);
<a name="l01308"></a>01308     goMouseClickAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Center the map onto where you right clicked the mouse&quot;</span>));
<a name="l01309"></a>01309     connect(goMouseClickAct, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(onGoMouseClickAct_triggered()));
<a name="l01310"></a>01310 
<a name="l01311"></a>01311     setHomeAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Set the home location&quot;</span>), <span class="keyword">this</span>);
<a name="l01312"></a>01312     setHomeAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Set the home location to where you clicked&quot;</span>));
<a name="l01313"></a>01313 <span class="preprocessor">    #if !defined(allow_manual_home_location_move)</span>
<a name="l01314"></a>01314 <span class="preprocessor"></span>        setHomeAct-&gt;setEnabled(<span class="keyword">false</span>);
<a name="l01315"></a>01315 <span class="preprocessor">    #endif</span>
<a name="l01316"></a>01316 <span class="preprocessor"></span>    connect(setHomeAct, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(onSetHomeAct_triggered()));
<a name="l01317"></a>01317 
<a name="l01318"></a>01318     goHomeAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Go to &amp;Home location&quot;</span>), <span class="keyword">this</span>);
<a name="l01319"></a>01319     goHomeAct-&gt;setShortcut(tr(<span class="stringliteral">&quot;Ctrl+H&quot;</span>));
<a name="l01320"></a>01320     goHomeAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Center the map onto the home location&quot;</span>));
<a name="l01321"></a>01321     connect(goHomeAct, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(onGoHomeAct_triggered()));
<a name="l01322"></a>01322 
<a name="l01323"></a>01323     goUAVAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Go to &amp;UAV location&quot;</span>), <span class="keyword">this</span>);
<a name="l01324"></a>01324     goUAVAct-&gt;setShortcut(tr(<span class="stringliteral">&quot;Ctrl+U&quot;</span>));
<a name="l01325"></a>01325     goUAVAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Center the map onto the UAV location&quot;</span>));
<a name="l01326"></a>01326     connect(goUAVAct, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(onGoUAVAct_triggered()));
<a name="l01327"></a>01327 
<a name="l01328"></a>01328     followUAVpositionAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Follow UAV position&quot;</span>), <span class="keyword">this</span>);
<a name="l01329"></a>01329     followUAVpositionAct-&gt;setShortcut(tr(<span class="stringliteral">&quot;Ctrl+F&quot;</span>));
<a name="l01330"></a>01330     followUAVpositionAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Keep the map centered onto the UAV&quot;</span>));
<a name="l01331"></a>01331     followUAVpositionAct-&gt;setCheckable(<span class="keyword">true</span>);
<a name="l01332"></a>01332     followUAVpositionAct-&gt;setChecked(<span class="keyword">false</span>);
<a name="l01333"></a>01333     connect(followUAVpositionAct, SIGNAL(toggled(<span class="keywordtype">bool</span>)), <span class="keyword">this</span>, SLOT(onFollowUAVpositionAct_toggled(<span class="keywordtype">bool</span>)));
<a name="l01334"></a>01334 
<a name="l01335"></a>01335     followUAVheadingAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Follow UAV heading&quot;</span>), <span class="keyword">this</span>);
<a name="l01336"></a>01336     followUAVheadingAct-&gt;setShortcut(tr(<span class="stringliteral">&quot;Ctrl+F&quot;</span>));
<a name="l01337"></a>01337     followUAVheadingAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Keep the map rotation to the UAV heading&quot;</span>));
<a name="l01338"></a>01338     followUAVheadingAct-&gt;setCheckable(<span class="keyword">true</span>);
<a name="l01339"></a>01339     followUAVheadingAct-&gt;setChecked(<span class="keyword">false</span>);
<a name="l01340"></a>01340     connect(followUAVheadingAct, SIGNAL(toggled(<span class="keywordtype">bool</span>)), <span class="keyword">this</span>, SLOT(onFollowUAVheadingAct_toggled(<span class="keywordtype">bool</span>)));
<a name="l01341"></a>01341 
<a name="l01342"></a>01342     wayPointEditorAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;&amp;Waypoint editor&quot;</span>), <span class="keyword">this</span>);
<a name="l01343"></a>01343     wayPointEditorAct-&gt;setShortcut(tr(<span class="stringliteral">&quot;Ctrl+W&quot;</span>));
<a name="l01344"></a>01344     wayPointEditorAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Open the waypoint editor&quot;</span>));
<a name="l01345"></a>01345     connect(wayPointEditorAct, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(onOpenWayPointEditorAct_triggered()));
<a name="l01346"></a>01346 
<a name="l01347"></a>01347     addWayPointActFromContextMenu = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;&amp;Add waypoint&quot;</span>), <span class="keyword">this</span>);
<a name="l01348"></a>01348     addWayPointActFromContextMenu-&gt;setShortcut(tr(<span class="stringliteral">&quot;Ctrl+A&quot;</span>));
<a name="l01349"></a>01349     addWayPointActFromContextMenu-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Add waypoint&quot;</span>));
<a name="l01350"></a>01350     connect(addWayPointActFromContextMenu, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(onAddWayPointAct_triggeredFromContextMenu()));
<a name="l01351"></a>01351 
<a name="l01352"></a>01352     addWayPointActFromThis = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;&amp;Add waypoint&quot;</span>), <span class="keyword">this</span>);
<a name="l01353"></a>01353     addWayPointActFromThis-&gt;setShortcut(tr(<span class="stringliteral">&quot;Ctrl+A&quot;</span>));
<a name="l01354"></a>01354     addWayPointActFromThis-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Add waypoint&quot;</span>));
<a name="l01355"></a>01355     connect(addWayPointActFromThis, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(onAddWayPointAct_triggeredFromThis()));
<a name="l01356"></a>01356     this-&gt;addAction(addWayPointActFromThis);
<a name="l01357"></a>01357 
<a name="l01358"></a>01358     editWayPointAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;&amp;Edit waypoint&quot;</span>), <span class="keyword">this</span>);
<a name="l01359"></a>01359     editWayPointAct-&gt;setShortcut(tr(<span class="stringliteral">&quot;Ctrl+E&quot;</span>));
<a name="l01360"></a>01360     editWayPointAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Edit waypoint&quot;</span>));
<a name="l01361"></a>01361     connect(editWayPointAct, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(onEditWayPointAct_triggered()));
<a name="l01362"></a>01362 
<a name="l01363"></a>01363     lockWayPointAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;&amp;Lock waypoint&quot;</span>), <span class="keyword">this</span>);
<a name="l01364"></a>01364     lockWayPointAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Lock/Unlock a waypoint&quot;</span>));
<a name="l01365"></a>01365     lockWayPointAct-&gt;setCheckable(<span class="keyword">true</span>);
<a name="l01366"></a>01366     lockWayPointAct-&gt;setChecked(<span class="keyword">false</span>);
<a name="l01367"></a>01367     connect(lockWayPointAct, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(onLockWayPointAct_triggered()));
<a name="l01368"></a>01368 
<a name="l01369"></a>01369     deleteWayPointAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;&amp;Delete waypoint&quot;</span>), <span class="keyword">this</span>);
<a name="l01370"></a>01370     deleteWayPointAct-&gt;setShortcut(tr(<span class="stringliteral">&quot;Ctrl+D&quot;</span>));
<a name="l01371"></a>01371     deleteWayPointAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Delete waypoint&quot;</span>));
<a name="l01372"></a>01372     connect(deleteWayPointAct, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(onDeleteWayPointAct_triggered()));
<a name="l01373"></a>01373 
<a name="l01374"></a>01374     clearWayPointsAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;&amp;Clear waypoints&quot;</span>), <span class="keyword">this</span>);
<a name="l01375"></a>01375     clearWayPointsAct-&gt;setShortcut(tr(<span class="stringliteral">&quot;Ctrl+C&quot;</span>));
<a name="l01376"></a>01376     clearWayPointsAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Clear waypoints&quot;</span>));
<a name="l01377"></a>01377     connect(clearWayPointsAct, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(onClearWayPointsAct_triggered()));
<a name="l01378"></a>01378 
<a name="l01379"></a>01379     overlayOpacityActGroup = <span class="keyword">new</span> QActionGroup(<span class="keyword">this</span>);
<a name="l01380"></a>01380     connect(overlayOpacityActGroup, SIGNAL(triggered(QAction *)), <span class="keyword">this</span>, SLOT(onOverlayOpacityActGroup_triggered(QAction *)));
<a name="l01381"></a>01381     overlayOpacityAct.clear();
<a name="l01382"></a>01382     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt;= 10; <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)
<a name="l01383"></a>01383     {
<a name="l01384"></a>01384         QAction *overlayAct = <span class="keyword">new</span> QAction(QString::number(<a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>*10), overlayOpacityActGroup);
<a name="l01385"></a>01385         overlayAct-&gt;setCheckable(<span class="keyword">true</span>);
<a name="l01386"></a>01386         overlayAct-&gt;setData(<a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>*10);
<a name="l01387"></a>01387         overlayOpacityAct.append(overlayAct);
<a name="l01388"></a>01388     }
<a name="l01389"></a>01389 
<a name="l01390"></a>01390     homeMagicWaypointAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Home magic waypoint&quot;</span>), <span class="keyword">this</span>);
<a name="l01391"></a>01391     homeMagicWaypointAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Move the magic waypoint to the home position&quot;</span>));
<a name="l01392"></a>01392     connect(homeMagicWaypointAct, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(onHomeMagicWaypointAct_triggered()));
<a name="l01393"></a>01393 
<a name="l01394"></a>01394     mapModeActGroup = <span class="keyword">new</span> QActionGroup(<span class="keyword">this</span>);
<a name="l01395"></a>01395     connect(mapModeActGroup, SIGNAL(triggered(QAction *)), <span class="keyword">this</span>, SLOT(onMapModeActGroup_triggered(QAction *)));
<a name="l01396"></a>01396     mapModeAct.clear();
<a name="l01397"></a>01397     {
<a name="l01398"></a>01398         QAction *map_mode_act;
<a name="l01399"></a>01399 
<a name="l01400"></a>01400         map_mode_act = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Normal&quot;</span>), mapModeActGroup);
<a name="l01401"></a>01401         map_mode_act-&gt;setCheckable(<span class="keyword">true</span>);
<a name="l01402"></a>01402         map_mode_act-&gt;setChecked(m_map_mode == <a class="code" href="group___o_p_map_plugin.html#gga10cb3e7dfbac87e40e00c1a8c76c16e5afdcda6e378c8e0a54e928947a5fdede8">Normal_MapMode</a>);
<a name="l01403"></a>01403         map_mode_act-&gt;setData((<span class="keywordtype">int</span>)<a class="code" href="group___o_p_map_plugin.html#gga10cb3e7dfbac87e40e00c1a8c76c16e5afdcda6e378c8e0a54e928947a5fdede8">Normal_MapMode</a>);
<a name="l01404"></a>01404         mapModeAct.append(map_mode_act);
<a name="l01405"></a>01405 
<a name="l01406"></a>01406         map_mode_act = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Magic Waypoint&quot;</span>), mapModeActGroup);
<a name="l01407"></a>01407         map_mode_act-&gt;setCheckable(<span class="keyword">true</span>);
<a name="l01408"></a>01408         map_mode_act-&gt;setChecked(m_map_mode == <a class="code" href="group___o_p_map_plugin.html#gga10cb3e7dfbac87e40e00c1a8c76c16e5abdc1c0b7296fb52149bbda0739034825">MagicWaypoint_MapMode</a>);
<a name="l01409"></a>01409         map_mode_act-&gt;setData((<span class="keywordtype">int</span>)<a class="code" href="group___o_p_map_plugin.html#gga10cb3e7dfbac87e40e00c1a8c76c16e5abdc1c0b7296fb52149bbda0739034825">MagicWaypoint_MapMode</a>);
<a name="l01410"></a>01410         mapModeAct.append(map_mode_act);
<a name="l01411"></a>01411     }
<a name="l01412"></a>01412 
<a name="l01413"></a>01413     zoomActGroup = <span class="keyword">new</span> QActionGroup(<span class="keyword">this</span>);
<a name="l01414"></a>01414     connect(zoomActGroup, SIGNAL(triggered(QAction *)), <span class="keyword">this</span>, SLOT(onZoomActGroup_triggered(QAction *)));
<a name="l01415"></a>01415     zoomAct.clear();
<a name="l01416"></a>01416         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = m_min_zoom; <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt;= m_max_zoom; <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)
<a name="l01417"></a>01417     {
<a name="l01418"></a>01418         QAction *zoom_act = <span class="keyword">new</span> QAction(QString::number(<a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>), zoomActGroup);
<a name="l01419"></a>01419         zoom_act-&gt;setCheckable(<span class="keyword">true</span>);
<a name="l01420"></a>01420         zoom_act-&gt;setData(<a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>);
<a name="l01421"></a>01421         zoomAct.append(zoom_act);
<a name="l01422"></a>01422     }
<a name="l01423"></a>01423 
<a name="l01424"></a>01424         maxUpdateRateActGroup = <span class="keyword">new</span> QActionGroup(<span class="keyword">this</span>);
<a name="l01425"></a>01425         connect(maxUpdateRateActGroup, SIGNAL(triggered(QAction *)), <span class="keyword">this</span>, SLOT(onMaxUpdateRateActGroup_triggered(QAction *)));
<a name="l01426"></a>01426         maxUpdateRateAct.clear();
<a name="l01427"></a>01427         list_size = <span class="keyword">sizeof</span>(<a class="code" href="group___o_p_map_plugin.html#ga924197d237c4236b05e045cf5b299e51">max_update_rate_list</a>) / <span class="keyword">sizeof</span>(<a class="code" href="group___o_p_map_plugin.html#ga924197d237c4236b05e045cf5b299e51">max_update_rate_list</a>[0]);
<a name="l01428"></a>01428         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; list_size; <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)
<a name="l01429"></a>01429         {
<a name="l01430"></a>01430                 QAction *maxUpdateRate_act;
<a name="l01431"></a>01431                 <span class="keywordtype">int</span> j = <a class="code" href="group___o_p_map_plugin.html#ga924197d237c4236b05e045cf5b299e51">max_update_rate_list</a>[<a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>];
<a name="l01432"></a>01432                 maxUpdateRate_act = <span class="keyword">new</span> QAction(QString::number(j), maxUpdateRateActGroup);
<a name="l01433"></a>01433                 maxUpdateRate_act-&gt;setCheckable(<span class="keyword">true</span>);
<a name="l01434"></a>01434                 maxUpdateRate_act-&gt;setData(j);
<a name="l01435"></a>01435                 maxUpdateRate_act-&gt;setChecked(j == m_maxUpdateRate);
<a name="l01436"></a>01436                 maxUpdateRateAct.append(maxUpdateRate_act);
<a name="l01437"></a>01437         }
<a name="l01438"></a>01438 
<a name="l01439"></a>01439         <span class="comment">// *****</span>
<a name="l01440"></a>01440     <span class="comment">// safe area</span>
<a name="l01441"></a>01441 
<a name="l01442"></a>01442     showSafeAreaAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Show Safe Area&quot;</span>), <span class="keyword">this</span>);
<a name="l01443"></a>01443     showSafeAreaAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Show/Hide the Safe Area around the home location&quot;</span>));
<a name="l01444"></a>01444     showSafeAreaAct-&gt;setCheckable(<span class="keyword">true</span>);
<a name="l01445"></a>01445     showSafeAreaAct-&gt;setChecked(m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga3c39e182c87b25990664fbe7dd0a9eff">Home</a>-&gt;ShowSafeArea());
<a name="l01446"></a>01446     connect(showSafeAreaAct, SIGNAL(toggled(<span class="keywordtype">bool</span>)), <span class="keyword">this</span>, SLOT(onShowSafeAreaAct_toggled(<span class="keywordtype">bool</span>)));
<a name="l01447"></a>01447 
<a name="l01448"></a>01448     safeAreaActGroup = <span class="keyword">new</span> QActionGroup(<span class="keyword">this</span>);
<a name="l01449"></a>01449     connect(safeAreaActGroup, SIGNAL(triggered(QAction *)), <span class="keyword">this</span>, SLOT(onSafeAreaActGroup_triggered(QAction *)));
<a name="l01450"></a>01450     safeAreaAct.clear();
<a name="l01451"></a>01451         list_size = <span class="keyword">sizeof</span>(<a class="code" href="group___o_p_map_plugin.html#ga508cdf04246e0731ce2b58e5d72844d6">safe_area_radius_list</a>) / <span class="keyword">sizeof</span>(<a class="code" href="group___o_p_map_plugin.html#ga508cdf04246e0731ce2b58e5d72844d6">safe_area_radius_list</a>[0]);
<a name="l01452"></a>01452         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; list_size; <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)
<a name="l01453"></a>01453     {
<a name="l01454"></a>01454         <span class="keywordtype">int</span> safeArea = <a class="code" href="group___o_p_map_plugin.html#ga508cdf04246e0731ce2b58e5d72844d6">safe_area_radius_list</a>[<a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>];
<a name="l01455"></a>01455         QAction *safeArea_act = <span class="keyword">new</span> QAction(QString::number(safeArea) + <span class="stringliteral">&quot;m&quot;</span>, safeAreaActGroup);
<a name="l01456"></a>01456         safeArea_act-&gt;setCheckable(<span class="keyword">true</span>);
<a name="l01457"></a>01457         safeArea_act-&gt;setChecked(safeArea == m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga3c39e182c87b25990664fbe7dd0a9eff">Home</a>-&gt;SafeArea());
<a name="l01458"></a>01458         safeArea_act-&gt;setData(safeArea);
<a name="l01459"></a>01459         safeAreaAct.append(safeArea_act);
<a name="l01460"></a>01460     }
<a name="l01461"></a>01461 
<a name="l01462"></a>01462     <span class="comment">// *****</span>
<a name="l01463"></a>01463     <span class="comment">// UAV trail</span>
<a name="l01464"></a>01464 
<a name="l01465"></a>01465     uavTrailTypeActGroup = <span class="keyword">new</span> QActionGroup(<span class="keyword">this</span>);
<a name="l01466"></a>01466     connect(uavTrailTypeActGroup, SIGNAL(triggered(QAction *)), <span class="keyword">this</span>, SLOT(onUAVTrailTypeActGroup_triggered(QAction *)));
<a name="l01467"></a>01467     uavTrailTypeAct.clear();
<a name="l01468"></a>01468     QStringList uav_trail_type_list = <a class="code" href="group___o_p_map_widget.html#gad33e776681a2d3d4d44bef508d231336" title="Returns QStringList with string representing all the enum values.">mapcontrol::Helper::UAVTrailTypes</a>();
<a name="l01469"></a>01469     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; uav_trail_type_list.count(); <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)
<a name="l01470"></a>01470     {
<a name="l01471"></a>01471         mapcontrol::UAVTrailType::Types uav_trail_type = <a class="code" href="group___o_p_map_widget.html#ga09a4876b008985c01beda818f860830b" title="Converts from String to Type.">mapcontrol::Helper::UAVTrailTypeFromString</a>(uav_trail_type_list[<a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>]);
<a name="l01472"></a>01472         QAction *uavTrailType_act = <span class="keyword">new</span> QAction(<a class="code" href="group___o_p_map_widget.html#gab2895e09cf7115779c738cc43d815123" title="Converts from Type to String.">mapcontrol::Helper::StrFromUAVTrailType</a>(uav_trail_type), uavTrailTypeActGroup);
<a name="l01473"></a>01473         uavTrailType_act-&gt;setCheckable(<span class="keyword">true</span>);
<a name="l01474"></a>01474         uavTrailType_act-&gt;setChecked(uav_trail_type == m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;GetTrailType());
<a name="l01475"></a>01475         uavTrailType_act-&gt;setData(<a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>);
<a name="l01476"></a>01476         uavTrailTypeAct.append(uavTrailType_act);
<a name="l01477"></a>01477     }
<a name="l01478"></a>01478 
<a name="l01479"></a>01479     showTrailAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Show Trail dots&quot;</span>), <span class="keyword">this</span>);
<a name="l01480"></a>01480     showTrailAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Show/Hide the Trail dots&quot;</span>));
<a name="l01481"></a>01481     showTrailAct-&gt;setCheckable(<span class="keyword">true</span>);
<a name="l01482"></a>01482     showTrailAct-&gt;setChecked(<span class="keyword">true</span>);
<a name="l01483"></a>01483     connect(showTrailAct, SIGNAL(toggled(<span class="keywordtype">bool</span>)), <span class="keyword">this</span>, SLOT(onShowTrailAct_toggled(<span class="keywordtype">bool</span>)));
<a name="l01484"></a>01484 
<a name="l01485"></a>01485     showTrailLineAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Show Trail lines&quot;</span>), <span class="keyword">this</span>);
<a name="l01486"></a>01486     showTrailLineAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Show/Hide the Trail lines&quot;</span>));
<a name="l01487"></a>01487     showTrailLineAct-&gt;setCheckable(<span class="keyword">true</span>);
<a name="l01488"></a>01488     showTrailLineAct-&gt;setChecked(<span class="keyword">true</span>);
<a name="l01489"></a>01489     connect(showTrailLineAct, SIGNAL(toggled(<span class="keywordtype">bool</span>)), <span class="keyword">this</span>, SLOT(onShowTrailLineAct_toggled(<span class="keywordtype">bool</span>)));
<a name="l01490"></a>01490 
<a name="l01491"></a>01491     clearUAVtrailAct = <span class="keyword">new</span> QAction(tr(<span class="stringliteral">&quot;Clear UAV trail&quot;</span>), <span class="keyword">this</span>);
<a name="l01492"></a>01492     clearUAVtrailAct-&gt;setStatusTip(tr(<span class="stringliteral">&quot;Clear the UAV trail&quot;</span>));
<a name="l01493"></a>01493     connect(clearUAVtrailAct, SIGNAL(triggered()), <span class="keyword">this</span>, SLOT(onClearUAVtrailAct_triggered()));
<a name="l01494"></a>01494 
<a name="l01495"></a>01495     uavTrailTimeActGroup = <span class="keyword">new</span> QActionGroup(<span class="keyword">this</span>);
<a name="l01496"></a>01496     connect(uavTrailTimeActGroup, SIGNAL(triggered(QAction *)), <span class="keyword">this</span>, SLOT(onUAVTrailTimeActGroup_triggered(QAction *)));
<a name="l01497"></a>01497     uavTrailTimeAct.clear();
<a name="l01498"></a>01498         list_size = <span class="keyword">sizeof</span>(<a class="code" href="group___o_p_map_plugin.html#ga42a1c15ba77f6bec7efc5e15cc2d7a6b">uav_trail_time_list</a>) / <span class="keyword">sizeof</span>(<a class="code" href="group___o_p_map_plugin.html#ga42a1c15ba77f6bec7efc5e15cc2d7a6b">uav_trail_time_list</a>[0]);
<a name="l01499"></a>01499         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; list_size; <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)
<a name="l01500"></a>01500     {
<a name="l01501"></a>01501         <span class="keywordtype">int</span> uav_trail_time = <a class="code" href="group___o_p_map_plugin.html#ga42a1c15ba77f6bec7efc5e15cc2d7a6b">uav_trail_time_list</a>[<a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>];
<a name="l01502"></a>01502         QAction *uavTrailTime_act = <span class="keyword">new</span> QAction(QString::number(uav_trail_time) + <span class="stringliteral">&quot; sec&quot;</span>, uavTrailTimeActGroup);
<a name="l01503"></a>01503         uavTrailTime_act-&gt;setCheckable(<span class="keyword">true</span>);
<a name="l01504"></a>01504         uavTrailTime_act-&gt;setChecked(uav_trail_time == m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;TrailTime());
<a name="l01505"></a>01505         uavTrailTime_act-&gt;setData(uav_trail_time);
<a name="l01506"></a>01506         uavTrailTimeAct.append(uavTrailTime_act);
<a name="l01507"></a>01507     }
<a name="l01508"></a>01508 
<a name="l01509"></a>01509     uavTrailDistanceActGroup = <span class="keyword">new</span> QActionGroup(<span class="keyword">this</span>);
<a name="l01510"></a>01510     connect(uavTrailDistanceActGroup, SIGNAL(triggered(QAction *)), <span class="keyword">this</span>, SLOT(onUAVTrailDistanceActGroup_triggered(QAction *)));
<a name="l01511"></a>01511     uavTrailDistanceAct.clear();
<a name="l01512"></a>01512         list_size = <span class="keyword">sizeof</span>(<a class="code" href="group___o_p_map_plugin.html#ga8974b27951316cb97856a384f680d85e">uav_trail_distance_list</a>) / <span class="keyword">sizeof</span>(<a class="code" href="group___o_p_map_plugin.html#ga8974b27951316cb97856a384f680d85e">uav_trail_distance_list</a>[0]);
<a name="l01513"></a>01513         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; list_size; <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)
<a name="l01514"></a>01514     {
<a name="l01515"></a>01515         <span class="keywordtype">int</span> uav_trail_distance = <a class="code" href="group___o_p_map_plugin.html#ga8974b27951316cb97856a384f680d85e">uav_trail_distance_list</a>[<a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>];
<a name="l01516"></a>01516         QAction *uavTrailDistance_act = <span class="keyword">new</span> QAction(QString::number(uav_trail_distance) + <span class="stringliteral">&quot; meters&quot;</span>, uavTrailDistanceActGroup);
<a name="l01517"></a>01517         uavTrailDistance_act-&gt;setCheckable(<span class="keyword">true</span>);
<a name="l01518"></a>01518         uavTrailDistance_act-&gt;setChecked(uav_trail_distance == m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;TrailDistance());
<a name="l01519"></a>01519         uavTrailDistance_act-&gt;setData(uav_trail_distance);
<a name="l01520"></a>01520         uavTrailDistanceAct.append(uavTrailDistance_act);
<a name="l01521"></a>01521     }
<a name="l01522"></a>01522 }
<a name="l01523"></a>01523 
<a name="l01524"></a>01524 <span class="keywordtype">void</span> OPMapGadgetWidget::onReloadAct_triggered()
<a name="l01525"></a>01525 {
<a name="l01526"></a>01526         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01527"></a>01527                 <span class="keywordflow">return</span>;
<a name="l01528"></a>01528 
<a name="l01529"></a>01529     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga5281e4aae5ac664f9d4093735e6ced51">ReloadMap</a>();
<a name="l01530"></a>01530 }
<a name="l01531"></a>01531 
<a name="l01532"></a>01532 <span class="keywordtype">void</span> OPMapGadgetWidget::onRipAct_triggered()
<a name="l01533"></a>01533 {
<a name="l01534"></a>01534     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga3cc1af46a4555caac4d2bcafc775dd3c" title="Ripps the current selection to the DB.">RipMap</a>();
<a name="l01535"></a>01535 }
<a name="l01536"></a>01536 
<a name="l01537"></a>01537 <span class="keywordtype">void</span> OPMapGadgetWidget::onCopyMouseLatLonToClipAct_triggered()
<a name="l01538"></a>01538 {
<a name="l01539"></a>01539     QClipboard *clipboard = QApplication::clipboard();
<a name="l01540"></a>01540         clipboard-&gt;setText(QString::number(m_context_menu_lat_lon.<a class="code" href="group___o_p_map_widget.html#gacf58e663626e5a88876d68937505dc64">Lat</a>(), <span class="charliteral">&#39;f&#39;</span>, 7) + <span class="stringliteral">&quot;, &quot;</span> + QString::number(m_context_menu_lat_lon.<a class="code" href="group___o_p_map_widget.html#ga2a02db7101a66a3c2e5f536e60b38423">Lng</a>(), <span class="charliteral">&#39;f&#39;</span>, 7), QClipboard::Clipboard);
<a name="l01541"></a>01541 }
<a name="l01542"></a>01542 
<a name="l01543"></a>01543 <span class="keywordtype">void</span> OPMapGadgetWidget::onCopyMouseLatToClipAct_triggered()
<a name="l01544"></a>01544 {
<a name="l01545"></a>01545     QClipboard *clipboard = QApplication::clipboard();
<a name="l01546"></a>01546         clipboard-&gt;setText(QString::number(m_context_menu_lat_lon.<a class="code" href="group___o_p_map_widget.html#gacf58e663626e5a88876d68937505dc64">Lat</a>(), <span class="charliteral">&#39;f&#39;</span>, 7), QClipboard::Clipboard);
<a name="l01547"></a>01547 }
<a name="l01548"></a>01548 
<a name="l01549"></a>01549 <span class="keywordtype">void</span> OPMapGadgetWidget::onCopyMouseLonToClipAct_triggered()
<a name="l01550"></a>01550 {
<a name="l01551"></a>01551     QClipboard *clipboard = QApplication::clipboard();
<a name="l01552"></a>01552         clipboard-&gt;setText(QString::number(m_context_menu_lat_lon.<a class="code" href="group___o_p_map_widget.html#ga2a02db7101a66a3c2e5f536e60b38423">Lng</a>(), <span class="charliteral">&#39;f&#39;</span>, 7), QClipboard::Clipboard);
<a name="l01553"></a>01553 }
<a name="l01554"></a>01554 
<a name="l01555"></a>01555 
<a name="l01556"></a>01556 <span class="keywordtype">void</span> OPMapGadgetWidget::onShowCompassAct_toggled(<span class="keywordtype">bool</span> show)
<a name="l01557"></a>01557 {
<a name="l01558"></a>01558         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01559"></a>01559                 <span class="keywordflow">return</span>;
<a name="l01560"></a>01560 
<a name="l01561"></a>01561     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga6f97b86b2d7a7ca6f5b7bb65a70b5a96">SetShowCompass</a>(show);
<a name="l01562"></a>01562 }
<a name="l01563"></a>01563 
<a name="l01564"></a>01564 <span class="keywordtype">void</span> OPMapGadgetWidget::onShowDiagnostics_toggled(<span class="keywordtype">bool</span> show)
<a name="l01565"></a>01565 {
<a name="l01566"></a>01566     <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01567"></a>01567                 <span class="keywordflow">return</span>;
<a name="l01568"></a>01568 
<a name="l01569"></a>01569     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabf19ca6f76133841be5fedfff841073e">SetShowDiagnostics</a>(show);
<a name="l01570"></a>01570 }
<a name="l01571"></a>01571 
<a name="l01572"></a>01572 <span class="keywordtype">void</span> OPMapGadgetWidget::onShowUAVInfo_toggled(<span class="keywordtype">bool</span> show)
<a name="l01573"></a>01573 {
<a name="l01574"></a>01574     <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01575"></a>01575         <span class="keywordflow">return</span>;
<a name="l01576"></a>01576 
<a name="l01577"></a>01577     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;SetShowUAVInfo(show);
<a name="l01578"></a>01578 }
<a name="l01579"></a>01579 
<a name="l01580"></a>01580 <span class="keywordtype">void</span> OPMapGadgetWidget::onShowHomeAct_toggled(<span class="keywordtype">bool</span> show)
<a name="l01581"></a>01581 {
<a name="l01582"></a>01582         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01583"></a>01583                 <span class="keywordflow">return</span>;
<a name="l01584"></a>01584 
<a name="l01585"></a>01585     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga3c39e182c87b25990664fbe7dd0a9eff">Home</a>-&gt;setVisible(show);
<a name="l01586"></a>01586 }
<a name="l01587"></a>01587 
<a name="l01588"></a>01588 <span class="keywordtype">void</span> OPMapGadgetWidget::onShowUAVAct_toggled(<span class="keywordtype">bool</span> show)
<a name="l01589"></a>01589 {
<a name="l01590"></a>01590         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01591"></a>01591                 <span class="keywordflow">return</span>;
<a name="l01592"></a>01592 
<a name="l01593"></a>01593     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;setVisible(show);
<a name="l01594"></a>01594     <span class="keywordflow">if</span>(m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga83798c623babeffb173d483ad1c84ccc">GPS</a>)
<a name="l01595"></a>01595         m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga83798c623babeffb173d483ad1c84ccc">GPS</a>-&gt;setVisible(show);
<a name="l01596"></a>01596 }
<a name="l01597"></a>01597 
<a name="l01598"></a>01598 <span class="keywordtype">void</span> OPMapGadgetWidget::onShowTrailAct_toggled(<span class="keywordtype">bool</span> show)
<a name="l01599"></a>01599 {
<a name="l01600"></a>01600         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01601"></a>01601                 <span class="keywordflow">return</span>;
<a name="l01602"></a>01602 
<a name="l01603"></a>01603     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;SetShowTrail(show);
<a name="l01604"></a>01604     <span class="keywordflow">if</span>(m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga83798c623babeffb173d483ad1c84ccc">GPS</a>)
<a name="l01605"></a>01605         m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga83798c623babeffb173d483ad1c84ccc">GPS</a>-&gt;SetShowTrail(show);
<a name="l01606"></a>01606 }
<a name="l01607"></a>01607 
<a name="l01608"></a>01608 <span class="keywordtype">void</span> OPMapGadgetWidget::onShowTrailLineAct_toggled(<span class="keywordtype">bool</span> show)
<a name="l01609"></a>01609 {
<a name="l01610"></a>01610         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01611"></a>01611                 <span class="keywordflow">return</span>;
<a name="l01612"></a>01612 
<a name="l01613"></a>01613     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;SetShowTrailLine(show);
<a name="l01614"></a>01614     <span class="keywordflow">if</span>(m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga83798c623babeffb173d483ad1c84ccc">GPS</a>)
<a name="l01615"></a>01615         m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga83798c623babeffb173d483ad1c84ccc">GPS</a>-&gt;SetShowTrailLine(show);
<a name="l01616"></a>01616 }
<a name="l01617"></a>01617 
<a name="l01618"></a>01618 <span class="keywordtype">void</span> OPMapGadgetWidget::onMapModeActGroup_triggered(QAction *action)
<a name="l01619"></a>01619 {
<a name="l01620"></a>01620     <span class="keywordflow">if</span> (!m_widget || !m_map || !action)
<a name="l01621"></a>01621         <span class="keywordflow">return</span>;
<a name="l01622"></a>01622 
<a name="l01623"></a>01623     <a class="code" href="group___o_p_map_plugin.html#ga10cb3e7dfbac87e40e00c1a8c76c16e5">opMapModeType</a> mode = (<a class="code" href="group___o_p_map_plugin.html#ga10cb3e7dfbac87e40e00c1a8c76c16e5">opMapModeType</a>)action-&gt;data().toInt();
<a name="l01624"></a>01624 
<a name="l01625"></a>01625     <a class="code" href="group___o_p_map_plugin.html#gafe9c5443c9ed4947f2072bf8feba9673">setMapMode</a>(mode);
<a name="l01626"></a>01626 }
<a name="l01627"></a>01627 
<a name="l01628"></a>01628 <span class="keywordtype">void</span> OPMapGadgetWidget::onGoZoomInAct_triggered()
<a name="l01629"></a>01629 {
<a name="l01630"></a>01630     zoomIn();
<a name="l01631"></a>01631 }
<a name="l01632"></a>01632 
<a name="l01633"></a>01633 <span class="keywordtype">void</span> OPMapGadgetWidget::onGoZoomOutAct_triggered()
<a name="l01634"></a>01634 {
<a name="l01635"></a>01635     zoomOut();
<a name="l01636"></a>01636 }
<a name="l01637"></a>01637 
<a name="l01638"></a>01638 <span class="keywordtype">void</span> OPMapGadgetWidget::onZoomActGroup_triggered(QAction *action)
<a name="l01639"></a>01639 {
<a name="l01640"></a>01640         <span class="keywordflow">if</span> (!m_widget || !m_map || !action)
<a name="l01641"></a>01641                 <span class="keywordflow">return</span>;
<a name="l01642"></a>01642 
<a name="l01643"></a>01643     <a class="code" href="group___o_p_map_plugin.html#gaa2731b7fb965c417860b30ac354437ca">setZoom</a>(action-&gt;data().toInt());
<a name="l01644"></a>01644 }
<a name="l01645"></a>01645 
<a name="l01646"></a>01646 <span class="keywordtype">void</span> OPMapGadgetWidget::onMaxUpdateRateActGroup_triggered(QAction *action)
<a name="l01647"></a>01647 {
<a name="l01648"></a>01648         <span class="keywordflow">if</span> (!m_widget || !m_map || !action)
<a name="l01649"></a>01649                 <span class="keywordflow">return</span>;
<a name="l01650"></a>01650 
<a name="l01651"></a>01651     <a class="code" href="group___o_p_map_plugin.html#ga865f22d42c30a2446539f03df486e64e">setMaxUpdateRate</a>(action-&gt;data().toInt());
<a name="l01652"></a>01652 }
<a name="l01653"></a>01653 
<a name="l01654"></a>01654 <span class="keywordtype">void</span> OPMapGadgetWidget::onChangeDefaultLocalAndZoom()
<a name="l01655"></a>01655 {
<a name="l01656"></a>01656     emit <a class="code" href="group___o_p_map_plugin.html#ga1e2bbe9f774b6c505ba7645a868f1c52">defaultLocationAndZoomChanged</a>(m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga5da99e2dca74bad302e2a35466a5a2fc">CurrentPosition</a>().<a class="code" href="group___o_p_map_widget.html#ga2a02db7101a66a3c2e5f536e60b38423">Lng</a>(),m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga5da99e2dca74bad302e2a35466a5a2fc">CurrentPosition</a>().<a class="code" href="group___o_p_map_widget.html#gacf58e663626e5a88876d68937505dc64">Lat</a>(),m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga2060cbfea71913a458f3a6f0c6dad8c5">ZoomTotal</a>());
<a name="l01657"></a>01657 }
<a name="l01658"></a>01658 
<a name="l01659"></a>01659 <span class="keywordtype">void</span> OPMapGadgetWidget::onGoMouseClickAct_triggered()
<a name="l01660"></a>01660 {
<a name="l01661"></a>01661         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01662"></a>01662                 <span class="keywordflow">return</span>;
<a name="l01663"></a>01663 
<a name="l01664"></a>01664     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga5144489a16c9bd07abbd0d8adc01656d">SetCurrentPosition</a>(m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb9370f367fc42a3987983e79db0828a">currentMousePosition</a>());   <span class="comment">// center the map onto the mouse position</span>
<a name="l01665"></a>01665 }
<a name="l01666"></a>01666 
<a name="l01667"></a>01667 <span class="keywordtype">void</span> OPMapGadgetWidget::onSetHomeAct_triggered()
<a name="l01668"></a>01668 {
<a name="l01669"></a>01669         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01670"></a>01670                 <span class="keywordflow">return</span>;
<a name="l01671"></a>01671 
<a name="l01672"></a>01672     <span class="keywordtype">float</span> altitude=0;
<a name="l01673"></a>01673     <span class="keywordtype">bool</span> ok=<span class="keyword">false</span>;
<a name="l01674"></a>01674 
<a name="l01675"></a>01675     <span class="comment">//Get desired HomeLocation altitude from dialog box.</span>
<a name="l01676"></a>01676     <span class="comment">//TODO: Populate box with altitude already in HomeLocation UAVO</span>
<a name="l01677"></a>01677     altitude = QInputDialog::getDouble(<span class="keyword">this</span>, tr(<span class="stringliteral">&quot;Set home altitude&quot;</span>),
<a name="l01678"></a>01678                                       tr(<span class="stringliteral">&quot;In [m], referenced to WGS84:&quot;</span>), altitude, -100, 100000, 2, &amp;ok);
<a name="l01679"></a>01679 
<a name="l01680"></a>01680     <span class="keywordflow">if</span>(ok){
<a name="l01681"></a>01681         <a class="code" href="group___o_p_map_plugin.html#gaea4b659a9476e351373fc6df96026327" title="public functions">setHome</a>(m_context_menu_lat_lon, altitude);
<a name="l01682"></a>01682     }
<a name="l01683"></a>01683 
<a name="l01684"></a>01684     setHomeLocationObject();  <span class="comment">// update the HomeLocation UAVObject</span>
<a name="l01685"></a>01685 
<a name="l01686"></a>01686 }
<a name="l01687"></a>01687 
<a name="l01688"></a>01688 <span class="keywordtype">void</span> OPMapGadgetWidget::onGoHomeAct_triggered()
<a name="l01689"></a>01689 {
<a name="l01690"></a>01690         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01691"></a>01691                 <span class="keywordflow">return</span>;
<a name="l01692"></a>01692 
<a name="l01693"></a>01693     <a class="code" href="group___o_p_map_plugin.html#gab81157189920148cb4178548aeef4b92">goHome</a>();
<a name="l01694"></a>01694 }
<a name="l01695"></a>01695 
<a name="l01696"></a>01696 <span class="keywordtype">void</span> OPMapGadgetWidget::onGoUAVAct_triggered()
<a name="l01697"></a>01697 {
<a name="l01698"></a>01698         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01699"></a>01699                 <span class="keywordflow">return</span>;
<a name="l01700"></a>01700 
<a name="l01701"></a>01701     <span class="keywordtype">double</span> latitude;
<a name="l01702"></a>01702     <span class="keywordtype">double</span> longitude;
<a name="l01703"></a>01703     <span class="keywordtype">double</span> altitude;
<a name="l01704"></a>01704         <span class="keywordflow">if</span> (getUAVPosition(latitude, longitude, altitude))  <span class="comment">// get current UAV position</span>
<a name="l01705"></a>01705     {
<a name="l01706"></a>01706         <a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a> uav_pos = <a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a>(latitude, longitude);   <span class="comment">// current UAV position</span>
<a name="l01707"></a>01707         <a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a> map_pos = m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga5da99e2dca74bad302e2a35466a5a2fc">CurrentPosition</a>();                      <span class="comment">// current MAP position</span>
<a name="l01708"></a>01708         <span class="keywordflow">if</span> (map_pos != uav_pos) m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga5144489a16c9bd07abbd0d8adc01656d">SetCurrentPosition</a>(uav_pos);                     <span class="comment">// center the map onto the UAV</span>
<a name="l01709"></a>01709     }
<a name="l01710"></a>01710 }
<a name="l01711"></a>01711 
<a name="l01712"></a>01712 <span class="keywordtype">void</span> OPMapGadgetWidget::onFollowUAVpositionAct_toggled(<span class="keywordtype">bool</span> checked)
<a name="l01713"></a>01713 {
<a name="l01714"></a>01714         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01715"></a>01715                 <span class="keywordflow">return</span>;
<a name="l01716"></a>01716 
<a name="l01717"></a>01717     <span class="keywordflow">if</span> (m_widget-&gt;toolButtonMapUAV-&gt;isChecked() != checked)
<a name="l01718"></a>01718         m_widget-&gt;toolButtonMapUAV-&gt;setChecked(checked);
<a name="l01719"></a>01719 
<a name="l01720"></a>01720     setMapFollowingMode();
<a name="l01721"></a>01721 }
<a name="l01722"></a>01722 
<a name="l01723"></a>01723 <span class="keywordtype">void</span> OPMapGadgetWidget::onFollowUAVheadingAct_toggled(<span class="keywordtype">bool</span> checked)
<a name="l01724"></a>01724 {
<a name="l01725"></a>01725         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01726"></a>01726                 <span class="keywordflow">return</span>;
<a name="l01727"></a>01727 
<a name="l01728"></a>01728     <span class="keywordflow">if</span> (m_widget-&gt;toolButtonMapUAVheading-&gt;isChecked() != checked)
<a name="l01729"></a>01729         m_widget-&gt;toolButtonMapUAVheading-&gt;setChecked(checked);
<a name="l01730"></a>01730 
<a name="l01731"></a>01731     setMapFollowingMode();
<a name="l01732"></a>01732 }
<a name="l01733"></a>01733 
<a name="l01734"></a>01734 <span class="keywordtype">void</span> OPMapGadgetWidget::onUAVTrailTypeActGroup_triggered(QAction *action)
<a name="l01735"></a>01735 {
<a name="l01736"></a>01736         <span class="keywordflow">if</span> (!m_widget || !m_map || !action)
<a name="l01737"></a>01737                 <span class="keywordflow">return</span>;
<a name="l01738"></a>01738 
<a name="l01739"></a>01739     <span class="keywordtype">int</span> trail_type_idx = action-&gt;data().toInt();
<a name="l01740"></a>01740 
<a name="l01741"></a>01741     QStringList uav_trail_type_list = <a class="code" href="group___o_p_map_widget.html#gad33e776681a2d3d4d44bef508d231336" title="Returns QStringList with string representing all the enum values.">mapcontrol::Helper::UAVTrailTypes</a>();
<a name="l01742"></a>01742     mapcontrol::UAVTrailType::Types uav_trail_type = <a class="code" href="group___o_p_map_widget.html#ga09a4876b008985c01beda818f860830b" title="Converts from String to Type.">mapcontrol::Helper::UAVTrailTypeFromString</a>(uav_trail_type_list[trail_type_idx]);
<a name="l01743"></a>01743 
<a name="l01744"></a>01744     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;SetTrailType(uav_trail_type);
<a name="l01745"></a>01745 }
<a name="l01746"></a>01746 
<a name="l01747"></a>01747 <span class="keywordtype">void</span> OPMapGadgetWidget::onClearUAVtrailAct_triggered()
<a name="l01748"></a>01748 {
<a name="l01749"></a>01749         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01750"></a>01750                 <span class="keywordflow">return</span>;
<a name="l01751"></a>01751 
<a name="l01752"></a>01752     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;DeleteTrail();
<a name="l01753"></a>01753     <span class="keywordflow">if</span>(m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga83798c623babeffb173d483ad1c84ccc">GPS</a>)
<a name="l01754"></a>01754         m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga83798c623babeffb173d483ad1c84ccc">GPS</a>-&gt;DeleteTrail();
<a name="l01755"></a>01755 }
<a name="l01756"></a>01756 
<a name="l01757"></a>01757 <span class="keywordtype">void</span> OPMapGadgetWidget::onUAVTrailTimeActGroup_triggered(QAction *action)
<a name="l01758"></a>01758 {
<a name="l01759"></a>01759         <span class="keywordflow">if</span> (!m_widget || !m_map || !action)
<a name="l01760"></a>01760                 <span class="keywordflow">return</span>;
<a name="l01761"></a>01761 
<a name="l01762"></a>01762     <span class="keywordtype">int</span> trail_time = (double)action-&gt;data().toInt();
<a name="l01763"></a>01763 
<a name="l01764"></a>01764     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;SetTrailTime(trail_time);
<a name="l01765"></a>01765 }
<a name="l01766"></a>01766 
<a name="l01767"></a>01767 <span class="keywordtype">void</span> OPMapGadgetWidget::onUAVTrailDistanceActGroup_triggered(QAction *action)
<a name="l01768"></a>01768 {
<a name="l01769"></a>01769         <span class="keywordflow">if</span> (!m_widget || !m_map || !action)
<a name="l01770"></a>01770                 <span class="keywordflow">return</span>;
<a name="l01771"></a>01771 
<a name="l01772"></a>01772     <span class="keywordtype">int</span> trail_distance = action-&gt;data().toInt();
<a name="l01773"></a>01773 
<a name="l01774"></a>01774     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;SetTrailDistance(trail_distance);
<a name="l01775"></a>01775 }
<a name="l01776"></a>01776 
<a name="l01781"></a>01781 <span class="keywordtype">void</span> OPMapGadgetWidget::onOpenWayPointEditorAct_triggered()
<a name="l01782"></a>01782 {
<a name="l01783"></a>01783     <span class="comment">//create dialog</span>
<a name="l01784"></a>01784     pathPlannerDialog = <span class="keyword">new</span> QDialog(<span class="keyword">this</span>);
<a name="l01785"></a>01785     pathPlannerDialog-&gt;setModal(<span class="keyword">true</span>);
<a name="l01786"></a>01786     pathPlannerDialog-&gt;show();
<a name="l01787"></a>01787 
<a name="l01788"></a>01788     <span class="comment">//create layout dialog</span>
<a name="l01789"></a>01789     QHBoxLayout *dialogLayout = <span class="keyword">new</span> QHBoxLayout(pathPlannerDialog);
<a name="l01790"></a>01790     pathPlannerDialog-&gt;setLayout(dialogLayout);
<a name="l01791"></a>01791     <span class="comment">//create elements of dialog</span>
<a name="l01792"></a>01792     QPointer&lt;PathPlannerGadgetWidget&gt; widget = <span class="keyword">new</span> <a class="code" href="class_path_planner_gadget_widget.html">PathPlannerGadgetWidget</a>(pathPlannerDialog);
<a name="l01793"></a>01793     dialogLayout-&gt;addWidget(widget);
<a name="l01794"></a>01794 }
<a name="l01795"></a>01795 
<a name="l01796"></a>01796 <span class="keywordtype">void</span> OPMapGadgetWidget::onAddWayPointAct_triggeredFromContextMenu()
<a name="l01797"></a>01797 {
<a name="l01798"></a>01798     onAddWayPointAct_triggered(m_context_menu_lat_lon);
<a name="l01799"></a>01799 }
<a name="l01800"></a>01800 <span class="keywordtype">void</span> OPMapGadgetWidget::onAddWayPointAct_triggeredFromThis()
<a name="l01801"></a>01801 {
<a name="l01802"></a>01802     onAddWayPointAct_triggered(lastLatLngMouse);
<a name="l01803"></a>01803 }
<a name="l01804"></a>01804 
<a name="l01805"></a>01805 <span class="keywordtype">void</span> OPMapGadgetWidget::onAddWayPointAct_triggered(<a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a> coord)
<a name="l01806"></a>01806 {
<a name="l01807"></a>01807         <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01808"></a>01808                 <span class="keywordflow">return</span>;
<a name="l01809"></a>01809 
<a name="l01810"></a>01810     <span class="keywordflow">if</span> (m_map_mode != Normal_MapMode)
<a name="l01811"></a>01811         <span class="keywordflow">return</span>;
<a name="l01812"></a>01812 
<a name="l01813"></a>01813     mapProxy-&gt;createWayPoint(coord);
<a name="l01814"></a>01814 }
<a name="l01815"></a>01815 
<a name="l01816"></a>01816 
<a name="l01822"></a>01822 <span class="keywordtype">void</span> OPMapGadgetWidget::onEditWayPointAct_triggered()
<a name="l01823"></a>01823 {
<a name="l01824"></a>01824     <a class="code" href="class_waypoint_dialog.html" title="The WaypointDialog class creates a dialog for editing the properties of a single waypoint.">WaypointDialog</a> *dialog =  pm-&gt;getObject&lt;<a class="code" href="class_waypoint_dialog.html" title="The WaypointDialog class creates a dialog for editing the properties of a single waypoint.">WaypointDialog</a>&gt;();
<a name="l01825"></a>01825     Q_ASSERT(dialog);
<a name="l01826"></a>01826     <span class="keywordflow">if</span> (dialog != NULL)
<a name="l01827"></a>01827         dialog-&gt;show();
<a name="l01828"></a>01828 }
<a name="l01829"></a>01829 
<a name="l01830"></a>01830 
<a name="l01835"></a>01835 <span class="keywordtype">void</span> OPMapGadgetWidget::onLockWayPointAct_triggered()
<a name="l01836"></a>01836 {
<a name="l01837"></a>01837     <span class="keywordflow">if</span> (!m_widget || !m_map || !m_mouse_waypoint)
<a name="l01838"></a>01838         <span class="keywordflow">return</span>;
<a name="l01839"></a>01839 
<a name="l01840"></a>01840     <span class="keywordflow">if</span> (m_map_mode != Normal_MapMode)
<a name="l01841"></a>01841         <span class="keywordflow">return</span>;
<a name="l01842"></a>01842 
<a name="l01843"></a>01843     <span class="keywordtype">bool</span> locked = (m_mouse_waypoint-&gt;flags() &amp; QGraphicsItem::ItemIsMovable) == 0;
<a name="l01844"></a>01844     m_mouse_waypoint-&gt;setFlag(QGraphicsItem::ItemIsMovable, locked);
<a name="l01845"></a>01845 
<a name="l01846"></a>01846     <span class="keywordflow">if</span> (!locked)
<a name="l01847"></a>01847         m_mouse_waypoint-&gt;picture.load(QString::fromUtf8(<span class="stringliteral">&quot;:/opmap/images/waypoint_marker2.png&quot;</span>));
<a name="l01848"></a>01848     <span class="keywordflow">else</span>
<a name="l01849"></a>01849         m_mouse_waypoint-&gt;picture.load(QString::fromUtf8(<span class="stringliteral">&quot;:/opmap/images/waypoint_marker1.png&quot;</span>));
<a name="l01850"></a>01850     m_mouse_waypoint-&gt;update();
<a name="l01851"></a>01851 
<a name="l01852"></a>01852     m_mouse_waypoint = NULL;
<a name="l01853"></a>01853 }
<a name="l01854"></a>01854 
<a name="l01855"></a>01855 <span class="keywordtype">void</span> OPMapGadgetWidget::onDeleteWayPointAct_triggered()
<a name="l01856"></a>01856 {
<a name="l01857"></a>01857     <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01858"></a>01858         <span class="keywordflow">return</span>;
<a name="l01859"></a>01859 
<a name="l01860"></a>01860     <span class="keywordflow">if</span> (m_map_mode != Normal_MapMode)
<a name="l01861"></a>01861         <span class="keywordflow">return</span>;
<a name="l01862"></a>01862 
<a name="l01863"></a>01863     <span class="keywordflow">if</span> (!m_mouse_waypoint)
<a name="l01864"></a>01864         <span class="keywordflow">return</span>;
<a name="l01865"></a>01865 
<a name="l01866"></a>01866     mapProxy-&gt;deleteWayPoint(m_mouse_waypoint-&gt;Number());
<a name="l01867"></a>01867 }
<a name="l01868"></a>01868 
<a name="l01869"></a>01869 <span class="keywordtype">void</span> OPMapGadgetWidget::onClearWayPointsAct_triggered()
<a name="l01870"></a>01870 {
<a name="l01871"></a>01871 
<a name="l01872"></a>01872     <span class="comment">//First, ask to ensure this is what the user wants to do</span>
<a name="l01873"></a>01873     QMessageBox msgBox;
<a name="l01874"></a>01874     msgBox.setText(tr(<span class="stringliteral">&quot;Are you sure you want to clear waypoints?&quot;</span>));
<a name="l01875"></a>01875     msgBox.setInformativeText(tr(<span class="stringliteral">&quot;All associated data will be lost.&quot;</span>));
<a name="l01876"></a>01876     msgBox.setStandardButtons(QMessageBox::Yes | QMessageBox::No);
<a name="l01877"></a>01877     <span class="keywordtype">int</span> <a class="code" href="group___i_p_conn_plugin.html#gabc99fe6afec1a75ccff1092e47375a40">ret</a> = msgBox.exec();
<a name="l01878"></a>01878 
<a name="l01879"></a>01879     <span class="keywordflow">if</span> (ret == QMessageBox::No)
<a name="l01880"></a>01880     {
<a name="l01881"></a>01881         <span class="keywordflow">return</span>;
<a name="l01882"></a>01882     }
<a name="l01883"></a>01883 
<a name="l01884"></a>01884     <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01885"></a>01885         <span class="keywordflow">return</span>;
<a name="l01886"></a>01886 
<a name="l01887"></a>01887     <span class="keywordflow">if</span> (m_map_mode != Normal_MapMode)
<a name="l01888"></a>01888         <span class="keywordflow">return</span>;
<a name="l01889"></a>01889 
<a name="l01890"></a>01890     mapProxy-&gt;deleteAll();
<a name="l01891"></a>01891 
<a name="l01892"></a>01892  }
<a name="l01893"></a>01893 
<a name="l01894"></a>01894 
<a name="l01895"></a>01895 <span class="keywordtype">void</span> OPMapGadgetWidget::onHomeMagicWaypointAct_triggered()
<a name="l01896"></a>01896 {
<a name="l01897"></a>01897     <span class="comment">// center the magic waypoint on the home position</span>
<a name="l01898"></a>01898     homeMagicWaypoint();
<a name="l01899"></a>01899 }
<a name="l01900"></a>01900 
<a name="l01901"></a>01901 <span class="keywordtype">void</span> OPMapGadgetWidget::onShowSafeAreaAct_toggled(<span class="keywordtype">bool</span> show)
<a name="l01902"></a>01902 {
<a name="l01903"></a>01903     <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01904"></a>01904         <span class="keywordflow">return</span>;
<a name="l01905"></a>01905 
<a name="l01906"></a>01906     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga3c39e182c87b25990664fbe7dd0a9eff">Home</a>-&gt;SetShowSafeArea(show);             <span class="comment">// show the safe area</span>
<a name="l01907"></a>01907     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga3c39e182c87b25990664fbe7dd0a9eff">Home</a>-&gt;SetToggleRefresh(<span class="keyword">true</span>);
<a name="l01908"></a>01908     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga3c39e182c87b25990664fbe7dd0a9eff">Home</a>-&gt;<a class="code" href="group___o_p_map_widget.html#ga1c60e950a733d8e38796cfe092fb4154">RefreshPos</a>();
<a name="l01909"></a>01909 }
<a name="l01910"></a>01910 
<a name="l01911"></a>01911 <span class="keywordtype">void</span> OPMapGadgetWidget::onSafeAreaActGroup_triggered(QAction *action)
<a name="l01912"></a>01912 {
<a name="l01913"></a>01913         <span class="keywordflow">if</span> (!m_widget || !m_map || !action)
<a name="l01914"></a>01914         <span class="keywordflow">return</span>;
<a name="l01915"></a>01915 
<a name="l01916"></a>01916     <span class="keywordtype">int</span> radius = action-&gt;data().toInt();
<a name="l01917"></a>01917 
<a name="l01918"></a>01918     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga3c39e182c87b25990664fbe7dd0a9eff">Home</a>-&gt;SetSafeArea(radius);               <span class="comment">// set the radius (meters)</span>
<a name="l01919"></a>01919     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga3c39e182c87b25990664fbe7dd0a9eff">Home</a>-&gt;<a class="code" href="group___o_p_map_widget.html#ga1c60e950a733d8e38796cfe092fb4154">RefreshPos</a>();
<a name="l01920"></a>01920 
<a name="l01921"></a>01921     <span class="comment">// move the magic waypoint if need be to keep it within the safe area around the home position</span>
<a name="l01922"></a>01922     keepMagicWaypointWithInSafeArea();
<a name="l01923"></a>01923 }
<a name="l01924"></a>01924 
<a name="l01928"></a>01928 <span class="keywordtype">void</span> OPMapGadgetWidget::homeMagicWaypoint()
<a name="l01929"></a>01929 {
<a name="l01930"></a>01930     <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01931"></a>01931         <span class="keywordflow">return</span>;
<a name="l01932"></a>01932 
<a name="l01933"></a>01933     <span class="keywordflow">if</span> (m_map_mode != MagicWaypoint_MapMode)
<a name="l01934"></a>01934         <span class="keywordflow">return</span>;
<a name="l01935"></a>01935 
<a name="l01936"></a>01936     magicWayPoint-&gt;SetCoord(m_home_position.<a class="code" href="group___o_p_map_plugin.html#ga6324b0912396582281b54bc6d5a6f38a">coord</a>);
<a name="l01937"></a>01937 }
<a name="l01938"></a>01938 
<a name="l01939"></a>01939 <span class="comment">// *************************************************************************************</span>
<a name="l01940"></a>01940 <span class="comment">// move the UAV to the magic waypoint position</span>
<a name="l01941"></a>01941 
<a name="l01942"></a>01942 <span class="keywordtype">void</span> OPMapGadgetWidget::moveToMagicWaypointPosition()
<a name="l01943"></a>01943 {
<a name="l01944"></a>01944     <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l01945"></a>01945         <span class="keywordflow">return</span>;
<a name="l01946"></a>01946 
<a name="l01947"></a>01947     <span class="keywordflow">if</span> (m_map_mode != MagicWaypoint_MapMode)
<a name="l01948"></a>01948         <span class="keywordflow">return</span>;
<a name="l01949"></a>01949 }
<a name="l01950"></a>01950 
<a name="l01951"></a>01951 <span class="comment">// *************************************************************************************</span>
<a name="l01952"></a>01952 <span class="comment">// show/hide the magic waypoint controls</span>
<a name="l01953"></a>01953 
<a name="l01954"></a>01954 <span class="keywordtype">void</span> OPMapGadgetWidget::hideMagicWaypointControls()
<a name="l01955"></a>01955 {
<a name="l01956"></a>01956     m_widget-&gt;lineWaypoint-&gt;setVisible(<span class="keyword">false</span>);
<a name="l01957"></a>01957     m_widget-&gt;toolButtonHomeWaypoint-&gt;setVisible(<span class="keyword">false</span>);
<a name="l01958"></a>01958     m_widget-&gt;toolButtonMoveToWP-&gt;setVisible(<span class="keyword">false</span>);
<a name="l01959"></a>01959 }
<a name="l01960"></a>01960 
<a name="l01961"></a>01961 <span class="keywordtype">void</span> OPMapGadgetWidget::showMagicWaypointControls()
<a name="l01962"></a>01962 {
<a name="l01963"></a>01963     m_widget-&gt;lineWaypoint-&gt;setVisible(<span class="keyword">true</span>);
<a name="l01964"></a>01964     m_widget-&gt;toolButtonHomeWaypoint-&gt;setVisible(<span class="keyword">true</span>);
<a name="l01965"></a>01965 
<a name="l01966"></a>01966 <span class="preprocessor">    #if defined(allow_manual_home_location_move)</span>
<a name="l01967"></a>01967 <span class="preprocessor"></span>        m_widget-&gt;toolButtonMoveToWP-&gt;setVisible(<span class="keyword">true</span>);
<a name="l01968"></a>01968 <span class="preprocessor">    #else</span>
<a name="l01969"></a>01969 <span class="preprocessor"></span>        m_widget-&gt;toolButtonMoveToWP-&gt;setVisible(<span class="keyword">false</span>);
<a name="l01970"></a>01970 <span class="preprocessor">    #endif</span>
<a name="l01971"></a>01971 <span class="preprocessor"></span>}
<a name="l01972"></a>01972 
<a name="l01973"></a>01973 <span class="comment">// *************************************************************************************</span>
<a name="l01974"></a>01974 <span class="comment">// move the magic waypoint to keep it within the safe area boundry</span>
<a name="l01975"></a>01975 
<a name="l01976"></a>01976 <span class="keywordtype">void</span> OPMapGadgetWidget::keepMagicWaypointWithInSafeArea()
<a name="l01977"></a>01977 {
<a name="l01978"></a>01978 
<a name="l01979"></a>01979     <span class="comment">// calcute the bearing and distance from the home position to the magic waypoint</span>
<a name="l01980"></a>01980     <span class="keywordtype">double</span> dist = distance(m_home_position.<a class="code" href="group___o_p_map_plugin.html#ga6324b0912396582281b54bc6d5a6f38a">coord</a>, magicWayPoint-&gt;Coord());
<a name="l01981"></a>01981     <span class="keywordtype">double</span> bear = bearing(m_home_position.<a class="code" href="group___o_p_map_plugin.html#ga6324b0912396582281b54bc6d5a6f38a">coord</a>, magicWayPoint-&gt;Coord());
<a name="l01982"></a>01982 
<a name="l01983"></a>01983     <span class="comment">// get the maximum safe distance - in kilometers</span>
<a name="l01984"></a>01984     <span class="keywordtype">double</span> boundry_dist = (double)m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga3c39e182c87b25990664fbe7dd0a9eff">Home</a>-&gt;SafeArea() / 1000;
<a name="l01985"></a>01985 
<a name="l01986"></a>01986     <span class="keywordflow">if</span> (dist &gt; boundry_dist) dist = boundry_dist;
<a name="l01987"></a>01987 
<a name="l01988"></a>01988     <span class="comment">// move the magic waypoint;</span>
<a name="l01989"></a>01989 
<a name="l01990"></a>01990     <span class="keywordflow">if</span> (m_map_mode == MagicWaypoint_MapMode)
<a name="l01991"></a>01991     {   <span class="comment">// move the on-screen waypoint</span>
<a name="l01992"></a>01992         <span class="keywordflow">if</span> (magicWayPoint)
<a name="l01993"></a>01993             magicWayPoint-&gt;SetCoord(destPoint(m_home_position.<a class="code" href="group___o_p_map_plugin.html#ga6324b0912396582281b54bc6d5a6f38a">coord</a>, bear, dist));
<a name="l01994"></a>01994     }
<a name="l01995"></a>01995 }
<a name="l01996"></a>01996 
<a name="l01997"></a>01997 <span class="comment">// *************************************************************************************</span>
<a name="l01998"></a>01998 <span class="comment">// return the distance between two points .. in kilometers</span>
<a name="l01999"></a>01999 
<a name="l02000"></a>02000 <span class="keywordtype">double</span> OPMapGadgetWidget::distance(<a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a> from, <a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a> to)
<a name="l02001"></a>02001 {
<a name="l02002"></a>02002     <span class="keywordtype">double</span> lat1 = from.<a class="code" href="group___o_p_map_widget.html#gacf58e663626e5a88876d68937505dc64">Lat</a>() * deg_to_rad;
<a name="l02003"></a>02003     <span class="keywordtype">double</span> lon1 = from.<a class="code" href="group___o_p_map_widget.html#ga2a02db7101a66a3c2e5f536e60b38423">Lng</a>() * deg_to_rad;
<a name="l02004"></a>02004 
<a name="l02005"></a>02005     <span class="keywordtype">double</span> lat2 = to.<a class="code" href="group___o_p_map_widget.html#gacf58e663626e5a88876d68937505dc64">Lat</a>() * deg_to_rad;
<a name="l02006"></a>02006     <span class="keywordtype">double</span> lon2 = to.<a class="code" href="group___o_p_map_widget.html#ga2a02db7101a66a3c2e5f536e60b38423">Lng</a>() * deg_to_rad;
<a name="l02007"></a>02007 
<a name="l02008"></a>02008     <span class="keywordflow">return</span> (acos(sin(lat1) * sin(lat2) + cos(lat1) * cos(lat2) * cos(lon2 - lon1)) * earth_mean_radius);
<a name="l02009"></a>02009 
<a name="l02010"></a>02010     <span class="comment">// ***********************</span>
<a name="l02011"></a>02011 }
<a name="l02012"></a>02012 
<a name="l02013"></a>02013 <span class="comment">// *************************************************************************************</span>
<a name="l02014"></a>02014 <span class="comment">// return the bearing from one point to another .. in degrees</span>
<a name="l02015"></a>02015 
<a name="l02016"></a>02016 <span class="keywordtype">double</span> OPMapGadgetWidget::bearing(<a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a> from, <a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a> to)
<a name="l02017"></a>02017 {
<a name="l02018"></a>02018     <span class="keywordtype">double</span> lat1 = from.<a class="code" href="group___o_p_map_widget.html#gacf58e663626e5a88876d68937505dc64">Lat</a>() * deg_to_rad;
<a name="l02019"></a>02019     <span class="keywordtype">double</span> lon1 = from.<a class="code" href="group___o_p_map_widget.html#ga2a02db7101a66a3c2e5f536e60b38423">Lng</a>() * deg_to_rad;
<a name="l02020"></a>02020 
<a name="l02021"></a>02021     <span class="keywordtype">double</span> lat2 = to.<a class="code" href="group___o_p_map_widget.html#gacf58e663626e5a88876d68937505dc64">Lat</a>() * deg_to_rad;
<a name="l02022"></a>02022     <span class="keywordtype">double</span> lon2 = to.<a class="code" href="group___o_p_map_widget.html#ga2a02db7101a66a3c2e5f536e60b38423">Lng</a>() * deg_to_rad;
<a name="l02023"></a>02023 
<a name="l02024"></a>02024 <span class="comment">//    double delta_lat = lat2 - lat1;</span>
<a name="l02025"></a>02025     <span class="keywordtype">double</span> delta_lon = lon2 - lon1;
<a name="l02026"></a>02026 
<a name="l02027"></a>02027     <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#a2fb1c5cf58867b5bbc9a1b145a86f3a0">y</a> = sin(delta_lon) * cos(lat2);
<a name="l02028"></a>02028     <span class="keywordtype">double</span> <a class="code" href="_o_p_plots_8m.html#a9336ebf25087d91c818ee6e9ec29f8c1">x</a> = cos(lat1) * sin(lat2) - sin(lat1) * cos(lat2) * cos(delta_lon);
<a name="l02029"></a>02029     <span class="keywordtype">double</span> bear = atan2(y, x) * rad_to_deg;
<a name="l02030"></a>02030 
<a name="l02031"></a>02031     bear += 360;
<a name="l02032"></a>02032     <span class="keywordflow">while</span> (bear &lt; 0) bear += 360;
<a name="l02033"></a>02033     <span class="keywordflow">while</span> (bear &gt;= 360) bear -= 360;
<a name="l02034"></a>02034 
<a name="l02035"></a>02035     <span class="keywordflow">return</span> bear;
<a name="l02036"></a>02036 }
<a name="l02037"></a>02037 
<a name="l02038"></a>02038 <span class="comment">// *************************************************************************************</span>
<a name="l02039"></a>02039 <span class="comment">// return a destination lat/lon point given a source lat/lon point and the bearing and distance from the source point</span>
<a name="l02040"></a>02040 
<a name="l02041"></a>02041 <a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a> OPMapGadgetWidget::destPoint(<a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a> source, <span class="keywordtype">double</span> bear, <span class="keywordtype">double</span> dist)
<a name="l02042"></a>02042 {
<a name="l02043"></a>02043     <span class="keywordtype">double</span> lat1 = source.<a class="code" href="group___o_p_map_widget.html#gacf58e663626e5a88876d68937505dc64">Lat</a>() * deg_to_rad;
<a name="l02044"></a>02044     <span class="keywordtype">double</span> lon1 = source.<a class="code" href="group___o_p_map_widget.html#ga2a02db7101a66a3c2e5f536e60b38423">Lng</a>() * deg_to_rad;
<a name="l02045"></a>02045 
<a name="l02046"></a>02046     bear *= deg_to_rad;
<a name="l02047"></a>02047 
<a name="l02048"></a>02048     <span class="keywordtype">double</span> ad = dist / earth_mean_radius;
<a name="l02049"></a>02049 
<a name="l02050"></a>02050     <span class="keywordtype">double</span> lat2 = asin(sin(lat1) * cos(ad) + cos(lat1) * sin(ad) * cos(bear));
<a name="l02051"></a>02051     <span class="keywordtype">double</span> lon2 = lon1 + atan2(sin(bear) * sin(ad) * cos(lat1), cos(ad) - sin(lat1) * sin(lat2));
<a name="l02052"></a>02052 
<a name="l02053"></a>02053     <span class="keywordflow">return</span> <a class="code" href="structinternals_1_1_point_lat_lng.html">internals::PointLatLng</a>(lat2 * rad_to_deg, lon2 * rad_to_deg);
<a name="l02054"></a>02054 }
<a name="l02055"></a>02055 
<a name="l02056"></a>02056 <span class="comment">// *************************************************************************************</span>
<a name="l02057"></a>02057 
<a name="l02058"></a>02058 <span class="keywordtype">bool</span> OPMapGadgetWidget::getUAVPosition(<span class="keywordtype">double</span> &amp;latitude, <span class="keywordtype">double</span> &amp;longitude, <span class="keywordtype">double</span> &amp;altitude)
<a name="l02059"></a>02059 {
<a name="l02060"></a>02060     <span class="keywordtype">double</span> NED[3];
<a name="l02061"></a>02061     <span class="keywordtype">double</span> LLA[3];
<a name="l02062"></a>02062     <span class="keywordtype">double</span> homeLLA[3];
<a name="l02063"></a>02063 
<a name="l02064"></a>02064     Q_ASSERT(obm != NULL);
<a name="l02065"></a>02065 
<a name="l02066"></a>02066     HomeLocation *homeLocation = HomeLocation::GetInstance(obm);
<a name="l02067"></a>02067     Q_ASSERT(homeLocation != NULL);
<a name="l02068"></a>02068     HomeLocation::DataFields homeLocationData = homeLocation-&gt;getData();
<a name="l02069"></a>02069 
<a name="l02070"></a>02070     homeLLA[0] = homeLocationData.Latitude / 1e7;
<a name="l02071"></a>02071     homeLLA[1] = homeLocationData.Longitude / 1e7;
<a name="l02072"></a>02072     homeLLA[2] = homeLocationData.Altitude;
<a name="l02073"></a>02073 
<a name="l02074"></a>02074     PositionActual *positionActual = PositionActual::GetInstance(obm);
<a name="l02075"></a>02075     Q_ASSERT(positionActual != NULL);
<a name="l02076"></a>02076     PositionActual::DataFields positionActualData = positionActual-&gt;getData();
<a name="l02077"></a>02077 
<a name="l02078"></a>02078     NED[0] = positionActualData.North;
<a name="l02079"></a>02079     NED[1] = positionActualData.East;
<a name="l02080"></a>02080     NED[2] = positionActualData.Down;
<a name="l02081"></a>02081 
<a name="l02082"></a>02082     <a class="code" href="class_utils_1_1_coordinate_conversions.html">Utils::CoordinateConversions</a>().<a class="code" href="class_utils_1_1_coordinate_conversions.html#aa8dc93690408a9522db08f0a13ec12e1">NED2LLA_HomeLLA</a>(homeLLA, NED, LLA);
<a name="l02083"></a>02083 
<a name="l02084"></a>02084     latitude = LLA[0];
<a name="l02085"></a>02085     longitude = LLA[1];
<a name="l02086"></a>02086     altitude = LLA[2];
<a name="l02087"></a>02087 
<a name="l02088"></a>02088     <span class="keywordflow">if</span> (latitude != latitude) latitude = 0; <span class="comment">// nan detection</span>
<a name="l02089"></a>02089     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (latitude &gt;  90) latitude =  90;
<a name="l02090"></a>02090     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (latitude &lt; -90) latitude = -90;
<a name="l02091"></a>02091 
<a name="l02092"></a>02092     <span class="keywordflow">if</span> (longitude != longitude) longitude = 0; <span class="comment">// nan detection</span>
<a name="l02093"></a>02093     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (longitude &gt;  180) longitude =  180;
<a name="l02094"></a>02094     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (longitude &lt; -180) longitude = -180;
<a name="l02095"></a>02095 
<a name="l02096"></a>02096     <span class="keywordflow">if</span> (altitude != altitude) altitude = 0; <span class="comment">// nan detection</span>
<a name="l02097"></a>02097 
<a name="l02098"></a>02098     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02099"></a>02099 }
<a name="l02100"></a>02100 
<a name="l02101"></a>02101 <span class="keywordtype">double</span> OPMapGadgetWidget::getUAV_Yaw()
<a name="l02102"></a>02102 {
<a name="l02103"></a>02103         <span class="keywordflow">if</span> (!obm)
<a name="l02104"></a>02104                 <span class="keywordflow">return</span> 0;
<a name="l02105"></a>02105 
<a name="l02106"></a>02106         <a class="code" href="class_u_a_v_object.html">UAVObject</a> *obj = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_u_a_v_data_object.html">UAVDataObject</a>*<span class="keyword">&gt;</span>(obm-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gada44cdbfa55a281b78d41abcc6834dc0">getObject</a>(<a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a>(<span class="stringliteral">&quot;AttitudeActual&quot;</span>)));
<a name="l02107"></a>02107         <span class="keywordtype">double</span> yaw = obj-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga0c8a0350ce2c49430124b59842fff131">getField</a>(<a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a>(<span class="stringliteral">&quot;Yaw&quot;</span>))-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gac189fe8172d3c25a937b7d0106025dfe">getDouble</a>();
<a name="l02108"></a>02108 
<a name="l02109"></a>02109         <span class="keywordflow">if</span> (yaw != yaw) yaw = 0; <span class="comment">// nan detection</span>
<a name="l02110"></a>02110 
<a name="l02111"></a>02111         <span class="keywordflow">while</span> (yaw &lt; 0) yaw += 360;
<a name="l02112"></a>02112         <span class="keywordflow">while</span> (yaw &gt;= 360) yaw -= 360;
<a name="l02113"></a>02113 
<a name="l02114"></a>02114         <span class="keywordflow">return</span> yaw;
<a name="l02115"></a>02115 }
<a name="l02116"></a>02116 
<a name="l02117"></a>02117 
<a name="l02118"></a>02118 <span class="comment">// *************************************************************************************</span>
<a name="l02119"></a>02119 <span class="keywordtype">void</span> OPMapGadgetWidget::setMapFollowingMode()
<a name="l02120"></a>02120 {
<a name="l02121"></a>02121     <span class="keywordflow">if</span> (!m_widget || !m_map)
<a name="l02122"></a>02122         <span class="keywordflow">return</span>;
<a name="l02123"></a>02123 
<a name="l02124"></a>02124     <span class="keywordflow">if</span> (!followUAVpositionAct-&gt;isChecked())
<a name="l02125"></a>02125     {
<a name="l02126"></a>02126         m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;SetMapFollowType(UAVMapFollowType::None);
<a name="l02127"></a>02127         m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga1e6312bc140cbcfa38ac1bd66b278a71">SetRotate</a>(0);                                                            <span class="comment">// reset map rotation to 0deg</span>
<a name="l02128"></a>02128     }
<a name="l02129"></a>02129     <span class="keywordflow">else</span>
<a name="l02130"></a>02130     <span class="keywordflow">if</span> (!followUAVheadingAct-&gt;isChecked())
<a name="l02131"></a>02131     {
<a name="l02132"></a>02132         m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;SetMapFollowType(UAVMapFollowType::CenterMap);
<a name="l02133"></a>02133         m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga1e6312bc140cbcfa38ac1bd66b278a71">SetRotate</a>(0);                                                            <span class="comment">// reset map rotation to 0deg</span>
<a name="l02134"></a>02134     }
<a name="l02135"></a>02135     <span class="keywordflow">else</span>
<a name="l02136"></a>02136     {
<a name="l02137"></a>02137         m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;SetMapFollowType(UAVMapFollowType::CenterMap);      <span class="comment">// the map library won&#39;t let you reset the uav rotation if it&#39;s already in rotate mode</span>
<a name="l02138"></a>02138 
<a name="l02139"></a>02139         m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;SetUAVHeading(0);                                   <span class="comment">// reset the UAV heading to 0deg</span>
<a name="l02140"></a>02140         m_map-&gt;<a class="code" href="group___o_p_map_widget.html#gabb5c6c7e07970a7f9b774ebf94cd2286">UAV</a>-&gt;SetMapFollowType(UAVMapFollowType::CenterAndRotateMap);
<a name="l02141"></a>02141     }
<a name="l02142"></a>02142 }
<a name="l02143"></a>02143 
<a name="l02144"></a>02144 <span class="comment">// *************************************************************************************</span>
<a name="l02145"></a>02145 <span class="comment">// update the HomeLocation UAV Object</span>
<a name="l02146"></a>02146 
<a name="l02147"></a>02147 <span class="keywordtype">bool</span> OPMapGadgetWidget::setHomeLocationObject()
<a name="l02148"></a>02148 {
<a name="l02149"></a>02149         <span class="keywordflow">if</span> (!obum)
<a name="l02150"></a>02150                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02151"></a>02151 
<a name="l02152"></a>02152         <span class="keywordtype">double</span> LLA[3] = {m_home_position.<a class="code" href="group___o_p_map_plugin.html#ga6324b0912396582281b54bc6d5a6f38a">coord</a>.<a class="code" href="group___o_p_map_widget.html#gacf58e663626e5a88876d68937505dc64">Lat</a>(), m_home_position.<a class="code" href="group___o_p_map_plugin.html#ga6324b0912396582281b54bc6d5a6f38a">coord</a>.<a class="code" href="group___o_p_map_widget.html#ga2a02db7101a66a3c2e5f536e60b38423">Lng</a>(), m_home_position.<a class="code" href="group___o_p_map_plugin.html#ga14ce78cb516fe7a0e7f20e423e92d538">altitude</a>};
<a name="l02153"></a>02153         <span class="keywordflow">return</span> (obum-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gafcfa22c5812ed36ca7a2d6e442ba1710">setHomeLocation</a>(LLA, <span class="keyword">true</span>) &gt;= 0);
<a name="l02154"></a>02154 }
<a name="l02155"></a>02155 
<a name="l02156"></a>02156 <span class="comment">// *************************************************************************************</span>
<a name="l02157"></a>02157 
<a name="l02158"></a><a class="code" href="group___o_p_map_plugin.html#gaada757b80b86bdf8e272319a861e2f73">02158</a> <span class="keywordtype">void</span> <a class="code" href="group___o_p_map_plugin.html#gaada757b80b86bdf8e272319a861e2f73">OPMapGadgetWidget::SetUavPic</a>(<a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> UAVPic)
<a name="l02159"></a>02159 {
<a name="l02160"></a>02160     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga6413251a1bea12088cdfa6d7f599ba04">SetUavPic</a>(UAVPic);
<a name="l02161"></a>02161 }
<a name="l02162"></a>02162 
<a name="l02163"></a>02163 <span class="comment">// *************************************************************************************</span>
<a name="l02164"></a>02164 <span class="keywordtype">void</span> OPMapGadgetWidget::on_tbFind_clicked()
<a name="l02165"></a>02165 {
<a name="l02166"></a>02166     QPalette pal = m_widget-&gt;leFind-&gt;palette();
<a name="l02167"></a>02167 
<a name="l02168"></a>02168     <span class="keywordtype">int</span> result=m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga6dfd41d966be5940e4bb94dd36a25499">SetCurrentPositionByKeywords</a>(m_widget-&gt;leFind-&gt;text());
<a name="l02169"></a>02169     <span class="keywordflow">if</span>(result==core::GeoCoderStatusCode::G_GEO_SUCCESS)
<a name="l02170"></a>02170     {
<a name="l02171"></a>02171         pal.setColor( m_widget-&gt;leFind-&gt;backgroundRole(), Qt::green);
<a name="l02172"></a>02172         m_widget-&gt;leFind-&gt;setPalette(pal);
<a name="l02173"></a>02173         m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga63fe346f4ea58f09453ccd42ffe87260">SetZoom</a>(12);
<a name="l02174"></a>02174     }
<a name="l02175"></a>02175     <span class="keywordflow">else</span>
<a name="l02176"></a>02176     {
<a name="l02177"></a>02177         pal.setColor( m_widget-&gt;leFind-&gt;backgroundRole(), Qt::red);
<a name="l02178"></a>02178         m_widget-&gt;leFind-&gt;setPalette(pal);
<a name="l02179"></a>02179     }
<a name="l02180"></a>02180 }
<a name="l02181"></a>02181 
<a name="l02182"></a>02182 <span class="keywordtype">void</span> OPMapGadgetWidget::onHomeDoubleClick(HomeItem *)
<a name="l02183"></a>02183 {
<a name="l02184"></a>02184     <span class="keyword">new</span> <a class="code" href="classhome_editor.html">homeEditor</a>(m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga3c39e182c87b25990664fbe7dd0a9eff">Home</a>,<span class="keyword">this</span>);
<a name="l02185"></a>02185 }
<a name="l02186"></a>02186 
<a name="l02187"></a>02187 <span class="keywordtype">void</span> OPMapGadgetWidget::onOverlayOpacityActGroup_triggered(QAction *action)
<a name="l02188"></a>02188 {
<a name="l02189"></a>02189     <span class="keywordflow">if</span> (!m_widget || !m_map || !action)
<a name="l02190"></a>02190         <span class="keywordflow">return</span>;
<a name="l02191"></a>02191 
<a name="l02192"></a>02192     m_map-&gt;<a class="code" href="group___o_p_map_widget.html#ga989b4bdc242ebd97536cffb2be2193fc">setOverlayOpacity</a>(action-&gt;data().toReal()/100);
<a name="l02193"></a>02193     emit <a class="code" href="group___o_p_map_plugin.html#gaa3099fde3c8867538207ed89067345eb">overlayOpacityChanged</a>(action-&gt;data().toReal()/100);
<a name="l02194"></a>02194 }
<a name="l02195"></a>02195 
<a name="l02196"></a>02196 <span class="keywordtype">void</span> OPMapGadgetWidget::on_leFind_returnPressed()
<a name="l02197"></a>02197 {
<a name="l02198"></a>02198     on_tbFind_clicked();
<a name="l02199"></a>02199 }
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="opmapgadgetwidget_8cpp.html">opmapgadgetwidget.cpp</a>      </li>

    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
