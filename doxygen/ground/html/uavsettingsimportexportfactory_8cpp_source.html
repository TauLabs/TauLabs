<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>TauLabs: /home/jb/code/TauLabs/ground/gcs/src/plugins/uavsettingsimportexport/uavsettingsimportexportfactory.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="icon_128x128.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">TauLabs
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('uavsettingsimportexportfactory_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">/home/jb/code/TauLabs/ground/gcs/src/plugins/uavsettingsimportexport/uavsettingsimportexportfactory.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="uavsettingsimportexportfactory_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00012"></a>00012 <span class="comment">/*</span>
<a name="l00013"></a>00013 <span class="comment"> * This program is free software; you can redistribute it and/or modify</span>
<a name="l00014"></a>00014 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<a name="l00015"></a>00015 <span class="comment"> * the Free Software Foundation; either version 3 of the License, or</span>
<a name="l00016"></a>00016 <span class="comment"> * (at your option) any later version.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * This program is distributed in the hope that it will be useful, but</span>
<a name="l00019"></a>00019 <span class="comment"> * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
<a name="l00020"></a>00020 <span class="comment"> * or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License</span>
<a name="l00021"></a>00021 <span class="comment"> * for more details.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * You should have received a copy of the GNU General Public License along</span>
<a name="l00024"></a>00024 <span class="comment"> * with this program; if not, write to the Free Software Foundation, Inc.,</span>
<a name="l00025"></a>00025 <span class="comment"> * 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="uavsettingsimportexportfactory_8h.html">uavsettingsimportexportfactory.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;QtPlugin&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;QStringList&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;QDebug&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;QCheckBox&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="importsummary_8h.html">importsummary.h</a>&quot;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="comment">// for menu item</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;<a class="code" href="coreconstants_8h.html">coreplugin/coreconstants.h</a>&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;<a class="code" href="actionmanager_8h.html">coreplugin/actionmanager/actionmanager.h</a>&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;<a class="code" href="icore_8h.html">coreplugin/icore.h</a>&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;QKeySequence&gt;</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="comment">// for UAVObjects</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="uavdataobject_8h.html">uavdataobject.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="uavobjectmanager_8h.html">uavobjectmanager.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="pluginmanager_8h.html">extensionsystem/pluginmanager.h</a>&quot;</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="comment">// for XML object</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;QDomDocument&gt;</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="comment">// for file dialog and error messages</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &lt;QFileDialog&gt;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;QMessageBox&gt;</span>
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="group___u_a_v_settings_import_export.html#gac83bc105170e6ccdb6e39818edd45b57">00053</a> <a class="code" href="group___u_a_v_settings_import_export.html#gac83bc105170e6ccdb6e39818edd45b57">UAVSettingsImportExportFactory::~UAVSettingsImportExportFactory</a>()
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055    <span class="comment">// Do nothing</span>
<a name="l00056"></a>00056 }
<a name="l00057"></a>00057 
<a name="l00058"></a><a class="code" href="group___u_a_v_settings_import_export.html#ga487d479be4ae96eddde7372c94c27bd7">00058</a> <a class="code" href="group___u_a_v_settings_import_export.html#ga487d479be4ae96eddde7372c94c27bd7">UAVSettingsImportExportFactory::UAVSettingsImportExportFactory</a>(QObject *parent):QObject(parent)
<a name="l00059"></a>00059 {
<a name="l00060"></a>00060 
<a name="l00061"></a>00061    <span class="comment">// Add Menu entry</span>
<a name="l00062"></a>00062    <a class="code" href="class_core_1_1_action_manager.html" title="The action manager is responsible for registration of menus and menu items and keyboard shortcuts...">Core::ActionManager</a> *am = <a class="code" href="group___core_plugin.html#ga71099762904aac0b404fcd1f93bdc83e">Core::ICore::instance</a>()-&gt;<a class="code" href="group___core_plugin.html#ga5e44e7795213bb2627acfa08a13f6a12" title="Returns the application&#39;s action manager.">actionManager</a>();
<a name="l00063"></a>00063    <a class="code" href="class_core_1_1_action_container.html">Core::ActionContainer</a> *ac = am-&gt;<a class="code" href="group___core_plugin.html#ga0bd5e0ad7658056a7c80666200734df8" title="Returns the IActionContainter object that is know to the system under the given string id...">actionContainer</a>(<a class="code" href="group___core_plugin.html#ga86cd43471b9407a34f91a707e8c37a94">Core::Constants::M_FILE</a>);
<a name="l00064"></a>00064    <a class="code" href="class_core_1_1_command.html" title="The class Command represents an action like a menu item, tool button, or shortcut. You don&#39;t create Command objects directly, instead use {ActionManager::registerAction()} to register an action and retrieve a Command. The Command object represents the user visible action and its properties. If multiple actions are registered with the same ID (but different contexts) the returned Command is the shared one between these actions.">Core::Command</a> *cmd = am-&gt;<a class="code" href="group___core_plugin.html#ga316dd0cff29b294cd1b0631677f6357d" title="Makes an action known to the system under the specified string id.">registerAction</a>(<span class="keyword">new</span> QAction(<span class="keyword">this</span>),
<a name="l00065"></a>00065                                            <span class="stringliteral">&quot;UAVSettingsImportExportPlugin.UAVSettingsExport&quot;</span>,
<a name="l00066"></a>00066                                            QList&lt;int&gt;() &lt;&lt;
<a name="l00067"></a>00067                                            <a class="code" href="group___core_plugin.html#ga73bcb9a176a2f5b7cec3008d5b0f244c">Core::Constants::C_GLOBAL_ID</a>);
<a name="l00068"></a>00068     cmd-&gt;<a class="code" href="group___core_plugin.html#ga9edb60253a233526349538b2fcb2e093">setDefaultKeySequence</a>(QKeySequence(<span class="stringliteral">&quot;Ctrl+E&quot;</span>));
<a name="l00069"></a>00069     cmd-&gt;<a class="code" href="group___core_plugin.html#ga68bf6b0115ef45e9a734956f3b0d40c5">action</a>()-&gt;setText(tr(<span class="stringliteral">&quot;Export UAV Settings...&quot;</span>));
<a name="l00070"></a>00070     ac-&gt;<a class="code" href="group___core_plugin.html#gaae18910476f06c6af0eecd572bf1dd51">addAction</a>(cmd, <a class="code" href="group___core_plugin.html#ga71aab5cd1940b131cfa9089cf7b6a6cc">Core::Constants::G_FILE_SAVE</a>);
<a name="l00071"></a>00071     connect(cmd-&gt;<a class="code" href="group___core_plugin.html#ga68bf6b0115ef45e9a734956f3b0d40c5">action</a>(), SIGNAL(triggered(<span class="keywordtype">bool</span>)), <span class="keyword">this</span>, SLOT(exportUAVSettings()));
<a name="l00072"></a>00072 
<a name="l00073"></a>00073     cmd = am-&gt;<a class="code" href="group___core_plugin.html#ga316dd0cff29b294cd1b0631677f6357d" title="Makes an action known to the system under the specified string id.">registerAction</a>(<span class="keyword">new</span> QAction(<span class="keyword">this</span>),
<a name="l00074"></a>00074                              <span class="stringliteral">&quot;UAVSettingsImportExportPlugin.UAVSettingsImport&quot;</span>,
<a name="l00075"></a>00075                              QList&lt;int&gt;() &lt;&lt;
<a name="l00076"></a>00076                              <a class="code" href="group___core_plugin.html#ga73bcb9a176a2f5b7cec3008d5b0f244c">Core::Constants::C_GLOBAL_ID</a>);
<a name="l00077"></a>00077     cmd-&gt;<a class="code" href="group___core_plugin.html#ga9edb60253a233526349538b2fcb2e093">setDefaultKeySequence</a>(QKeySequence(<span class="stringliteral">&quot;Ctrl+I&quot;</span>));
<a name="l00078"></a>00078     cmd-&gt;action()-&gt;setText(tr(<span class="stringliteral">&quot;Import UAV Settings...&quot;</span>));
<a name="l00079"></a>00079     ac-&gt;<a class="code" href="group___core_plugin.html#gaae18910476f06c6af0eecd572bf1dd51">addAction</a>(cmd, <a class="code" href="group___core_plugin.html#ga71aab5cd1940b131cfa9089cf7b6a6cc">Core::Constants::G_FILE_SAVE</a>);
<a name="l00080"></a>00080     connect(cmd-&gt;action(), SIGNAL(triggered(<span class="keywordtype">bool</span>)), <span class="keyword">this</span>, SLOT(importUAVSettings()));
<a name="l00081"></a>00081 
<a name="l00082"></a>00082     ac = am-&gt;<a class="code" href="group___core_plugin.html#ga0bd5e0ad7658056a7c80666200734df8" title="Returns the IActionContainter object that is know to the system under the given string id...">actionContainer</a>(<a class="code" href="group___core_plugin.html#ga67b5fbe80e9f8a05d1c50c1af7ac39d2">Core::Constants::M_HELP</a>);
<a name="l00083"></a>00083     cmd = am-&gt;<a class="code" href="group___core_plugin.html#ga316dd0cff29b294cd1b0631677f6357d" title="Makes an action known to the system under the specified string id.">registerAction</a>(<span class="keyword">new</span> QAction(<span class="keyword">this</span>),
<a name="l00084"></a>00084                              <span class="stringliteral">&quot;UAVSettingsImportExportPlugin.UAVDataExport&quot;</span>,
<a name="l00085"></a>00085                              QList&lt;int&gt;() &lt;&lt;
<a name="l00086"></a>00086                              <a class="code" href="group___core_plugin.html#ga73bcb9a176a2f5b7cec3008d5b0f244c">Core::Constants::C_GLOBAL_ID</a>);
<a name="l00087"></a>00087     cmd-&gt;<a class="code" href="group___core_plugin.html#ga68bf6b0115ef45e9a734956f3b0d40c5">action</a>()-&gt;setText(tr(<span class="stringliteral">&quot;Export UAV Data...&quot;</span>));
<a name="l00088"></a>00088     ac-&gt;addAction(cmd, <a class="code" href="group___core_plugin.html#ga8e2fb85a38cf8aedef4ada147ef05f83">Core::Constants::G_HELP_HELP</a>);
<a name="l00089"></a>00089     connect(cmd-&gt;action(), SIGNAL(triggered(<span class="keywordtype">bool</span>)), <span class="keyword">this</span>, SLOT(exportUAVData()));
<a name="l00090"></a>00090 
<a name="l00091"></a>00091     ac = am-&gt;<a class="code" href="group___core_plugin.html#ga0bd5e0ad7658056a7c80666200734df8" title="Returns the IActionContainter object that is know to the system under the given string id...">actionContainer</a>(<a class="code" href="group___core_plugin.html#ga86cd43471b9407a34f91a707e8c37a94">Core::Constants::M_FILE</a>);
<a name="l00092"></a>00092     cmd = am-&gt;<a class="code" href="group___core_plugin.html#ga316dd0cff29b294cd1b0631677f6357d" title="Makes an action known to the system under the specified string id.">registerAction</a>(<span class="keyword">new</span> QAction(<span class="keyword">this</span>),
<a name="l00093"></a>00093                              <span class="stringliteral">&quot;UAVSettingsImportExportPlugin.UAVWaypointsExport&quot;</span>,
<a name="l00094"></a>00094                              QList&lt;int&gt;() &lt;&lt;
<a name="l00095"></a>00095                              <a class="code" href="group___core_plugin.html#ga73bcb9a176a2f5b7cec3008d5b0f244c">Core::Constants::C_GLOBAL_ID</a>);
<a name="l00096"></a>00096     cmd-&gt;<a class="code" href="group___core_plugin.html#ga68bf6b0115ef45e9a734956f3b0d40c5">action</a>()-&gt;setText(tr(<span class="stringliteral">&quot;Export Waypoints...&quot;</span>));
<a name="l00097"></a>00097     ac-&gt;addAction(cmd, <a class="code" href="group___core_plugin.html#ga71aab5cd1940b131cfa9089cf7b6a6cc">Core::Constants::G_FILE_SAVE</a>);
<a name="l00098"></a>00098     connect(cmd-&gt;action(), SIGNAL(triggered(<span class="keywordtype">bool</span>)), <span class="keyword">this</span>, SLOT(exportWaypoints()));
<a name="l00099"></a>00099 
<a name="l00100"></a>00100     ac = am-&gt;<a class="code" href="group___core_plugin.html#ga0bd5e0ad7658056a7c80666200734df8" title="Returns the IActionContainter object that is know to the system under the given string id...">actionContainer</a>(<a class="code" href="group___core_plugin.html#ga86cd43471b9407a34f91a707e8c37a94">Core::Constants::M_FILE</a>);
<a name="l00101"></a>00101     cmd = am-&gt;<a class="code" href="group___core_plugin.html#ga316dd0cff29b294cd1b0631677f6357d" title="Makes an action known to the system under the specified string id.">registerAction</a>(<span class="keyword">new</span> QAction(<span class="keyword">this</span>),
<a name="l00102"></a>00102                              <span class="stringliteral">&quot;UAVSettingsImportExportPlugin.UAVWaypointsImport&quot;</span>,
<a name="l00103"></a>00103                              QList&lt;int&gt;() &lt;&lt;
<a name="l00104"></a>00104                              <a class="code" href="group___core_plugin.html#ga73bcb9a176a2f5b7cec3008d5b0f244c">Core::Constants::C_GLOBAL_ID</a>);
<a name="l00105"></a>00105     cmd-&gt;<a class="code" href="group___core_plugin.html#ga68bf6b0115ef45e9a734956f3b0d40c5">action</a>()-&gt;setText(tr(<span class="stringliteral">&quot;Import Waypoints...&quot;</span>));
<a name="l00106"></a>00106     ac-&gt;addAction(cmd, <a class="code" href="group___core_plugin.html#ga71aab5cd1940b131cfa9089cf7b6a6cc">Core::Constants::G_FILE_SAVE</a>);
<a name="l00107"></a>00107     connect(cmd-&gt;action(), SIGNAL(triggered(<span class="keywordtype">bool</span>)), <span class="keyword">this</span>, SLOT(importWaypoints()));
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 }
<a name="l00110"></a>00110 
<a name="l00111"></a>00111 <span class="comment">// Slot called by the menu manager on user action</span>
<a name="l00112"></a>00112 <span class="keywordtype">void</span> UAVSettingsImportExportFactory::importUAVSettings()
<a name="l00113"></a>00113 {
<a name="l00114"></a>00114     <span class="comment">// ask for file name</span>
<a name="l00115"></a>00115     <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> fileName;
<a name="l00116"></a>00116     <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> filters = tr(<span class="stringliteral">&quot;UAVObjects XML files (*.uav);; XML files (*.xml)&quot;</span>);
<a name="l00117"></a>00117     fileName = QFileDialog::getOpenFileName(0, tr(<span class="stringliteral">&quot;Import UAV Settings&quot;</span>), <span class="stringliteral">&quot;&quot;</span>, filters);
<a name="l00118"></a>00118     <span class="keywordflow">if</span> (fileName.isEmpty()) {
<a name="l00119"></a>00119         <span class="keywordflow">return</span>;
<a name="l00120"></a>00120     }
<a name="l00121"></a>00121 
<a name="l00122"></a>00122     <span class="comment">// Now open the file</span>
<a name="l00123"></a>00123     QFile <a class="code" href="uavobjecttemplate_8m.html#a97c04efa65bcf0928abf9260bc5cbf46">file</a>(fileName);
<a name="l00124"></a>00124     QDomDocument doc(<span class="stringliteral">&quot;UAVObjects&quot;</span>);
<a name="l00125"></a>00125     <a class="code" href="uavobjecttemplate_8m.html#a97c04efa65bcf0928abf9260bc5cbf46">file</a>.open(QFile::ReadOnly|QFile::Text);
<a name="l00126"></a>00126     <span class="keywordflow">if</span> (!doc.setContent(<a class="code" href="uavobjecttemplate_8m.html#a97c04efa65bcf0928abf9260bc5cbf46">file</a>.readAll())) {
<a name="l00127"></a>00127         QMessageBox msgBox;
<a name="l00128"></a>00128         msgBox.setText(tr(<span class="stringliteral">&quot;File Parsing Failed.&quot;</span>));
<a name="l00129"></a>00129         msgBox.setInformativeText(tr(<span class="stringliteral">&quot;This file is not a correct XML file&quot;</span>));
<a name="l00130"></a>00130         msgBox.setStandardButtons(QMessageBox::Ok);
<a name="l00131"></a>00131         msgBox.exec();
<a name="l00132"></a>00132         <span class="keywordflow">return</span>;
<a name="l00133"></a>00133     }
<a name="l00134"></a>00134     <a class="code" href="uavobjecttemplate_8m.html#a97c04efa65bcf0928abf9260bc5cbf46">file</a>.close();
<a name="l00135"></a>00135 
<a name="l00136"></a>00136     <span class="comment">// find the root of settings subtree</span>
<a name="l00137"></a>00137     emit <a class="code" href="group___u_a_v_settings_import_export.html#ga1d7a913adac9094e20d9086a8a1cb5c3">importAboutToBegin</a>();
<a name="l00138"></a>00138     qDebug()&lt;&lt;<span class="stringliteral">&quot;Import about to begin&quot;</span>;
<a name="l00139"></a>00139 
<a name="l00140"></a>00140     QDomElement root = doc.documentElement();
<a name="l00141"></a>00141     <span class="keywordflow">if</span> (root.tagName() == <span class="stringliteral">&quot;uavobjects&quot;</span>) {
<a name="l00142"></a>00142         root = root.firstChildElement(<span class="stringliteral">&quot;settings&quot;</span>);
<a name="l00143"></a>00143     }
<a name="l00144"></a>00144     <span class="keywordflow">if</span> (root.isNull() || (root.tagName() != <span class="stringliteral">&quot;settings&quot;</span>)) {
<a name="l00145"></a>00145         QMessageBox msgBox;
<a name="l00146"></a>00146         msgBox.setText(tr(<span class="stringliteral">&quot;Wrong file contents&quot;</span>));
<a name="l00147"></a>00147         msgBox.setInformativeText(tr(<span class="stringliteral">&quot;This file does not contain correct UAVSettings&quot;</span>));
<a name="l00148"></a>00148         msgBox.setStandardButtons(QMessageBox::Ok);
<a name="l00149"></a>00149         msgBox.exec();
<a name="l00150"></a>00150         <span class="keywordflow">return</span>;
<a name="l00151"></a>00151     }
<a name="l00152"></a>00152 
<a name="l00153"></a>00153     <span class="comment">// We are now ok: setup the import summary dialog &amp; update it as we</span>
<a name="l00154"></a>00154     <span class="comment">// go along.</span>
<a name="l00155"></a>00155     <a class="code" href="class_import_summary_dialog.html">ImportSummaryDialog</a> swui((QWidget*)<a class="code" href="group___core_plugin.html#ga71099762904aac0b404fcd1f93bdc83e">Core::ICore::instance</a>()-&gt;mainWindow());
<a name="l00156"></a>00156 
<a name="l00157"></a>00157     <a class="code" href="class_extension_system_1_1_plugin_manager.html" title="Core plugin system that manages the plugins, their life cycle and their registered objects...">ExtensionSystem::PluginManager</a> *pm = ExtensionSystem::PluginManager::instance();
<a name="l00158"></a>00158     <a class="code" href="class_u_a_v_object_manager.html">UAVObjectManager</a> *objManager = pm-&gt;getObject&lt;<a class="code" href="class_u_a_v_object_manager.html">UAVObjectManager</a>&gt;();
<a name="l00159"></a>00159     swui.show();
<a name="l00160"></a>00160 
<a name="l00161"></a>00161     QDomNode node = root.firstChild();
<a name="l00162"></a>00162     <span class="keywordflow">while</span> (!node.isNull()) {
<a name="l00163"></a>00163         QDomElement <a class="code" href="_o_p_plots_8m.html#a9425be9aab51621e317ba7ade564b570">e</a> = node.toElement();
<a name="l00164"></a>00164         <span class="keywordflow">if</span> (e.tagName() == <span class="stringliteral">&quot;object&quot;</span>) {
<a name="l00165"></a>00165 
<a name="l00166"></a>00166             <span class="comment">//  - Read each object</span>
<a name="l00167"></a>00167             <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> uavObjectName  = e.attribute(<span class="stringliteral">&quot;name&quot;</span>);
<a name="l00168"></a>00168             uint uavObjectID = e.attribute(<span class="stringliteral">&quot;id&quot;</span>).toUInt(NULL,16);
<a name="l00169"></a>00169 
<a name="l00170"></a>00170             <span class="comment">// Sanity Check:</span>
<a name="l00171"></a>00171             <a class="code" href="class_u_a_v_object.html">UAVObject</a> *obj = objManager-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gada44cdbfa55a281b78d41abcc6834dc0">getObject</a>(uavObjectName);
<a name="l00172"></a>00172             <span class="keywordflow">if</span> (obj == NULL) {
<a name="l00173"></a>00173                 <span class="comment">// This object is unknown!</span>
<a name="l00174"></a>00174                 qDebug() &lt;&lt; <span class="stringliteral">&quot;Object unknown:&quot;</span> &lt;&lt; uavObjectName &lt;&lt; uavObjectID;
<a name="l00175"></a>00175                 swui.addLine(uavObjectName, <span class="stringliteral">&quot;Error (Object unknown)&quot;</span>, <span class="keyword">false</span>);
<a name="l00176"></a>00176             } <span class="keywordflow">else</span> {
<a name="l00177"></a>00177                 <span class="comment">//  - Update each field</span>
<a name="l00178"></a>00178                 <span class="comment">//  - Issue and &quot;updated&quot; command</span>
<a name="l00179"></a>00179                 <span class="keywordtype">bool</span> <a class="code" href="uavobjecttemplate_8m.html#a8760c7f0db08dc03416f4c8c3fc08f02">error</a> = <span class="keyword">false</span>;
<a name="l00180"></a>00180                 <span class="keywordtype">bool</span> setError = <span class="keyword">false</span>;
<a name="l00181"></a>00181                 QDomNode field = node.firstChild();
<a name="l00182"></a>00182                 <span class="keywordflow">while</span>(!field.isNull()) {
<a name="l00183"></a>00183                     QDomElement f = field.toElement();
<a name="l00184"></a>00184                     <span class="keywordflow">if</span> (f.tagName() == <span class="stringliteral">&quot;field&quot;</span>) {
<a name="l00185"></a>00185                         <a class="code" href="class_u_a_v_object_field.html">UAVObjectField</a> *uavfield = obj-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga0c8a0350ce2c49430124b59842fff131">getField</a>(f.attribute(<span class="stringliteral">&quot;name&quot;</span>));
<a name="l00186"></a>00186                         <span class="keywordflow">if</span> (uavfield) {
<a name="l00187"></a>00187                             QStringList list = f.attribute(<span class="stringliteral">&quot;values&quot;</span>).split(<span class="stringliteral">&quot;,&quot;</span>);
<a name="l00188"></a>00188                             <span class="keywordflow">if</span> (list.length() == 1) {
<a name="l00189"></a>00189                                 <span class="keywordflow">if</span> (<span class="keyword">false</span> == uavfield-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga8aed4e68eb0697d4776a103bfe5aa059">checkValue</a>(f.attribute(<span class="stringliteral">&quot;values&quot;</span>))) {
<a name="l00190"></a>00190                                     qDebug() &lt;&lt; <span class="stringliteral">&quot;checkValue returned false on: &quot;</span> &lt;&lt; uavObjectName &lt;&lt; f.attribute(<span class="stringliteral">&quot;values&quot;</span>);
<a name="l00191"></a>00191                                     setError = <span class="keyword">true</span>;
<a name="l00192"></a>00192                                 } <span class="keywordflow">else</span> {
<a name="l00193"></a>00193                                     uavfield-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gab647538e1956252e12841c42a54106c7">setValue</a>(f.attribute(<span class="stringliteral">&quot;values&quot;</span>));
<a name="l00194"></a>00194                                 }
<a name="l00195"></a>00195                             } <span class="keywordflow">else</span> {
<a name="l00196"></a>00196                                 <span class="comment">// This is an enum:</span>
<a name="l00197"></a>00197                                 <span class="keywordtype">int</span> <a class="code" href="_o_p_plots_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0;
<a name="l00198"></a>00198                                 QStringList list = f.attribute(<span class="stringliteral">&quot;values&quot;</span>).split(<span class="stringliteral">&quot;,&quot;</span>);
<a name="l00199"></a>00199                                 <span class="keywordflow">foreach</span> (<a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> element, list) {
<a name="l00200"></a>00200                                     <span class="keywordflow">if</span> (<span class="keyword">false</span> == uavfield-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga8aed4e68eb0697d4776a103bfe5aa059">checkValue</a>(element, i)) {
<a name="l00201"></a>00201                                         qDebug() &lt;&lt; <span class="stringliteral">&quot;checkValue(list) returned false on: &quot;</span> &lt;&lt; uavObjectName &lt;&lt; list;
<a name="l00202"></a>00202                                         setError = <span class="keyword">true</span>;
<a name="l00203"></a>00203                                     } <span class="keywordflow">else</span> {
<a name="l00204"></a>00204                                          uavfield-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gab647538e1956252e12841c42a54106c7">setValue</a>(element,i);
<a name="l00205"></a>00205                                     }
<a name="l00206"></a>00206                                     i++;
<a name="l00207"></a>00207                                 }
<a name="l00208"></a>00208                             }
<a name="l00209"></a>00209                         } <span class="keywordflow">else</span> {
<a name="l00210"></a>00210                             error = <span class="keyword">true</span>;
<a name="l00211"></a>00211                         }
<a name="l00212"></a>00212                     }
<a name="l00213"></a>00213                     field = field.nextSibling();
<a name="l00214"></a>00214                 }
<a name="l00215"></a>00215                 obj-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga295ff9d6b0c01a6a8809a4cf9eb027cc">updated</a>();
<a name="l00216"></a>00216 
<a name="l00217"></a>00217                 <span class="keywordflow">if</span> (error) {
<a name="l00218"></a>00218                     swui.addLine(uavObjectName, <span class="stringliteral">&quot;Warning (Object field unknown)&quot;</span>, <span class="keyword">true</span>);
<a name="l00219"></a>00219                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (uavObjectID != obj-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gaad45ab83a511083bfe60df0c244e9b88">getObjID</a>()) {
<a name="l00220"></a>00220                     qDebug() &lt;&lt; <span class="stringliteral">&quot;Mismatch for Object &quot;</span> &lt;&lt; uavObjectName &lt;&lt; uavObjectID &lt;&lt; <span class="stringliteral">&quot; - &quot;</span> &lt;&lt; obj-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gaad45ab83a511083bfe60df0c244e9b88">getObjID</a>();
<a name="l00221"></a>00221                     swui.addLine(uavObjectName, <span class="stringliteral">&quot;Warning (ObjectID mismatch)&quot;</span>, <span class="keyword">true</span>);
<a name="l00222"></a>00222                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (setError) {
<a name="l00223"></a>00223                     swui.addLine(uavObjectName, <span class="stringliteral">&quot;Warning (Objects field value(s) invalid)&quot;</span>, <span class="keyword">false</span>);
<a name="l00224"></a>00224                 } <span class="keywordflow">else</span> {
<a name="l00225"></a>00225                     swui.addLine(uavObjectName, <span class="stringliteral">&quot;OK&quot;</span>, <span class="keyword">true</span>);
<a name="l00226"></a>00226                 }
<a name="l00227"></a>00227             }
<a name="l00228"></a>00228         }
<a name="l00229"></a>00229         node = node.nextSibling();
<a name="l00230"></a>00230     }
<a name="l00231"></a>00231     qDebug() &lt;&lt; <span class="stringliteral">&quot;End import&quot;</span>;
<a name="l00232"></a>00232     swui.exec();
<a name="l00233"></a>00233 }
<a name="l00234"></a>00234 
<a name="l00235"></a>00235 
<a name="l00236"></a>00236 <span class="comment">// Slot called by the menu manager on user action</span>
<a name="l00237"></a>00237 <span class="keywordtype">void</span> UAVSettingsImportExportFactory::importWaypoints()
<a name="l00238"></a>00238 {
<a name="l00239"></a>00239     <span class="comment">// ask for file name</span>
<a name="l00240"></a>00240     <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> fileName;
<a name="l00241"></a>00241     <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> filters = tr(<span class="stringliteral">&quot;Waypoint XML files (*.xml)&quot;</span>);
<a name="l00242"></a>00242     fileName = QFileDialog::getOpenFileName(0, tr(<span class="stringliteral">&quot;Import waypoints&quot;</span>), <span class="stringliteral">&quot;&quot;</span>, filters);
<a name="l00243"></a>00243     <span class="keywordflow">if</span> (fileName.isEmpty()) {
<a name="l00244"></a>00244         <span class="keywordflow">return</span>;
<a name="l00245"></a>00245     }
<a name="l00246"></a>00246 
<a name="l00247"></a>00247     <span class="comment">// Now open the file</span>
<a name="l00248"></a>00248     QFile <a class="code" href="uavobjecttemplate_8m.html#a97c04efa65bcf0928abf9260bc5cbf46">file</a>(fileName);
<a name="l00249"></a>00249     QDomDocument doc(<span class="stringliteral">&quot;UAVObjects&quot;</span>);
<a name="l00250"></a>00250     <a class="code" href="uavobjecttemplate_8m.html#a97c04efa65bcf0928abf9260bc5cbf46">file</a>.open(QFile::ReadOnly|QFile::Text);
<a name="l00251"></a>00251     <span class="keywordflow">if</span> (!doc.setContent(<a class="code" href="uavobjecttemplate_8m.html#a97c04efa65bcf0928abf9260bc5cbf46">file</a>.readAll())) {
<a name="l00252"></a>00252         QMessageBox msgBox;
<a name="l00253"></a>00253         msgBox.setText(tr(<span class="stringliteral">&quot;File Parsing Failed.&quot;</span>));
<a name="l00254"></a>00254         msgBox.setInformativeText(tr(<span class="stringliteral">&quot;This file is not a correct XML file&quot;</span>));
<a name="l00255"></a>00255         msgBox.setStandardButtons(QMessageBox::Ok);
<a name="l00256"></a>00256         msgBox.exec();
<a name="l00257"></a>00257         <span class="keywordflow">return</span>;
<a name="l00258"></a>00258     }
<a name="l00259"></a>00259     <a class="code" href="uavobjecttemplate_8m.html#a97c04efa65bcf0928abf9260bc5cbf46">file</a>.close();
<a name="l00260"></a>00260 
<a name="l00261"></a>00261     <span class="comment">// find the root of settings subtree</span>
<a name="l00262"></a>00262     emit <a class="code" href="group___u_a_v_settings_import_export.html#ga1d7a913adac9094e20d9086a8a1cb5c3">importAboutToBegin</a>();
<a name="l00263"></a>00263     qDebug()&lt;&lt;<span class="stringliteral">&quot;Import about to begin&quot;</span>;
<a name="l00264"></a>00264 
<a name="l00265"></a>00265     QDomElement root = doc.documentElement();
<a name="l00266"></a>00266     <span class="keywordflow">if</span> (root.tagName() == <span class="stringliteral">&quot;uavobjects&quot;</span>) {
<a name="l00267"></a>00267         root = root.firstChildElement(<span class="stringliteral">&quot;waypoints&quot;</span>);
<a name="l00268"></a>00268     }
<a name="l00269"></a>00269     <span class="keywordflow">if</span> (root.isNull() || (root.tagName() != <span class="stringliteral">&quot;waypoints&quot;</span>)) {
<a name="l00270"></a>00270         QMessageBox msgBox;
<a name="l00271"></a>00271         msgBox.setText(tr(<span class="stringliteral">&quot;Wrong file contents&quot;</span>));
<a name="l00272"></a>00272         msgBox.setInformativeText(tr(<span class="stringliteral">&quot;This file does not contain waypoints&quot;</span>));
<a name="l00273"></a>00273         msgBox.setStandardButtons(QMessageBox::Ok);
<a name="l00274"></a>00274         msgBox.exec();
<a name="l00275"></a>00275         <span class="keywordflow">return</span>;
<a name="l00276"></a>00276     }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278     <a class="code" href="class_extension_system_1_1_plugin_manager.html" title="Core plugin system that manages the plugins, their life cycle and their registered objects...">ExtensionSystem::PluginManager</a> *pm = ExtensionSystem::PluginManager::instance();
<a name="l00279"></a>00279     <a class="code" href="class_u_a_v_object_manager.html">UAVObjectManager</a> *objManager = pm-&gt;getObject&lt;<a class="code" href="class_u_a_v_object_manager.html">UAVObjectManager</a>&gt;();
<a name="l00280"></a>00280 
<a name="l00281"></a>00281     QDomNode node = root.firstChild();
<a name="l00282"></a>00282     <span class="keywordflow">while</span> (!node.isNull()) {
<a name="l00283"></a>00283         QDomElement e = node.toElement();
<a name="l00284"></a>00284         <span class="keywordflow">if</span> (e.tagName() == <span class="stringliteral">&quot;object&quot;</span>) {
<a name="l00285"></a>00285 
<a name="l00286"></a>00286             <span class="comment">//  - Read each object</span>
<a name="l00287"></a>00287             <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> uavObjectName  = e.attribute(<span class="stringliteral">&quot;name&quot;</span>);
<a name="l00288"></a>00288             uint uavObjectID = e.attribute(<span class="stringliteral">&quot;id&quot;</span>).toUInt(NULL,16);
<a name="l00289"></a>00289             uint instId = e.attribute(<span class="stringliteral">&quot;instId&quot;</span>).toUInt(NULL,10);
<a name="l00290"></a>00290 
<a name="l00291"></a>00291             <span class="comment">// Sanity Check:</span>
<a name="l00292"></a>00292             <a class="code" href="class_u_a_v_data_object.html">UAVDataObject</a> * obj = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_u_a_v_data_object.html">UAVDataObject</a>*<span class="keyword">&gt;</span>(objManager-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gada44cdbfa55a281b78d41abcc6834dc0">getObject</a>(uavObjectName));
<a name="l00293"></a>00293             <span class="keywordflow">if</span> (obj == NULL) {
<a name="l00294"></a>00294                 <span class="comment">// This object is unknown!</span>
<a name="l00295"></a>00295                 qDebug() &lt;&lt; <span class="stringliteral">&quot;Object unknown:&quot;</span> &lt;&lt; uavObjectName &lt;&lt; uavObjectID;
<a name="l00296"></a>00296             } <span class="keywordflow">else</span> {
<a name="l00297"></a>00297 
<a name="l00298"></a>00298                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> numInstances = objManager-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gab285ecd0299f701264d624cad6e51ef1">getNumInstances</a>(obj-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gaad45ab83a511083bfe60df0c244e9b88">getObjID</a>());
<a name="l00299"></a>00299                 <span class="keywordflow">if</span> (instId &gt;= numInstances) {
<a name="l00300"></a>00300                     obj = obj-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga9c113847ecf6bd99cf7efe3535620e66">clone</a>(instId);
<a name="l00301"></a>00301                     objManager-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gad71bd0967de227335d5fec0b599a54e3">registerObject</a>(obj);
<a name="l00302"></a>00302                     qDebug() &lt;&lt; <span class="stringliteral">&quot;Cloned new object&quot;</span>;
<a name="l00303"></a>00303                 } <span class="keywordflow">else</span> {
<a name="l00304"></a>00304                     obj = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="class_u_a_v_data_object.html">UAVDataObject</a>*<span class="keyword">&gt;</span>(objManager-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gada44cdbfa55a281b78d41abcc6834dc0">getObject</a>(uavObjectName, instId));
<a name="l00305"></a>00305                     Q_ASSERT(obj);
<a name="l00306"></a>00306                     qDebug() &lt;&lt; <span class="stringliteral">&quot;Setting existing object&quot;</span>;
<a name="l00307"></a>00307                 }
<a name="l00308"></a>00308 
<a name="l00309"></a>00309                 <span class="comment">//  - Update each field</span>
<a name="l00310"></a>00310                 <span class="comment">//  - Issue and &quot;updated&quot; command</span>
<a name="l00311"></a>00311                 <span class="keywordtype">bool</span> error = <span class="keyword">false</span>;
<a name="l00312"></a>00312                 <span class="keywordtype">bool</span> setError = <span class="keyword">false</span>;
<a name="l00313"></a>00313                 QDomNode field = node.firstChild();
<a name="l00314"></a>00314                 <span class="keywordflow">while</span>(!field.isNull()) {
<a name="l00315"></a>00315                     QDomElement f = field.toElement();
<a name="l00316"></a>00316                     <span class="keywordflow">if</span> (f.tagName() == <span class="stringliteral">&quot;field&quot;</span>) {
<a name="l00317"></a>00317                         <a class="code" href="class_u_a_v_object_field.html">UAVObjectField</a> *uavfield = obj-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga0c8a0350ce2c49430124b59842fff131">getField</a>(f.attribute(<span class="stringliteral">&quot;name&quot;</span>));
<a name="l00318"></a>00318                         <span class="keywordflow">if</span> (uavfield) {
<a name="l00319"></a>00319                             QStringList list = f.attribute(<span class="stringliteral">&quot;values&quot;</span>).split(<span class="stringliteral">&quot;,&quot;</span>);
<a name="l00320"></a>00320                             <span class="keywordflow">if</span> (list.length() == 1) {
<a name="l00321"></a>00321                                 <span class="keywordflow">if</span> (<span class="keyword">false</span> == uavfield-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga8aed4e68eb0697d4776a103bfe5aa059">checkValue</a>(f.attribute(<span class="stringliteral">&quot;values&quot;</span>))) {
<a name="l00322"></a>00322                                     qDebug() &lt;&lt; <span class="stringliteral">&quot;checkValue returned false on: &quot;</span> &lt;&lt; uavObjectName &lt;&lt; f.attribute(<span class="stringliteral">&quot;values&quot;</span>);
<a name="l00323"></a>00323                                     setError = <span class="keyword">true</span>;
<a name="l00324"></a>00324                                 } <span class="keywordflow">else</span> {
<a name="l00325"></a>00325                                     uavfield-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gab647538e1956252e12841c42a54106c7">setValue</a>(f.attribute(<span class="stringliteral">&quot;values&quot;</span>));
<a name="l00326"></a>00326                                 }
<a name="l00327"></a>00327                             } <span class="keywordflow">else</span> {
<a name="l00328"></a>00328                                 <span class="comment">// This is an enum:</span>
<a name="l00329"></a>00329                                 <span class="keywordtype">int</span> i = 0;
<a name="l00330"></a>00330                                 QStringList list = f.attribute(<span class="stringliteral">&quot;values&quot;</span>).split(<span class="stringliteral">&quot;,&quot;</span>);
<a name="l00331"></a>00331                                 <span class="keywordflow">foreach</span> (<a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> element, list) {
<a name="l00332"></a>00332                                     <span class="keywordflow">if</span> (<span class="keyword">false</span> == uavfield-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga8aed4e68eb0697d4776a103bfe5aa059">checkValue</a>(element, i)) {
<a name="l00333"></a>00333                                         qDebug() &lt;&lt; <span class="stringliteral">&quot;checkValue(list) returned false on: &quot;</span> &lt;&lt; uavObjectName &lt;&lt; list;
<a name="l00334"></a>00334                                         setError = <span class="keyword">true</span>;
<a name="l00335"></a>00335                                     } <span class="keywordflow">else</span> {
<a name="l00336"></a>00336                                          uavfield-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gab647538e1956252e12841c42a54106c7">setValue</a>(element,i);
<a name="l00337"></a>00337                                     }
<a name="l00338"></a>00338                                     i++;
<a name="l00339"></a>00339                                 }
<a name="l00340"></a>00340                             }
<a name="l00341"></a>00341                         } <span class="keywordflow">else</span> {
<a name="l00342"></a>00342                             error = <span class="keyword">true</span>;
<a name="l00343"></a>00343                         }
<a name="l00344"></a>00344                     }
<a name="l00345"></a>00345                     field = field.nextSibling();
<a name="l00346"></a>00346                 }
<a name="l00347"></a>00347             }
<a name="l00348"></a>00348         }
<a name="l00349"></a>00349         node = node.nextSibling();
<a name="l00350"></a>00350     }
<a name="l00351"></a>00351     qDebug() &lt;&lt; <span class="stringliteral">&quot;End import&quot;</span>;
<a name="l00352"></a>00352 }
<a name="l00353"></a>00353 
<a name="l00354"></a>00354 <span class="comment">// Create an XML document from UAVObject database</span>
<a name="l00355"></a>00355 <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> UAVSettingsImportExportFactory::createXMLDocument(<span class="keyword">const</span> <span class="keyword">enum</span> storedData what, <span class="keyword">const</span> <span class="keywordtype">bool</span> fullExport)
<a name="l00356"></a>00356 {
<a name="l00357"></a>00357     <span class="comment">// generate an XML first (used for all export formats as a formatted data source)</span>
<a name="l00358"></a>00358     <a class="code" href="class_extension_system_1_1_plugin_manager.html" title="Core plugin system that manages the plugins, their life cycle and their registered objects...">ExtensionSystem::PluginManager</a> *pm = ExtensionSystem::PluginManager::instance();
<a name="l00359"></a>00359     <a class="code" href="class_u_a_v_object_manager.html">UAVObjectManager</a> *objManager = pm-&gt;getObject&lt;<a class="code" href="class_u_a_v_object_manager.html">UAVObjectManager</a>&gt;();
<a name="l00360"></a>00360 
<a name="l00361"></a>00361     <span class="comment">// create an XML root</span>
<a name="l00362"></a>00362     QDomDocument doc(<span class="stringliteral">&quot;UAVObjects&quot;</span>);
<a name="l00363"></a>00363     QDomElement root = doc.createElement(<span class="stringliteral">&quot;uavobjects&quot;</span>);
<a name="l00364"></a>00364     doc.appendChild(root);
<a name="l00365"></a>00365 
<a name="l00366"></a>00366     <span class="comment">// add hardware, firmware and GCS version info</span>
<a name="l00367"></a>00367     QDomElement versionInfo = doc.createElement(<span class="stringliteral">&quot;version&quot;</span>);
<a name="l00368"></a>00368     root.appendChild(versionInfo);
<a name="l00369"></a>00369 
<a name="l00370"></a>00370     <a class="code" href="class_u_a_v_object_util_manager.html">UAVObjectUtilManager</a> *utilMngr = pm-&gt;getObject&lt;<a class="code" href="class_u_a_v_object_util_manager.html">UAVObjectUtilManager</a>&gt;();
<a name="l00371"></a>00371     <a class="code" href="classdevice_descriptor_struct.html">deviceDescriptorStruct</a> board = utilMngr-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga37ed95a95ca8906a45b06bb7174b1158">getBoardDescriptionStruct</a>();
<a name="l00372"></a>00372 
<a name="l00373"></a>00373     QDomElement hw = doc.createElement(<span class="stringliteral">&quot;hardware&quot;</span>);
<a name="l00374"></a>00374     hw.setAttribute(<span class="stringliteral">&quot;type&quot;</span>, <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a>().setNum(board.boardType, 16));
<a name="l00375"></a>00375     hw.setAttribute(<span class="stringliteral">&quot;revision&quot;</span>, <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a>().setNum(board.boardRevision, 16));
<a name="l00376"></a>00376     hw.setAttribute(<span class="stringliteral">&quot;serial&quot;</span>, <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a>(utilMngr-&gt;<a class="code" href="group___u_a_v_object_util_plugin.html#ga11c8171d7e380e699b4edf9b6860a236">getBoardCPUSerial</a>().toHex()));
<a name="l00377"></a>00377     versionInfo.appendChild(hw);
<a name="l00378"></a>00378 
<a name="l00379"></a>00379     QDomElement fw = doc.createElement(<span class="stringliteral">&quot;firmware&quot;</span>);
<a name="l00380"></a>00380     fw.setAttribute(<span class="stringliteral">&quot;date&quot;</span>, board.gitDate);
<a name="l00381"></a>00381     fw.setAttribute(<span class="stringliteral">&quot;hash&quot;</span>, board.gitHash);
<a name="l00382"></a>00382     fw.setAttribute(<span class="stringliteral">&quot;tag&quot;</span>, board.gitTag);
<a name="l00383"></a>00383     versionInfo.appendChild(fw);
<a name="l00384"></a>00384 
<a name="l00385"></a>00385     <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> gcsRevision = QString::fromLatin1(<a class="code" href="group___core_plugin.html#ga6978a5ac87f3d9dcd891f1be551d3b87">Core::Constants::GCS_REVISION_STR</a>);
<a name="l00386"></a>00386     <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> gcsGitDate = gcsRevision.mid(gcsRevision.indexOf(<span class="stringliteral">&quot; &quot;</span>) + 1, 14);
<a name="l00387"></a>00387     <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> gcsGitHash = gcsRevision.mid(gcsRevision.indexOf(<span class="stringliteral">&quot;:&quot;</span>) + 1, 8);
<a name="l00388"></a>00388     <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> gcsGitTag = gcsRevision.left(gcsRevision.indexOf(<span class="stringliteral">&quot;:&quot;</span>));
<a name="l00389"></a>00389 
<a name="l00390"></a>00390     QDomElement gcs = doc.createElement(<span class="stringliteral">&quot;gcs&quot;</span>);
<a name="l00391"></a>00391     gcs.setAttribute(<span class="stringliteral">&quot;date&quot;</span>, gcsGitDate);
<a name="l00392"></a>00392     gcs.setAttribute(<span class="stringliteral">&quot;hash&quot;</span>, gcsGitHash);
<a name="l00393"></a>00393     gcs.setAttribute(<span class="stringliteral">&quot;tag&quot;</span>, gcsGitTag);
<a name="l00394"></a>00394     versionInfo.appendChild(gcs);
<a name="l00395"></a>00395 
<a name="l00396"></a>00396     <span class="comment">// create settings and/or data elements</span>
<a name="l00397"></a>00397     QDomElement settings = doc.createElement(<span class="stringliteral">&quot;settings&quot;</span>);
<a name="l00398"></a>00398     QDomElement data = doc.createElement(<span class="stringliteral">&quot;data&quot;</span>);
<a name="l00399"></a>00399     QDomElement waypoints = doc.createElement(<span class="stringliteral">&quot;waypoints&quot;</span>);
<a name="l00400"></a>00400 
<a name="l00401"></a>00401     <span class="keywordflow">switch</span> (what)
<a name="l00402"></a>00402     {
<a name="l00403"></a>00403     <span class="keywordflow">case</span> <a class="code" href="class_settings.html">Settings</a>:
<a name="l00404"></a>00404         root.appendChild(settings);
<a name="l00405"></a>00405         <span class="keywordflow">break</span>;
<a name="l00406"></a>00406     <span class="keywordflow">case</span> Data:
<a name="l00407"></a>00407         root.appendChild(data);
<a name="l00408"></a>00408         <span class="keywordflow">break</span>;
<a name="l00409"></a>00409     <span class="keywordflow">case</span> Both:
<a name="l00410"></a>00410         root.appendChild(data);
<a name="l00411"></a>00411         root.appendChild(settings);
<a name="l00412"></a>00412         <span class="keywordflow">break</span>;
<a name="l00413"></a>00413     <span class="keywordflow">case</span> Waypoints:
<a name="l00414"></a>00414         root.appendChild(waypoints);
<a name="l00415"></a>00415         <span class="keywordflow">break</span>;
<a name="l00416"></a>00416     }
<a name="l00417"></a>00417 
<a name="l00418"></a>00418     <span class="keywordflow">switch</span> (what)
<a name="l00419"></a>00419     {
<a name="l00420"></a>00420     <span class="keywordflow">case</span> <a class="code" href="class_settings.html">Settings</a>:
<a name="l00421"></a>00421     <span class="keywordflow">case</span> Data:
<a name="l00422"></a>00422     <span class="keywordflow">case</span> Both:
<a name="l00423"></a>00423     {
<a name="l00424"></a>00424         <span class="comment">// iterate over settings objects</span>
<a name="l00425"></a>00425         QVector&lt; QVector&lt;UAVDataObject*&gt; &gt; objList = objManager-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gaddd03a2027eb1ac4f3208d3fda7e76c9">getDataObjects</a>();
<a name="l00426"></a>00426         <span class="keywordflow">foreach</span> (QVector&lt;UAVDataObject*&gt; list, objList) {
<a name="l00427"></a>00427             <span class="keywordflow">foreach</span> (<a class="code" href="class_u_a_v_data_object.html">UAVDataObject</a> *obj, list) {
<a name="l00428"></a>00428                 <span class="keywordflow">if</span> (((what == <a class="code" href="class_settings.html">Settings</a>) &amp;&amp; obj-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga77932d3af8bd55182bbc39af1f01f447">isSettings</a>()) ||
<a name="l00429"></a>00429                         ((what == Data) &amp;&amp; !obj-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga77932d3af8bd55182bbc39af1f01f447">isSettings</a>()) ||
<a name="l00430"></a>00430                         (what == Both)) {
<a name="l00431"></a>00431 
<a name="l00432"></a>00432                     <span class="comment">// add each object to the XML</span>
<a name="l00433"></a>00433                     QDomElement o = doc.createElement(<span class="stringliteral">&quot;object&quot;</span>);
<a name="l00434"></a>00434                     o.setAttribute(<span class="stringliteral">&quot;name&quot;</span>, obj-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga92eb502fc16ba82b924a430acaa55f46">getName</a>());
<a name="l00435"></a>00435                     o.setAttribute(<span class="stringliteral">&quot;id&quot;</span>, <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a>(<span class="stringliteral">&quot;0x&quot;</span>)+ <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a>().setNum(obj-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gaad45ab83a511083bfe60df0c244e9b88">getObjID</a>(),16).toUpper());
<a name="l00436"></a>00436                     <span class="keywordflow">if</span> (fullExport) {
<a name="l00437"></a>00437                         QDomElement d = doc.createElement(<span class="stringliteral">&quot;description&quot;</span>);
<a name="l00438"></a>00438                         QDomText t = doc.createTextNode(obj-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga319c487a42b628a2e83274c89fa77625">getDescription</a>().remove(<span class="stringliteral">&quot;@Ref &quot;</span>, Qt::CaseInsensitive));
<a name="l00439"></a>00439                         d.appendChild(t);
<a name="l00440"></a>00440                         o.appendChild(d);
<a name="l00441"></a>00441                     }
<a name="l00442"></a>00442 
<a name="l00443"></a>00443                     <span class="comment">// iterate over fields</span>
<a name="l00444"></a>00444                     QList&lt;UAVObjectField*&gt; fieldList = obj-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga043de5085e6ade44abfb005e320d10ca">getFields</a>();
<a name="l00445"></a>00445 
<a name="l00446"></a>00446                     <span class="keywordflow">foreach</span> (<a class="code" href="class_u_a_v_object_field.html">UAVObjectField</a>* field, fieldList) {
<a name="l00447"></a>00447                         QDomElement f = doc.createElement(<span class="stringliteral">&quot;field&quot;</span>);
<a name="l00448"></a>00448 
<a name="l00449"></a>00449                         <span class="comment">// iterate over values</span>
<a name="l00450"></a>00450                         <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> vals;
<a name="l00451"></a>00451                         quint32 nelem = field-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga6c929356a6e66fd7c56e9d547e67ef7c">getNumElements</a>();
<a name="l00452"></a>00452                         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_o_p_plots_8m.html#a1ee0621678c54afffb4b6e50f10c9ab8">n</a> = 0; <a class="code" href="_o_p_plots_8m.html#a1ee0621678c54afffb4b6e50f10c9ab8">n</a> &lt; nelem; ++<a class="code" href="_o_p_plots_8m.html#a1ee0621678c54afffb4b6e50f10c9ab8">n</a>) {
<a name="l00453"></a>00453                             vals.append(<a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a>(<span class="stringliteral">&quot;%1,&quot;</span>).arg(field-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga60a1c56703ea2c28f76d1eaf05554f5e">getValue</a>(<a class="code" href="_o_p_plots_8m.html#a1ee0621678c54afffb4b6e50f10c9ab8">n</a>).toString()));
<a name="l00454"></a>00454                         }
<a name="l00455"></a>00455                         vals.chop(1);
<a name="l00456"></a>00456 
<a name="l00457"></a>00457                         f.setAttribute(<span class="stringliteral">&quot;name&quot;</span>, field-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga86c7c87ecda0ed11b8a2f125b0741bab">getName</a>());
<a name="l00458"></a>00458                         f.setAttribute(<span class="stringliteral">&quot;values&quot;</span>, vals);
<a name="l00459"></a>00459                         <span class="keywordflow">if</span> (fullExport) {
<a name="l00460"></a>00460                             f.setAttribute(<span class="stringliteral">&quot;type&quot;</span>, field-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga53cf1cae78bc619ca91faffedacfc61f">getTypeAsString</a>());
<a name="l00461"></a>00461                             f.setAttribute(<span class="stringliteral">&quot;units&quot;</span>, field-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gabb1e371d4c3d91f70a172d7827db2da8">getUnits</a>());
<a name="l00462"></a>00462                             f.setAttribute(<span class="stringliteral">&quot;elements&quot;</span>, nelem);
<a name="l00463"></a>00463                             <span class="keywordflow">if</span> (field-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gad306893ea1f5623eaa970e35ffa7d901">getType</a>() == <a class="code" href="group___u_a_v_objects_plugin.html#gga74498368bc91f3ed74beacb096744cf3a6b66856b80e5733eb7b8b08f3d870871">UAVObjectField::ENUM</a>) {
<a name="l00464"></a>00464                                 f.setAttribute(<span class="stringliteral">&quot;options&quot;</span>, field-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga23e324a921bdf20972f940b4497a2c21">getOptions</a>().join(<span class="stringliteral">&quot;,&quot;</span>));
<a name="l00465"></a>00465                             }
<a name="l00466"></a>00466                         }
<a name="l00467"></a>00467                         o.appendChild(f);
<a name="l00468"></a>00468                     }
<a name="l00469"></a>00469 
<a name="l00470"></a>00470                     <span class="comment">// append to the settings or data element</span>
<a name="l00471"></a>00471                     <span class="keywordflow">if</span> (obj-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga77932d3af8bd55182bbc39af1f01f447">isSettings</a>())
<a name="l00472"></a>00472                         settings.appendChild(o);
<a name="l00473"></a>00473                     <span class="keywordflow">else</span>
<a name="l00474"></a>00474                         data.appendChild(o);
<a name="l00475"></a>00475                 }
<a name="l00476"></a>00476             }
<a name="l00477"></a>00477         }
<a name="l00478"></a>00478     }
<a name="l00479"></a>00479         <span class="keywordflow">break</span>;
<a name="l00480"></a>00480     <span class="keywordflow">case</span> Waypoints:
<a name="l00481"></a>00481     {
<a name="l00482"></a>00482         <span class="comment">// iterate over waypoints until the first one that is set to Stop</span>
<a name="l00483"></a>00483         QVector&lt;UAVObject*&gt; list = objManager-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga575678dce0852cc3843610477ea587ff">getObjectInstances</a>(<span class="stringliteral">&quot;Waypoint&quot;</span>);
<a name="l00484"></a>00484         <span class="keywordflow">foreach</span> (<a class="code" href="class_u_a_v_object.html">UAVObject</a> *obj, list) {
<a name="l00485"></a>00485             <span class="comment">// add each object to the XML</span>
<a name="l00486"></a>00486             QDomElement o = doc.createElement(<span class="stringliteral">&quot;object&quot;</span>);
<a name="l00487"></a>00487             o.setAttribute(<span class="stringliteral">&quot;name&quot;</span>, obj-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga92eb502fc16ba82b924a430acaa55f46">getName</a>());
<a name="l00488"></a>00488             o.setAttribute(<span class="stringliteral">&quot;id&quot;</span>, <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a>(<span class="stringliteral">&quot;0x&quot;</span>)+ <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a>().setNum(obj-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gaad45ab83a511083bfe60df0c244e9b88">getObjID</a>(),16).toUpper());
<a name="l00489"></a>00489             o.setAttribute(<span class="stringliteral">&quot;instId&quot;</span>,<a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a>().setNum(obj-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gaf465e2bde7a1e41ba94c19eac2ba9b80">getInstID</a>()));
<a name="l00490"></a>00490 
<a name="l00491"></a>00491             <span class="comment">// iterate over fields</span>
<a name="l00492"></a>00492             QList&lt;UAVObjectField*&gt; fieldList = obj-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga043de5085e6ade44abfb005e320d10ca">getFields</a>();
<a name="l00493"></a>00493 
<a name="l00494"></a>00494             <span class="keywordflow">foreach</span> (<a class="code" href="class_u_a_v_object_field.html">UAVObjectField</a>* field, fieldList) {
<a name="l00495"></a>00495                 QDomElement f = doc.createElement(<span class="stringliteral">&quot;field&quot;</span>);
<a name="l00496"></a>00496 
<a name="l00497"></a>00497                 <span class="comment">// iterate over values</span>
<a name="l00498"></a>00498                 <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> vals;
<a name="l00499"></a>00499                 quint32 nelem = field-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga6c929356a6e66fd7c56e9d547e67ef7c">getNumElements</a>();
<a name="l00500"></a>00500                 <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_o_p_plots_8m.html#a1ee0621678c54afffb4b6e50f10c9ab8">n</a> = 0; <a class="code" href="_o_p_plots_8m.html#a1ee0621678c54afffb4b6e50f10c9ab8">n</a> &lt; nelem; ++<a class="code" href="_o_p_plots_8m.html#a1ee0621678c54afffb4b6e50f10c9ab8">n</a>) {
<a name="l00501"></a>00501                     vals.append(<a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a>(<span class="stringliteral">&quot;%1,&quot;</span>).arg(field-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga60a1c56703ea2c28f76d1eaf05554f5e">getValue</a>(<a class="code" href="_o_p_plots_8m.html#a1ee0621678c54afffb4b6e50f10c9ab8">n</a>).toString()));
<a name="l00502"></a>00502                 }
<a name="l00503"></a>00503                 vals.chop(1);
<a name="l00504"></a>00504 
<a name="l00505"></a>00505                 f.setAttribute(<span class="stringliteral">&quot;name&quot;</span>, field-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga86c7c87ecda0ed11b8a2f125b0741bab">getName</a>());
<a name="l00506"></a>00506                 f.setAttribute(<span class="stringliteral">&quot;values&quot;</span>, vals);
<a name="l00507"></a>00507                 <span class="keywordflow">if</span> (fullExport) {
<a name="l00508"></a>00508                     f.setAttribute(<span class="stringliteral">&quot;type&quot;</span>, field-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga53cf1cae78bc619ca91faffedacfc61f">getTypeAsString</a>());
<a name="l00509"></a>00509                     f.setAttribute(<span class="stringliteral">&quot;units&quot;</span>, field-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gabb1e371d4c3d91f70a172d7827db2da8">getUnits</a>());
<a name="l00510"></a>00510                     f.setAttribute(<span class="stringliteral">&quot;elements&quot;</span>, nelem);
<a name="l00511"></a>00511                     <span class="keywordflow">if</span> (field-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#gad306893ea1f5623eaa970e35ffa7d901">getType</a>() == <a class="code" href="group___u_a_v_objects_plugin.html#gga74498368bc91f3ed74beacb096744cf3a6b66856b80e5733eb7b8b08f3d870871">UAVObjectField::ENUM</a>) {
<a name="l00512"></a>00512                         f.setAttribute(<span class="stringliteral">&quot;options&quot;</span>, field-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga23e324a921bdf20972f940b4497a2c21">getOptions</a>().join(<span class="stringliteral">&quot;,&quot;</span>));
<a name="l00513"></a>00513                     }
<a name="l00514"></a>00514                 }
<a name="l00515"></a>00515                 o.appendChild(f);
<a name="l00516"></a>00516             }
<a name="l00517"></a>00517             waypoints.appendChild(o);
<a name="l00518"></a>00518 
<a name="l00519"></a>00519             <span class="comment">// If this waypoint was stop, then don&#39;t add anymore</span>
<a name="l00520"></a>00520             <a class="code" href="class_u_a_v_object_field.html">UAVObjectField</a> *field = obj-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga0c8a0350ce2c49430124b59842fff131">getField</a>(<span class="stringliteral">&quot;Action&quot;</span>);
<a name="l00521"></a>00521             Q_ASSERT(field);
<a name="l00522"></a>00522             <span class="keywordflow">if</span>(field &amp;&amp; field-&gt;<a class="code" href="group___u_a_v_objects_plugin.html#ga60a1c56703ea2c28f76d1eaf05554f5e">getValue</a>().toString().compare(<span class="stringliteral">&quot;Stop&quot;</span>) == 0)
<a name="l00523"></a>00523                 <span class="keywordflow">break</span>;
<a name="l00524"></a>00524 
<a name="l00525"></a>00525         }
<a name="l00526"></a>00526         <span class="keywordflow">break</span>;
<a name="l00527"></a>00527     }
<a name="l00528"></a>00528     }
<a name="l00529"></a>00529 
<a name="l00530"></a>00530     <span class="keywordflow">return</span> doc.toString(4);
<a name="l00531"></a>00531 }
<a name="l00532"></a>00532 
<a name="l00533"></a>00533 <span class="comment">// Slot called by the menu manager on user action</span>
<a name="l00534"></a>00534 <span class="keywordtype">void</span> UAVSettingsImportExportFactory::exportUAVSettings()
<a name="l00535"></a>00535 {
<a name="l00536"></a>00536     <span class="comment">// ask for file name</span>
<a name="l00537"></a>00537     <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> fileName;
<a name="l00538"></a>00538     <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> filters = tr(<span class="stringliteral">&quot;UAVObjects XML files (*.uav)&quot;</span>);
<a name="l00539"></a>00539 
<a name="l00540"></a>00540     fileName = QFileDialog::getSaveFileName(0, tr(<span class="stringliteral">&quot;Save UAVSettings File As&quot;</span>), <span class="stringliteral">&quot;&quot;</span>, filters);
<a name="l00541"></a>00541     <span class="keywordflow">if</span> (fileName.isEmpty()) {
<a name="l00542"></a>00542         <span class="keywordflow">return</span>;
<a name="l00543"></a>00543     }
<a name="l00544"></a>00544 
<a name="l00545"></a>00545     <span class="comment">// If the filename ends with .xml, we will do a full export, otherwise, a simple export</span>
<a name="l00546"></a>00546     <span class="keywordtype">bool</span> fullExport = <span class="keyword">false</span>;
<a name="l00547"></a>00547     <span class="keywordflow">if</span> (fileName.endsWith(<span class="stringliteral">&quot;.xml&quot;</span>)) {
<a name="l00548"></a>00548         fullExport = <span class="keyword">true</span>;
<a name="l00549"></a>00549     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!fileName.endsWith(<span class="stringliteral">&quot;.uav&quot;</span>)) {
<a name="l00550"></a>00550         fileName.append(<span class="stringliteral">&quot;.uav&quot;</span>);
<a name="l00551"></a>00551     }
<a name="l00552"></a>00552 
<a name="l00553"></a>00553     <span class="comment">// generate an XML first (used for all export formats as a formatted data source)</span>
<a name="l00554"></a>00554     <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> xml = createXMLDocument(<a class="code" href="class_settings.html">Settings</a>, fullExport);
<a name="l00555"></a>00555 
<a name="l00556"></a>00556     <span class="comment">// save file</span>
<a name="l00557"></a>00557     QFile <a class="code" href="uavobjecttemplate_8m.html#a97c04efa65bcf0928abf9260bc5cbf46">file</a>(fileName);
<a name="l00558"></a>00558     <span class="keywordflow">if</span> (<a class="code" href="uavobjecttemplate_8m.html#a97c04efa65bcf0928abf9260bc5cbf46">file</a>.open(QIODevice::WriteOnly) &amp;&amp;
<a name="l00559"></a>00559             (<a class="code" href="uavobjecttemplate_8m.html#a97c04efa65bcf0928abf9260bc5cbf46">file</a>.write(xml.toAscii()) != -1)) {
<a name="l00560"></a>00560         <a class="code" href="uavobjecttemplate_8m.html#a97c04efa65bcf0928abf9260bc5cbf46">file</a>.close();
<a name="l00561"></a>00561     } <span class="keywordflow">else</span> {
<a name="l00562"></a>00562         QMessageBox::critical(0,
<a name="l00563"></a>00563                               tr(<span class="stringliteral">&quot;UAV Settings Export&quot;</span>),
<a name="l00564"></a>00564                               tr(<span class="stringliteral">&quot;Unable to save settings: &quot;</span>) + fileName,
<a name="l00565"></a>00565                               QMessageBox::Ok);
<a name="l00566"></a>00566         <span class="keywordflow">return</span>;
<a name="l00567"></a>00567     }
<a name="l00568"></a>00568 
<a name="l00569"></a>00569     QMessageBox msgBox;
<a name="l00570"></a>00570     msgBox.setText(tr(<span class="stringliteral">&quot;Settings saved.&quot;</span>));
<a name="l00571"></a>00571     msgBox.setStandardButtons(QMessageBox::Ok);
<a name="l00572"></a>00572     msgBox.exec();
<a name="l00573"></a>00573 }
<a name="l00574"></a>00574 
<a name="l00575"></a>00575 <span class="comment">// Slot called by the menu manager on user action</span>
<a name="l00576"></a>00576 <span class="keywordtype">void</span> UAVSettingsImportExportFactory::exportUAVData()
<a name="l00577"></a>00577 {
<a name="l00578"></a>00578     <span class="keywordflow">if</span> (QMessageBox::question(0, tr(<span class="stringliteral">&quot;Are you sure?&quot;</span>),
<a name="l00579"></a>00579         tr(<span class="stringliteral">&quot;This option is only useful for passing your current &quot;</span>
<a name="l00580"></a>00580            <span class="stringliteral">&quot;system data to the technical support staff. &quot;</span>
<a name="l00581"></a>00581            <span class="stringliteral">&quot;Do you really want to export?&quot;</span>),
<a name="l00582"></a>00582            QMessageBox::Ok | QMessageBox::Cancel,
<a name="l00583"></a>00583            QMessageBox::Ok) != QMessageBox::Ok) {
<a name="l00584"></a>00584         <span class="keywordflow">return</span>;
<a name="l00585"></a>00585     }
<a name="l00586"></a>00586 
<a name="l00587"></a>00587     <span class="comment">// ask for file name</span>
<a name="l00588"></a>00588     <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> fileName;
<a name="l00589"></a>00589     <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> filters = tr(<span class="stringliteral">&quot;UAVObjects XML files (*.uav)&quot;</span>);
<a name="l00590"></a>00590 
<a name="l00591"></a>00591     fileName = QFileDialog::getSaveFileName(0, tr(<span class="stringliteral">&quot;Save UAVData File As&quot;</span>), <span class="stringliteral">&quot;&quot;</span>, filters);
<a name="l00592"></a>00592     <span class="keywordflow">if</span> (fileName.isEmpty()) {
<a name="l00593"></a>00593         <span class="keywordflow">return</span>;
<a name="l00594"></a>00594     }
<a name="l00595"></a>00595 
<a name="l00596"></a>00596     <span class="comment">// If the filename ends with .xml, we will do a full export, otherwise, a simple export</span>
<a name="l00597"></a>00597     <span class="keywordtype">bool</span> fullExport = <span class="keyword">false</span>;
<a name="l00598"></a>00598     <span class="keywordflow">if</span> (fileName.endsWith(<span class="stringliteral">&quot;.xml&quot;</span>)) {
<a name="l00599"></a>00599         fullExport = <span class="keyword">true</span>;
<a name="l00600"></a>00600     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!fileName.endsWith(<span class="stringliteral">&quot;.uav&quot;</span>)) {
<a name="l00601"></a>00601         fileName.append(<span class="stringliteral">&quot;.uav&quot;</span>);
<a name="l00602"></a>00602     }
<a name="l00603"></a>00603 
<a name="l00604"></a>00604     <span class="comment">// generate an XML first (used for all export formats as a formatted data source)</span>
<a name="l00605"></a>00605     <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> xml = createXMLDocument(Both, fullExport);
<a name="l00606"></a>00606 
<a name="l00607"></a>00607     <span class="comment">// save file</span>
<a name="l00608"></a>00608     QFile <a class="code" href="uavobjecttemplate_8m.html#a97c04efa65bcf0928abf9260bc5cbf46">file</a>(fileName);
<a name="l00609"></a>00609     <span class="keywordflow">if</span> (<a class="code" href="uavobjecttemplate_8m.html#a97c04efa65bcf0928abf9260bc5cbf46">file</a>.open(QIODevice::WriteOnly) &amp;&amp;
<a name="l00610"></a>00610             (<a class="code" href="uavobjecttemplate_8m.html#a97c04efa65bcf0928abf9260bc5cbf46">file</a>.write(xml.toAscii()) != -1)) {
<a name="l00611"></a>00611         <a class="code" href="uavobjecttemplate_8m.html#a97c04efa65bcf0928abf9260bc5cbf46">file</a>.close();
<a name="l00612"></a>00612     } <span class="keywordflow">else</span> {
<a name="l00613"></a>00613         QMessageBox::critical(0,
<a name="l00614"></a>00614                               tr(<span class="stringliteral">&quot;UAV Data Export&quot;</span>),
<a name="l00615"></a>00615                               tr(<span class="stringliteral">&quot;Unable to save data: &quot;</span>) + fileName,
<a name="l00616"></a>00616                               QMessageBox::Ok);
<a name="l00617"></a>00617         <span class="keywordflow">return</span>;
<a name="l00618"></a>00618     }
<a name="l00619"></a>00619 
<a name="l00620"></a>00620     QMessageBox msgBox;
<a name="l00621"></a>00621     msgBox.setText(tr(<span class="stringliteral">&quot;Data saved.&quot;</span>));
<a name="l00622"></a>00622     msgBox.setStandardButtons(QMessageBox::Ok);
<a name="l00623"></a>00623     msgBox.exec();
<a name="l00624"></a>00624 }
<a name="l00625"></a>00625 
<a name="l00629"></a>00629 <span class="keywordtype">void</span> UAVSettingsImportExportFactory::exportWaypoints()
<a name="l00630"></a>00630 {
<a name="l00631"></a>00631 
<a name="l00632"></a>00632     <span class="comment">// ask for file name</span>
<a name="l00633"></a>00633     <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> fileName;
<a name="l00634"></a>00634     <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> filters = tr(<span class="stringliteral">&quot;UAVObjects XML files (*.xml)&quot;</span>);
<a name="l00635"></a>00635 
<a name="l00636"></a>00636     fileName = QFileDialog::getSaveFileName(0, tr(<span class="stringliteral">&quot;Save waypoint File As&quot;</span>), <span class="stringliteral">&quot;&quot;</span>, filters);
<a name="l00637"></a>00637     <span class="keywordflow">if</span> (fileName.isEmpty()) {
<a name="l00638"></a>00638         <span class="keywordflow">return</span>;
<a name="l00639"></a>00639     }
<a name="l00640"></a>00640 
<a name="l00641"></a>00641     <span class="comment">// generate an XML first (used for all export formats as a formatted data source)</span>
<a name="l00642"></a>00642     <a class="code" href="group___u_a_v_objects_plugin.html#gab9d252f49c333c94a72f97ce3105a32d">QString</a> xml = createXMLDocument(Waypoints, <span class="keyword">false</span>);
<a name="l00643"></a>00643 
<a name="l00644"></a>00644     <span class="comment">// save file</span>
<a name="l00645"></a>00645     QFile <a class="code" href="uavobjecttemplate_8m.html#a97c04efa65bcf0928abf9260bc5cbf46">file</a>(fileName);
<a name="l00646"></a>00646     <span class="keywordflow">if</span> (<a class="code" href="uavobjecttemplate_8m.html#a97c04efa65bcf0928abf9260bc5cbf46">file</a>.open(QIODevice::WriteOnly) &amp;&amp;
<a name="l00647"></a>00647             (<a class="code" href="uavobjecttemplate_8m.html#a97c04efa65bcf0928abf9260bc5cbf46">file</a>.write(xml.toAscii()) != -1)) {
<a name="l00648"></a>00648         <a class="code" href="uavobjecttemplate_8m.html#a97c04efa65bcf0928abf9260bc5cbf46">file</a>.close();
<a name="l00649"></a>00649     } <span class="keywordflow">else</span> {
<a name="l00650"></a>00650         QMessageBox::critical(0,
<a name="l00651"></a>00651                               tr(<span class="stringliteral">&quot;UAV Data Export&quot;</span>),
<a name="l00652"></a>00652                               tr(<span class="stringliteral">&quot;Unable to save data: &quot;</span>) + fileName,
<a name="l00653"></a>00653                               QMessageBox::Ok);
<a name="l00654"></a>00654         <span class="keywordflow">return</span>;
<a name="l00655"></a>00655     }
<a name="l00656"></a>00656 
<a name="l00657"></a>00657     QMessageBox msgBox;
<a name="l00658"></a>00658     msgBox.setText(tr(<span class="stringliteral">&quot;Data saved.&quot;</span>));
<a name="l00659"></a>00659     msgBox.setStandardButtons(QMessageBox::Ok);
<a name="l00660"></a>00660     msgBox.exec();
<a name="l00661"></a>00661 }
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="uavsettingsimportexportfactory_8cpp.html">uavsettingsimportexportfactory.cpp</a>      </li>

    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
